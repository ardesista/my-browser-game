var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=(cb,mod)=>function __require(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_global=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/global.js"(exports,module){"use strict";var check=function(it){return it&&it.Math===Math&&it};module.exports=check(typeof globalThis=="object"&&globalThis)||check(typeof window=="object"&&window)||check(typeof self=="object"&&self)||check(typeof global=="object"&&global)||check(typeof exports=="object"&&exports)||function(){return this}()||Function("return this")()}});var require_fails=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/fails.js"(exports,module){"use strict";module.exports=function(exec){try{return!!exec()}catch(error){return true}}}});var require_descriptors=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/descriptors.js"(exports,module){"use strict";var fails=require_fails();module.exports=!fails(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})}});var require_function_bind_native=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/function-bind-native.js"(exports,module){"use strict";var fails=require_fails();module.exports=!fails(function(){var test=function(){}.bind();return typeof test!="function"||test.hasOwnProperty("prototype")})}});var require_function_call=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/function-call.js"(exports,module){"use strict";var NATIVE_BIND=require_function_bind_native();var call=Function.prototype.call;module.exports=NATIVE_BIND?call.bind(call):function(){return call.apply(call,arguments)}}});var require_object_property_is_enumerable=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-property-is-enumerable.js"(exports){"use strict";var $propertyIsEnumerable={}.propertyIsEnumerable;var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var NASHORN_BUG=getOwnPropertyDescriptor&&!$propertyIsEnumerable.call({1:2},1);exports.f=NASHORN_BUG?function propertyIsEnumerable(V){var descriptor=getOwnPropertyDescriptor(this,V);return!!descriptor&&descriptor.enumerable}:$propertyIsEnumerable}});var require_create_property_descriptor=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/create-property-descriptor.js"(exports,module){"use strict";module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}}});var require_function_uncurry_this=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/function-uncurry-this.js"(exports,module){"use strict";var NATIVE_BIND=require_function_bind_native();var FunctionPrototype=Function.prototype;var call=FunctionPrototype.call;var uncurryThisWithBind=NATIVE_BIND&&FunctionPrototype.bind.bind(call,call);module.exports=NATIVE_BIND?uncurryThisWithBind:function(fn){return function(){return call.apply(fn,arguments)}}}});var require_classof_raw=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/classof-raw.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var toString2=uncurryThis({}.toString);var stringSlice=uncurryThis("".slice);module.exports=function(it){return stringSlice(toString2(it),8,-1)}}});var require_indexed_object=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/indexed-object.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var fails=require_fails();var classof=require_classof_raw();var $Object=Object;var split=uncurryThis("".split);module.exports=fails(function(){return!$Object("z").propertyIsEnumerable(0)})?function(it){return classof(it)==="String"?split(it,""):$Object(it)}:$Object}});var require_is_null_or_undefined=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-null-or-undefined.js"(exports,module){"use strict";module.exports=function(it){return it===null||it===void 0}}});var require_require_object_coercible=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/require-object-coercible.js"(exports,module){"use strict";var isNullOrUndefined=require_is_null_or_undefined();var $TypeError=TypeError;module.exports=function(it){if(isNullOrUndefined(it))throw new $TypeError("Can't call method on "+it);return it}}});var require_to_indexed_object=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-indexed-object.js"(exports,module){"use strict";var IndexedObject=require_indexed_object();var requireObjectCoercible=require_require_object_coercible();module.exports=function(it){return IndexedObject(requireObjectCoercible(it))}}});var require_is_callable=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-callable.js"(exports,module){"use strict";var documentAll=typeof document=="object"&&document.all;module.exports=typeof documentAll=="undefined"&&documentAll!==void 0?function(argument){return typeof argument=="function"||argument===documentAll}:function(argument){return typeof argument=="function"}}});var require_is_object=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-object.js"(exports,module){"use strict";var isCallable=require_is_callable();module.exports=function(it){return typeof it=="object"?it!==null:isCallable(it)}}});var require_get_built_in=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/get-built-in.js"(exports,module){"use strict";var global2=require_global();var isCallable=require_is_callable();var aFunction=function(argument){return isCallable(argument)?argument:void 0};module.exports=function(namespace,method){return arguments.length<2?aFunction(global2[namespace]):global2[namespace]&&global2[namespace][method]}}});var require_object_is_prototype_of=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-is-prototype-of.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();module.exports=uncurryThis({}.isPrototypeOf)}});var require_engine_user_agent=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/engine-user-agent.js"(exports,module){"use strict";module.exports=typeof navigator!="undefined"&&String(navigator.userAgent)||""}});var require_engine_v8_version=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/engine-v8-version.js"(exports,module){"use strict";var global2=require_global();var userAgent=require_engine_user_agent();var process=global2.process;var Deno=global2.Deno;var versions=process&&process.versions||Deno&&Deno.version;var v8=versions&&versions.v8;var match;var version2;if(v8){match=v8.split(".");version2=match[0]>0&&match[0]<4?1:+(match[0]+match[1])}if(!version2&&userAgent){match=userAgent.match(/Edge\/(\d+)/);if(!match||match[1]>=74){match=userAgent.match(/Chrome\/(\d+)/);if(match)version2=+match[1]}}module.exports=version2}});var require_symbol_constructor_detection=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/symbol-constructor-detection.js"(exports,module){"use strict";var V8_VERSION=require_engine_v8_version();var fails=require_fails();var global2=require_global();var $String=global2.String;module.exports=!!Object.getOwnPropertySymbols&&!fails(function(){var symbol=Symbol("symbol detection");return!$String(symbol)||!(Object(symbol)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41})}});var require_use_symbol_as_uid=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/use-symbol-as-uid.js"(exports,module){"use strict";var NATIVE_SYMBOL=require_symbol_constructor_detection();module.exports=NATIVE_SYMBOL&&!Symbol.sham&&typeof Symbol.iterator=="symbol"}});var require_is_symbol=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-symbol.js"(exports,module){"use strict";var getBuiltIn=require_get_built_in();var isCallable=require_is_callable();var isPrototypeOf=require_object_is_prototype_of();var USE_SYMBOL_AS_UID=require_use_symbol_as_uid();var $Object=Object;module.exports=USE_SYMBOL_AS_UID?function(it){return typeof it=="symbol"}:function(it){var $Symbol=getBuiltIn("Symbol");return isCallable($Symbol)&&isPrototypeOf($Symbol.prototype,$Object(it))}}});var require_try_to_string=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/try-to-string.js"(exports,module){"use strict";var $String=String;module.exports=function(argument){try{return $String(argument)}catch(error){return"Object"}}}});var require_a_callable=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/a-callable.js"(exports,module){"use strict";var isCallable=require_is_callable();var tryToString=require_try_to_string();var $TypeError=TypeError;module.exports=function(argument){if(isCallable(argument))return argument;throw new $TypeError(tryToString(argument)+" is not a function")}}});var require_get_method=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/get-method.js"(exports,module){"use strict";var aCallable=require_a_callable();var isNullOrUndefined=require_is_null_or_undefined();module.exports=function(V,P){var func=V[P];return isNullOrUndefined(func)?void 0:aCallable(func)}}});var require_ordinary_to_primitive=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/ordinary-to-primitive.js"(exports,module){"use strict";var call=require_function_call();var isCallable=require_is_callable();var isObject=require_is_object();var $TypeError=TypeError;module.exports=function(input,pref){var fn,val;if(pref==="string"&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input)))return val;if(isCallable(fn=input.valueOf)&&!isObject(val=call(fn,input)))return val;if(pref!=="string"&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input)))return val;throw new $TypeError("Can't convert object to primitive value")}}});var require_is_pure=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-pure.js"(exports,module){"use strict";module.exports=false}});var require_define_global_property=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/define-global-property.js"(exports,module){"use strict";var global2=require_global();var defineProperty=Object.defineProperty;module.exports=function(key,value){try{defineProperty(global2,key,{value:value,configurable:true,writable:true})}catch(error){global2[key]=value}return value}}});var require_shared_store=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/shared-store.js"(exports,module){"use strict";var IS_PURE=require_is_pure();var globalThis2=require_global();var defineGlobalProperty=require_define_global_property();var SHARED="__core-js_shared__";var store=module.exports=globalThis2[SHARED]||defineGlobalProperty(SHARED,{});(store.versions||(store.versions=[])).push({version:"3.37.1",mode:IS_PURE?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})}});var require_shared=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/shared.js"(exports,module){"use strict";var store=require_shared_store();module.exports=function(key,value){return store[key]||(store[key]=value||{})}}});var require_to_object=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-object.js"(exports,module){"use strict";var requireObjectCoercible=require_require_object_coercible();var $Object=Object;module.exports=function(argument){return $Object(requireObjectCoercible(argument))}}});var require_has_own_property=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/has-own-property.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var toObject=require_to_object();var hasOwnProperty=uncurryThis({}.hasOwnProperty);module.exports=Object.hasOwn||function hasOwn(it,key){return hasOwnProperty(toObject(it),key)}}});var require_uid=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/uid.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var id=0;var postfix=Math.random();var toString2=uncurryThis(1..toString);module.exports=function(key){return"Symbol("+(key===void 0?"":key)+")_"+toString2(++id+postfix,36)}}});var require_well_known_symbol=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/well-known-symbol.js"(exports,module){"use strict";var global2=require_global();var shared=require_shared();var hasOwn=require_has_own_property();var uid=require_uid();var NATIVE_SYMBOL=require_symbol_constructor_detection();var USE_SYMBOL_AS_UID=require_use_symbol_as_uid();var Symbol2=global2.Symbol;var WellKnownSymbolsStore=shared("wks");var createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol2["for"]||Symbol2:Symbol2&&Symbol2.withoutSetter||uid;module.exports=function(name){if(!hasOwn(WellKnownSymbolsStore,name)){WellKnownSymbolsStore[name]=NATIVE_SYMBOL&&hasOwn(Symbol2,name)?Symbol2[name]:createWellKnownSymbol("Symbol."+name)}return WellKnownSymbolsStore[name]}}});var require_to_primitive=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-primitive.js"(exports,module){"use strict";var call=require_function_call();var isObject=require_is_object();var isSymbol=require_is_symbol();var getMethod=require_get_method();var ordinaryToPrimitive=require_ordinary_to_primitive();var wellKnownSymbol=require_well_known_symbol();var $TypeError=TypeError;var TO_PRIMITIVE=wellKnownSymbol("toPrimitive");module.exports=function(input,pref){if(!isObject(input)||isSymbol(input))return input;var exoticToPrim=getMethod(input,TO_PRIMITIVE);var result;if(exoticToPrim){if(pref===void 0)pref="default";result=call(exoticToPrim,input,pref);if(!isObject(result)||isSymbol(result))return result;throw new $TypeError("Can't convert object to primitive value")}if(pref===void 0)pref="number";return ordinaryToPrimitive(input,pref)}}});var require_to_property_key=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-property-key.js"(exports,module){"use strict";var toPrimitive=require_to_primitive();var isSymbol=require_is_symbol();module.exports=function(argument){var key=toPrimitive(argument,"string");return isSymbol(key)?key:key+""}}});var require_document_create_element=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/document-create-element.js"(exports,module){"use strict";var global2=require_global();var isObject=require_is_object();var document2=global2.document;var EXISTS=isObject(document2)&&isObject(document2.createElement);module.exports=function(it){return EXISTS?document2.createElement(it):{}}}});var require_ie8_dom_define=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/ie8-dom-define.js"(exports,module){"use strict";var DESCRIPTORS=require_descriptors();var fails=require_fails();var createElement=require_document_create_element();module.exports=!DESCRIPTORS&&!fails(function(){return Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a!==7})}});var require_object_get_own_property_descriptor=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-get-own-property-descriptor.js"(exports){"use strict";var DESCRIPTORS=require_descriptors();var call=require_function_call();var propertyIsEnumerableModule=require_object_property_is_enumerable();var createPropertyDescriptor=require_create_property_descriptor();var toIndexedObject=require_to_indexed_object();var toPropertyKey=require_to_property_key();var hasOwn=require_has_own_property();var IE8_DOM_DEFINE=require_ie8_dom_define();var $getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;exports.f=DESCRIPTORS?$getOwnPropertyDescriptor:function getOwnPropertyDescriptor(O,P){O=toIndexedObject(O);P=toPropertyKey(P);if(IE8_DOM_DEFINE)try{return $getOwnPropertyDescriptor(O,P)}catch(error){}if(hasOwn(O,P))return createPropertyDescriptor(!call(propertyIsEnumerableModule.f,O,P),O[P])}}});var require_v8_prototype_define_bug=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/v8-prototype-define-bug.js"(exports,module){"use strict";var DESCRIPTORS=require_descriptors();var fails=require_fails();module.exports=DESCRIPTORS&&fails(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:false}).prototype!==42})}});var require_an_object=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/an-object.js"(exports,module){"use strict";var isObject=require_is_object();var $String=String;var $TypeError=TypeError;module.exports=function(argument){if(isObject(argument))return argument;throw new $TypeError($String(argument)+" is not an object")}}});var require_object_define_property=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-define-property.js"(exports){"use strict";var DESCRIPTORS=require_descriptors();var IE8_DOM_DEFINE=require_ie8_dom_define();var V8_PROTOTYPE_DEFINE_BUG=require_v8_prototype_define_bug();var anObject=require_an_object();var toPropertyKey=require_to_property_key();var $TypeError=TypeError;var $defineProperty=Object.defineProperty;var $getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;var ENUMERABLE="enumerable";var CONFIGURABLE="configurable";var WRITABLE="writable";exports.f=DESCRIPTORS?V8_PROTOTYPE_DEFINE_BUG?function defineProperty(O,P,Attributes){anObject(O);P=toPropertyKey(P);anObject(Attributes);if(typeof O==="function"&&P==="prototype"&&"value"in Attributes&&WRITABLE in Attributes&&!Attributes[WRITABLE]){var current=$getOwnPropertyDescriptor(O,P);if(current&&current[WRITABLE]){O[P]=Attributes.value;Attributes={configurable:CONFIGURABLE in Attributes?Attributes[CONFIGURABLE]:current[CONFIGURABLE],enumerable:ENUMERABLE in Attributes?Attributes[ENUMERABLE]:current[ENUMERABLE],writable:false}}}return $defineProperty(O,P,Attributes)}:$defineProperty:function defineProperty(O,P,Attributes){anObject(O);P=toPropertyKey(P);anObject(Attributes);if(IE8_DOM_DEFINE)try{return $defineProperty(O,P,Attributes)}catch(error){}if("get"in Attributes||"set"in Attributes)throw new $TypeError("Accessors not supported");if("value"in Attributes)O[P]=Attributes.value;return O}}});var require_create_non_enumerable_property=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/create-non-enumerable-property.js"(exports,module){"use strict";var DESCRIPTORS=require_descriptors();var definePropertyModule=require_object_define_property();var createPropertyDescriptor=require_create_property_descriptor();module.exports=DESCRIPTORS?function(object,key,value){return definePropertyModule.f(object,key,createPropertyDescriptor(1,value))}:function(object,key,value){object[key]=value;return object}}});var require_function_name=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/function-name.js"(exports,module){"use strict";var DESCRIPTORS=require_descriptors();var hasOwn=require_has_own_property();var FunctionPrototype=Function.prototype;var getDescriptor=DESCRIPTORS&&Object.getOwnPropertyDescriptor;var EXISTS=hasOwn(FunctionPrototype,"name");var PROPER=EXISTS&&function something(){}.name==="something";var CONFIGURABLE=EXISTS&&(!DESCRIPTORS||DESCRIPTORS&&getDescriptor(FunctionPrototype,"name").configurable);module.exports={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE}}});var require_inspect_source=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/inspect-source.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var isCallable=require_is_callable();var store=require_shared_store();var functionToString=uncurryThis(Function.toString);if(!isCallable(store.inspectSource)){store.inspectSource=function(it){return functionToString(it)}}module.exports=store.inspectSource}});var require_weak_map_basic_detection=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/weak-map-basic-detection.js"(exports,module){"use strict";var global2=require_global();var isCallable=require_is_callable();var WeakMap=global2.WeakMap;module.exports=isCallable(WeakMap)&&/native code/.test(String(WeakMap))}});var require_shared_key=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/shared-key.js"(exports,module){"use strict";var shared=require_shared();var uid=require_uid();var keys=shared("keys");module.exports=function(key){return keys[key]||(keys[key]=uid(key))}}});var require_hidden_keys=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/hidden-keys.js"(exports,module){"use strict";module.exports={}}});var require_internal_state=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/internal-state.js"(exports,module){"use strict";var NATIVE_WEAK_MAP=require_weak_map_basic_detection();var global2=require_global();var isObject=require_is_object();var createNonEnumerableProperty=require_create_non_enumerable_property();var hasOwn=require_has_own_property();var shared=require_shared_store();var sharedKey=require_shared_key();var hiddenKeys=require_hidden_keys();var OBJECT_ALREADY_INITIALIZED="Object already initialized";var TypeError2=global2.TypeError;var WeakMap=global2.WeakMap;var set;var get2;var has;var enforce=function(it){return has(it)?get2(it):set(it,{})};var getterFor=function(TYPE){return function(it){var state2;if(!isObject(it)||(state2=get2(it)).type!==TYPE){throw new TypeError2("Incompatible receiver, "+TYPE+" required")}return state2}};if(NATIVE_WEAK_MAP||shared.state){store=shared.state||(shared.state=new WeakMap);store.get=store.get;store.has=store.has;store.set=store.set;set=function(it,metadata){if(store.has(it))throw new TypeError2(OBJECT_ALREADY_INITIALIZED);metadata.facade=it;store.set(it,metadata);return metadata};get2=function(it){return store.get(it)||{}};has=function(it){return store.has(it)}}else{STATE=sharedKey("state");hiddenKeys[STATE]=true;set=function(it,metadata){if(hasOwn(it,STATE))throw new TypeError2(OBJECT_ALREADY_INITIALIZED);metadata.facade=it;createNonEnumerableProperty(it,STATE,metadata);return metadata};get2=function(it){return hasOwn(it,STATE)?it[STATE]:{}};has=function(it){return hasOwn(it,STATE)}}var store;var STATE;module.exports={set:set,get:get2,has:has,enforce:enforce,getterFor:getterFor}}});var require_make_built_in=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/make-built-in.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var fails=require_fails();var isCallable=require_is_callable();var hasOwn=require_has_own_property();var DESCRIPTORS=require_descriptors();var CONFIGURABLE_FUNCTION_NAME=require_function_name().CONFIGURABLE;var inspectSource=require_inspect_source();var InternalStateModule=require_internal_state();var enforceInternalState=InternalStateModule.enforce;var getInternalState=InternalStateModule.get;var $String=String;var defineProperty=Object.defineProperty;var stringSlice=uncurryThis("".slice);var replace=uncurryThis("".replace);var join=uncurryThis([].join);var CONFIGURABLE_LENGTH=DESCRIPTORS&&!fails(function(){return defineProperty(function(){},"length",{value:8}).length!==8});var TEMPLATE=String(String).split("String");var makeBuiltIn=module.exports=function(value,name,options){if(stringSlice($String(name),0,7)==="Symbol("){name="["+replace($String(name),/^Symbol\(([^)]*)\).*$/,"$1")+"]"}if(options&&options.getter)name="get "+name;if(options&&options.setter)name="set "+name;if(!hasOwn(value,"name")||CONFIGURABLE_FUNCTION_NAME&&value.name!==name){if(DESCRIPTORS)defineProperty(value,"name",{value:name,configurable:true});else value.name=name}if(CONFIGURABLE_LENGTH&&options&&hasOwn(options,"arity")&&value.length!==options.arity){defineProperty(value,"length",{value:options.arity})}try{if(options&&hasOwn(options,"constructor")&&options.constructor){if(DESCRIPTORS)defineProperty(value,"prototype",{writable:false})}else if(value.prototype)value.prototype=void 0}catch(error){}var state2=enforceInternalState(value);if(!hasOwn(state2,"source")){state2.source=join(TEMPLATE,typeof name=="string"?name:"")}return value};Function.prototype.toString=makeBuiltIn(function toString2(){return isCallable(this)&&getInternalState(this).source||inspectSource(this)},"toString")}});var require_define_built_in=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/define-built-in.js"(exports,module){"use strict";var isCallable=require_is_callable();var definePropertyModule=require_object_define_property();var makeBuiltIn=require_make_built_in();var defineGlobalProperty=require_define_global_property();module.exports=function(O,key,value,options){if(!options)options={};var simple=options.enumerable;var name=options.name!==void 0?options.name:key;if(isCallable(value))makeBuiltIn(value,name,options);if(options.global){if(simple)O[key]=value;else defineGlobalProperty(key,value)}else{try{if(!options.unsafe)delete O[key];else if(O[key])simple=true}catch(error){}if(simple)O[key]=value;else definePropertyModule.f(O,key,{value:value,enumerable:false,configurable:!options.nonConfigurable,writable:!options.nonWritable})}return O}}});var require_math_trunc=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/math-trunc.js"(exports,module){"use strict";var ceil=Math.ceil;var floor=Math.floor;module.exports=Math.trunc||function trunc(x){var n=+x;return(n>0?floor:ceil)(n)}}});var require_to_integer_or_infinity=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-integer-or-infinity.js"(exports,module){"use strict";var trunc=require_math_trunc();module.exports=function(argument){var number=+argument;return number!==number||number===0?0:trunc(number)}}});var require_to_absolute_index=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-absolute-index.js"(exports,module){"use strict";var toIntegerOrInfinity=require_to_integer_or_infinity();var max=Math.max;var min=Math.min;module.exports=function(index,length){var integer=toIntegerOrInfinity(index);return integer<0?max(integer+length,0):min(integer,length)}}});var require_to_length=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-length.js"(exports,module){"use strict";var toIntegerOrInfinity=require_to_integer_or_infinity();var min=Math.min;module.exports=function(argument){var len=toIntegerOrInfinity(argument);return len>0?min(len,9007199254740991):0}}});var require_length_of_array_like=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/length-of-array-like.js"(exports,module){"use strict";var toLength=require_to_length();module.exports=function(obj){return toLength(obj.length)}}});var require_array_includes=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/array-includes.js"(exports,module){"use strict";var toIndexedObject=require_to_indexed_object();var toAbsoluteIndex=require_to_absolute_index();var lengthOfArrayLike=require_length_of_array_like();var createMethod=function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIndexedObject($this);var length=lengthOfArrayLike(O);if(length===0)return!IS_INCLUDES&&-1;var index=toAbsoluteIndex(fromIndex,length);var value;if(IS_INCLUDES&&el!==el)while(length>index){value=O[index++];if(value!==value)return true}else for(;length>index;index++){if((IS_INCLUDES||index in O)&&O[index]===el)return IS_INCLUDES||index||0}return!IS_INCLUDES&&-1}};module.exports={includes:createMethod(true),indexOf:createMethod(false)}}});var require_object_keys_internal=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-keys-internal.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var hasOwn=require_has_own_property();var toIndexedObject=require_to_indexed_object();var indexOf=require_array_includes().indexOf;var hiddenKeys=require_hidden_keys();var push=uncurryThis([].push);module.exports=function(object,names){var O=toIndexedObject(object);var i=0;var result=[];var key;for(key in O)!hasOwn(hiddenKeys,key)&&hasOwn(O,key)&&push(result,key);while(names.length>i)if(hasOwn(O,key=names[i++])){~indexOf(result,key)||push(result,key)}return result}}});var require_enum_bug_keys=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/enum-bug-keys.js"(exports,module){"use strict";module.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]}});var require_object_get_own_property_names=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-get-own-property-names.js"(exports){"use strict";var internalObjectKeys=require_object_keys_internal();var enumBugKeys=require_enum_bug_keys();var hiddenKeys=enumBugKeys.concat("length","prototype");exports.f=Object.getOwnPropertyNames||function getOwnPropertyNames(O){return internalObjectKeys(O,hiddenKeys)}}});var require_object_get_own_property_symbols=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/object-get-own-property-symbols.js"(exports){"use strict";exports.f=Object.getOwnPropertySymbols}});var require_own_keys=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/own-keys.js"(exports,module){"use strict";var getBuiltIn=require_get_built_in();var uncurryThis=require_function_uncurry_this();var getOwnPropertyNamesModule=require_object_get_own_property_names();var getOwnPropertySymbolsModule=require_object_get_own_property_symbols();var anObject=require_an_object();var concat=uncurryThis([].concat);module.exports=getBuiltIn("Reflect","ownKeys")||function ownKeys(it){var keys=getOwnPropertyNamesModule.f(anObject(it));var getOwnPropertySymbols=getOwnPropertySymbolsModule.f;return getOwnPropertySymbols?concat(keys,getOwnPropertySymbols(it)):keys}}});var require_copy_constructor_properties=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/copy-constructor-properties.js"(exports,module){"use strict";var hasOwn=require_has_own_property();var ownKeys=require_own_keys();var getOwnPropertyDescriptorModule=require_object_get_own_property_descriptor();var definePropertyModule=require_object_define_property();module.exports=function(target,source,exceptions){var keys=ownKeys(source);var defineProperty=definePropertyModule.f;var getOwnPropertyDescriptor=getOwnPropertyDescriptorModule.f;for(var i=0;i<keys.length;i++){var key=keys[i];if(!hasOwn(target,key)&&!(exceptions&&hasOwn(exceptions,key))){defineProperty(target,key,getOwnPropertyDescriptor(source,key))}}}}});var require_is_forced=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/is-forced.js"(exports,module){"use strict";var fails=require_fails();var isCallable=require_is_callable();var replacement=/#|\.prototype\./;var isForced=function(feature,detection){var value=data2[normalize2(feature)];return value===POLYFILL?true:value===NATIVE?false:isCallable(detection)?fails(detection):!!detection};var normalize2=isForced.normalize=function(string){return String(string).replace(replacement,".").toLowerCase()};var data2=isForced.data={};var NATIVE=isForced.NATIVE="N";var POLYFILL=isForced.POLYFILL="P";module.exports=isForced}});var require_export=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/export.js"(exports,module){"use strict";var global2=require_global();var getOwnPropertyDescriptor=require_object_get_own_property_descriptor().f;var createNonEnumerableProperty=require_create_non_enumerable_property();var defineBuiltIn=require_define_built_in();var defineGlobalProperty=require_define_global_property();var copyConstructorProperties=require_copy_constructor_properties();var isForced=require_is_forced();module.exports=function(options,source){var TARGET=options.target;var GLOBAL=options.global;var STATIC=options.stat;var FORCED,target,key,targetProperty,sourceProperty,descriptor;if(GLOBAL){target=global2}else if(STATIC){target=global2[TARGET]||defineGlobalProperty(TARGET,{})}else{target=global2[TARGET]&&global2[TARGET].prototype}if(target)for(key in source){sourceProperty=source[key];if(options.dontCallGetSet){descriptor=getOwnPropertyDescriptor(target,key);targetProperty=descriptor&&descriptor.value}else targetProperty=target[key];FORCED=isForced(GLOBAL?key:TARGET+(STATIC?".":"#")+key,options.forced);if(!FORCED&&targetProperty!==void 0){if(typeof sourceProperty==typeof targetProperty)continue;copyConstructorProperties(sourceProperty,targetProperty)}if(options.sham||targetProperty&&targetProperty.sham){createNonEnumerableProperty(sourceProperty,"sham",true)}defineBuiltIn(target,key,sourceProperty,options)}}}});var require_es_global_this=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/es.global-this.js"(){"use strict";var $=require_export();var global2=require_global();$({global:true,forced:global2.globalThis!==global2},{globalThis:global2})}});var require_esnext_global_this=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/esnext.global-this.js"(){"use strict";require_es_global_this()}});var require_global_this=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/proposals/global-this.js"(exports,module){"use strict";require_esnext_global_this();var global2=require_global();module.exports=global2}});var require_to_string_tag_support=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-string-tag-support.js"(exports,module){"use strict";var wellKnownSymbol=require_well_known_symbol();var TO_STRING_TAG=wellKnownSymbol("toStringTag");var test={};test[TO_STRING_TAG]="z";module.exports=String(test)==="[object z]"}});var require_classof=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/classof.js"(exports,module){"use strict";var TO_STRING_TAG_SUPPORT=require_to_string_tag_support();var isCallable=require_is_callable();var classofRaw=require_classof_raw();var wellKnownSymbol=require_well_known_symbol();var TO_STRING_TAG=wellKnownSymbol("toStringTag");var $Object=Object;var CORRECT_ARGUMENTS=classofRaw(function(){return arguments}())==="Arguments";var tryGet=function(it,key){try{return it[key]}catch(error){}};module.exports=TO_STRING_TAG_SUPPORT?classofRaw:function(it){var O,tag,result;return it===void 0?"Undefined":it===null?"Null":typeof(tag=tryGet(O=$Object(it),TO_STRING_TAG))=="string"?tag:CORRECT_ARGUMENTS?classofRaw(O):(result=classofRaw(O))==="Object"&&isCallable(O.callee)?"Arguments":result}}});var require_to_string=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/to-string.js"(exports,module){"use strict";var classof=require_classof();var $String=String;module.exports=function(argument){if(classof(argument)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $String(argument)}}});var require_whitespaces=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/whitespaces.js"(exports,module){"use strict";module.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"}});var require_string_trim=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/string-trim.js"(exports,module){"use strict";var uncurryThis=require_function_uncurry_this();var requireObjectCoercible=require_require_object_coercible();var toString2=require_to_string();var whitespaces=require_whitespaces();var replace=uncurryThis("".replace);var ltrim=RegExp("^["+whitespaces+"]+");var rtrim=RegExp("(^|[^"+whitespaces+"])["+whitespaces+"]+$");var createMethod=function(TYPE){return function($this){var string=toString2(requireObjectCoercible($this));if(TYPE&1)string=replace(string,ltrim,"");if(TYPE&2)string=replace(string,rtrim,"$1");return string}};module.exports={start:createMethod(1),end:createMethod(2),trim:createMethod(3)}}});var require_string_trim_forced=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/string-trim-forced.js"(exports,module){"use strict";var PROPER_FUNCTION_NAME=require_function_name().PROPER;var fails=require_fails();var whitespaces=require_whitespaces();var non="​᠎";module.exports=function(METHOD_NAME){return fails(function(){return!!whitespaces[METHOD_NAME]()||non[METHOD_NAME]()!==non||PROPER_FUNCTION_NAME&&whitespaces[METHOD_NAME].name!==METHOD_NAME})}}});var require_string_trim_start=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/string-trim-start.js"(exports,module){"use strict";var $trimStart=require_string_trim().start;var forcedStringTrimMethod=require_string_trim_forced();module.exports=forcedStringTrimMethod("trimStart")?function trimStart(){return $trimStart(this)}:"".trimStart}});var require_es_string_trim_left=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/es.string.trim-left.js"(){"use strict";var $=require_export();var trimStart=require_string_trim_start();$({target:"String",proto:true,name:"trimStart",forced:"".trimLeft!==trimStart},{trimLeft:trimStart})}});var require_es_string_trim_start=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/es.string.trim-start.js"(){"use strict";require_es_string_trim_left();var $=require_export();var trimStart=require_string_trim_start();$({target:"String",proto:true,name:"trimStart",forced:"".trimStart!==trimStart},{trimStart:trimStart})}});var require_entry_unbind=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/entry-unbind.js"(exports,module){"use strict";var global2=require_global();var uncurryThis=require_function_uncurry_this();module.exports=function(CONSTRUCTOR,METHOD){return uncurryThis(global2[CONSTRUCTOR].prototype[METHOD])}}});var require_trim_start=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/es/string/trim-start.js"(exports,module){"use strict";require_es_string_trim_start();var entryUnbind=require_entry_unbind();module.exports=entryUnbind("String","trimLeft")}});var require_string_trim_end=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/internals/string-trim-end.js"(exports,module){"use strict";var $trimEnd=require_string_trim().end;var forcedStringTrimMethod=require_string_trim_forced();module.exports=forcedStringTrimMethod("trimEnd")?function trimEnd(){return $trimEnd(this)}:"".trimEnd}});var require_es_string_trim_right=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/es.string.trim-right.js"(){"use strict";var $=require_export();var trimEnd=require_string_trim_end();$({target:"String",proto:true,name:"trimEnd",forced:"".trimRight!==trimEnd},{trimRight:trimEnd})}});var require_es_string_trim_end=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/modules/es.string.trim-end.js"(){"use strict";require_es_string_trim_right();var $=require_export();var trimEnd=require_string_trim_end();$({target:"String",proto:true,name:"trimEnd",forced:"".trimEnd!==trimEnd},{trimEnd:trimEnd})}});var require_trim_end=__commonJS({"../../node_modules/.pnpm/core-js@3.37.1/node_modules/core-js/es/string/trim-end.js"(exports,module){"use strict";require_es_string_trim_end();var entryUnbind=require_entry_unbind();module.exports=entryUnbind("String","trimRight")}});var require_howler=__commonJS({"../../node_modules/.pnpm/howler@2.2.4/node_modules/howler/dist/howler.js"(exports){(function(){"use strict";var HowlerGlobal2=function(){this.init()};HowlerGlobal2.prototype={init:function(){var self2=this||Howler3;self2._counter=1e3;self2._html5AudioPool=[];self2.html5PoolSize=10;self2._codecs={};self2._howls=[];self2._muted=false;self2._volume=1;self2._canPlayEvent="canplaythrough";self2._navigator=typeof window!=="undefined"&&window.navigator?window.navigator:null;self2.masterGain=null;self2.noAudio=false;self2.usingWebAudio=true;self2.autoSuspend=true;self2.ctx=null;self2.autoUnlock=true;self2._setup();return self2},volume:function(vol){var self2=this||Howler3;vol=parseFloat(vol);if(!self2.ctx){setupAudioContext()}if(typeof vol!=="undefined"&&vol>=0&&vol<=1){self2._volume=vol;if(self2._muted){return self2}if(self2.usingWebAudio){self2.masterGain.gain.setValueAtTime(vol,Howler3.ctx.currentTime)}for(var i=0;i<self2._howls.length;i++){if(!self2._howls[i]._webAudio){var ids=self2._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound2=self2._howls[i]._soundById(ids[j]);if(sound2&&sound2._node){sound2._node.volume=sound2._volume*vol}}}}return self2}return self2._volume},mute:function(muted2){var self2=this||Howler3;if(!self2.ctx){setupAudioContext()}self2._muted=muted2;if(self2.usingWebAudio){self2.masterGain.gain.setValueAtTime(muted2?0:self2._volume,Howler3.ctx.currentTime)}for(var i=0;i<self2._howls.length;i++){if(!self2._howls[i]._webAudio){var ids=self2._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound2=self2._howls[i]._soundById(ids[j]);if(sound2&&sound2._node){sound2._node.muted=muted2?true:sound2._muted}}}}return self2},stop:function(){var self2=this||Howler3;for(var i=0;i<self2._howls.length;i++){self2._howls[i].stop()}return self2},unload:function(){var self2=this||Howler3;for(var i=self2._howls.length-1;i>=0;i--){self2._howls[i].unload()}if(self2.usingWebAudio&&self2.ctx&&typeof self2.ctx.close!=="undefined"){self2.ctx.close();self2.ctx=null;setupAudioContext()}return self2},codecs:function(ext){return(this||Howler3)._codecs[ext.replace(/^x-/,"")]},_setup:function(){var self2=this||Howler3;self2.state=self2.ctx?self2.ctx.state||"suspended":"suspended";self2._autoSuspend();if(!self2.usingWebAudio){if(typeof Audio!=="undefined"){try{var test=new Audio;if(typeof test.oncanplaythrough==="undefined"){self2._canPlayEvent="canplay"}}catch(e){self2.noAudio=true}}else{self2.noAudio=true}}try{var test=new Audio;if(test.muted){self2.noAudio=true}}catch(e){}if(!self2.noAudio){self2._setupCodecs()}return self2},_setupCodecs:function(){var self2=this||Howler3;var audioTest=null;try{audioTest=typeof Audio!=="undefined"?new Audio:null}catch(err){return self2}if(!audioTest||typeof audioTest.canPlayType!=="function"){return self2}var mpegTest=audioTest.canPlayType("audio/mpeg;").replace(/^no$/,"");var ua2=self2._navigator?self2._navigator.userAgent:"";var checkOpera=ua2.match(/OPR\/(\d+)/g);var isOldOpera=checkOpera&&parseInt(checkOpera[0].split("/")[1],10)<33;var checkSafari=ua2.indexOf("Safari")!==-1&&ua2.indexOf("Chrome")===-1;var safariVersion=ua2.match(/Version\/(.*?) /);var isOldSafari=checkSafari&&safariVersion&&parseInt(safariVersion[1],10)<15;self2._codecs={mp3:!!(!isOldOpera&&(mpegTest||audioTest.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!mpegTest,opus:!!audioTest.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!audioTest.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(audioTest.canPlayType('audio/wav; codecs="1"')||audioTest.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!audioTest.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!audioTest.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(audioTest.canPlayType("audio/x-m4a;")||audioTest.canPlayType("audio/m4a;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(audioTest.canPlayType("audio/x-m4b;")||audioTest.canPlayType("audio/m4b;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(audioTest.canPlayType("audio/x-mp4;")||audioTest.canPlayType("audio/mp4;")||audioTest.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!isOldSafari&&audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!isOldSafari&&audioTest.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!audioTest.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(audioTest.canPlayType("audio/x-flac;")||audioTest.canPlayType("audio/flac;")).replace(/^no$/,"")};return self2},_unlockAudio:function(){var self2=this||Howler3;if(self2._audioUnlocked||!self2.ctx){return}self2._audioUnlocked=false;self2.autoUnlock=false;if(!self2._mobileUnloaded&&self2.ctx.sampleRate!==44100){self2._mobileUnloaded=true;self2.unload()}self2._scratchBuffer=self2.ctx.createBuffer(1,1,22050);var unlock=function(e){while(self2._html5AudioPool.length<self2.html5PoolSize){try{var audioNode=new Audio;audioNode._unlocked=true;self2._releaseHtml5Audio(audioNode)}catch(e2){self2.noAudio=true;break}}for(var i=0;i<self2._howls.length;i++){if(!self2._howls[i]._webAudio){var ids=self2._howls[i]._getSoundIds();for(var j=0;j<ids.length;j++){var sound2=self2._howls[i]._soundById(ids[j]);if(sound2&&sound2._node&&!sound2._node._unlocked){sound2._node._unlocked=true;sound2._node.load()}}}}self2._autoResume();var source=self2.ctx.createBufferSource();source.buffer=self2._scratchBuffer;source.connect(self2.ctx.destination);if(typeof source.start==="undefined"){source.noteOn(0)}else{source.start(0)}if(typeof self2.ctx.resume==="function"){self2.ctx.resume()}source.onended=function(){source.disconnect(0);self2._audioUnlocked=true;document.removeEventListener("touchstart",unlock,true);document.removeEventListener("touchend",unlock,true);document.removeEventListener("click",unlock,true);document.removeEventListener("keydown",unlock,true);for(var i2=0;i2<self2._howls.length;i2++){self2._howls[i2]._emit("unlock")}}};document.addEventListener("touchstart",unlock,true);document.addEventListener("touchend",unlock,true);document.addEventListener("click",unlock,true);document.addEventListener("keydown",unlock,true);return self2},_obtainHtml5Audio:function(){var self2=this||Howler3;if(self2._html5AudioPool.length){return self2._html5AudioPool.pop()}var testPlay=(new Audio).play();if(testPlay&&typeof Promise!=="undefined"&&(testPlay instanceof Promise||typeof testPlay.then==="function")){testPlay.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})}return new Audio},_releaseHtml5Audio:function(audio){var self2=this||Howler3;if(audio._unlocked){self2._html5AudioPool.push(audio)}return self2},_autoSuspend:function(){var self2=this;if(!self2.autoSuspend||!self2.ctx||typeof self2.ctx.suspend==="undefined"||!Howler3.usingWebAudio){return}for(var i=0;i<self2._howls.length;i++){if(self2._howls[i]._webAudio){for(var j=0;j<self2._howls[i]._sounds.length;j++){if(!self2._howls[i]._sounds[j]._paused){return self2}}}}if(self2._suspendTimer){clearTimeout(self2._suspendTimer)}self2._suspendTimer=setTimeout(function(){if(!self2.autoSuspend){return}self2._suspendTimer=null;self2.state="suspending";var handleSuspension=function(){self2.state="suspended";if(self2._resumeAfterSuspend){delete self2._resumeAfterSuspend;self2._autoResume()}};self2.ctx.suspend().then(handleSuspension,handleSuspension)},3e4);return self2},_autoResume:function(){var self2=this;if(!self2.ctx||typeof self2.ctx.resume==="undefined"||!Howler3.usingWebAudio){return}if(self2.state==="running"&&self2.ctx.state!=="interrupted"&&self2._suspendTimer){clearTimeout(self2._suspendTimer);self2._suspendTimer=null}else if(self2.state==="suspended"||self2.state==="running"&&self2.ctx.state==="interrupted"){self2.ctx.resume().then(function(){self2.state="running";for(var i=0;i<self2._howls.length;i++){self2._howls[i]._emit("resume")}});if(self2._suspendTimer){clearTimeout(self2._suspendTimer);self2._suspendTimer=null}}else if(self2.state==="suspending"){self2._resumeAfterSuspend=true}return self2}};var Howler3=new HowlerGlobal2;var Howl3=function(o){var self2=this;if(!o.src||o.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}self2.init(o)};Howl3.prototype={init:function(o){var self2=this;if(!Howler3.ctx){setupAudioContext()}self2._autoplay=o.autoplay||false;self2._format=typeof o.format!=="string"?o.format:[o.format];self2._html5=o.html5||false;self2._muted=o.mute||false;self2._loop=o.loop||false;self2._pool=o.pool||5;self2._preload=typeof o.preload==="boolean"||o.preload==="metadata"?o.preload:true;self2._rate=o.rate||1;self2._sprite=o.sprite||{};self2._src=typeof o.src!=="string"?o.src:[o.src];self2._volume=o.volume!==void 0?o.volume:1;self2._xhr={method:o.xhr&&o.xhr.method?o.xhr.method:"GET",headers:o.xhr&&o.xhr.headers?o.xhr.headers:null,withCredentials:o.xhr&&o.xhr.withCredentials?o.xhr.withCredentials:false};self2._duration=0;self2._state="unloaded";self2._sounds=[];self2._endTimers={};self2._queue=[];self2._playLock=false;self2._onend=o.onend?[{fn:o.onend}]:[];self2._onfade=o.onfade?[{fn:o.onfade}]:[];self2._onload=o.onload?[{fn:o.onload}]:[];self2._onloaderror=o.onloaderror?[{fn:o.onloaderror}]:[];self2._onplayerror=o.onplayerror?[{fn:o.onplayerror}]:[];self2._onpause=o.onpause?[{fn:o.onpause}]:[];self2._onplay=o.onplay?[{fn:o.onplay}]:[];self2._onstop=o.onstop?[{fn:o.onstop}]:[];self2._onmute=o.onmute?[{fn:o.onmute}]:[];self2._onvolume=o.onvolume?[{fn:o.onvolume}]:[];self2._onrate=o.onrate?[{fn:o.onrate}]:[];self2._onseek=o.onseek?[{fn:o.onseek}]:[];self2._onunlock=o.onunlock?[{fn:o.onunlock}]:[];self2._onresume=[];self2._webAudio=Howler3.usingWebAudio&&!self2._html5;if(typeof Howler3.ctx!=="undefined"&&Howler3.ctx&&Howler3.autoUnlock){Howler3._unlockAudio()}Howler3._howls.push(self2);if(self2._autoplay){self2._queue.push({event:"play",action:function(){self2.play()}})}if(self2._preload&&self2._preload!=="none"){self2.load()}return self2},load:function(){var self2=this;var url=null;if(Howler3.noAudio){self2._emit("loaderror",null,"No audio support.");return}if(typeof self2._src==="string"){self2._src=[self2._src]}for(var i=0;i<self2._src.length;i++){var ext,str;if(self2._format&&self2._format[i]){ext=self2._format[i]}else{str=self2._src[i];if(typeof str!=="string"){self2._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}ext=/^data:audio\/([^;,]+);/i.exec(str);if(!ext){ext=/\.([^.]+)$/.exec(str.split("?",1)[0])}if(ext){ext=ext[1].toLowerCase()}}if(!ext){console.warn('No file extension was found. Consider using the "format" property or specify an extension.')}if(ext&&Howler3.codecs(ext)){url=self2._src[i];break}}if(!url){self2._emit("loaderror",null,"No codec support for selected audio sources.");return}self2._src=url;self2._state="loading";if(window.location.protocol==="https:"&&url.slice(0,5)==="http:"){self2._html5=true;self2._webAudio=false}new Sound2(self2);if(self2._webAudio){loadBuffer(self2)}return self2},play:function(sprite,internal){var self2=this;var id=null;if(typeof sprite==="number"){id=sprite;sprite=null}else if(typeof sprite==="string"&&self2._state==="loaded"&&!self2._sprite[sprite]){return null}else if(typeof sprite==="undefined"){sprite="__default";if(!self2._playLock){var num=0;for(var i=0;i<self2._sounds.length;i++){if(self2._sounds[i]._paused&&!self2._sounds[i]._ended){num++;id=self2._sounds[i]._id}}if(num===1){sprite=null}else{id=null}}}var sound2=id?self2._soundById(id):self2._inactiveSound();if(!sound2){return null}if(id&&!sprite){sprite=sound2._sprite||"__default"}if(self2._state!=="loaded"){sound2._sprite=sprite;sound2._ended=false;var soundId=sound2._id;self2._queue.push({event:"play",action:function(){self2.play(soundId)}});return soundId}if(id&&!sound2._paused){if(!internal){self2._loadQueue("play")}return sound2._id}if(self2._webAudio){Howler3._autoResume()}var seek2=Math.max(0,sound2._seek>0?sound2._seek:self2._sprite[sprite][0]/1e3);var duration=Math.max(0,(self2._sprite[sprite][0]+self2._sprite[sprite][1])/1e3-seek2);var timeout=duration*1e3/Math.abs(sound2._rate);var start=self2._sprite[sprite][0]/1e3;var stop2=(self2._sprite[sprite][0]+self2._sprite[sprite][1])/1e3;sound2._sprite=sprite;sound2._ended=false;var setParams=function(){sound2._paused=false;sound2._seek=seek2;sound2._start=start;sound2._stop=stop2;sound2._loop=!!(sound2._loop||self2._sprite[sprite][2])};if(seek2>=stop2){self2._ended(sound2);return}var node=sound2._node;if(self2._webAudio){var playWebAudio=function(){self2._playLock=false;setParams();self2._refreshBuffer(sound2);var vol=sound2._muted||self2._muted?0:sound2._volume;node.gain.setValueAtTime(vol,Howler3.ctx.currentTime);sound2._playStart=Howler3.ctx.currentTime;if(typeof node.bufferSource.start==="undefined"){sound2._loop?node.bufferSource.noteGrainOn(0,seek2,86400):node.bufferSource.noteGrainOn(0,seek2,duration)}else{sound2._loop?node.bufferSource.start(0,seek2,86400):node.bufferSource.start(0,seek2,duration)}if(timeout!==Infinity){self2._endTimers[sound2._id]=setTimeout(self2._ended.bind(self2,sound2),timeout)}if(!internal){setTimeout(function(){self2._emit("play",sound2._id);self2._loadQueue()},0)}};if(Howler3.state==="running"&&Howler3.ctx.state!=="interrupted"){playWebAudio()}else{self2._playLock=true;self2.once("resume",playWebAudio);self2._clearTimer(sound2._id)}}else{var playHtml5=function(){node.currentTime=seek2;node.muted=sound2._muted||self2._muted||Howler3._muted||node.muted;node.volume=sound2._volume*Howler3.volume();node.playbackRate=sound2._rate;try{var play2=node.play();if(play2&&typeof Promise!=="undefined"&&(play2 instanceof Promise||typeof play2.then==="function")){self2._playLock=true;setParams();play2.then(function(){self2._playLock=false;node._unlocked=true;if(!internal){self2._emit("play",sound2._id)}else{self2._loadQueue()}}).catch(function(){self2._playLock=false;self2._emit("playerror",sound2._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");sound2._ended=true;sound2._paused=true})}else if(!internal){self2._playLock=false;setParams();self2._emit("play",sound2._id)}node.playbackRate=sound2._rate;if(node.paused){self2._emit("playerror",sound2._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}if(sprite!=="__default"||sound2._loop){self2._endTimers[sound2._id]=setTimeout(self2._ended.bind(self2,sound2),timeout)}else{self2._endTimers[sound2._id]=function(){self2._ended(sound2);node.removeEventListener("ended",self2._endTimers[sound2._id],false)};node.addEventListener("ended",self2._endTimers[sound2._id],false)}}catch(err){self2._emit("playerror",sound2._id,err)}};if(node.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"){node.src=self2._src;node.load()}var loadedNoReadyState=window&&window.ejecta||!node.readyState&&Howler3._navigator.isCocoonJS;if(node.readyState>=3||loadedNoReadyState){playHtml5()}else{self2._playLock=true;self2._state="loading";var listener=function(){self2._state="loaded";playHtml5();node.removeEventListener(Howler3._canPlayEvent,listener,false)};node.addEventListener(Howler3._canPlayEvent,listener,false);self2._clearTimer(sound2._id)}}return sound2._id},pause:function(id){var self2=this;if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"pause",action:function(){self2.pause(id)}});return self2}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){self2._clearTimer(ids[i]);var sound2=self2._soundById(ids[i]);if(sound2&&!sound2._paused){sound2._seek=self2.seek(ids[i]);sound2._rateSeek=0;sound2._paused=true;self2._stopFade(ids[i]);if(sound2._node){if(self2._webAudio){if(!sound2._node.bufferSource){continue}if(typeof sound2._node.bufferSource.stop==="undefined"){sound2._node.bufferSource.noteOff(0)}else{sound2._node.bufferSource.stop(0)}self2._cleanBuffer(sound2._node)}else if(!isNaN(sound2._node.duration)||sound2._node.duration===Infinity){sound2._node.pause()}}}if(!arguments[1]){self2._emit("pause",sound2?sound2._id:null)}}return self2},stop:function(id,internal){var self2=this;if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"stop",action:function(){self2.stop(id)}});return self2}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){self2._clearTimer(ids[i]);var sound2=self2._soundById(ids[i]);if(sound2){sound2._seek=sound2._start||0;sound2._rateSeek=0;sound2._paused=true;sound2._ended=true;self2._stopFade(ids[i]);if(sound2._node){if(self2._webAudio){if(sound2._node.bufferSource){if(typeof sound2._node.bufferSource.stop==="undefined"){sound2._node.bufferSource.noteOff(0)}else{sound2._node.bufferSource.stop(0)}self2._cleanBuffer(sound2._node)}}else if(!isNaN(sound2._node.duration)||sound2._node.duration===Infinity){sound2._node.currentTime=sound2._start||0;sound2._node.pause();if(sound2._node.duration===Infinity){self2._clearSound(sound2._node)}}}if(!internal){self2._emit("stop",sound2._id)}}}return self2},mute:function(muted2,id){var self2=this;if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"mute",action:function(){self2.mute(muted2,id)}});return self2}if(typeof id==="undefined"){if(typeof muted2==="boolean"){self2._muted=muted2}else{return self2._muted}}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound2=self2._soundById(ids[i]);if(sound2){sound2._muted=muted2;if(sound2._interval){self2._stopFade(sound2._id)}if(self2._webAudio&&sound2._node){sound2._node.gain.setValueAtTime(muted2?0:sound2._volume,Howler3.ctx.currentTime)}else if(sound2._node){sound2._node.muted=Howler3._muted?true:muted2}self2._emit("mute",sound2._id)}}return self2},volume:function(){var self2=this;var args=arguments;var vol,id;if(args.length===0){return self2._volume}else if(args.length===1||args.length===2&&typeof args[1]==="undefined"){var ids=self2._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else{vol=parseFloat(args[0])}}else if(args.length>=2){vol=parseFloat(args[0]);id=parseInt(args[1],10)}var sound2;if(typeof vol!=="undefined"&&vol>=0&&vol<=1){if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"volume",action:function(){self2.volume.apply(self2,args)}});return self2}if(typeof id==="undefined"){self2._volume=vol}id=self2._getSoundIds(id);for(var i=0;i<id.length;i++){sound2=self2._soundById(id[i]);if(sound2){sound2._volume=vol;if(!args[2]){self2._stopFade(id[i])}if(self2._webAudio&&sound2._node&&!sound2._muted){sound2._node.gain.setValueAtTime(vol,Howler3.ctx.currentTime)}else if(sound2._node&&!sound2._muted){sound2._node.volume=vol*Howler3.volume()}self2._emit("volume",sound2._id)}}}else{sound2=id?self2._soundById(id):self2._sounds[0];return sound2?sound2._volume:0}return self2},fade:function(from,to,len,id){var self2=this;if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"fade",action:function(){self2.fade(from,to,len,id)}});return self2}from=Math.min(Math.max(0,parseFloat(from)),1);to=Math.min(Math.max(0,parseFloat(to)),1);len=parseFloat(len);self2.volume(from,id);var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound2=self2._soundById(ids[i]);if(sound2){if(!id){self2._stopFade(ids[i])}if(self2._webAudio&&!sound2._muted){var currentTime=Howler3.ctx.currentTime;var end=currentTime+len/1e3;sound2._volume=from;sound2._node.gain.setValueAtTime(from,currentTime);sound2._node.gain.linearRampToValueAtTime(to,end)}self2._startFadeInterval(sound2,from,to,len,ids[i],typeof id==="undefined")}}return self2},_startFadeInterval:function(sound2,from,to,len,id,isGroup){var self2=this;var vol=from;var diff=to-from;var steps=Math.abs(diff/.01);var stepLen=Math.max(4,steps>0?len/steps:len);var lastTick=Date.now();sound2._fadeTo=to;sound2._interval=setInterval(function(){var tick=(Date.now()-lastTick)/len;lastTick=Date.now();vol+=diff*tick;vol=Math.round(vol*100)/100;if(diff<0){vol=Math.max(to,vol)}else{vol=Math.min(to,vol)}if(self2._webAudio){sound2._volume=vol}else{self2.volume(vol,sound2._id,true)}if(isGroup){self2._volume=vol}if(to<from&&vol<=to||to>from&&vol>=to){clearInterval(sound2._interval);sound2._interval=null;sound2._fadeTo=null;self2.volume(to,sound2._id);self2._emit("fade",sound2._id)}},stepLen)},_stopFade:function(id){var self2=this;var sound2=self2._soundById(id);if(sound2&&sound2._interval){if(self2._webAudio){sound2._node.gain.cancelScheduledValues(Howler3.ctx.currentTime)}clearInterval(sound2._interval);sound2._interval=null;self2.volume(sound2._fadeTo,id);sound2._fadeTo=null;self2._emit("fade",id)}return self2},loop:function(){var self2=this;var args=arguments;var loop,id,sound2;if(args.length===0){return self2._loop}else if(args.length===1){if(typeof args[0]==="boolean"){loop=args[0];self2._loop=loop}else{sound2=self2._soundById(parseInt(args[0],10));return sound2?sound2._loop:false}}else if(args.length===2){loop=args[0];id=parseInt(args[1],10)}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){sound2=self2._soundById(ids[i]);if(sound2){sound2._loop=loop;if(self2._webAudio&&sound2._node&&sound2._node.bufferSource){sound2._node.bufferSource.loop=loop;if(loop){sound2._node.bufferSource.loopStart=sound2._start||0;sound2._node.bufferSource.loopEnd=sound2._stop;if(self2.playing(ids[i])){self2.pause(ids[i],true);self2.play(ids[i],true)}}}}}return self2},rate:function(){var self2=this;var args=arguments;var rate2,id;if(args.length===0){id=self2._sounds[0]._id}else if(args.length===1){var ids=self2._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else{rate2=parseFloat(args[0])}}else if(args.length===2){rate2=parseFloat(args[0]);id=parseInt(args[1],10)}var sound2;if(typeof rate2==="number"){if(self2._state!=="loaded"||self2._playLock){self2._queue.push({event:"rate",action:function(){self2.rate.apply(self2,args)}});return self2}if(typeof id==="undefined"){self2._rate=rate2}id=self2._getSoundIds(id);for(var i=0;i<id.length;i++){sound2=self2._soundById(id[i]);if(sound2){if(self2.playing(id[i])){sound2._rateSeek=self2.seek(id[i]);sound2._playStart=self2._webAudio?Howler3.ctx.currentTime:sound2._playStart}sound2._rate=rate2;if(self2._webAudio&&sound2._node&&sound2._node.bufferSource){sound2._node.bufferSource.playbackRate.setValueAtTime(rate2,Howler3.ctx.currentTime)}else if(sound2._node){sound2._node.playbackRate=rate2}var seek2=self2.seek(id[i]);var duration=(self2._sprite[sound2._sprite][0]+self2._sprite[sound2._sprite][1])/1e3-seek2;var timeout=duration*1e3/Math.abs(sound2._rate);if(self2._endTimers[id[i]]||!sound2._paused){self2._clearTimer(id[i]);self2._endTimers[id[i]]=setTimeout(self2._ended.bind(self2,sound2),timeout)}self2._emit("rate",sound2._id)}}}else{sound2=self2._soundById(id);return sound2?sound2._rate:self2._rate}return self2},seek:function(){var self2=this;var args=arguments;var seek2,id;if(args.length===0){if(self2._sounds.length){id=self2._sounds[0]._id}}else if(args.length===1){var ids=self2._getSoundIds();var index=ids.indexOf(args[0]);if(index>=0){id=parseInt(args[0],10)}else if(self2._sounds.length){id=self2._sounds[0]._id;seek2=parseFloat(args[0])}}else if(args.length===2){seek2=parseFloat(args[0]);id=parseInt(args[1],10)}if(typeof id==="undefined"){return 0}if(typeof seek2==="number"&&(self2._state!=="loaded"||self2._playLock)){self2._queue.push({event:"seek",action:function(){self2.seek.apply(self2,args)}});return self2}var sound2=self2._soundById(id);if(sound2){if(typeof seek2==="number"&&seek2>=0){var playing=self2.playing(id);if(playing){self2.pause(id,true)}sound2._seek=seek2;sound2._ended=false;self2._clearTimer(id);if(!self2._webAudio&&sound2._node&&!isNaN(sound2._node.duration)){sound2._node.currentTime=seek2}var seekAndEmit=function(){if(playing){self2.play(id,true)}self2._emit("seek",id)};if(playing&&!self2._webAudio){var emitSeek=function(){if(!self2._playLock){seekAndEmit()}else{setTimeout(emitSeek,0)}};setTimeout(emitSeek,0)}else{seekAndEmit()}}else{if(self2._webAudio){var realTime=self2.playing(id)?Howler3.ctx.currentTime-sound2._playStart:0;var rateSeek=sound2._rateSeek?sound2._rateSeek-sound2._seek:0;return sound2._seek+(rateSeek+realTime*Math.abs(sound2._rate))}else{return sound2._node.currentTime}}}return self2},playing:function(id){var self2=this;if(typeof id==="number"){var sound2=self2._soundById(id);return sound2?!sound2._paused:false}for(var i=0;i<self2._sounds.length;i++){if(!self2._sounds[i]._paused){return true}}return false},duration:function(id){var self2=this;var duration=self2._duration;var sound2=self2._soundById(id);if(sound2){duration=self2._sprite[sound2._sprite][1]/1e3}return duration},state:function(){return this._state},unload:function(){var self2=this;var sounds=self2._sounds;for(var i=0;i<sounds.length;i++){if(!sounds[i]._paused){self2.stop(sounds[i]._id)}if(!self2._webAudio){self2._clearSound(sounds[i]._node);sounds[i]._node.removeEventListener("error",sounds[i]._errorFn,false);sounds[i]._node.removeEventListener(Howler3._canPlayEvent,sounds[i]._loadFn,false);sounds[i]._node.removeEventListener("ended",sounds[i]._endFn,false);Howler3._releaseHtml5Audio(sounds[i]._node)}delete sounds[i]._node;self2._clearTimer(sounds[i]._id)}var index=Howler3._howls.indexOf(self2);if(index>=0){Howler3._howls.splice(index,1)}var remCache=true;for(i=0;i<Howler3._howls.length;i++){if(Howler3._howls[i]._src===self2._src||self2._src.indexOf(Howler3._howls[i]._src)>=0){remCache=false;break}}if(cache2&&remCache){delete cache2[self2._src]}Howler3.noAudio=false;self2._state="unloaded";self2._sounds=[];self2=null;return null},on:function(event,fn,id,once2){var self2=this;var events=self2["_on"+event];if(typeof fn==="function"){events.push(once2?{id:id,fn:fn,once:once2}:{id:id,fn:fn})}return self2},off:function(event,fn,id){var self2=this;var events=self2["_on"+event];var i=0;if(typeof fn==="number"){id=fn;fn=null}if(fn||id){for(i=0;i<events.length;i++){var isId=id===events[i].id;if(fn===events[i].fn&&isId||!fn&&isId){events.splice(i,1);break}}}else if(event){self2["_on"+event]=[]}else{var keys=Object.keys(self2);for(i=0;i<keys.length;i++){if(keys[i].indexOf("_on")===0&&Array.isArray(self2[keys[i]])){self2[keys[i]]=[]}}}return self2},once:function(event,fn,id){var self2=this;self2.on(event,fn,id,1);return self2},_emit:function(event,id,msg){var self2=this;var events=self2["_on"+event];for(var i=events.length-1;i>=0;i--){if(!events[i].id||events[i].id===id||event==="load"){setTimeout(function(fn){fn.call(this,id,msg)}.bind(self2,events[i].fn),0);if(events[i].once){self2.off(event,events[i].fn,events[i].id)}}}self2._loadQueue(event);return self2},_loadQueue:function(event){var self2=this;if(self2._queue.length>0){var task=self2._queue[0];if(task.event===event){self2._queue.shift();self2._loadQueue()}if(!event){task.action()}}return self2},_ended:function(sound2){var self2=this;var sprite=sound2._sprite;if(!self2._webAudio&&sound2._node&&!sound2._node.paused&&!sound2._node.ended&&sound2._node.currentTime<sound2._stop){setTimeout(self2._ended.bind(self2,sound2),100);return self2}var loop=!!(sound2._loop||self2._sprite[sprite][2]);self2._emit("end",sound2._id);if(!self2._webAudio&&loop){self2.stop(sound2._id,true).play(sound2._id)}if(self2._webAudio&&loop){self2._emit("play",sound2._id);sound2._seek=sound2._start||0;sound2._rateSeek=0;sound2._playStart=Howler3.ctx.currentTime;var timeout=(sound2._stop-sound2._start)*1e3/Math.abs(sound2._rate);self2._endTimers[sound2._id]=setTimeout(self2._ended.bind(self2,sound2),timeout)}if(self2._webAudio&&!loop){sound2._paused=true;sound2._ended=true;sound2._seek=sound2._start||0;sound2._rateSeek=0;self2._clearTimer(sound2._id);self2._cleanBuffer(sound2._node);Howler3._autoSuspend()}if(!self2._webAudio&&!loop){self2.stop(sound2._id,true)}return self2},_clearTimer:function(id){var self2=this;if(self2._endTimers[id]){if(typeof self2._endTimers[id]!=="function"){clearTimeout(self2._endTimers[id])}else{var sound2=self2._soundById(id);if(sound2&&sound2._node){sound2._node.removeEventListener("ended",self2._endTimers[id],false)}}delete self2._endTimers[id]}return self2},_soundById:function(id){var self2=this;for(var i=0;i<self2._sounds.length;i++){if(id===self2._sounds[i]._id){return self2._sounds[i]}}return null},_inactiveSound:function(){var self2=this;self2._drain();for(var i=0;i<self2._sounds.length;i++){if(self2._sounds[i]._ended){return self2._sounds[i].reset()}}return new Sound2(self2)},_drain:function(){var self2=this;var limit=self2._pool;var cnt=0;var i=0;if(self2._sounds.length<limit){return}for(i=0;i<self2._sounds.length;i++){if(self2._sounds[i]._ended){cnt++}}for(i=self2._sounds.length-1;i>=0;i--){if(cnt<=limit){return}if(self2._sounds[i]._ended){if(self2._webAudio&&self2._sounds[i]._node){self2._sounds[i]._node.disconnect(0)}self2._sounds.splice(i,1);cnt--}}},_getSoundIds:function(id){var self2=this;if(typeof id==="undefined"){var ids=[];for(var i=0;i<self2._sounds.length;i++){ids.push(self2._sounds[i]._id)}return ids}else{return[id]}},_refreshBuffer:function(sound2){var self2=this;sound2._node.bufferSource=Howler3.ctx.createBufferSource();sound2._node.bufferSource.buffer=cache2[self2._src];if(sound2._panner){sound2._node.bufferSource.connect(sound2._panner)}else{sound2._node.bufferSource.connect(sound2._node)}sound2._node.bufferSource.loop=sound2._loop;if(sound2._loop){sound2._node.bufferSource.loopStart=sound2._start||0;sound2._node.bufferSource.loopEnd=sound2._stop||0}sound2._node.bufferSource.playbackRate.setValueAtTime(sound2._rate,Howler3.ctx.currentTime);return self2},_cleanBuffer:function(node){var self2=this;var isIOS=Howler3._navigator&&Howler3._navigator.vendor.indexOf("Apple")>=0;if(!node.bufferSource){return self2}if(Howler3._scratchBuffer&&node.bufferSource){node.bufferSource.onended=null;node.bufferSource.disconnect(0);if(isIOS){try{node.bufferSource.buffer=Howler3._scratchBuffer}catch(e){}}}node.bufferSource=null;return self2},_clearSound:function(node){var checkIE=/MSIE |Trident\//.test(Howler3._navigator&&Howler3._navigator.userAgent);if(!checkIE){node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"}}};var Sound2=function(howl){this._parent=howl;this.init()};Sound2.prototype={init:function(){var self2=this;var parent=self2._parent;self2._muted=parent._muted;self2._loop=parent._loop;self2._volume=parent._volume;self2._rate=parent._rate;self2._seek=0;self2._paused=true;self2._ended=true;self2._sprite="__default";self2._id=++Howler3._counter;parent._sounds.push(self2);self2.create();return self2},create:function(){var self2=this;var parent=self2._parent;var volume=Howler3._muted||self2._muted||self2._parent._muted?0:self2._volume;if(parent._webAudio){self2._node=typeof Howler3.ctx.createGain==="undefined"?Howler3.ctx.createGainNode():Howler3.ctx.createGain();self2._node.gain.setValueAtTime(volume,Howler3.ctx.currentTime);self2._node.paused=true;self2._node.connect(Howler3.masterGain)}else if(!Howler3.noAudio){self2._node=Howler3._obtainHtml5Audio();self2._errorFn=self2._errorListener.bind(self2);self2._node.addEventListener("error",self2._errorFn,false);self2._loadFn=self2._loadListener.bind(self2);self2._node.addEventListener(Howler3._canPlayEvent,self2._loadFn,false);self2._endFn=self2._endListener.bind(self2);self2._node.addEventListener("ended",self2._endFn,false);self2._node.src=parent._src;self2._node.preload=parent._preload===true?"auto":parent._preload;self2._node.volume=volume*Howler3.volume();self2._node.load()}return self2},reset:function(){var self2=this;var parent=self2._parent;self2._muted=parent._muted;self2._loop=parent._loop;self2._volume=parent._volume;self2._rate=parent._rate;self2._seek=0;self2._rateSeek=0;self2._paused=true;self2._ended=true;self2._sprite="__default";self2._id=++Howler3._counter;return self2},_errorListener:function(){var self2=this;self2._parent._emit("loaderror",self2._id,self2._node.error?self2._node.error.code:0);self2._node.removeEventListener("error",self2._errorFn,false)},_loadListener:function(){var self2=this;var parent=self2._parent;parent._duration=Math.ceil(self2._node.duration*10)/10;if(Object.keys(parent._sprite).length===0){parent._sprite={__default:[0,parent._duration*1e3]}}if(parent._state!=="loaded"){parent._state="loaded";parent._emit("load");parent._loadQueue()}self2._node.removeEventListener(Howler3._canPlayEvent,self2._loadFn,false)},_endListener:function(){var self2=this;var parent=self2._parent;if(parent._duration===Infinity){parent._duration=Math.ceil(self2._node.duration*10)/10;if(parent._sprite.__default[1]===Infinity){parent._sprite.__default[1]=parent._duration*1e3}parent._ended(self2)}self2._node.removeEventListener("ended",self2._endFn,false)}};var cache2={};var loadBuffer=function(self2){var url=self2._src;if(cache2[url]){self2._duration=cache2[url].duration;loadSound(self2);return}if(/^data:[^;]+;base64,/.test(url)){var data2=atob(url.split(",")[1]);var dataView=new Uint8Array(data2.length);for(var i=0;i<data2.length;++i){dataView[i]=data2.charCodeAt(i)}decodeAudioData(dataView.buffer,self2)}else{var xhr=new XMLHttpRequest;xhr.open(self2._xhr.method,url,true);xhr.withCredentials=self2._xhr.withCredentials;xhr.responseType="arraybuffer";if(self2._xhr.headers){Object.keys(self2._xhr.headers).forEach(function(key){xhr.setRequestHeader(key,self2._xhr.headers[key])})}xhr.onload=function(){var code=(xhr.status+"")[0];if(code!=="0"&&code!=="2"&&code!=="3"){self2._emit("loaderror",null,"Failed loading audio file with status: "+xhr.status+".");return}decodeAudioData(xhr.response,self2)};xhr.onerror=function(){if(self2._webAudio){self2._html5=true;self2._webAudio=false;self2._sounds=[];delete cache2[url];self2.load()}};safeXhrSend(xhr)}};var safeXhrSend=function(xhr){try{xhr.send()}catch(e){xhr.onerror()}};var decodeAudioData=function(arraybuffer,self2){var error=function(){self2._emit("loaderror",null,"Decoding audio data failed.")};var success=function(buffer){if(buffer&&self2._sounds.length>0){cache2[self2._src]=buffer;loadSound(self2,buffer)}else{error()}};if(typeof Promise!=="undefined"&&Howler3.ctx.decodeAudioData.length===1){Howler3.ctx.decodeAudioData(arraybuffer).then(success).catch(error)}else{Howler3.ctx.decodeAudioData(arraybuffer,success,error)}};var loadSound=function(self2,buffer){if(buffer&&!self2._duration){self2._duration=buffer.duration}if(Object.keys(self2._sprite).length===0){self2._sprite={__default:[0,self2._duration*1e3]}}if(self2._state!=="loaded"){self2._state="loaded";self2._emit("load");self2._loadQueue()}};var setupAudioContext=function(){if(!Howler3.usingWebAudio){return}try{if(typeof AudioContext!=="undefined"){Howler3.ctx=new AudioContext}else if(typeof webkitAudioContext!=="undefined"){Howler3.ctx=new webkitAudioContext}else{Howler3.usingWebAudio=false}}catch(e){Howler3.usingWebAudio=false}if(!Howler3.ctx){Howler3.usingWebAudio=false}var iOS2=/iP(hone|od|ad)/.test(Howler3._navigator&&Howler3._navigator.platform);var appVersion=Howler3._navigator&&Howler3._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);var version2=appVersion?parseInt(appVersion[1],10):null;if(iOS2&&version2&&version2<9){var safari=/safari/.test(Howler3._navigator&&Howler3._navigator.userAgent.toLowerCase());if(Howler3._navigator&&!safari){Howler3.usingWebAudio=false}}if(Howler3.usingWebAudio){Howler3.masterGain=typeof Howler3.ctx.createGain==="undefined"?Howler3.ctx.createGainNode():Howler3.ctx.createGain();Howler3.masterGain.gain.setValueAtTime(Howler3._muted?0:Howler3._volume,Howler3.ctx.currentTime);Howler3.masterGain.connect(Howler3.ctx.destination)}Howler3._setup()};if(typeof define==="function"&&define.amd){define([],function(){return{Howler:Howler3,Howl:Howl3}})}if(typeof exports!=="undefined"){exports.Howler=Howler3;exports.Howl=Howl3}if(typeof global!=="undefined"){global.HowlerGlobal=HowlerGlobal2;global.Howler=Howler3;global.Howl=Howl3;global.Sound=Sound2}else if(typeof window!=="undefined"){window.HowlerGlobal=HowlerGlobal2;window.Howler=Howler3;window.Howl=Howl3;window.Sound=Sound2}})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(pan){var self2=this;if(!self2.ctx||!self2.ctx.listener){return self2}for(var i=self2._howls.length-1;i>=0;i--){self2._howls[i].stereo(pan)}return self2};HowlerGlobal.prototype.pos=function(x,y,z){var self2=this;if(!self2.ctx||!self2.ctx.listener){return self2}y=typeof y!=="number"?self2._pos[1]:y;z=typeof z!=="number"?self2._pos[2]:z;if(typeof x==="number"){self2._pos=[x,y,z];if(typeof self2.ctx.listener.positionX!=="undefined"){self2.ctx.listener.positionX.setTargetAtTime(self2._pos[0],Howler.ctx.currentTime,.1);self2.ctx.listener.positionY.setTargetAtTime(self2._pos[1],Howler.ctx.currentTime,.1);self2.ctx.listener.positionZ.setTargetAtTime(self2._pos[2],Howler.ctx.currentTime,.1)}else{self2.ctx.listener.setPosition(self2._pos[0],self2._pos[1],self2._pos[2])}}else{return self2._pos}return self2};HowlerGlobal.prototype.orientation=function(x,y,z,xUp,yUp,zUp){var self2=this;if(!self2.ctx||!self2.ctx.listener){return self2}var or=self2._orientation;y=typeof y!=="number"?or[1]:y;z=typeof z!=="number"?or[2]:z;xUp=typeof xUp!=="number"?or[3]:xUp;yUp=typeof yUp!=="number"?or[4]:yUp;zUp=typeof zUp!=="number"?or[5]:zUp;if(typeof x==="number"){self2._orientation=[x,y,z,xUp,yUp,zUp];if(typeof self2.ctx.listener.forwardX!=="undefined"){self2.ctx.listener.forwardX.setTargetAtTime(x,Howler.ctx.currentTime,.1);self2.ctx.listener.forwardY.setTargetAtTime(y,Howler.ctx.currentTime,.1);self2.ctx.listener.forwardZ.setTargetAtTime(z,Howler.ctx.currentTime,.1);self2.ctx.listener.upX.setTargetAtTime(xUp,Howler.ctx.currentTime,.1);self2.ctx.listener.upY.setTargetAtTime(yUp,Howler.ctx.currentTime,.1);self2.ctx.listener.upZ.setTargetAtTime(zUp,Howler.ctx.currentTime,.1)}else{self2.ctx.listener.setOrientation(x,y,z,xUp,yUp,zUp)}}else{return or}return self2};Howl.prototype.init=function(_super){return function(o){var self2=this;self2._orientation=o.orientation||[1,0,0];self2._stereo=o.stereo||null;self2._pos=o.pos||null;self2._pannerAttr={coneInnerAngle:typeof o.coneInnerAngle!=="undefined"?o.coneInnerAngle:360,coneOuterAngle:typeof o.coneOuterAngle!=="undefined"?o.coneOuterAngle:360,coneOuterGain:typeof o.coneOuterGain!=="undefined"?o.coneOuterGain:0,distanceModel:typeof o.distanceModel!=="undefined"?o.distanceModel:"inverse",maxDistance:typeof o.maxDistance!=="undefined"?o.maxDistance:1e4,panningModel:typeof o.panningModel!=="undefined"?o.panningModel:"HRTF",refDistance:typeof o.refDistance!=="undefined"?o.refDistance:1,rolloffFactor:typeof o.rolloffFactor!=="undefined"?o.rolloffFactor:1};self2._onstereo=o.onstereo?[{fn:o.onstereo}]:[];self2._onpos=o.onpos?[{fn:o.onpos}]:[];self2._onorientation=o.onorientation?[{fn:o.onorientation}]:[];return _super.call(this,o)}}(Howl.prototype.init);Howl.prototype.stereo=function(pan,id){var self2=this;if(!self2._webAudio){return self2}if(self2._state!=="loaded"){self2._queue.push({event:"stereo",action:function(){self2.stereo(pan,id)}});return self2}var pannerType=typeof Howler.ctx.createStereoPanner==="undefined"?"spatial":"stereo";if(typeof id==="undefined"){if(typeof pan==="number"){self2._stereo=pan;self2._pos=[pan,0,0]}else{return self2._stereo}}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound2=self2._soundById(ids[i]);if(sound2){if(typeof pan==="number"){sound2._stereo=pan;sound2._pos=[pan,0,0];if(sound2._node){sound2._pannerAttr.panningModel="equalpower";if(!sound2._panner||!sound2._panner.pan){setupPanner(sound2,pannerType)}if(pannerType==="spatial"){if(typeof sound2._panner.positionX!=="undefined"){sound2._panner.positionX.setValueAtTime(pan,Howler.ctx.currentTime);sound2._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime);sound2._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)}else{sound2._panner.setPosition(pan,0,0)}}else{sound2._panner.pan.setValueAtTime(pan,Howler.ctx.currentTime)}}self2._emit("stereo",sound2._id)}else{return sound2._stereo}}}return self2};Howl.prototype.pos=function(x,y,z,id){var self2=this;if(!self2._webAudio){return self2}if(self2._state!=="loaded"){self2._queue.push({event:"pos",action:function(){self2.pos(x,y,z,id)}});return self2}y=typeof y!=="number"?0:y;z=typeof z!=="number"?-.5:z;if(typeof id==="undefined"){if(typeof x==="number"){self2._pos=[x,y,z]}else{return self2._pos}}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound2=self2._soundById(ids[i]);if(sound2){if(typeof x==="number"){sound2._pos=[x,y,z];if(sound2._node){if(!sound2._panner||sound2._panner.pan){setupPanner(sound2,"spatial")}if(typeof sound2._panner.positionX!=="undefined"){sound2._panner.positionX.setValueAtTime(x,Howler.ctx.currentTime);sound2._panner.positionY.setValueAtTime(y,Howler.ctx.currentTime);sound2._panner.positionZ.setValueAtTime(z,Howler.ctx.currentTime)}else{sound2._panner.setPosition(x,y,z)}}self2._emit("pos",sound2._id)}else{return sound2._pos}}}return self2};Howl.prototype.orientation=function(x,y,z,id){var self2=this;if(!self2._webAudio){return self2}if(self2._state!=="loaded"){self2._queue.push({event:"orientation",action:function(){self2.orientation(x,y,z,id)}});return self2}y=typeof y!=="number"?self2._orientation[1]:y;z=typeof z!=="number"?self2._orientation[2]:z;if(typeof id==="undefined"){if(typeof x==="number"){self2._orientation=[x,y,z]}else{return self2._orientation}}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){var sound2=self2._soundById(ids[i]);if(sound2){if(typeof x==="number"){sound2._orientation=[x,y,z];if(sound2._node){if(!sound2._panner){if(!sound2._pos){sound2._pos=self2._pos||[0,0,-.5]}setupPanner(sound2,"spatial")}if(typeof sound2._panner.orientationX!=="undefined"){sound2._panner.orientationX.setValueAtTime(x,Howler.ctx.currentTime);sound2._panner.orientationY.setValueAtTime(y,Howler.ctx.currentTime);sound2._panner.orientationZ.setValueAtTime(z,Howler.ctx.currentTime)}else{sound2._panner.setOrientation(x,y,z)}}self2._emit("orientation",sound2._id)}else{return sound2._orientation}}}return self2};Howl.prototype.pannerAttr=function(){var self2=this;var args=arguments;var o,id,sound2;if(!self2._webAudio){return self2}if(args.length===0){return self2._pannerAttr}else if(args.length===1){if(typeof args[0]==="object"){o=args[0];if(typeof id==="undefined"){if(!o.pannerAttr){o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}}self2._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle!=="undefined"?o.pannerAttr.coneInnerAngle:self2._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle!=="undefined"?o.pannerAttr.coneOuterAngle:self2._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain!=="undefined"?o.pannerAttr.coneOuterGain:self2._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel!=="undefined"?o.pannerAttr.distanceModel:self2._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance!=="undefined"?o.pannerAttr.maxDistance:self2._maxDistance,refDistance:typeof o.pannerAttr.refDistance!=="undefined"?o.pannerAttr.refDistance:self2._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor!=="undefined"?o.pannerAttr.rolloffFactor:self2._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel!=="undefined"?o.pannerAttr.panningModel:self2._panningModel}}}else{sound2=self2._soundById(parseInt(args[0],10));return sound2?sound2._pannerAttr:self2._pannerAttr}}else if(args.length===2){o=args[0];id=parseInt(args[1],10)}var ids=self2._getSoundIds(id);for(var i=0;i<ids.length;i++){sound2=self2._soundById(ids[i]);if(sound2){var pa=sound2._pannerAttr;pa={coneInnerAngle:typeof o.coneInnerAngle!=="undefined"?o.coneInnerAngle:pa.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle!=="undefined"?o.coneOuterAngle:pa.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain!=="undefined"?o.coneOuterGain:pa.coneOuterGain,distanceModel:typeof o.distanceModel!=="undefined"?o.distanceModel:pa.distanceModel,maxDistance:typeof o.maxDistance!=="undefined"?o.maxDistance:pa.maxDistance,refDistance:typeof o.refDistance!=="undefined"?o.refDistance:pa.refDistance,rolloffFactor:typeof o.rolloffFactor!=="undefined"?o.rolloffFactor:pa.rolloffFactor,panningModel:typeof o.panningModel!=="undefined"?o.panningModel:pa.panningModel};var panner2=sound2._panner;if(!panner2){if(!sound2._pos){sound2._pos=self2._pos||[0,0,-.5]}setupPanner(sound2,"spatial");panner2=sound2._panner}panner2.coneInnerAngle=pa.coneInnerAngle;panner2.coneOuterAngle=pa.coneOuterAngle;panner2.coneOuterGain=pa.coneOuterGain;panner2.distanceModel=pa.distanceModel;panner2.maxDistance=pa.maxDistance;panner2.refDistance=pa.refDistance;panner2.rolloffFactor=pa.rolloffFactor;panner2.panningModel=pa.panningModel}}return self2};Sound.prototype.init=function(_super){return function(){var self2=this;var parent=self2._parent;self2._orientation=parent._orientation;self2._stereo=parent._stereo;self2._pos=parent._pos;self2._pannerAttr=parent._pannerAttr;_super.call(this);if(self2._stereo){parent.stereo(self2._stereo)}else if(self2._pos){parent.pos(self2._pos[0],self2._pos[1],self2._pos[2],self2._id)}}}(Sound.prototype.init);Sound.prototype.reset=function(_super){return function(){var self2=this;var parent=self2._parent;self2._orientation=parent._orientation;self2._stereo=parent._stereo;self2._pos=parent._pos;self2._pannerAttr=parent._pannerAttr;if(self2._stereo){parent.stereo(self2._stereo)}else if(self2._pos){parent.pos(self2._pos[0],self2._pos[1],self2._pos[2],self2._id)}else if(self2._panner){self2._panner.disconnect(0);self2._panner=void 0;parent._refreshBuffer(self2)}return _super.call(this)}}(Sound.prototype.reset);var setupPanner=function(sound2,type){type=type||"spatial";if(type==="spatial"){sound2._panner=Howler.ctx.createPanner();sound2._panner.coneInnerAngle=sound2._pannerAttr.coneInnerAngle;sound2._panner.coneOuterAngle=sound2._pannerAttr.coneOuterAngle;sound2._panner.coneOuterGain=sound2._pannerAttr.coneOuterGain;sound2._panner.distanceModel=sound2._pannerAttr.distanceModel;sound2._panner.maxDistance=sound2._pannerAttr.maxDistance;sound2._panner.refDistance=sound2._pannerAttr.refDistance;sound2._panner.rolloffFactor=sound2._pannerAttr.rolloffFactor;sound2._panner.panningModel=sound2._pannerAttr.panningModel;if(typeof sound2._panner.positionX!=="undefined"){sound2._panner.positionX.setValueAtTime(sound2._pos[0],Howler.ctx.currentTime);sound2._panner.positionY.setValueAtTime(sound2._pos[1],Howler.ctx.currentTime);sound2._panner.positionZ.setValueAtTime(sound2._pos[2],Howler.ctx.currentTime)}else{sound2._panner.setPosition(sound2._pos[0],sound2._pos[1],sound2._pos[2])}if(typeof sound2._panner.orientationX!=="undefined"){sound2._panner.orientationX.setValueAtTime(sound2._orientation[0],Howler.ctx.currentTime);sound2._panner.orientationY.setValueAtTime(sound2._orientation[1],Howler.ctx.currentTime);sound2._panner.orientationZ.setValueAtTime(sound2._orientation[2],Howler.ctx.currentTime)}else{sound2._panner.setOrientation(sound2._orientation[0],sound2._orientation[1],sound2._orientation[2])}}else{sound2._panner=Howler.ctx.createStereoPanner();sound2._panner.pan.setValueAtTime(sound2._stereo,Howler.ctx.currentTime)}sound2._panner.connect(sound2._node);if(!sound2._paused){sound2._parent.pause(sound2._id,true).play(sound2._id,true)}}})()}});var import_global_this=__toESM(require_global_this(),1);var import_trim_start=__toESM(require_trim_start(),1);var import_trim_end=__toESM(require_trim_end(),1);if(typeof globalThis!=="undefined"){if(typeof globalThis.console==="undefined"){globalThis.console={};globalThis.console.log=function(){};globalThis.console.assert=function(){};globalThis.console.warn=function(){};globalThis.console.error=function(...args){alert(Array.prototype.slice.call(args).join(", "))}}}function roundRect(x,y,w,h,radii){if(![x,y,w,h].every(input=>{return Number.isFinite(input)})){return}const parsedRadii=parseRadiiArgument(radii);let upperLeft;let upperRight;let lowerRight;let lowerLeft;if(parsedRadii.length===4){upperLeft=toCornerPoint(parsedRadii[0]);upperRight=toCornerPoint(parsedRadii[1]);lowerRight=toCornerPoint(parsedRadii[2]);lowerLeft=toCornerPoint(parsedRadii[3])}else if(parsedRadii.length===3){upperLeft=toCornerPoint(parsedRadii[0]);upperRight=toCornerPoint(parsedRadii[1]);lowerLeft=toCornerPoint(parsedRadii[1]);lowerRight=toCornerPoint(parsedRadii[2])}else if(parsedRadii.length===2){upperLeft=toCornerPoint(parsedRadii[0]);lowerRight=toCornerPoint(parsedRadii[0]);upperRight=toCornerPoint(parsedRadii[1]);lowerLeft=toCornerPoint(parsedRadii[1])}else if(parsedRadii.length===1){upperLeft=toCornerPoint(parsedRadii[0]);upperRight=toCornerPoint(parsedRadii[0]);lowerRight=toCornerPoint(parsedRadii[0]);lowerLeft=toCornerPoint(parsedRadii[0])}else{throw new Error(`${parsedRadii.length} is not a valid size for radii sequence.`)}const corners=[upperLeft,upperRight,lowerRight,lowerLeft];const negativeCorner=corners.find(({x:x2,y:y2})=>{return x2<0||y2<0});if(corners.some(({x:x2,y:y2})=>{return!Number.isFinite(x2)||!Number.isFinite(y2)})){return}if(negativeCorner){throw new Error(`Radius value ${negativeCorner} is negative.`)}fixOverlappingCorners(corners);if(w<0&&h<0){this.moveTo(x-upperLeft.x,y);this.ellipse(x+w+upperRight.x,y-upperRight.y,upperRight.x,upperRight.y,0,-Math.PI*1.5,-Math.PI);this.ellipse(x+w+lowerRight.x,y+h+lowerRight.y,lowerRight.x,lowerRight.y,0,-Math.PI,-Math.PI/2);this.ellipse(x-lowerLeft.x,y+h+lowerLeft.y,lowerLeft.x,lowerLeft.y,0,-Math.PI/2,0);this.ellipse(x-upperLeft.x,y-upperLeft.y,upperLeft.x,upperLeft.y,0,0,-Math.PI/2)}else if(w<0){this.moveTo(x-upperLeft.x,y);this.ellipse(x+w+upperRight.x,y+upperRight.y,upperRight.x,upperRight.y,0,-Math.PI/2,-Math.PI,true);this.ellipse(x+w+lowerRight.x,y+h-lowerRight.y,lowerRight.x,lowerRight.y,0,-Math.PI,-Math.PI*1.5,true);this.ellipse(x-lowerLeft.x,y+h-lowerLeft.y,lowerLeft.x,lowerLeft.y,0,Math.PI/2,0,true);this.ellipse(x-upperLeft.x,y+upperLeft.y,upperLeft.x,upperLeft.y,0,0,-Math.PI/2,true)}else if(h<0){this.moveTo(x+upperLeft.x,y);this.ellipse(x+w-upperRight.x,y-upperRight.y,upperRight.x,upperRight.y,0,Math.PI/2,0,true);this.ellipse(x+w-lowerRight.x,y+h+lowerRight.y,lowerRight.x,lowerRight.y,0,0,-Math.PI/2,true);this.ellipse(x+lowerLeft.x,y+h+lowerLeft.y,lowerLeft.x,lowerLeft.y,0,-Math.PI/2,-Math.PI,true);this.ellipse(x+upperLeft.x,y-upperLeft.y,upperLeft.x,upperLeft.y,0,-Math.PI,-Math.PI*1.5,true)}else{this.moveTo(x+upperLeft.x,y);this.ellipse(x+w-upperRight.x,y+upperRight.y,upperRight.x,upperRight.y,0,-Math.PI/2,0);this.ellipse(x+w-lowerRight.x,y+h-lowerRight.y,lowerRight.x,lowerRight.y,0,0,Math.PI/2);this.ellipse(x+lowerLeft.x,y+h-lowerLeft.y,lowerLeft.x,lowerLeft.y,0,Math.PI/2,Math.PI);this.ellipse(x+upperLeft.x,y+upperLeft.y,upperLeft.x,upperLeft.y,0,Math.PI,Math.PI*1.5)}this.closePath();this.moveTo(x,y);function toDOMPointInit(value){const{x:x2,y:y2,z,w:w2}=value;return{x:x2,y:y2,z:z,w:w2}}function parseRadiiArgument(value){const type=typeof value;if(type==="undefined"||value===null){return[0]}if(type==="function"){return[NaN]}if(type==="object"){if(typeof value[Symbol.iterator]==="function"){return[...value].map(elem=>{const elemType=typeof elem;if(elemType==="undefined"||elem===null){return 0}if(elemType==="function"){return NaN}if(elemType==="object"){return toDOMPointInit(elem)}return toUnrestrictedNumber(elem)})}return[toDOMPointInit(value)]}return[toUnrestrictedNumber(value)]}function toUnrestrictedNumber(value){return+value}function toCornerPoint(value){const asNumber=toUnrestrictedNumber(value);if(Number.isFinite(asNumber)){return{x:asNumber,y:asNumber}}if(Object(value)===value){return{x:toUnrestrictedNumber(value.x||0),y:toUnrestrictedNumber(value.y||0)}}return{x:NaN,y:NaN}}function fixOverlappingCorners(corners2){const[upperLeft2,upperRight2,lowerRight2,lowerLeft2]=corners2;const factors=[Math.abs(w)/(upperLeft2.x+upperRight2.x),Math.abs(h)/(upperRight2.y+lowerRight2.y),Math.abs(w)/(lowerRight2.x+lowerLeft2.x),Math.abs(h)/(upperLeft2.y+lowerLeft2.y)];const minFactor=Math.min(...factors);if(minFactor<=1){corners2.forEach(radii2=>{radii2.x*=minFactor;radii2.y*=minFactor})}}}if(globalThis.CanvasRenderingContext2D){if(typeof globalThis.Path2D.prototype.roundRect==="undefined"){globalThis.Path2D.prototype.roundRect=roundRect}}if(globalThis.CanvasRenderingContext2D){if(typeof globalThis.CanvasRenderingContext2D.prototype.roundRect==="undefined"){globalThis.CanvasRenderingContext2D.prototype.roundRect=roundRect}}if(globalThis.OffscreenCanvasRenderingContext2D){if(typeof globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect==="undefined"){globalThis.OffscreenCanvasRenderingContext2D.prototype.roundRect=roundRect}}var array_exports={};__export(array_exports,{random:()=>random2,remove:()=>remove,weightedRandom:()=>weightedRandom2});var math_exports={};__export(math_exports,{DEG_TO_RAD:()=>DEG_TO_RAD,EPSILON:()=>EPSILON,ETA:()=>ETA,RAD_TO_DEG:()=>RAD_TO_DEG,TAU:()=>TAU,clamp:()=>clamp,degToRad:()=>degToRad,isPowerOfFour:()=>isPowerOfFour,isPowerOfTwo:()=>isPowerOfTwo,nextPowerOfTwo:()=>nextPowerOfTwo,pow:()=>pow,radToDeg:()=>radToDeg,random:()=>random,randomFloat:()=>randomFloat,round:()=>round,toBeCloseTo:()=>toBeCloseTo,weightedRandom:()=>weightedRandom});var DEG_TO_RAD=Math.PI/180;var RAD_TO_DEG=180/Math.PI;var TAU=Math.PI*2;var ETA=Math.PI*.5;var EPSILON=1e-6;function isPowerOfTwo(val){return(val&val-1)===0}function isPowerOfFour(val){if(val===0||val===2||val===3){return false}if(val===1){return true}if((val&val-1)===0){if((val&2863311530)===0){return true}}return false}function nextPowerOfTwo(val){val--;val|=val>>1;val|=val>>2;val|=val>>4;val|=val>>8;val|=val>>16;val++;return val}function degToRad(angle){return angle*DEG_TO_RAD}function radToDeg(radians){return radians*RAD_TO_DEG}function clamp(val,low,high){return val<low?low:val>high?high:+val}function random(min,max){return~~(Math.random()*(max-min))+min}function randomFloat(min,max){return Math.random()*(max-min)+min}function weightedRandom(min,max){return~~(Math.pow(Math.random(),2)*(max-min))+min}function round(num,dec=0){const powres=Math.pow(10,dec);return~~(.5+num*powres)/powres}function toBeCloseTo(expected,actual,precision=2){return Math.abs(expected-actual)<Math.pow(10,-precision)/2}function pow(n){return Math.pow(n,2)}function remove(arr,obj){const i=Array.prototype.indexOf.call(arr,obj);if(i!==-1){Array.prototype.splice.call(arr,i,1)}return arr}function random2(arr){return arr[random(0,arr.length)]}function weightedRandom2(arr){return arr[weightedRandom(0,arr.length)]}var takeFromSet=set=>{for(const value of set){set.delete(value);return value}};var createPool=options=>{const available=new Set;const instanceResetMethods=new Map;const instanceReleaseMethods=new Map;let inUse=0;return{release:instance=>{if(available.has(instance)){throw new Error("Instance is already in pool.")}const release=instanceReleaseMethods.get(instance);release?.();available.add(instance);inUse--},get:(...args)=>{const object=takeFromSet(available);if(object){const reset3=instanceResetMethods.get(object);reset3?.(...args);inUse++;return object}else{const{instance,reset:reset3,release}=options(...args);instanceResetMethods.set(instance,reset3);instanceReleaseMethods.set(instance,release);inUse++;return instance}},purge:()=>{available.clear();inUse=0},size:()=>{return available.size},used:()=>{return inUse}}};var Vector2d=class _Vector2d{constructor(x=0,y=0){this.x=x;this.y=y}onResetEvent(x=0,y=0){this.x=x;this.y=y}set(x,y){this.x=x;this.y=y;return this}setZero(){return this.set(0,0)}setV(v){return this.set(v.x,v.y)}add(v){return this.set(this.x+v.x,this.y+v.y)}sub(v){return this.set(this.x-v.x,this.y-v.y)}scale(x,y=x){return this.set(this.x*x,this.y*y)}toIso(){return this.set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this.set(this.y+this.x/2,this.y-this.x/2)}scaleV(v){return this.set(this.x*v.x,this.y*v.y)}div(n){return this.set(this.x/n,this.y/n)}abs(){return this.set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(low,high){return new _Vector2d(clamp(this.x,low,high),clamp(this.y,low,high))}clampSelf(low,high){return this.set(clamp(this.x,low,high),clamp(this.y,low,high))}minV(v){return this.set(this.x<v.x?this.x:v.x,this.y<v.y?this.y:v.y)}maxV(v){return this.set(this.x>v.x?this.x:v.x,this.y>v.y?this.y:v.y)}floor(){return new _Vector2d(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this.set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new _Vector2d(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this.set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new _Vector2d(-this.x,-this.y)}negateSelf(){return this.set(-this.x,-this.y)}copy(v){return this.set(v.x,v.y)}equals(...args){if(args.length===2){return this.x===args[0]&&this.y===args[1]}return this.x===args[0].x&&this.y===args[0].y}normalize(){return this.div(this.length()||1)}perp(){return this.set(this.y,-this.x)}rotate(angle,v){let cx=0;let cy=0;if(v){cx=v.x;cy=v.y}const x=this.x-cx;const y=this.y-cy;const c=Math.cos(angle);const s=Math.sin(angle);return this.set(x*c-y*s+cx,x*s+y*c+cy)}dot(v){return this.x*v.x+this.y*v.y}cross(v){return this.x*v.y-this.y*v.x}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(v,alpha2){this.x+=(v.x-this.x)*alpha2;this.y+=(v.y-this.y)*alpha2;return this}moveTowards(target,step){const angle=Math.atan2(target.y-this.y,target.x-this.x);const distance=this.distance(target);if(distance===0||step>=0&&distance<=step*step){return target}this.x+=Math.cos(angle)*step;this.y+=Math.sin(angle)*step;return this}distance(v){const dx=this.x-v.x;const dy=this.y-v.y;return Math.sqrt(dx*dx+dy*dy)}angle(v){return Math.acos(clamp(this.dot(v)/(this.length()*v.length()),-1,1))}project(v){return this.scale(this.dot(v)/v.length2())}projectN(v){return this.scale(this.dot(v))}clone(){return vector2dPool.get(this.x,this.y)}toString(){return`x:${this.x},y:${this.y}`}};var vector2dPool=createPool((x,y)=>{const vector=new Vector2d(x,y);return{instance:vector,reset(x2=0,y2=0){vector.x=x2;vector.y=y2}}});var QT_ARRAY=[];function QT_ARRAY_POP(world,bounds,max_objects=4,max_levels=4,level2=0){if(QT_ARRAY.length>0){const _qt=QT_ARRAY.pop();_qt.world=world;_qt.bounds=bounds;_qt.max_objects=max_objects;_qt.max_levels=max_levels;_qt.level=level2;return _qt}else{return new QuadTree(world,bounds,max_objects,max_levels,level2)}}function QT_ARRAY_PUSH(qt){QT_ARRAY.push(qt)}var QT_VECTOR=new Vector2d;var QuadTree=class{constructor(world,bounds,max_objects=4,max_levels=4,level2=0){this.world=world;this.bounds=bounds;this.max_objects=max_objects;this.max_levels=max_levels;this.level=level2;this.objects=[];this.nodes=[]}split(){const nextLevel=this.level+1;const subWidth=this.bounds.width/2;const subHeight=this.bounds.height/2;const left=this.bounds.left;const top=this.bounds.top;this.nodes[0]=QT_ARRAY_POP(this.world,{left:left+subWidth,top:top,width:subWidth,height:subHeight},this.max_objects,this.max_levels,nextLevel);this.nodes[1]=QT_ARRAY_POP(this.world,{left:left,top:top,width:subWidth,height:subHeight},this.max_objects,this.max_levels,nextLevel);this.nodes[2]=QT_ARRAY_POP(this.world,{left:left,top:top+subHeight,width:subWidth,height:subHeight},this.max_objects,this.max_levels,nextLevel);this.nodes[3]=QT_ARRAY_POP(this.world,{left:left+subWidth,top:top+subHeight,width:subWidth,height:subHeight},this.max_objects,this.max_levels,nextLevel)}getIndex(item){let pos;const bounds=item.getBounds();if(item.isFloating===true){pos=this.world.app.viewport.localToWorld(bounds.left,bounds.top,QT_VECTOR)}else{pos=QT_VECTOR.set(item.left,item.top)}let index=-1;const rx=pos.x;const ry=pos.y;const rw=bounds.width;const rh=bounds.height;const verticalMidpoint=this.bounds.left+this.bounds.width/2;const horizontalMidpoint=this.bounds.top+this.bounds.height/2;const topQuadrant=ry<horizontalMidpoint&&ry+rh<horizontalMidpoint;const bottomQuadrant=ry>horizontalMidpoint;if(rx<verticalMidpoint&&rx+rw<verticalMidpoint){if(topQuadrant){index=1}else if(bottomQuadrant){index=2}}else if(rx>verticalMidpoint){if(topQuadrant){index=0}else if(bottomQuadrant){index=3}}return index}insertContainer(container){const children=container.children;const childrenLength=children.length;for(let i=childrenLength,child;i--,child=children[i];){if(child.isKinematic!==true){if(typeof child.addChild==="function"){if(child.name!=="rootContainer"){this.insert(child)}this.insertContainer(child)}else{if(typeof child.getBounds==="function"){this.insert(child)}}}}}insert(item){let index=-1;if(this.nodes.length>0){index=this.getIndex(item);if(index!==-1){this.nodes[index].insert(item);return}}this.objects.push(item);if(this.objects.length>this.max_objects&&this.level<this.max_levels){if(this.nodes.length===0){this.split()}let i=0;while(i<this.objects.length){index=this.getIndex(this.objects[i]);if(index!==-1){this.nodes[index].insert(this.objects.splice(i,1)[0])}else{i=i+1}}}}retrieve(item,fn){let returnObjects=this.objects;if(this.nodes.length>0){const index=this.getIndex(item);if(index!==-1){returnObjects=returnObjects.concat(this.nodes[index].retrieve(item))}else{for(let i=0;i<this.nodes.length;i=i+1){returnObjects=returnObjects.concat(this.nodes[i].retrieve(item))}}}if(typeof fn==="function"){returnObjects.sort(fn)}return returnObjects}remove(item){let found=false;if(typeof item.getBounds==="undefined"){return false}if(this.nodes.length>0){const index=this.getIndex(item);if(index!==-1){found=remove(this.nodes[index],item);if(found&&this.nodes[index].isPrunable()){this.nodes.splice(index,1)}}}if(found===false){if(this.objects.indexOf(item)!==-1){remove(this.objects,item);found=true}}return found}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(let i=0;i<this.nodes.length;i=i+1){const subnode=this.nodes[i];if(subnode.length>0||subnode.objects.length>0){return true}}return false}clear(bounds){this.objects.length=0;for(let i=0;i<this.nodes.length;i++){this.nodes[i].clear();QT_ARRAY_PUSH(this.nodes[i])}this.nodes.length=0;if(typeof bounds!=="undefined"){this.bounds.setMinMax(bounds.min.x,bounds.min.y,bounds.max.x,bounds.max.y)}}};var Point=class _Point{constructor(x,y){this.x=x??0;this.y=y??0;this.type="Point"}set(x=0,y=0){this.x=x;this.y=y;return this}equals(xOrPoint,y){if(typeof xOrPoint==="object"){return this.x===xOrPoint.x&&this.y===xOrPoint.y}return this.x===xOrPoint&&this.y===y}clone(){return new _Point(this.x,this.y)}};var pointPool=createPool((x,y)=>{const instance=new Point(x,y);return{instance:instance,reset(x2=0,y2=0){instance.x=x2;instance.y=y2}}});var Bounds=class _Bounds{constructor(vertices){this._center=new Vector2d;this.type="Bounds";this.min={x:Infinity,y:Infinity};this.max={x:-Infinity,y:-Infinity};if(vertices){this.update(vertices)}}clear(){this.setMinMax(Infinity,Infinity,-Infinity,-Infinity)}setMinMax(minX,minY,maxX,maxY){this.min.x=minX;this.min.y=minY;this.max.x=maxX;this.max.y=maxY}get x(){return this.min.x}set x(value){const deltaX=this.max.x-this.min.x;this.min.x=value;this.max.x=value+deltaX}get y(){return this.min.y}set y(value){const deltaY=this.max.y-this.min.y;this.min.y=value;this.max.y=value+deltaY}get width(){return this.max.x-this.min.x}set width(value){this.max.x=this.min.x+value}get height(){return this.max.y-this.min.y}set height(value){this.max.y=this.min.y+value}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}centerOn(x,y){this.shift(x-this.width/2,y-this.height/2);return this}update(vertices){this.add(vertices,true)}add(vertices,clear=false){if(clear){this.clear()}for(const vertex of vertices){if(vertex.x>this.max.x){this.max.x=vertex.x}if(vertex.x<this.min.x){this.min.x=vertex.x}if(vertex.y>this.max.y){this.max.y=vertex.y}if(vertex.y<this.min.y){this.min.y=vertex.y}}}addBounds(bounds,clear=false){if(clear){this.max.x=bounds.max.x;this.min.x=bounds.min.x;this.max.y=bounds.max.y;this.min.y=bounds.min.y}else{if(bounds.max.x>this.max.x){this.max.x=bounds.max.x}if(bounds.min.x<this.min.x){this.min.x=bounds.min.x}if(bounds.max.y>this.max.y){this.max.y=bounds.max.y}if(bounds.min.y<this.min.y){this.min.y=bounds.min.y}}}addPoint(point,m){const p=m?m.apply(point):point;this.min.x=Math.min(this.min.x,p.x);this.max.x=Math.max(this.max.x,p.x);this.min.y=Math.min(this.min.y,p.y);this.max.y=Math.max(this.max.y,p.y)}addFrame(x0,y0,x1,y1,m){const v=pointPool.get();this.addPoint(v.set(x0,y0),m);this.addPoint(v.set(x1,y0),m);this.addPoint(v.set(x0,y1),m);this.addPoint(v.set(x1,y1),m);pointPool.release(v)}contains(xOrVectorOrBounds,y){let _x1;let _x2;let _y1;let _y2;if(xOrVectorOrBounds instanceof Vector2d){_x1=_x2=xOrVectorOrBounds.x;_y1=_y2=xOrVectorOrBounds.y}else if(xOrVectorOrBounds instanceof _Bounds){_x1=xOrVectorOrBounds.min.x;_x2=xOrVectorOrBounds.max.x;_y1=xOrVectorOrBounds.min.y;_y2=xOrVectorOrBounds.max.y}else{_x1=_x2=xOrVectorOrBounds;_y1=_y2=y}return _x1>=this.min.x&&_x2<=this.max.x&&_y1>=this.min.y&&_y2<=this.max.y}overlaps(bounds){return!(this.right<bounds.left||this.left>bounds.right||this.bottom<bounds.top||this.top>bounds.bottom)}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}this.min.x+=_x;this.max.x+=_x;this.min.y+=_y;this.max.y+=_y}shift(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}const deltaX=this.max.x-this.min.x;const deltaY=this.max.y-this.min.y;this.min.x=_x;this.max.x=_x+deltaX;this.min.y=_y;this.max.y=_y+deltaY}clone(){const bounds=new _Bounds;bounds.addBounds(this);return bounds}toPolygon(){return polygonPool.get(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}};var boundsPool=createPool(vertices=>{const instance=new Bounds(vertices);return{instance:instance,reset(vertices2){instance.clear();if(vertices2){instance.update(vertices2)}}}});function earcut(data2,holeIndices,dim=2){const hasHoles=holeIndices&&holeIndices.length;const outerLen=hasHoles?holeIndices[0]*dim:data2.length;let outerNode=linkedList(data2,0,outerLen,dim,true);const triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;let minX,minY,invSize;if(hasHoles)outerNode=eliminateHoles(data2,holeIndices,outerNode,dim);if(data2.length>80*dim){minX=Infinity;minY=Infinity;let maxX=-Infinity;let maxY=-Infinity;for(let i=dim;i<outerLen;i+=dim){const x=data2[i];const y=data2[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}invSize=Math.max(maxX-minX,maxY-minY);invSize=invSize!==0?32767/invSize:0}earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0);return triangles}function linkedList(data2,start,end,dim,clockwise){let last=null;if(clockwise===signedArea(data2,start,end,dim)>0){for(let i=start;i<end;i+=dim){last=insertNode(i/dim|0,data2[i],data2[i+1],last)}}else{for(let i=end-dim;i>=start;i-=dim){last=insertNode(i/dim|0,data2[i],data2[i+1],last)}}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;let p=start,again;do{again=false;if(!p.steiner&&(equals(p,p.next)||area(p.prev,p,p.next)===0)){removeNode(p);p=end=p.prev;if(p===p.next)break;again=true}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);let stop2=ear;while(ear.prev!==ear.next){const prev=ear.prev;const next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i,ear.i,next.i);removeNode(ear);ear=next.next;stop2=next.next;continue}ear=next;if(ear===stop2){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1)}else if(pass===1){ear=cureLocalIntersections(filterPoints(ear),triangles);earcutLinked(ear,triangles,dim,minX,minY,invSize,2)}else if(pass===2){splitEarcut(ear,triangles,dim,minX,minY,invSize)}break}}}function isEar(ear){const a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;const ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y;const x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy;let p=c.next;while(p!==a){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.next}return true}function isEarHashed(ear,minX,minY,invSize){const a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return false;const ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y;const x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy;const minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize);let p=ear.prevZ,n=ear.nextZ;while(p&&p.z>=minZ&&n&&n.z<=maxZ){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ;if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}while(p&&p.z>=minZ){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return false;p=p.prevZ}while(n&&n.z<=maxZ){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return false;n=n.nextZ}return true}function cureLocalIntersections(start,triangles){let p=start;do{const a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i,p.i,b.i);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){let a=start;do{let b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){let c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize,0);earcutLinked(c,triangles,dim,minX,minY,invSize,0);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data2,holeIndices,outerNode,dim){const queue=[];for(let i=0,len=holeIndices.length;i<len;i++){const start=holeIndices[i]*dim;const end=i<len-1?holeIndices[i+1]*dim:data2.length;const list=linkedList(data2,start,end,dim,false);if(list===list.next)list.steiner=true;queue.push(getLeftmost(list))}queue.sort(compareX);for(let i=0;i<queue.length;i++){outerNode=eliminateHole(queue[i],outerNode)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){const bridge=findHoleBridge(hole,outerNode);if(!bridge){return outerNode}const bridgeReverse=splitPolygon(bridge,hole);filterPoints(bridgeReverse,bridgeReverse.next);return filterPoints(bridge,bridge.next)}function findHoleBridge(hole,outerNode){let p=outerNode;const hx=hole.x;const hy=hole.y;let qx=-Infinity;let m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){const x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;m=p.x<p.next.x?p:p.next;if(x===hx)return m}}p=p.next}while(p!==outerNode);if(!m)return null;const stop2=m;const mx=m.x;const my=m.y;let tanMin=Infinity;p=m;do{if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){const tan=Math.abs(hy-p.y)/(hx-p.x);if(locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))){m=p;tanMin=tan}}p=p.next}while(p!==stop2);return m}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function indexCurve(start,minX,minY,invSize){let p=start;do{if(p.z===0)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(head){let numMerges;let inSize=1;let list=head;do{let p=list;let e;list=null;let tail=null;numMerges=0;while(p){numMerges++;let q=p;let pSize=0;for(let i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}let qSize=inSize;while(pSize>0||qSize>0&&q){if(pSize!==0&&(qSize===0||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail){tail.nextZ=e}else{list=e}e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,invSize){x=(x-minX)*invSize|0;y=(y-minY)*invSize|0;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;x=(x|x<<1)&1431655765;y=(y|y<<8)&16711935;y=(y|y<<4)&252645135;y=(y|y<<2)&858993459;y=(y|y<<1)&1431655765;return x|y<<1}function getLeftmost(start){let p=start,leftmost=start;do{if(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){const o1=sign(area(p1,q1,p2));const o2=sign(area(p1,q1,q2));const o3=sign(area(p2,q2,p1));const o4=sign(area(p2,q2,q1));if(o1!==o2&&o3!==o4)return true;if(o1===0&&onSegment(p1,p2,q1))return true;if(o2===0&&onSegment(p1,q2,q1))return true;if(o3===0&&onSegment(p2,p1,q2))return true;if(o4===0&&onSegment(p2,q1,q2))return true;return false}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function intersectsPolygon(a,b){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return true;p=p.next}while(p!==a);return false}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){let p=a;let inside=false;const px=(a.x+b.x)/2;const py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x)inside=!inside;p=p.next}while(p!==a);return inside}function splitPolygon(a,b){const a2=createNode(a.i,a.x,a.y),b2=createNode(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){const p=createNode(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function createNode(i,x,y){return{i:i,x:x,y:y,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:false}}function signedArea(data2,start,end,dim){let sum=0;for(let i=start,j=end-dim;i<end;i+=dim){sum+=(data2[j]-data2[i])*(data2[i+1]+data2[j+1]);j=i}return sum}var Polygon=class{constructor(x=0,y=0,vertices){this.type="Polygon";this.pos=vector2dPool.get(x,y);this.points=[];this.edges=[];this.indices=[];this.normals=[];this._bounds=boundsPool.get();this.setVertices(vertices)}setShape(x,y,points){this.pos.set(x,y);this.setVertices(points);return this}setVertices(vertices){if(!Array.isArray(vertices)){return this}if(vertices.length<2){throw new Error("You must provide at least two vertices")}if(typeof vertices[0]==="number"){this.points=[];for(let p=0;p<vertices.length;p+=2){this.points.push(new Vector2d(vertices[p],vertices[p+1]))}}else if(vertices[0]instanceof Vector2d){this.points=vertices}else{this.points=[];for(const vertex of vertices){this.points.push(new Vector2d(vertex.x,vertex.y))}}this.recalc();this.updateBounds();return this}transform(m){const points=this.points;const len=points.length;for(let i=0;i<len;i++){m.apply(points[i])}this.recalc();this.updateBounds();return this}toIso(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)}to2d(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)}rotate(angle,v){if(angle!==0){const points=this.points;const len=points.length;for(let i=0;i<len;i++){points[i].rotate(angle,v)}this.recalc();this.updateBounds()}return this}scale(x,y=x){const points=this.points;const len=points.length;for(let i=0;i<len;i++){points[i].scale(x,y)}this.recalc();this.updateBounds();return this}scaleV(v){return this.scale(v.x,v.y)}recalc(){const edges=this.edges;const normals=this.normals;const indices=this.indices;const points=this.points;const len=points.length;if(len<3){throw new Error("Requires at least 3 points")}for(let i=0;i<len;i++){let edge=edges[i];if(typeof edge==="undefined"){edge=edges[i]=vector2dPool.get()}edge.copy(points[(i+1)%len]).sub(points[i]);let normal=normals[i];if(typeof normal==="undefined"){normal=normals[i]=vector2dPool.get()}normal.copy(edge).perp().normalize()}for(let i=len;i<edges.length;i++){vector2dPool.release(edges[i]);vector2dPool.release(normals[i])}edges.length=len;normals.length=len;indices.length=0;return this}getIndices(){if(this.indices.length===0){this.indices=earcut(this.points.flatMap(p=>{return[p.x,p.y]}))}return this.indices}isConvex(){let flag=0;const vertices=this.points;const n=vertices.length;if(n<3){return null}for(let i=0;i<n;i++){const j=(i+1)%n;const k=(i+2)%n;let z=(vertices[j].x-vertices[i].x)*(vertices[k].y-vertices[j].y);z-=(vertices[j].y-vertices[i].y)*(vertices[k].x-vertices[j].x);if(z<0){flag|=1}else if(z>0){flag|=2}if(flag===3){return false}}if(flag!==0){return true}else{return null}}translate(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}this.pos.x+=_x;this.pos.y+=_y;this.getBounds().translate(_x,_y);return this}shift(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}this.pos.x=_x;this.pos.y=_y;this.updateBounds()}contains(xOrVector,y){const[_x,_y]=xOrVector instanceof Vector2d?[xOrVector.x,xOrVector.y]:[xOrVector,y];let intersects2=false;const posx=this.pos.x;const posy=this.pos.y;const points=this.points;const len=points.length;for(let i=0,j=len-1;i<len;j=i++){const iy=points[i].y+posy;const ix=points[i].x+posx;const jy=points[j].y+posy;const jx=points[j].x+posx;if(iy>_y!==jy>_y&&_x<(jx-ix)*(_y-iy)/(jy-iy)+ix){intersects2=!intersects2}}return intersects2}getBounds(){return this._bounds}updateBounds(){const bounds=this.getBounds();bounds.update(this.points);bounds.translate(this.pos);return bounds}clone(){return polygonPool.get(this.pos.x,this.pos.y,this.points.map(point=>point.clone()))}};var polygonPool=createPool((x,y,vertices)=>{const polygon=new Polygon(x,y,vertices);return{instance:polygon,reset(x2,y2,points){polygon.pos.set(x2,y2);polygon.setVertices(points)}}});var Rect=class _Rect extends Polygon{constructor(x,y,w,h){super(x,y,[vector2dPool.get(0,0),vector2dPool.get(w,0),vector2dPool.get(w,h),vector2dPool.get(0,h)]);this.type="Rectangle"}setSize(width,height){this.points[0].set(0,0);this.points[1].set(width,0);this.points[2].set(width,height);this.points[3].set(0,height);return this}get left(){return this.pos.x}get right(){const w=this.width;return this.left+w||w}get top(){return this.pos.y}get bottom(){const h=this.height;return this.top+h||h}get width(){return this.points[2].x}set width(value){this.points[1].x=this.points[2].x=value;this.recalc();this.updateBounds()}get height(){return this.points[2].y}set height(value){this.points[2].y=this.points[3].y=value;this.recalc();this.updateBounds()}get centerX(){if(isFinite(this.width)){return this.left+this.width/2}else{return this.width}}set centerX(value){this.pos.x=value-this.width/2;this.recalc();this.updateBounds()}get centerY(){if(isFinite(this.height)){return this.top+this.height/2}else{return this.height}}set centerY(value){this.pos.y=value-this.height/2;this.recalc();this.updateBounds()}centerOn(x,y){this.centerX=x;this.centerY=y;return this}resize(w,h){this.width=w;this.height=h;return this}scale(x,y=x){this.width*=x;this.height*=y;return this}clone(){return new _Rect(this.left,this.top,this.width,this.height)}copy(rect){this.pos.set(rect.pos.x,rect.pos.y);this.setSize(rect.width,rect.height);return this}union(rect){const x1=Math.min(this.left,rect.left);const y1=Math.min(this.top,rect.top);this.resize(Math.max(this.right,rect.right)-x1,Math.max(this.bottom,rect.bottom)-y1);this.pos.set(x1,y1);return this}overlaps(rect){return this.left<rect.right&&rect.left<this.right&&this.top<rect.bottom&&rect.top<this.bottom}contains(xOrVector,y){let _x1;let _x2;let _y1;let _y2;if(xOrVector instanceof Vector2d){_x1=_x2=xOrVector.x;_y1=_y2=xOrVector.y}else{_x1=_x2=xOrVector;_y1=_y2=y}return _x1>=this.left&&_x2<=this.right&&_y1>=this.top&&_y2<=this.bottom}containsRectangle(rectangle){return rectangle.left>=this.left&&rectangle.right<=this.right&&rectangle.top>=this.top&&rectangle.bottom<=this.bottom}equals(rect){return rect.left===this.left&&rect.right===this.right&&rect.top===this.top&&rect.bottom===this.bottom}isFinite(){return isFinite(this.left)&&isFinite(this.top)&&isFinite(this.width)&&isFinite(this.height)}toPolygon(){return polygonPool.get(this.left,this.top,this.points)}};var rectPool=createPool((x,y,width,height)=>{const rectangle=new Rect(x,y,width,height);return{instance:rectangle,reset(x2,y2,width2,height2){rectangle.pos.set(x2,y2);rectangle.setSize(width2,height2)}}});var Ellipse=class _Ellipse{constructor(x,y,w,h){this.type="Ellipse";this.pos=new Vector2d;this._bounds=new Bounds;this.radius=NaN;this.radiusV=new Vector2d;this.radiusSq=new Vector2d;this.ratio=vector2dPool.get();this.setShape(x,y,w,h)}setShape(x,y,w,h){const hW=w/2;const hH=h/2;const radius=Math.max(hW,hH);const r=radius*radius;this.pos.set(x,y);this.radius=radius;this.ratio.set(hW/radius,hH/radius);this.radiusV.set(radius,radius).scaleV(this.ratio);this.radiusSq.set(r,r).scaleV(this.ratio);const bounds=this.getBounds();bounds.setMinMax(x,y,x+w,x+h);bounds.translate(-this.radiusV.x,-this.radiusV.y);return this}rotate(angle,v){const bounds=this.getBounds();this.pos.rotate(angle,v);bounds.shift(this.pos);bounds.translate(-this.radiusV.x,-this.radiusV.y);return this}scale(x,y=x){return this.setShape(this.pos.x,this.pos.y,this.radiusV.x*2*x,this.radiusV.y*2*y)}scaleV(v){return this.scale(v.x,v.y)}transform(){return this}translate(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}this.pos.x+=_x;this.pos.y+=_y;this.getBounds().translate(_x,_y);return this}contains(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){[_x,_y]=[xOrVector.x,xOrVector.y]}else{_x=xOrVector;_y=y}_x-=this.pos.x;_y-=this.pos.y;return _x*_x/this.radiusSq.x+_y*_y/this.radiusSq.y<=1}getBounds(){if(typeof this._bounds==="undefined"){this._bounds=boundsPool.get()}return this._bounds}clone(){return new _Ellipse(this.pos.x,this.pos.y,this.radiusV.x*2,this.radiusV.y*2)}};var ellipsePool=createPool((x,y,width,height)=>{const instance=new Ellipse(x,y,width,height);return{instance:instance,reset(x2,y2,width2,height2){instance.setShape(x2,y2,width2,height2)}}});var Line=class _Line extends Polygon{contains(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}_x-=this.pos.x;_y-=this.pos.y;const[start,end]=this.points;return(_y-start.y)*(end.x-start.x)===(end.y-start.y)*(_x-start.x)}recalc(){const edges=this.edges;const normals=this.normals;const indices=this.indices;const points=this.points;if(points.length!==2){throw new Error("Requires exactly 2 points")}if(edges[0]===void 0){edges[0]=vector2dPool.get()}edges[0].copy(points[1]).sub(points[0]);if(normals[0]===void 0){normals[0]=vector2dPool.get()}normals[0].copy(edges[0]).perp().normalize();indices.length=0;return this}clone(){return new _Line(this.pos.x,this.pos.y,this.points.map(point=>point.clone()))}};var linePool=createPool((x,y,points)=>{const line=new Line(x,y,points);return{instance:line,reset(x2,y2,points2){line.pos.set(x2,y2);line.setVertices(points2)}}});var DEFAULT_RADIUS=20;var RoundRect=class _RoundRect extends Rect{constructor(x,y,width,height,radius=DEFAULT_RADIUS){super(x,y,width,height);this.type="RoundRect";this.type="RoundRect";this.radius=radius}get radius(){return this._radius}set radius(value){if(this.width<2*value){value=this.width/2}if(this.height<2*value){value=this.height/2}this._radius=value}copy(rrect){this.pos.set(rrect.pos.x,rrect.pos.y);this.setSize(rrect.width,rrect.height);this.radius=rrect.radius;return this}contains(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}if(_x<this.left||_x>=this.right||_y<this.top||_y>=this.bottom){return false}if(_x>=this.left+this.radius&&_x<=this.right-this.radius||_y>=this.top+this.radius&&_y<=this.bottom-this.radius){return true}let tx;let ty;const radiusX=Math.max(0,Math.min(this.radius,this.width/2));const radiusY=Math.max(0,Math.min(this.radius,this.height/2));if(_x<this.left+radiusX&&_y<this.top+radiusY){tx=_x-this.left-radiusX;ty=_y-this.top-radiusY}else if(_x>this.right-radiusX&&_y<this.top+radiusY){tx=_x-this.right+radiusX;ty=_y-this.top-radiusY}else if(_x>this.right-radiusX&&_y>this.bottom-radiusY){tx=_x-this.right+radiusX;ty=_y-this.bottom+radiusY}else if(_x<this.left+radiusX&&_y>this.bottom-radiusY){tx=_x-this.left-radiusX;ty=_y-this.bottom+radiusY}else{return false}return tx*tx+ty*ty<=radiusX*radiusY}equals(rrect){return super.equals(rrect)&&this.radius===rrect.radius}clone(){return new _RoundRect(this.pos.x,this.pos.y,this.width,this.height,this.radius)}};var roundedRectanglePool=createPool((x,y,width,height,radius)=>{const roundedRectangle=new RoundRect(x,y,width,height,radius);return{instance:roundedRectangle,reset(x2,y2,width2,height2,radius2=DEFAULT_RADIUS){roundedRectangle.pos.set(x2,y2);roundedRectangle.setSize(width2,height2);roundedRectangle.radius=radius2}}});var charLookup=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function toHex(component){return charLookup[(component&240)>>4]+charLookup[component&15]}function hue2rgb(p,q,t){if(t<0){t+=1}if(t>1){t-=1}if(t<1/6){return p+(q-p)*6*t}if(t<1/2){return q}if(t<2/3){return p+(q-p)*(2/3-t)*6}return p}var rgbaRx=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d.]+))?\)$/;var hex3Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/;var hex4Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/;var hex6Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;var hex8Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;var CSS_COLORS=[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]];var cssToRGB=new Map;for(const[name,rgb]of CSS_COLORS){cssToRGB.set(name,rgb)}var Color=class{constructor(r=0,g=0,b=0,alpha2=1){if(typeof r==="number"){this.glArray=new Float32Array([0,0,0,1]);this.setColor(r,g,b,alpha2)}else if(typeof r==="string"){this.glArray=new Float32Array([0,0,0,1]);this.parseCSS(r)}else if(typeof r==="object"){this.glArray=r.glArray.slice()}else{throw new Error("Color: invalid parameter")}}get r(){return~~(this.glArray[0]*255)}set r(value){this.glArray[0]=clamp(value,0,255)/255}get g(){return~~(this.glArray[1]*255)}set g(value){this.glArray[1]=clamp(value,0,255)/255}get b(){return~~(this.glArray[2]*255)}set b(value){this.glArray[2]=clamp(value,0,255)/255}get alpha(){return this.glArray[3]}set alpha(value){this.glArray[3]=clamp(value,0,1)}setColor(r=0,g=0,b=0,alpha2=1){this.r=r;this.g=g;this.b=b;this.alpha=alpha2;return this}setFloat(r,g,b,alpha2=1){const a=this.glArray;a[0]=clamp(+r,0,1);a[1]=clamp(+g,0,1);a[2]=clamp(+b,0,1);a[3]=clamp(+alpha2,0,1);return this}setHSV(h,s,v){let r;let g;let b;const i=Math.floor(h*6);const f=h*6-i;const p=v*(1-s);const q=v*(1-f*s);const t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break}return this.setColor(r*255,g*255,b*255)}setHSL(h,s,l){let r;let g;let b;if(s===0){r=g=b=l}else{const q=l<.5?l*(1+s):l+s-l*s;const p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return this.setColor(r*255,g*255,b*255)}clone(){return colorPool.get(this)}copy(color){if(typeof color==="string"){return this.parseCSS(color)}else{this.glArray.set(color.glArray);return this}}add(color){this.glArray[0]=clamp(this.glArray[0]+color.glArray[0],0,1);this.glArray[1]=clamp(this.glArray[1]+color.glArray[1],0,1);this.glArray[2]=clamp(this.glArray[2]+color.glArray[2],0,1);this.glArray[3]=(this.glArray[3]+color.glArray[3])/2;return this}darken(scale2){scale2=clamp(scale2,0,1);this.glArray[0]*=scale2;this.glArray[1]*=scale2;this.glArray[2]*=scale2;return this}lerp(color,alpha2){alpha2=clamp(alpha2,0,1);this.glArray[0]+=(color.glArray[0]-this.glArray[0])*alpha2;this.glArray[1]+=(color.glArray[1]-this.glArray[1])*alpha2;this.glArray[2]+=(color.glArray[2]-this.glArray[2])*alpha2;return this}lighten(scale2){scale2=clamp(scale2,0,1);this.glArray[0]=clamp(this.glArray[0]+(1-this.glArray[0])*scale2,0,1);this.glArray[1]=clamp(this.glArray[1]+(1-this.glArray[1])*scale2,0,1);this.glArray[2]=clamp(this.glArray[2]+(1-this.glArray[2])*scale2,0,1);return this}random(min=0,max=255){if(min<0){min=0}if(max>255){max=255}return this.setColor(random(min,max),random(min,max),random(min,max),this.alpha)}equals(color){return this.glArray[0]===color.glArray[0]&&this.glArray[1]===color.glArray[1]&&this.glArray[2]===color.glArray[2]&&this.glArray[3]===color.glArray[3]}parseCSS(cssColor){const rgb=cssToRGB.get(cssColor);if(!rgb){return this.parseRGB(cssColor)}return this.setColor(...rgb)}parseRGB(rgbColor){const match=rgbaRx.exec(rgbColor);if(!match){return this.parseHex(rgbColor)}return this.setColor(+match[1],+match[2],+match[3],typeof match[5]!=="undefined"?+match[5]:1)}parseHex(hexColor,argb=false){let match;if(match=hex8Rx.exec(hexColor)){return this.setColor(parseInt(match[!argb?1:2],16),parseInt(match[!argb?2:3],16),parseInt(match[!argb?3:4],16),Number((clamp(parseInt(match[!argb?4:1],16),0,255)/255).toFixed(1)))}if(match=hex6Rx.exec(hexColor)){return this.setColor(parseInt(match[1],16),parseInt(match[2],16),parseInt(match[3],16))}if(match=hex4Rx.exec(hexColor)){const r=match[!argb?1:2];const g=match[!argb?2:3];const b=match[!argb?3:4];const a=match[!argb?4:1];return this.setColor(parseInt(r+r,16),parseInt(g+g,16),parseInt(b+b,16),Number((clamp(parseInt(a+a,16),0,255)/255).toFixed(1)))}if(match=hex3Rx.exec(hexColor)){return this.setColor(parseInt(match[1]+match[1],16),parseInt(match[2]+match[2],16),parseInt(match[3]+match[3],16))}throw new Error(`invalid parameter: ${hexColor}`)}toUint32(alpha2=1){const a=this.glArray;const ur=a[0]*255>>0;const ug=a[1]*255>>0;const ub=a[2]*255>>0;return alpha2*255>>0<<24|ur<<16|ug<<8|ub}toArray(){return this.glArray}toHex(){return`#${toHex(this.r)}${toHex(this.g)}${toHex(this.b)}`}toHex8(alpha2=this.alpha){return`#${toHex(this.r)}${toHex(this.g)}${toHex(this.b)}${toHex(alpha2*255)}`}toRGB(){return`rgb(${this.r},${this.g},${this.b})`}toRGBA(alpha2=this.alpha){return`rgba(${this.r},${this.g},${this.b},${alpha2})`}};var colorPool=createPool((r,g,b,alpha2)=>{const color=new Color(r,g,b,alpha2);return{instance:color,reset(r2,g2,b2,alpha3){if(arguments.length===0){color.setColor()}else{if(typeof r2==="number"){color.setColor(r2,g2,b2,alpha3)}else{color.copy(r2)}}}}});var Vector3d=class _Vector3d{constructor(x=0,y=0,z=0){this.onResetEvent(x,y,z)}onResetEvent(x=0,y=0,z=0){this.x=x;this.y=y;this.z=z}set(x,y,z=0){this.x=x;this.y=y;this.z=z;return this}setZero(){return this.set(0,0,0)}setV(v){return this.set(v.x,v.y,"z"in v?v.z:void 0)}add(v){return this.set(this.x+v.x,this.y+v.y,this.z+("z"in v?v.z:0))}sub(v){return this.set(this.x-v.x,this.y-v.y,this.z-("z"in v?v.z:0))}scale(x,y=x,z=1){return this.set(this.x*x,this.y*y,this.z*z)}scaleV(v){return this.scale(v.x,v.y,v.z)}toIso(){return this.set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this.set(this.y+this.x/2,this.y-this.x/2,this.z)}div(n){return this.set(this.x/n,this.y/n,this.z/n)}abs(){return this.set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(low,high){return new _Vector3d(clamp(this.x,low,high),clamp(this.y,low,high),clamp(this.z,low,high))}clampSelf(low,high){return this.set(clamp(this.x,low,high),clamp(this.y,low,high),clamp(this.z,low,high))}minV(v){const _vz="z"in v?v.z:0;return this.set(this.x<v.x?this.x:v.x,this.y<v.y?this.y:v.y,this.z<_vz?this.z:_vz)}maxV(v){const _vz="z"in v?v.z:0;return this.set(this.x>v.x?this.x:v.x,this.y>v.y?this.y:v.y,this.z>_vz?this.z:_vz)}floor(){return new _Vector3d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this.set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new _Vector3d(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this.set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new _Vector3d(-this.x,-this.y,-this.z)}negateSelf(){return this.set(-this.x,-this.y,-this.z)}copy(v){return this.set(v.x,v.y,"z"in v?v.z:0)}equals(...args){let _x;let _y;let _z;if(args.length===1){const arg=args[0];if(arg instanceof Vector2d||arg instanceof _Vector3d){[_x,_y,_z]=[arg.x,arg.y,"z"in arg?arg.z:this.z]}else{_x=arg;_y=this.y;_z=this.z}}else if(args.length===2){[_x,_y,_z]=[args[0],args[1],this.z]}else{[_x,_y,_z]=args}return this.x===_x&&this.y===_y&&this.z===_z}normalize(){return this.div(this.length()||1)}perp(){return this.set(this.y,-this.x,this.z)}rotate(angle,v){let cx=0;let cy=0;if(v){cx=v.x;cy=v.y}const x=this.x-cx;const y=this.y-cy;const c=Math.cos(angle);const s=Math.sin(angle);return this.set(x*c-y*s+cx,x*s+y*c+cy,this.z)}dot(v){return this.x*v.x+this.y*v.y+this.z*("z"in v?v.z:this.z)}cross(v){const ax=this.x;const ay=this.y;const az=this.z;const bx=v.x;const by=v.y;const bz=v.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this}length2(){return this.dot(this)}length(){return Math.sqrt(this.length2())}lerp(v,alpha2){this.x+=(v.x-this.x)*alpha2;this.y+=(v.y-this.y)*alpha2;this.z+=(v.z-this.z)*alpha2;return this}moveTowards(target,step){const angle=Math.atan2(target.y-this.y,target.x-this.x);const dx=this.x-target.x;const dy=this.y-target.y;const distance=Math.sqrt(dx*dx+dy*dy);if(distance===0||step>=0&&distance<=step*step){return target}this.x+=Math.cos(angle)*step;this.y+=Math.sin(angle)*step;return this}distance(v){const dx=this.x-v.x;const dy=this.y-v.y;const dz=this.z-("z"in v?v.z:0);return Math.sqrt(dx*dx+dy*dy+dz*dz)}angle(v){return Math.acos(clamp(this.dot(v)/(this.length()*v.length()),-1,1))}project(v){const ratio=this.dot(v)/v.length2();return this.scale(ratio,ratio,ratio)}projectN(v){const ratio=this.dot(v)/v.length2();return this.scale(ratio,ratio,ratio)}clone(){return vector3dPool.get(this.x,this.y,this.z)}toString(){return`x:${this.x},y:${this.y},z:${this.z}`}};var vector3dPool=createPool((x,y,z)=>{const vector=new Vector3d(x,y,z);return{instance:vector,reset(x2=0,y2=0,z2=0){vector.x=x2;vector.y=y2;vector.z=z2}}});var reset=(instance,...value)=>{if(value[0]instanceof Matrix3d){instance.copy(value[0])}else if(typeof value[0]==="number"){instance.setTransform(...value)}else{instance.identity()}};var Matrix3d=class{constructor(...value){this.val=new Float32Array(16);reset(this,...value)}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(...values){const a=this.val;a[0]=values[0];a[1]=values[1];a[2]=values[2];a[3]=values[3];a[4]=values[4];a[5]=values[5];a[6]=values[6];a[7]=values[7];a[8]=values[8];a[9]=values[9];a[10]=values[10];a[11]=values[11];a[12]=values[12];a[13]=values[13];a[14]=values[14];a[15]=values[15];return this}copy(m){this.val.set(m.val);return this}fromMat2d(m){const b=m.val;return this.setTransform(b[0],b[3],b[6],0,b[1],b[4],b[7],0,b[2],b[5],b[8],0,0,0,0,1)}multiply(m){const a=this.val;const b=m.val;const a00=a[0];const a01=a[1];const a02=a[2];const a03=a[3];const a10=a[4];const a11=a[5];const a12=a[6];const a13=a[7];const a20=a[8];const a21=a[9];const a22=a[10];const a23=a[11];const a30=a[12];const a31=a[13];const a32=a[14];const a33=a[15];let b0=b[0];let b1=b[1];let b2=b[2];let b3=b[3];a[0]=b0*a00+b1*a10+b2*a20+b3*a30;a[1]=b0*a01+b1*a11+b2*a21+b3*a31;a[2]=b0*a02+b1*a12+b2*a22+b3*a32;a[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];a[4]=b0*a00+b1*a10+b2*a20+b3*a30;a[5]=b0*a01+b1*a11+b2*a21+b3*a31;a[6]=b0*a02+b1*a12+b2*a22+b3*a32;a[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];a[8]=b0*a00+b1*a10+b2*a20+b3*a30;a[9]=b0*a01+b1*a11+b2*a21+b3*a31;a[10]=b0*a02+b1*a12+b2*a22+b3*a32;a[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];a[12]=b0*a00+b1*a10+b2*a20+b3*a30;a[13]=b0*a01+b1*a11+b2*a21+b3*a31;a[14]=b0*a02+b1*a12+b2*a22+b3*a32;a[15]=b0*a03+b1*a13+b2*a23+b3*a33;return this}transpose(){const a=this.val;const a01=a[1];const a02=a[2];const a03=a[3];const a12=a[6];const a13=a[7];const a23=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=a01;a[6]=a[9];a[7]=a[13];a[8]=a02;a[9]=a12;a[11]=a[14];a[12]=a03;a[13]=a13;a[14]=a23;return this}invert(){const a=this.val;const a00=a[0];const a01=a[1];const a02=a[2];const a03=a[3];const a10=a[4];const a11=a[5];const a12=a[6];const a13=a[7];const a20=a[8];const a21=a[9];const a22=a[10];const a23=a[11];const a30=a[12];const a31=a[13];const a32=a[14];const a33=a[15];const b00=a00*a11-a01*a10;const b01=a00*a12-a02*a10;const b02=a00*a13-a03*a10;const b03=a01*a12-a02*a11;const b04=a01*a13-a03*a11;const b05=a02*a13-a03*a12;const b06=a20*a31-a21*a30;const b07=a20*a32-a22*a30;const b08=a20*a33-a23*a30;const b09=a21*a32-a22*a31;const b10=a21*a33-a23*a31;const b11=a22*a33-a23*a32;let det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return this.identity()}det=1/det;a[0]=(a11*b11-a12*b10+a13*b09)*det;a[1]=(a02*b10-a01*b11-a03*b09)*det;a[2]=(a31*b05-a32*b04+a33*b03)*det;a[3]=(a22*b04-a21*b05-a23*b03)*det;a[4]=(a12*b08-a10*b11-a13*b07)*det;a[5]=(a00*b11-a02*b08+a03*b07)*det;a[6]=(a32*b02-a30*b05-a33*b01)*det;a[7]=(a20*b05-a22*b02+a23*b01)*det;a[8]=(a10*b10-a11*b08+a13*b06)*det;a[9]=(a01*b08-a00*b10-a03*b06)*det;a[10]=(a30*b04-a31*b02+a33*b00)*det;a[11]=(a21*b02-a20*b04-a23*b00)*det;a[12]=(a11*b07-a10*b09-a12*b06)*det;a[13]=(a00*b09-a01*b07+a02*b06)*det;a[14]=(a31*b01-a30*b03-a32*b00)*det;a[15]=(a20*b03-a21*b01+a22*b00)*det;return this}apply(v){const a=this.val;const x=v.x;const y=v.y;const z="z"in v?v.z:1;const w=a[3]*x+a[7]*y+a[11]*z+a[15]||1;v.x=(a[0]*x+a[4]*y+a[8]*z+a[12])/w;v.y=(a[1]*x+a[5]*y+a[9]*z+a[13])/w;if("z"in v){v.z=(a[2]*x+a[6]*y+a[10]*z+a[14])/w}return v}applyInverse(v){const im=matrix3dPool.get(this).invert();im.apply(v);matrix3dPool.release(im);return v}ortho(left,right,bottom,top,near,far){const a=this.val;const leftRight=1/(left-right);const bottomTop=1/(bottom-top);const nearFar=1/(near-far);a[0]=-2*leftRight;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*bottomTop;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*nearFar;a[11]=0;a[12]=(left+right)*leftRight;a[13]=(top+bottom)*bottomTop;a[14]=(far+near)*nearFar;a[15]=1;return this}scale(x,y=x,z=0){const a=this.val;a[0]=a[0]*x;a[1]=a[1]*x;a[2]=a[2]*x;a[3]=a[3]*x;a[4]=a[4]*y;a[5]=a[5]*y;a[6]=a[6]*y;a[7]=a[7]*y;a[8]=a[8]*z;a[9]=a[9]*z;a[10]=a[10]*z;a[11]=a[11]*z;return this}scaleV(v){return this.scale(v.x,v.y,v.z)}scaleX(x){return this.scale(x,1)}scaleY(y){return this.scale(1,y)}rotate(angle,v){if(angle!==0){const a=this.val;let x=v.x;let y=v.y;let z=v.z;let len=Math.sqrt(x*x+y*y+z*z);if(len<EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;const s=Math.sin(angle);const c=Math.cos(angle);const t=1-c;const a00=a[0];const a01=a[1];const a02=a[2];const a03=a[3];const a10=a[4];const a11=a[5];const a12=a[6];const a13=a[7];const a20=a[8];const a21=a[9];const a22=a[10];const a23=a[11];const b00=x*x*t+c;const b01=y*x*t+z*s;const b02=z*x*t-y*s;const b10=x*y*t-z*s;const b11=y*y*t+c;const b12=z*y*t+x*s;const b20=x*z*t+y*s;const b21=y*z*t-x*s;const b22=z*z*t+c;a[0]=a00*b00+a10*b01+a20*b02;a[1]=a01*b00+a11*b01+a21*b02;a[2]=a02*b00+a12*b01+a22*b02;a[3]=a03*b00+a13*b01+a23*b02;a[4]=a00*b10+a10*b11+a20*b12;a[5]=a01*b10+a11*b11+a21*b12;a[6]=a02*b10+a12*b11+a22*b12;a[7]=a03*b10+a13*b11+a23*b12;a[8]=a00*b20+a10*b21+a20*b22;a[9]=a01*b20+a11*b21+a21*b22;a[10]=a02*b20+a12*b21+a22*b22;a[11]=a03*b20+a13*b21+a23*b22}return this}translate(xOrVector,y,z){const a=this.val;let _x;let _y;let _z;if(xOrVector instanceof Vector3d){_x=xOrVector.x;_y=xOrVector.y;_z=xOrVector.z}else if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y;_z=0}else{_x=xOrVector;_y=y;_z=z??0}a[12]=a[0]*_x+a[4]*_y+a[8]*_z+a[12];a[13]=a[1]*_x+a[5]*_y+a[9]*_z+a[13];a[14]=a[2]*_x+a[6]*_y+a[10]*_z+a[14];a[15]=a[3]*_x+a[7]*_y+a[11]*_z+a[15];return this}isIdentity(){const a=this.val;return a[0]===1&&a[1]===0&&a[2]===0&&a[3]===0&&a[4]===0&&a[5]===1&&a[6]===0&&a[7]===0&&a[8]===0&&a[9]===0&&a[10]===1&&a[11]===0&&a[12]===0&&a[13]===0&&a[14]===0&&a[15]===1}equals(m){const b=m.val;const a=this.val;return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}clone(){return matrix3dPool.get(this)}toArray(){return this.val}toString(){const a=this.val;return`Matrix3d(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]}, ${a[4]}, ${a[5]}, ${a[6]}, ${a[7]}, ${a[8]}, ${a[9]}, ${a[10]}, ${a[11]}, ${a[12]}, ${a[13]}, ${a[14]}, ${a[15]})`}};var matrix3dPool=createPool((...values)=>{const instance=new Matrix3d(...values);return{instance:instance,reset(...value){reset(instance,...value)}}});var reset2=(instance,...value)=>{if(value[0]instanceof Matrix3d){instance.fromMat3d(value[0])}else if(value[0]instanceof Matrix2d){instance.copy(value[0])}else if(typeof value[0]==="number"){instance.setTransform(...value)}else{instance.identity()}};var Matrix2d=class{constructor(...value){this.val=new Float32Array(9);reset2(this,...value)}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){this.setTransform(1,0,0,0,1,0,0,0,1);return this}setTransform(...values){if(values.length===9){this.val[0]=values[0];this.val[1]=values[1];this.val[2]=values[2];this.val[3]=values[3];this.val[4]=values[4];this.val[5]=values[5];this.val[6]=values[6];this.val[7]=values[7];this.val[8]=values[8]}else if(values.length===6){this.val[0]=values[0];this.val[1]=values[2];this.val[2]=values[4];this.val[3]=values[1];this.val[4]=values[3];this.val[5]=values[5];this.val[6]=0;this.val[7]=0;this.val[8]=1}return this}transform(a,b,c,d,e,f){const v=this.val;const a0=v[0];const a1=v[1];const a3=v[3];const a4=v[4];const b0=a;const b1=b;const b3=c;const b4=d;const b6=e;const b7=f;v[0]=a0*b0+a3*b1;v[1]=a1*b0+a4*b1;v[3]=a0*b3+a3*b4;v[4]=a1*b3+a4*b4;v[6]+=a0*b6+a3*b7;v[7]+=a1*b6+a4*b7;return this}copy(m){this.val.set(m.val);return this}fromMat3d(m){this.val[0]=m.val[0];this.val[1]=m.val[1];this.val[2]=m.val[2];this.val[3]=m.val[4];this.val[4]=m.val[5];this.val[5]=m.val[6];this.val[6]=m.val[8];this.val[7]=m.val[9];this.val[8]=m.val[10];return this}multiply(m){const b=m.val;const a=this.val;const a0=a[0];const a1=a[1];const a3=a[3];const a4=a[4];const b0=b[0];const b1=b[1];const b3=b[3];const b4=b[4];const b6=b[6];const b7=b[7];a[0]=a0*b0+a3*b1;a[1]=a1*b0+a4*b1;a[3]=a0*b3+a3*b4;a[4]=a1*b3+a4*b4;a[6]+=a0*b6+a3*b7;a[7]+=a1*b6+a4*b7;return this}transpose(){const a=this.val;const a1=a[1];const a2=a[2];const a5=a[5];a[1]=a[3];a[2]=a[6];a[3]=a1;a[5]=a[7];a[6]=a2;a[7]=a5;return this}invert(){const val=this.val;const a=val[0];const b=val[1];const c=val[2];const d=val[3];const e=val[4];const f=val[5];const g=val[6];const h=val[7];const i=val[8];const ta=i*e-f*h;const td=f*g-i*d;const tg=h*d-e*g;const n=a*ta+b*td+c*tg;val[0]=ta/n;val[1]=(c*h-i*b)/n;val[2]=(f*b-c*e)/n;val[3]=td/n;val[4]=(i*a-c*g)/n;val[5]=(c*d-f*a)/n;val[6]=tg/n;val[7]=(b*g-h*a)/n;val[8]=(e*a-b*d)/n;return this}apply(v){const a=this.val;const x=v.x;const y=v.y;const z="z"in v?v.z:1;v.x=x*a[0]+y*a[3]+z*a[6];v.y=x*a[1]+y*a[4]+z*a[7];if("z"in v){v.z=x*a[2]+y*a[5]+z*a[8]}return v}applyInverse(v){const a=this.val;const x=v.x;const y=v.y;const invD=1/(a[0]*a[4]+a[3]*-a[1]);v.x=a[4]*invD*x+-a[3]*invD*y+(a[7]*a[3]-a[6]*a[4])*invD;v.y=a[0]*invD*y+-a[1]*invD*x+(-a[7]*a[0]+a[6]*a[1])*invD;return v}scale(x,y=x){const a=this.val;a[0]*=x;a[1]*=x;a[3]*=y;a[4]*=y;return this}scaleV(v){return this.scale(v.x,v.y)}scaleX(x){return this.scale(x,1)}scaleY(y){return this.scale(1,y)}rotate(angle){if(angle!==0){const a00=this.val[0];const a01=this.val[1];const a02=this.val[2];const a10=this.val[3];const a11=this.val[4];const a12=this.val[5];const s=Math.sin(angle);const c=Math.cos(angle);this.val[0]=c*a00+s*a10;this.val[1]=c*a01+s*a11;this.val[2]=c*a02+s*a12;this.val[3]=c*a10-s*a00;this.val[4]=c*a11-s*a01;this.val[5]=c*a12-s*a02}return this}translate(xOrVector,y){let _x;let _y;if(xOrVector instanceof Vector2d){_x=xOrVector.x;_y=xOrVector.y}else{_x=xOrVector;_y=y}this.val[6]+=this.val[0]*_x+this.val[3]*_y;this.val[7]+=this.val[1]*_x+this.val[4]*_y;return this}isIdentity(){return this.val[0]===1&&this.val[1]===0&&this.val[2]===0&&this.val[3]===0&&this.val[4]===1&&this.val[5]===0&&this.val[6]===0&&this.val[7]===0&&this.val[8]===1}equals(m){return this.val[0]===m.val[0]&&this.val[1]===m.val[1]&&this.val[2]===m.val[2]&&this.val[3]===m.val[3]&&this.val[4]===m.val[4]&&this.val[5]===m.val[5]&&this.val[6]===m.val[6]&&this.val[7]===m.val[7]&&this.val[8]===m.val[8]}clone(){return matrix2dPool.get(this)}toArray(){return this.val}toString(){const a=this.val;return`Matrix2d(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]}, ${a[4]}, ${a[5]}, ${a[6]}, ${a[7]}, ${a[8]})`}};var matrix2dPool=createPool((...values)=>{const instance=new Matrix2d(...values);return{instance:instance,reset(...value){reset2(instance,...value)}}});var event_exports={};__export(event_exports,{BLUR:()=>BLUR,BOOT:()=>BOOT,CANVAS_ONRESIZE:()=>CANVAS_ONRESIZE,DOM_READY:()=>DOM_READY,DRAGEND:()=>DRAGEND,DRAGSTART:()=>DRAGSTART,FOCUS:()=>FOCUS,GAMEPAD_CONNECTED:()=>GAMEPAD_CONNECTED,GAMEPAD_DISCONNECTED:()=>GAMEPAD_DISCONNECTED,GAMEPAD_UPDATE:()=>GAMEPAD_UPDATE,GAME_AFTER_DRAW:()=>GAME_AFTER_DRAW,GAME_AFTER_UPDATE:()=>GAME_AFTER_UPDATE,GAME_BEFORE_DRAW:()=>GAME_BEFORE_DRAW,GAME_BEFORE_UPDATE:()=>GAME_BEFORE_UPDATE,GAME_INIT:()=>GAME_INIT,GAME_RESET:()=>GAME_RESET,GAME_UPDATE:()=>GAME_UPDATE,KEYDOWN:()=>KEYDOWN,KEYUP:()=>KEYUP,LEVEL_LOADED:()=>LEVEL_LOADED,LOADER_COMPLETE:()=>LOADER_COMPLETE,LOADER_ERROR:()=>LOADER_ERROR,LOADER_PROGRESS:()=>LOADER_PROGRESS,ONCONTEXT_LOST:()=>ONCONTEXT_LOST,ONCONTEXT_RESTORED:()=>ONCONTEXT_RESTORED,POINTERLOCKCHANGE:()=>POINTERLOCKCHANGE,POINTERMOVE:()=>POINTERMOVE,STAGE_RESET:()=>STAGE_RESET,STATE_CHANGE:()=>STATE_CHANGE,STATE_PAUSE:()=>STATE_PAUSE,STATE_RESTART:()=>STATE_RESTART,STATE_RESUME:()=>STATE_RESUME,STATE_STOP:()=>STATE_STOP,TICK:()=>TICK,VIDEO_INIT:()=>VIDEO_INIT,VIEWPORT_ONCHANGE:()=>VIEWPORT_ONCHANGE,VIEWPORT_ONRESIZE:()=>VIEWPORT_ONRESIZE,WINDOW_ONORIENTATION_CHANGE:()=>WINDOW_ONORIENTATION_CHANGE,WINDOW_ONRESIZE:()=>WINDOW_ONRESIZE,WINDOW_ONSCROLL:()=>WINDOW_ONSCROLL,WORLD_STEP:()=>WORLD_STEP,eventEmitter:()=>eventEmitter,off:()=>off,on:()=>on,once:()=>once});var EventEmitter=class{constructor(){this.eventListeners={};this.eventListenersOnce={}}addListener(event,listener){let eventListenerList=this.eventListeners[event];if(!eventListenerList){eventListenerList=[];this.eventListeners[event]=eventListenerList}eventListenerList.push(listener);return()=>{this.removeListener(event,listener)}}addListenerOnce(event,listener){let eventListenerList=this.eventListenersOnce[event];if(!eventListenerList){eventListenerList=[];this.eventListenersOnce[event]=eventListenerList}eventListenerList.push(listener)}removeAllListeners(event){if(event){delete this.eventListeners[event]}else{this.eventListeners={}}}removeListener(event,listener){const listeners=this.eventListeners[event];if(listeners?.includes(listener)){listeners.splice(listeners.indexOf(listener),1)}const listenersOnce=this.eventListenersOnce[event];if(listenersOnce?.includes(listener)){listenersOnce.splice(listenersOnce.indexOf(listener),1)}}emit(event,...args){const listeners=this.eventListeners[event];if(listeners){for(const listener of listeners){listener(...args)}}const listenersOnce=this.eventListenersOnce[event];if(listenersOnce){for(const listener of listenersOnce){listener(...args)}this.eventListenersOnce[event]=[]}}hasListener(event,listener){return Array.from(this.eventListeners[event]?.values()??[]).includes(listener)||Array.from(this.eventListenersOnce[event]?.values()??[]).includes(listener)}};var DOM_READY="dom_ready";var BOOT="me.boot";var TICK="me.tick";var BLUR="me.blur";var FOCUS="me.focus";var STATE_PAUSE="me.state.onPause";var STATE_RESUME="me.state.onResume";var STATE_STOP="me.state.onStop";var STATE_RESTART="me.state.onRestart";var STATE_CHANGE="me.state.onChange";var STAGE_RESET="me.stage.onReset";var VIDEO_INIT="me.video.onInit";var GAME_INIT="me.game.onInit";var GAME_RESET="me.game.onReset";var GAME_BEFORE_UPDATE="me.game.beforeUpdate";var GAME_AFTER_UPDATE="me.game.afterUpdate";var GAME_UPDATE="me.game.onUpdate";var GAME_BEFORE_DRAW="me.game.beforeDraw";var GAME_AFTER_DRAW="me.game.afterDraw";var WORLD_STEP="me.world.step";var LEVEL_LOADED="me.game.onLevelLoaded";var LOADER_COMPLETE="me.loader.onload";var LOADER_PROGRESS="me.loader.onProgress";var LOADER_ERROR="me.loader.onError";var KEYDOWN="me.input.keydown";var KEYUP="me.input.keyup";var GAMEPAD_CONNECTED="gamepad.connected";var GAMEPAD_DISCONNECTED="gamepad.disconnected";var GAMEPAD_UPDATE="gamepad.update";var POINTERMOVE="me.event.pointermove";var POINTERLOCKCHANGE="me.event.pointerlockChange";var DRAGSTART="me.game.dragstart";var DRAGEND="me.game.dragend";var WINDOW_ONRESIZE="globalThis.onresize";var CANVAS_ONRESIZE="canvas.onresize";var VIEWPORT_ONRESIZE="viewport.onresize";var WINDOW_ONORIENTATION_CHANGE="globalThis.orientationchange";var WINDOW_ONSCROLL="globalThis.onscroll";var VIEWPORT_ONCHANGE="viewport.onchange";var ONCONTEXT_LOST="renderer.contextlost";var ONCONTEXT_RESTORED="renderer.contextrestored";var eventEmitter=new EventEmitter;function on(eventName,listener,context){eventEmitter.addListener(eventName,context?listener.bind(context):listener)}function once(eventName,listener,context){eventEmitter.addListenerOnce(eventName,context?listener.bind(context):listener)}function off(eventName,listener){eventEmitter.removeListener(eventName,listener)}var audio_exports={};__export(audio_exports,{disable:()=>disable,enable:()=>enable,fade:()=>fade,getCurrentTrack:()=>getCurrentTrack,getVolume:()=>getVolume,hasAudio:()=>hasAudio,hasFormat:()=>hasFormat,init:()=>init,load:()=>load,mute:()=>mute,muteAll:()=>muteAll,muted:()=>muted,orientation:()=>orientation,panner:()=>panner,pause:()=>pause,pauseTrack:()=>pauseTrack,play:()=>play,playTrack:()=>playTrack,position:()=>position,rate:()=>rate,resume:()=>resume,resumeTrack:()=>resumeTrack,seek:()=>seek,setVolume:()=>setVolume,stereo:()=>stereo,stop:()=>stop,stopOnAudioError:()=>stopOnAudioError,stopTrack:()=>stopTrack,unload:()=>unload,unloadAll:()=>unloadAll,unmute:()=>unmute,unmuteAll:()=>unmuteAll});var import_howler=__toESM(require_howler(),1);var string_exports={};__export(string_exports,{capitalize:()=>capitalize,isBoolean:()=>isBoolean,isDataUrl:()=>isDataUrl,isNumeric:()=>isNumeric,toHex:()=>toHex2});function capitalize(str){return str.charAt(0).toUpperCase()+str.slice(1)}function isNumeric(str){if(typeof str==="string"){str=str.trim()}return!Number.isNaN(str)&&/^[+-]?(\d+(\.\d+)?|\.\d+)$/.test(str)}function isBoolean(str){const trimmed=str.trim();return trimmed==="true"||trimmed==="false"}function toHex2(str){let res="";let c=0;while(c<str.length){res+=str.charCodeAt(c++).toString(16)}return res}function isDataUrl(str){return/^data:(.+);base64,(.+)$/.test(str)}var audioTracks={};var current_track_id=null;var retry_counter=0;var audioExts=[];var soundLoadError=function(sound_name,onerror_cb){if(retry_counter++>3){const errmsg="melonJS: failed loading "+sound_name;if(stopOnAudioError===false){disable();onerror_cb?.();console.log(errmsg+", disabling audio")}else{onerror_cb?.();throw new Error(errmsg)}}else{audioTracks[sound_name].load()}};var stopOnAudioError=true;function init(format="mp3"){audioExts=format.split(",");return!import_howler.Howler.noAudio}function hasFormat(codec){return hasAudio()&&import_howler.Howler.codecs(codec)}function hasAudio(){return!import_howler.Howler.noAudio}function enable(){unmuteAll()}function disable(){muteAll()}function load(sound2,onloadcb,onerrorcb,settings={}){const urls=[];if(audioExts.length===0){throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.")}if(isDataUrl(sound2.src)===true){urls.push(sound2.src)}else{for(let i=0;i<audioExts.length;i++){urls.push(sound2.src+sound2.name+"."+audioExts[i]+settings.nocache)}}audioTracks[sound2.name]=new import_howler.Howl({src:urls,volume:import_howler.Howler.volume(),autoplay:sound2.autoplay===true,loop:sound2.loop=true,html5:sound2.stream===true||sound2.html5===true,xhrWithCredentials:settings.withCredentials,onloaderror(){soundLoadError.call(this,sound2.name,onerrorcb)},onload(){retry_counter=0;if(typeof onloadcb==="function"){onloadcb()}}});return 1}function play(sound_name,loop=false,onend,volume){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){const id=sound2.play();if(typeof loop==="boolean"){sound2.loop(loop,id)}sound2.volume(typeof volume==="number"?clamp(volume,0,1):import_howler.Howler.volume(),id);if(typeof onend==="function"){if(loop===true){sound2.on("end",onend,id)}else{sound2.once("end",onend,id)}}return id}else{throw new Error("audio clip "+sound_name+" does not exist")}}function fade(sound_name,from,to,duration,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){sound2.fade(from,to,duration,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function seek(sound_name,...args){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.seek(...args)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function rate(sound_name,...args){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.rate(...args)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function stereo(sound_name,pan,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.stereo(pan,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function position(sound_name,x,y,z,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.pos(x,y,z,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function orientation(sound_name,x,y,z,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.orientation(x,y,z,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function panner(sound_name,attributes,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){return sound2.pannerAttr(attributes,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function stop(sound_name,id){if(typeof sound_name!=="undefined"){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){sound2.stop(id);sound2.off("end",void 0,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}else{import_howler.Howler.stop()}}function pause(sound_name,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){sound2.pause(id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function resume(sound_name,id){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){sound2.play(id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function playTrack(sound_name,volume){current_track_id=sound_name;return play(current_track_id,true,null,volume)}function stopTrack(){if(current_track_id!==null){audioTracks[current_track_id].stop();current_track_id=null}}function pauseTrack(){if(current_track_id!==null){audioTracks[current_track_id].pause()}}function resumeTrack(){if(current_track_id!==null){audioTracks[current_track_id].play()}}function getCurrentTrack(){return current_track_id}function setVolume(volume){import_howler.Howler.volume(volume)}function getVolume(){return import_howler.Howler.volume()}function mute(sound_name,id,mute2=true){const sound2=audioTracks[sound_name];if(sound2&&typeof sound2!=="undefined"){sound2.mute(mute2,id)}else{throw new Error("audio clip "+sound_name+" does not exist")}}function unmute(sound_name,id){mute(sound_name,id,false)}function muteAll(){import_howler.Howler.mute(true)}function unmuteAll(){import_howler.Howler.mute(false)}function muted(){return import_howler.Howler._muted}function unload(sound_name){if(!(sound_name in audioTracks)){return false}audioTracks[sound_name].unload();delete audioTracks[sound_name];return true}function unloadAll(){for(const sound_name in audioTracks){if(audioTracks.hasOwnProperty(sound_name)){unload(sound_name)}}}var video_exports={};__export(video_exports,{AUTO:()=>AUTO,CANVAS:()=>CANVAS,WEBGL:()=>WEBGL,createCanvas:()=>createCanvas,getParent:()=>getParent,init:()=>init2,renderer:()=>renderer});var device_exports={};__export(device_exports,{accelerationX:()=>accelerationX,accelerationY:()=>accelerationY,accelerationZ:()=>accelerationZ,alpha:()=>alpha,autoFocus:()=>autoFocus,beta:()=>beta,devicePixelRatio:()=>devicePixelRatio,enableSwipe:()=>enableSwipe,exitFullscreen:()=>exitFullscreen,focus:()=>focus,gamma:()=>gamma,getElement:()=>getElement,getElementBounds:()=>getElementBounds,getParentBounds:()=>getParentBounds,getParentElement:()=>getParentElement,getScreenOrientation:()=>getScreenOrientation,getStorage:()=>getStorage,hasAccelerometer:()=>hasAccelerometer,hasDeviceOrientation:()=>hasDeviceOrientation,hasFullscreenSupport:()=>hasFullscreenSupport,hasHTML5Audio:()=>hasHTML5Audio,hasPointerLockSupport:()=>hasPointerLockSupport,hasVideo:()=>hasVideo,hasVideoFormat:()=>hasVideoFormat,hasWebAudio:()=>hasWebAudio,isFullscreen:()=>isFullscreen,isLandscape:()=>isLandscape,isMobile:()=>isMobile2,isPortrait:()=>isPortrait,isWebGLSupported:()=>isWebGLSupported,language:()=>language,localStorage:()=>localStorage2,lockOrientation:()=>lockOrientation,maxTouchPoints:()=>maxTouchPoints,nativeBase64:()=>nativeBase64,offscreenCanvas:()=>offscreenCanvas,onDeviceRotate:()=>onDeviceRotate,onReady:()=>onReady,platform:()=>platform,pointerEvent:()=>pointerEvent,requestFullscreen:()=>requestFullscreen,screenOrientation:()=>screenOrientation,sound:()=>sound,touch:()=>touch,touchEvent:()=>touchEvent,unlockOrientation:()=>unlockOrientation,unwatchAccelerometer:()=>unwatchAccelerometer,unwatchDeviceOrientation:()=>unwatchDeviceOrientation,vibrate:()=>vibrate,watchAccelerometer:()=>watchAccelerometer,watchDeviceOrientation:()=>watchDeviceOrientation,wheel:()=>wheel});var utils_exports={};__export(utils_exports,{agent:()=>agent_exports,array:()=>array_exports,checkVersion:()=>checkVersion,createGUID:()=>createGUID,file:()=>file_exports,function:()=>function_exports,getUriFragment:()=>getUriFragment,isStringArray:()=>isStringArray,resetGUID:()=>resetGUID,string:()=>string_exports});var MAX_LENGTH=256;var compareIdentifiers=(a,b)=>{if(a===b){return 0}else if(Number(a)<Number(b)){return-1}else{return 1}};var SEMVER_REGEX=/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/;var SemVer=class{constructor(version2){if(version2.length>MAX_LENGTH){throw new TypeError(`version is longer than ${MAX_LENGTH} characters`)}const m=version2.trim().match(SEMVER_REGEX);if(!m){throw new TypeError(`Invalid Version: ${version2}`)}this.major=+m[1];this.minor=+m[2];this.patch=+m[3];if(this.major>Number.MAX_SAFE_INTEGER||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>Number.MAX_SAFE_INTEGER||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>Number.MAX_SAFE_INTEGER||this.patch<0){throw new TypeError("Invalid patch version")}}asString(){return`${this.major}.${this.minor}.${this.patch}`}compare(other){if(other.asString()===this.asString()){return 0}return this.compareMain(other)}compareMain(other){return compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch)}};var compare=(a,b)=>{return new SemVer(a).compare(new SemVer(b))};var agent_exports={};__export(agent_exports,{prefixed:()=>prefixed,setPrefixed:()=>setPrefixed});var vendors=["ms","MS","moz","webkit","o"];function prefixed(name,obj){obj=obj||globalThis;if(name in obj){return obj[name]}const uc_name=capitalize(name);let result;vendors.some(vendor=>{const name2=vendor+uc_name;return result=name2 in obj?obj[name2]:void 0});return result}function setPrefixed(name,value,obj){obj=obj||globalThis;if(name in obj){obj[name]=value;return}const uc_name=capitalize(name);vendors.some(vendor=>{const name2=vendor+uc_name;if(name2 in obj){obj[name2]=value;return true}return false});return false}var file_exports={};__export(file_exports,{getBasename:()=>getBasename,getExtension:()=>getExtension});var PATH=/^.*(\\|\/|:)/;var EXT=/\.[^.]*$/;function getBasename(path){return path.replace(PATH,"").replace(EXT,"")}function getExtension(path){return path.substring(path.lastIndexOf(".")+1,path.length)}var function_exports={};__export(function_exports,{defer:()=>defer,throttle:()=>throttle});function defer(func,thisArg,...args){return setTimeout(func.bind(thisArg),0,...args)}var throttle=(fn,wait=100)=>{let inThrottle,lastFn,lastTime;return(...args)=>{if(!inThrottle){fn.apply(void 0,args);lastTime=Date.now();inThrottle=true}else{clearTimeout(lastFn);lastFn=setTimeout(()=>{if(Date.now()-lastTime>=wait){fn.apply(void 0,args);lastTime=Date.now()}},Math.max(wait-(Date.now()-lastTime),0))}}};var GUID_base="";var GUID_index=0;function checkVersion(v1,v2){if(/^\d+$/.test(v1)){v1+=".0.0"}else if(/^\d+\.\d+$/.test(v1)){v1+=".0"}if(/^\d+$/.test(v2)){v2+=".0.0"}else if(/^\d+\.\d+$/.test(v2)){v2+=".0"}return compare(v1,v2)}function getUriFragment(url){const hash={};if(typeof url==="undefined"){if(typeof globalThis.document!=="undefined"){const location=globalThis.document.location;if(location&&location.hash){url=location.hash}else{return hash}}else{return hash}}else{const index=url.indexOf("#");if(index!==-1){url=url.slice(index,url.length)}else{return hash}}url.slice(1).split("&").filter(value=>{return value!==""}).forEach(value=>{const kv=value.split("=");const k=kv.shift();const v=kv.join("=");hash[k]=v||true});return hash}function resetGUID(base,index=0){GUID_base=toHex2(base.toString().toUpperCase());GUID_index=index}function createGUID(index=1){GUID_index+=index;return`${GUID_base}-${index||GUID_index}`}var isStringArray=value=>{return Array.isArray(value)&&value.every(element=>{return typeof element==="string"})};var data={};var hasLocalStorage=false;try{hasLocalStorage=typeof globalThis!=="undefined"&&typeof globalThis.localStorage!=="undefined"}catch{hasLocalStorage=false}function isReserved(key){return key==="add"||key==="remove"}eventEmitter.addListenerOnce(BOOT,()=>{if(hasLocalStorage){const me_save_content=localStorage.getItem("me.save");if(me_save_content!==null&&me_save_content.length>0){try{const stored=JSON.parse(me_save_content);const keys=isStringArray(stored)?stored:[];for(const key of keys){try{const storageKey=`me.save.${key}`;const stored2=localStorage.getItem(storageKey);data[key]=stored2===null?null:JSON.parse(stored2)}catch{}}}catch{}}}});var save={add(props){const obj=save;for(const key of Object.keys(props)){if(isReserved(key)){continue}Object.defineProperty(obj,key,{configurable:true,enumerable:true,get(){return data[key]},set(value){data[key]=value;if(hasLocalStorage){localStorage.setItem(`me.save.${key}`,JSON.stringify(value))}}});if(!(key in data)){save[key]=props[key]}}if(hasLocalStorage){localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))}},remove(key){if(!isReserved(key)){if(typeof data[key]!=="undefined"){delete data[key];if(hasLocalStorage){globalThis.localStorage.removeItem(`me.save.${key}`);globalThis.localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))}}}}};var save_default=save;var platform_exports={};__export(platform_exports,{BlackBerry:()=>BlackBerry,Kindle:()=>Kindle,android:()=>android,android2:()=>android2,chromeOS:()=>chromeOS,ejecta:()=>ejecta,iOS:()=>iOS,isMobile:()=>isMobile,isWeixin:()=>isWeixin,linux:()=>linux,nodeJS:()=>nodeJS,ua:()=>ua,webApp:()=>webApp,wp:()=>wp});var ua=typeof globalThis.navigator!=="undefined"?globalThis.navigator.userAgent:"";var iOS=/iPhone|iPad|iPod/i.test(ua);var android=/Android/i.test(ua);var android2=/Android 2/i.test(ua);var linux=/Linux/i.test(ua);var chromeOS=/CrOS/.test(ua);var wp=/Windows Phone/i.test(ua);var BlackBerry=/BlackBerry/i.test(ua);var Kindle=/Kindle|Silk.*Mobile Safari/i.test(ua);var ejecta="ejecta"in globalThis;var isWeixin=/MicroMessenger/i.test(ua);var nodeJS=typeof globalThis.process!=="undefined"&&typeof globalThis.process.release!=="undefined"&&globalThis.process.release.name==="node";var isMobile=/Mobi/i.test(ua)||iOS||android||wp||BlackBerry||Kindle||false;var webApp=typeof globalThis.navigator!=="undefined"&&"standalone"in globalThis.navigator&&globalThis.navigator.standalone===true||typeof globalThis.matchMedia!=="undefined"&&globalThis.matchMedia("(display-mode: standalone)").matches;var readyBound=false;var isDOMReady=false;function _domReady(){if(!isDOMReady){if(typeof globalThis.document!=="undefined"&&!globalThis.document.body){return setTimeout(_domReady,13)}if(typeof globalThis.document!=="undefined"&&typeof globalThis.document.removeEventListener==="function"){globalThis.document.removeEventListener("DOMContentLoaded",_domReady,false)}if(typeof globalThis.removeEventListener==="function"){globalThis.removeEventListener("load",_domReady,false)}eventEmitter.emit(DOM_READY);isDOMReady=true}}var DOMContentLoaded=fn=>{if(isDOMReady){fn()}else{eventEmitter.addListenerOnce(DOM_READY,fn);if(!readyBound){if(nodeJS||typeof globalThis.document!=="undefined"&&globalThis.document.readyState==="complete"){globalThis.setTimeout(_domReady,0)}else{if(typeof globalThis.document!=="undefined"&&typeof globalThis.document.addEventListener==="function"){globalThis.document.addEventListener("DOMContentLoaded",_domReady,false)}globalThis.addEventListener("load",_domReady,false)}readyBound=true}}};var accelInitialized=false;var deviceOrientationInitialized=false;var swipeEnabled=true;var domRect={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0};var videoCodecs;var WebGLSupport=-1;function disableSwipeFn(e){e.preventDefault();if(typeof globalThis.scroll==="function"){globalThis.scroll(0,0)}return false}function hasLocalStorage2(){try{return!!globalThis.localStorage}catch{return false}}function hasOffscreenCanvas(){try{return typeof globalThis.OffscreenCanvas!=="undefined"&&new globalThis.OffscreenCanvas(0,0).getContext("2d")!==null}catch{return false}}function onDeviceMotion(e){accelerationX=e.accelerationIncludingGravity.x;accelerationY=e.accelerationIncludingGravity.y;accelerationZ=e.accelerationIncludingGravity.z}function onDeviceRotate(e){gamma=e.gamma;beta=e.beta;alpha=e.alpha}var platform=platform_exports;var touchEvent=!!("ontouchstart"in globalThis);var pointerEvent=!!globalThis.PointerEvent;var touch=touchEvent||pointerEvent&&globalThis.navigator.maxTouchPoints>0;var maxTouchPoints=touch?pointerEvent?globalThis.navigator.maxTouchPoints||1:10:1;var wheel=typeof globalThis.document!=="undefined"&&"onwheel"in globalThis.document.createElement("div");var hasPointerLockSupport=typeof globalThis.document!=="undefined"&&typeof globalThis.document.pointerLockElement!=="undefined";var hasDeviceOrientation=!!globalThis.DeviceOrientationEvent;var screenOrientation=typeof screen!=="undefined"&&typeof screen.orientation!=="undefined";var hasAccelerometer=!!globalThis.DeviceMotionEvent;var hasFullscreenSupport=typeof globalThis.document!=="undefined"&&(prefixed("fullscreenEnabled",globalThis.document)||globalThis.document.mozFullScreenEnabled);var hasWebAudio=!!(globalThis.AudioContext||globalThis.webkitAudioContext);var hasHTML5Audio=typeof globalThis.Audio!=="undefined";var sound=hasWebAudio||hasHTML5Audio;var hasVideo=typeof globalThis.document!=="undefined"&&!!globalThis.document.createElement("video").canPlayType;var localStorage2=hasLocalStorage2();var offscreenCanvas=hasOffscreenCanvas();var nativeBase64=typeof globalThis.atob==="function";var language=typeof globalThis.navigator!=="undefined"?globalThis.navigator.language||globalThis.navigator.browserLanguage||globalThis.navigator.userLanguage||"en":"en";var devicePixelRatio=globalThis.devicePixelRatio||1;var isMobile2=platform.isMobile;var accelerationX=0;var accelerationY=0;var accelerationZ=0;var gamma=0;var beta=0;var alpha=0;var autoFocus=true;function onReady(fn){if(typeof globalThis.addEventListener==="function"){globalThis.addEventListener("blur",()=>{eventEmitter.emit(BLUR)},false);globalThis.addEventListener("focus",()=>{eventEmitter.emit(FOCUS);if(autoFocus===true){focus()}},false)}if(typeof globalThis.document!=="undefined"){if(typeof globalThis.document.addEventListener==="function"){globalThis.document.addEventListener("visibilitychange",()=>{if(globalThis.document.visibilityState==="visible"){eventEmitter.emit(FOCUS);if(autoFocus===true){focus()}}else{eventEmitter.emit(BLUR)}},false)}}DOMContentLoaded(fn)}function enableSwipe(enable2){const moveEvent=pointerEvent?"pointermove":touchEvent?"touchmove":"mousemove";if(enable2!==false){if(swipeEnabled===false){globalThis.document.removeEventListener(moveEvent,disableSwipeFn);swipeEnabled=true}}else if(swipeEnabled===true){globalThis.document.addEventListener(moveEvent,disableSwipeFn,{passive:false});swipeEnabled=false}}function isFullscreen(){if(hasFullscreenSupport){return!!(prefixed("fullscreenElement",globalThis.document)||globalThis.document.mozFullScreenElement)}else{return false}}function requestFullscreen(element){if(hasFullscreenSupport&&!isFullscreen()){element=element||getParent();element.requestFullscreen=prefixed("requestFullscreen",element)||element.mozRequestFullScreen;element.requestFullscreen()}}var exitFullscreen=()=>{if(hasFullscreenSupport&&isFullscreen()){document.exitFullscreen()}};function getScreenOrientation(){const PORTRAIT="portrait";const LANDSCAPE="landscape";const screen2=globalThis.screen;if(screenOrientation===true){const orientation2=prefixed("orientation",screen2);if(typeof orientation2!=="undefined"&&typeof orientation2.type==="string"){return orientation2.type}else if(typeof orientation2==="string"){return orientation2}}if(typeof globalThis.orientation==="number"){return Math.abs(globalThis.orientation)===90?LANDSCAPE:PORTRAIT}return globalThis.outerWidth>globalThis.outerHeight?LANDSCAPE:PORTRAIT}function lockOrientation(orientation2){const screen2=globalThis.screen;if(typeof screen2!=="undefined"){const _lockOrientation=prefixed("lockOrientation",screen2);if(typeof _lockOrientation!=="undefined"){return _lockOrientation(orientation2)}}return false}function unlockOrientation(){const screen2=globalThis.screen;if(typeof screen2!=="undefined"){const _unlockOrientation=prefixed("unlockOrientation",screen2);if(typeof _unlockOrientation!=="undefined"){return _unlockOrientation()}}return false}function isPortrait(){return getScreenOrientation().includes("portrait")}function isLandscape(){return getScreenOrientation().includes("landscape")}function getStorage(type="local"){switch(type){case"local":return save_default;default:throw new Error("storage type "+type+" not supported")}}function getParentElement(element){let target=getElement(element);if(target.parentNode!==null){target=target.parentNode}return target}function getElement(element){let target=null;if(element!=="undefined"){if(typeof element==="string"){target=globalThis.document.getElementById(element)}else if(typeof element==="object"&&element.nodeType===Node.ELEMENT_NODE){target=element}}if(!target){target=globalThis.document.body}return target}function getElementBounds(element){if(typeof element==="object"&&element!==globalThis.document.body&&typeof element.getBoundingClientRect!=="undefined"){return element.getBoundingClientRect()}else{domRect.width=domRect.right=globalThis.innerWidth;domRect.height=domRect.bottom=globalThis.innerHeight;return domRect}}function getParentBounds(element){return getElementBounds(getParentElement(element))}function isWebGLSupported(options){if(WebGLSupport===-1){let _supported=false;try{const canvas=globalThis.document.createElement("canvas");const ctxOptions={stencil:true,failIfMajorPerformanceCaveat:options.failIfMajorPerformanceCaveat};_supported=!!(globalThis.WebGLRenderingContext&&(canvas.getContext("webgl",ctxOptions)||canvas.getContext("experimental-webgl",ctxOptions)));WebGLSupport=_supported?1:0}catch{WebGLSupport=0}}return WebGLSupport===1}function focus(){if(typeof globalThis.focus==="function"){globalThis.focus()}}function watchAccelerometer(){if(hasAccelerometer&&!accelInitialized){if(DeviceOrientationEvent&&typeof DeviceOrientationEvent.requestPermission==="function"){DeviceOrientationEvent.requestPermission().then(response=>{if(response==="granted"){globalThis.addEventListener("devicemotion",onDeviceMotion,false);accelInitialized=true}}).catch(console.error)}else{globalThis.addEventListener("devicemotion",onDeviceMotion,false);accelInitialized=true}}return accelInitialized}function unwatchAccelerometer(){if(accelInitialized){globalThis.removeEventListener("devicemotion",onDeviceMotion,false);accelInitialized=false}}function watchDeviceOrientation(){if(hasDeviceOrientation&&!deviceOrientationInitialized){if(typeof DeviceOrientationEvent.requestPermission==="function"){DeviceOrientationEvent.requestPermission().then(response=>{if(response==="granted"){globalThis.addEventListener("deviceorientation",onDeviceRotate,false);deviceOrientationInitialized=true}}).catch(console.error)}else{globalThis.addEventListener("deviceorientation",onDeviceRotate,false);deviceOrientationInitialized=true}}return deviceOrientationInitialized}function unwatchDeviceOrientation(){if(deviceOrientationInitialized){globalThis.removeEventListener("deviceorientation",onDeviceRotate,false);deviceOrientationInitialized=false}}function vibrate(pattern){if(typeof globalThis.navigator!=="undefined"&&typeof globalThis.navigator.vibrate==="function"){globalThis.navigator.vibrate(pattern)}}function hasVideoFormat(codec){let result=false;if(hasVideo===true){if(typeof videoCodecs==="undefined"){const videoElement=globalThis.document.createElement("video");videoCodecs={h264:videoElement.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),h265:videoElement.canPlayType('video/mp4; codecs="hev1"').replace(/^no$/,""),ogg:videoElement.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),mp4:videoElement.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),m4v:videoElement.canPlayType("video/x-m4v").replace(/^no$/,""),webm:videoElement.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""),vp9:videoElement.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,""),hls:videoElement.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")}}result=!!videoCodecs[codec]}return result}var CANVAS=0;var WEBGL=1;var AUTO=2;var ScaleMethods={Manual:"manual",Fit:"fit",FillMin:"fill-min",FillMax:"fill-max",Flex:"flex",FlexWidth:"flex-width",FlexHeight:"flex-height",Stretch:"stretch"};var defaultApplicationSettings={renderer:AUTO,scale:1,scaleMethod:ScaleMethods.Manual,preferWebGL1:false,depthTest:"sorting",powerPreference:"default",transparent:false,antiAlias:false,consoleHeader:!("__vitest_browser__"in window),blendMode:"normal",physic:"builtin",failIfMajorPerformanceCaveat:true,subPixel:false,verbose:false,legacy:false};var renderer=null;function init2(width,height,options){if(!initialized){throw new Error("me.video.init() called before engine initialization.")}try{game.init(width,height,Object.assign(defaultApplicationSettings,options||{}))}catch(e){console.log(e.message);return false}renderer=game.renderer;globalThis.addEventListener("resize",e=>{eventEmitter.emit(WINDOW_ONRESIZE,e)},false);globalThis.addEventListener("orientationchange",e=>{eventEmitter.emit(WINDOW_ONORIENTATION_CHANGE,e)},false);globalThis.addEventListener("onmozorientationchange",e=>{eventEmitter.emit(WINDOW_ONORIENTATION_CHANGE,e)},false);if(screenOrientation===true){globalThis.screen.orientation.onchange=e=>{eventEmitter.emit(WINDOW_ONORIENTATION_CHANGE,e)}}globalThis.addEventListener("scroll",e=>{eventEmitter.emit(WINDOW_ONSCROLL,e)},false);eventEmitter.emit(VIDEO_INIT,game.renderer);return true}function createCanvas(width,height,returnOffscreenCanvas=false){let _canvas;if(width===0||height===0){throw new Error("width or height was zero, Canvas could not be initialized !")}if(offscreenCanvas===true&&returnOffscreenCanvas===true){_canvas=new globalThis.OffscreenCanvas(0,0);if(typeof _canvas.style==="undefined"){_canvas.style={}}}else{_canvas=globalThis.document.createElement("canvas")}_canvas.width=width;_canvas.height=height;return _canvas}function getParent(){return game.getParentElement()}var input_exports={};__export(input_exports,{GAMEPAD:()=>GAMEPAD,KEY:()=>KEY,bindGamepad:()=>bindGamepad,bindKey:()=>bindKey,bindPointer:()=>bindPointer,exitPointerLock:()=>exitPointerLock,getBindingKey:()=>getBindingKey,globalToLocal:()=>globalToLocal,hasActiveEvents:()=>hasActiveEvents,hasRegisteredEvents:()=>hasRegisteredEvents,initKeyboardEvent:()=>initKeyboardEvent,isKeyPressed:()=>isKeyPressed,keyBoardEventTarget:()=>keyBoardEventTarget,keyStatus:()=>keyStatus,locked:()=>locked,pointer:()=>pointer,pointerEventTarget:()=>pointerEventTarget,preventDefault:()=>preventDefault,registerPointerEvent:()=>registerPointerEvent,releaseAllPointerEvents:()=>releaseAllPointerEvents,releasePointerEvent:()=>releasePointerEvent,requestPointerLock:()=>requestPointerLock,setGamepadDeadzone:()=>setGamepadDeadzone,setGamepadMapping:()=>setGamepadMapping,setTouchAction:()=>setTouchAction,throttlingInterval:()=>throttlingInterval,triggerKeyEvent:()=>triggerKeyEvent,unbindGamepad:()=>unbindGamepad,unbindKey:()=>unbindKey,unbindPointer:()=>unbindPointer,unlockKey:()=>unlockKey});var _keyStatus={};var _keyLock={};var _keyLocked={};var _keyRefs={};var _preventDefaultForKeys={};var _keyBindings={};var keyDownEvent=options=>{const{keyCode}=options;const action=_keyBindings[keyCode];eventEmitter.emit(KEYDOWN,action,keyCode,action?!_keyLocked[action]:true);if(action){if(!_keyLocked[action]){const trigger=("mouseButton"in options?options.mouseButton:void 0)??keyCode;if(!_keyRefs[action][trigger]){_keyStatus[action]++;_keyRefs[action][trigger]=true}}if("preventDefault"in options&&_preventDefaultForKeys[keyCode]){options.preventDefault()}}};var keyUpEvent=options=>{const{keyCode}=options;const action=_keyBindings[keyCode];eventEmitter.emit(KEYUP,action,keyCode);if(action){const trigger=("mouseButton"in options?options.mouseButton:void 0)??keyCode;delete _keyRefs[action][trigger];if(_keyStatus[action]>0){_keyStatus[action]--}_keyLocked[action]=false;if("preventDefault"in options&&_preventDefaultForKeys[keyCode]){options.preventDefault()}}};var keyBoardEventTarget=null;function initKeyboardEvent(){if(!isMobile){if(globalThis.addEventListener){globalThis.addEventListener("keydown",e=>{keyDownEvent(e)},false);globalThis.addEventListener("keyup",keyUpEvent,false)}}}function isKeyPressed(action){if(_keyStatus[action]&&!_keyLocked[action]){if(_keyLock[action]){_keyLocked[action]=true}return true}return false}function keyStatus(action){return _keyStatus[action]>0}function triggerKeyEvent(keyCode,status,mouseButton){const handler=status?keyDownEvent:keyUpEvent;handler({keyCode:keyCode,mouseButton:mouseButton})}var bindKey=(keyCode,action,lock,preventDefault2=preventDefault)=>{_keyBindings[keyCode]=action;_preventDefaultForKeys[keyCode]=preventDefault2;_keyStatus[action]=0;_keyLock[action]=lock?lock:false;_keyLocked[action]=false;_keyRefs[action]={}};function getBindingKey(keyCode){return _keyBindings[keyCode]}function unlockKey(action){_keyLocked[action]=false}function unbindKey(keyCode){const keybinding=_keyBindings[keyCode];_keyStatus[keybinding]=0;_keyLock[keybinding]=false;_keyRefs[keybinding]={};delete _keyBindings[keyCode];delete _preventDefaultForKeys[keyCode]}var tmpVec=new Vector2d;var Pointer=class extends Bounds{constructor(x=0,y=0,w=1,h=1){super();this.setMinMax(x,y,x+w,y+h);this.LEFT=0;this.MIDDLE=1;this.RIGHT=2;this.event=void 0;this.type=void 0;this.button=0;this.isPrimary=false;this.pageX=0;this.pageY=0;this.clientX=0;this.clientY=0;this.movementX=0;this.movementY=0;this.deltaMode=0;this.deltaX=0;this.deltaY=0;this.deltaZ=0;this.gameX=0;this.gameY=0;this.gameScreenX=0;this.gameScreenY=0;this.gameWorldX=0;this.gameWorldY=0;this.gameLocalX=0;this.gameLocalY=0;this.pointerId=void 0;this.isNormalized=false;this.locked=false;this.bind=[0,0,0]}setEvent(event,pageX=0,pageY=0,clientX=0,clientY=0,pointerId=1){this.event=event;this.pageX=pageX;this.pageY=pageY;this.clientX=clientX;this.clientY=clientY;globalToLocal(this.pageX,this.pageY,tmpVec);this.gameScreenX=this.x=tmpVec.x;this.gameScreenY=this.y=tmpVec.y;this.isNormalized=typeof globalThis.PointerEvent!=="undefined"&&!(event instanceof globalThis.PointerEvent);this.locked=locked;this.movementX=event.movementX||0;this.movementY=event.movementY||0;if(event.type==="wheel"){this.deltaMode=event.deltaMode||0;this.deltaX=event.deltaX||0;this.deltaY=event.deltaY||0;this.deltaZ=event.deltaZ||0}else{this.deltaMode=0;this.deltaX=0;this.deltaY=0;this.deltaZ=0}this.pointerId=pointerId;this.isPrimary=typeof event.isPrimary!=="undefined"?event.isPrimary:true;this.button=event.button||0;this.type=event.type;if(typeof game.viewport!=="undefined"){game.viewport.localToWorld(this.gameScreenX,this.gameScreenY,tmpVec)}this.gameWorldX=tmpVec.x;this.gameWorldY=tmpVec.y;if(this.isNormalized===false){this.width=event.width||1;this.height=event.height||1}else if(typeof event.radiusX==="number"){this.width=event.radiusX*2||1;this.height=event.radiusY*2||1}else{this.width=this.height=1}}};var pointer_default=Pointer;var T_POINTERS=[];var eventHandlers=new Map;var currentPointer;var pointerInitialized=false;var lastTimeStamp=0;var activeEventList=[];var WHEEL=["wheel"];var POINTER_MOVE=["pointermove","mousemove","touchmove"];var POINTER_DOWN=["pointerdown","mousedown","touchstart"];var POINTER_UP=["pointerup","mouseup","touchend"];var POINTER_CANCEL=["pointercancel","mousecancel","touchcancel"];var POINTER_ENTER=["pointerenter","mouseenter","touchenter"];var POINTER_OVER=["pointerover","mouseover","touchover"];var POINTER_LEAVE=["pointerleave","mouseleave","touchleave"];var pointerEventList=[WHEEL[0],POINTER_MOVE[0],POINTER_DOWN[0],POINTER_UP[0],POINTER_CANCEL[0],POINTER_ENTER[0],POINTER_OVER[0],POINTER_LEAVE[0]];var mouseEventList=[WHEEL[0],POINTER_MOVE[1],POINTER_DOWN[1],POINTER_UP[1],POINTER_CANCEL[1],POINTER_ENTER[1],POINTER_OVER[1],POINTER_LEAVE[1]];var touchEventList=[POINTER_MOVE[2],POINTER_DOWN[2],POINTER_UP[2],POINTER_CANCEL[2],POINTER_ENTER[2],POINTER_OVER[2],POINTER_LEAVE[2]];var pointerEventMap={wheel:WHEEL,pointermove:POINTER_MOVE,pointerdown:POINTER_DOWN,pointerup:POINTER_UP,pointercancel:POINTER_CANCEL,pointerenter:POINTER_ENTER,pointerover:POINTER_OVER,pointerleave:POINTER_LEAVE};var normalizedEvents=[];function registerEventListener(eventList,callback){for(let x=0;x<eventList.length;x++){if(POINTER_MOVE.indexOf(eventList[x])===-1){pointerEventTarget.addEventListener(eventList[x],callback,{passive:preventDefault===false})}}}function enablePointerEvent(){if(!pointerInitialized){currentPointer=new Rect(0,0,1,1);for(let v=0;v<maxTouchPoints;v++){T_POINTERS.push(new pointer_default)}if(pointerEventTarget===null){pointerEventTarget=renderer.getCanvas()}if(pointerEvent){activeEventList=pointerEventList}else{activeEventList=mouseEventList}if(touch&&!pointerEvent){activeEventList=activeEventList.concat(touchEventList)}registerEventListener(activeEventList,onPointerEvent);if(typeof throttlingInterval==="undefined"){throttlingInterval=~~(1e3/timer_default.maxfps)}if(autoFocus===true){focus();pointerEventTarget.addEventListener(activeEventList[2],()=>{focus()},{passive:preventDefault===false})}const events=findAllActiveEvents(activeEventList,POINTER_MOVE);if(throttlingInterval<17){for(let i=0;i<events.length;i++){if(activeEventList.indexOf(events[i])!==-1){pointerEventTarget.addEventListener(events[i],onMoveEvent,{passive:true})}}}else{for(let i=0;i<events.length;i++){if(activeEventList.indexOf(events[i])!==-1){pointerEventTarget.addEventListener(events[i],throttle(onMoveEvent,throttlingInterval),{passive:true})}}}setTouchAction(pointerEventTarget);if(hasPointerLockSupport){globalThis.document.addEventListener(POINTERLOCKCHANGE,()=>{locked=globalThis.document.pointerLockElement===game.getParentElement();eventEmitter.emit(POINTERLOCKCHANGE,locked)},true)}pointerInitialized=true}}function findActiveEvent(activeEventList2,eventTypes){for(let i=0;i<eventTypes.length;i++){const event=activeEventList2.indexOf(eventTypes[i]);if(event!==-1){return eventTypes[i]}}}function findAllActiveEvents(activeEventList2,eventTypes){const events=[];for(let i=0;i<eventTypes.length;i++){const event=activeEventList2.indexOf(eventTypes[i]);if(event!==-1){events.push(eventTypes[i])}}return events}function triggerEvent(handlers,type,pointer2,pointerId){let callback;if(handlers.callbacks[type]){handlers.pointerId=pointerId;for(let i=handlers.callbacks[type].length-1;i>=0&&(callback=handlers.callbacks[type][i]);i--){if(callback(pointer2)===false){return true}}}return false}function dispatchEvent(normalizedEvents2){let handled=false;while(normalizedEvents2.length>0){const pointer2=normalizedEvents2.pop();T_POINTERS.push(pointer2);if(pointer2.isNormalized===true&&typeof pointer2.event.timeStamp!=="undefined"){if(pointer2.event.timeStamp<lastTimeStamp){continue}lastTimeStamp=pointer2.event.timeStamp}currentPointer.pos.set(pointer2.gameWorldX,pointer2.gameWorldY);currentPointer.setSize(pointer2.width,pointer2.height);if(POINTER_MOVE.includes(pointer2.type)){pointer2.gameX=pointer2.gameLocalX=pointer2.gameScreenX;pointer2.gameY=pointer2.gameLocalY=pointer2.gameScreenY;eventEmitter.emit(POINTERMOVE,pointer2)}let candidates=game.world.broadphase.retrieve(currentPointer,game.world._sortReverseZ);candidates=candidates.concat([game.viewport]);for(let c=candidates.length,candidate;c--,candidate=candidates[c];){if(eventHandlers.has(candidate)&&candidate.isKinematic!==true){const handlers=eventHandlers.get(candidate);const region=handlers.region;const ancestor=region.ancestor;const bounds=region.getBounds();let eventInBounds=false;if(region.isFloating===true){pointer2.gameX=pointer2.gameLocalX=pointer2.gameScreenX;pointer2.gameY=pointer2.gameLocalY=pointer2.gameScreenY}else{pointer2.gameX=pointer2.gameLocalX=pointer2.gameWorldX;pointer2.gameY=pointer2.gameLocalY=pointer2.gameWorldY}if(typeof ancestor!=="undefined"){const parentBounds=ancestor.getBounds();pointer2.gameLocalX=pointer2.gameX-parentBounds.x;pointer2.gameLocalY=pointer2.gameY-parentBounds.y}eventInBounds=bounds.contains(pointer2.gameX,pointer2.gameY);switch(pointer2.type){case POINTER_MOVE[0]:case POINTER_MOVE[1]:case POINTER_MOVE[2]:case POINTER_MOVE[3]:if(handlers.pointerId===pointer2.pointerId&&!eventInBounds){if(triggerEvent(handlers,findActiveEvent(activeEventList,POINTER_LEAVE),pointer2,null)){handled=true;break}}else if(handlers.pointerId===null&&eventInBounds){if(triggerEvent(handlers,findActiveEvent(activeEventList,POINTER_ENTER),pointer2,pointer2.pointerId)){handled=true;break}}if(eventInBounds&&triggerEvent(handlers,pointer2.type,pointer2,pointer2.pointerId)){handled=true;break}break;case POINTER_UP[0]:case POINTER_UP[1]:case POINTER_UP[2]:case POINTER_UP[3]:if(handlers.pointerId===pointer2.pointerId&&eventInBounds){if(triggerEvent(handlers,pointer2.type,pointer2,null)){handled=true;break}}break;case POINTER_CANCEL[0]:case POINTER_CANCEL[1]:case POINTER_CANCEL[2]:case POINTER_CANCEL[3]:if(handlers.pointerId===pointer2.pointerId){if(triggerEvent(handlers,pointer2.type,pointer2,null)){handled=true;break}}break;default:if(eventInBounds){if(triggerEvent(handlers,pointer2.type,pointer2,pointer2.pointerId)){handled=true;break}}break}}if(handled===true){break}}}return handled}function normalizeEvent(originalEvent){let _pointer;if(touchEvent&&originalEvent.changedTouches){for(let i=0,l=originalEvent.changedTouches.length;i<l;i++){const touchEvent2=originalEvent.changedTouches[i];_pointer=T_POINTERS.pop();_pointer.setEvent(originalEvent,touchEvent2.pageX,touchEvent2.pageY,touchEvent2.clientX,touchEvent2.clientY,touchEvent2.identifier);normalizedEvents.push(_pointer)}}else{_pointer=T_POINTERS.pop();_pointer.setEvent(originalEvent,originalEvent.pageX,originalEvent.pageY,originalEvent.clientX,originalEvent.clientY,originalEvent.pointerId);normalizedEvents.push(_pointer)}if(originalEvent.isPrimary===false){return normalizedEvents}normalizedEvents[0].isPrimary=true;Object.assign(pointer,normalizedEvents[0]);return normalizedEvents}function onMoveEvent(e){dispatchEvent(normalizeEvent(e))}function onPointerEvent(e){normalizeEvent(e);const button=normalizedEvents[0].button;if(dispatchEvent(normalizedEvents)||e.type==="wheel"){if(preventDefault===true){e.preventDefault()}}const keycode=pointer.bind[button];if(keycode){triggerKeyEvent(keycode,POINTER_DOWN.includes(e.type),button+1)}}var pointerEventTarget=null;var pointer=new pointer_default(0,0,1,1);var locked=false;var throttlingInterval;function hasActiveEvents(){return normalizedEvents.length>0}function hasRegisteredEvents(){return eventHandlers.size>0}function globalToLocal(x,y,v){v=v||vector2dPool.get();const rect=getElementBounds(renderer.getCanvas());const pixelRatio=globalThis.devicePixelRatio||1;x-=rect.left+(globalThis.pageXOffset||0);y-=rect.top+(globalThis.pageYOffset||0);const scale2=renderer.scaleRatio;if(scale2.x!==1||scale2.y!==1){x/=scale2.x;y/=scale2.y}return v.set(x*pixelRatio,y*pixelRatio)}function setTouchAction(element,value){element.style["touch-action"]=value||"none"}function bindPointer(){const button=arguments.length<2?pointer.LEFT:arguments[0];const keyCode=arguments.length<2?arguments[0]:arguments[1];enablePointerEvent();if(!getBindingKey(keyCode)){throw new Error("no action defined for keycode "+keyCode)}pointer.bind[button]=keyCode}function unbindPointer(button){pointer.bind[typeof button==="undefined"?pointer.LEFT:button]=null}function registerPointerEvent(eventType,region,callback){enablePointerEvent();if(pointerEventList.indexOf(eventType)===-1){throw new Error("invalid event type : "+eventType)}if(typeof region==="undefined"){throw new Error("registerPointerEvent: region for "+toString(region)+" event is undefined ")}const eventTypes=findAllActiveEvents(activeEventList,pointerEventMap[eventType]);if(!eventHandlers.has(region)){eventHandlers.set(region,{region:region,callbacks:{},pointerId:null})}const handlers=eventHandlers.get(region);for(let i=0;i<eventTypes.length;i++){const eventType2=eventTypes[i];if(handlers.callbacks[eventType2]){handlers.callbacks[eventType2].push(callback)}else{handlers.callbacks[eventType2]=[callback]}}}function releasePointerEvent(eventType,region,callback){if(pointerEventList.indexOf(eventType)===-1){throw new Error("invalid event type : "+eventType)}const eventTypes=findAllActiveEvents(activeEventList,pointerEventMap[eventType]);const handlers=eventHandlers.get(region);if(typeof handlers!=="undefined"){for(let i=0;i<eventTypes.length;i++){const eventType2=eventTypes[i];if(handlers.callbacks[eventType2]){if(typeof callback!=="undefined"){remove(handlers.callbacks[eventType2],callback)}else{while(handlers.callbacks[eventType2].length>0){handlers.callbacks[eventType2].pop()}}if(handlers.callbacks[eventType2].length===0){delete handlers.callbacks[eventType2]}}}if(Object.keys(handlers.callbacks).length===0){eventHandlers.delete(region)}}}function releaseAllPointerEvents(region){if(eventHandlers.has(region)){for(let i=0;i<pointerEventList.length;i++){releasePointerEvent(pointerEventList[i],region)}}}function requestPointerLock(){if(hasPointerLockSupport){const element=game.getParentElement();element.requestPointerLock();return true}return false}function exitPointerLock(){if(hasPointerLockSupport){globalThis.document.exitPointerLock();return true}return false}var deadzone=.1;function wiredXbox360NormalizeFn(value,axis,button){if(button===this.GAMEPAD.BUTTONS.L2||button===this.GAMEPAD.BUTTONS.R2){return(value+1)/2}return value}function ouyaNormalizeFn(value,axis,button){if(value>0){if(button===this.GAMEPAD.BUTTONS.L2){value=Math.max(0,value-2e4)/111070}else{value=(value-1)/131070}}else{value=(65536+value)/131070+.5}return value}var vendorProductRE=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i;var leadingZeroRE=/^0+/;function addMapping(id,mapping){const expanded_id=id.replace(vendorProductRE,(_,a,b)=>{return"000".slice(a.length-1)+a+"-"+"000".slice(b.length-1)+b+"-"});const sparse_id=id.replace(vendorProductRE,(_,a,b)=>{return a.replace(leadingZeroRE,"")+"-"+b.replace(leadingZeroRE,"")+"-"});mapping.analog=mapping.analog||mapping.buttons.map(()=>{return-1});mapping.normalize_fn=mapping.normalize_fn||function(value){return value};remap.set(expanded_id,mapping);remap.set(sparse_id,mapping)}var bindings={};var remap=new Map;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:wiredXbox360NormalizeFn}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}]].forEach(value=>{addMapping(value[0],value[1])});var updateGamepads=function(){const gamepads=navigator.getGamepads();Object.keys(bindings).forEach(index=>{const gamepad=gamepads[index];if(!gamepad){return}let mapping=null;if(gamepad.mapping!=="standard"){mapping=remap.get(gamepad.id)}const binding=bindings[index];Object.keys(binding.buttons).forEach(button=>{const last=binding.buttons[button];let mapped_button=button;let mapped_axis=-1;if(mapping){mapped_button=mapping.buttons[button];mapped_axis=mapping.analog[button];if(mapped_button<0&&mapped_axis<0){return}}let current=gamepad.buttons[mapped_button]||{};if(mapping){if(mapped_axis>=0){const value=mapping.normalize_fn(gamepad.axes[mapped_axis],-1,+button);current={value:value,pressed:current.pressed||Math.abs(value)>=deadzone}}}eventEmitter.emit(GAMEPAD_UPDATE,index,"buttons",+button,current);if(!last.pressed&&current.pressed){triggerKeyEvent(last.keyCode,true,mapped_button+256)}else if(last.pressed&&!current.pressed){triggerKeyEvent(last.keyCode,false,mapped_button+256)}last.value=current.value;last.pressed=current.pressed});Object.keys(binding.axes).forEach(axis=>{const last=binding.axes[axis];let mapped_axis=axis;if(mapping){mapped_axis=mapping.axes[axis];if(mapped_axis<0){return}}let value=gamepad.axes[mapped_axis];if(typeof value==="undefined"){return}if(mapping){value=mapping.normalize_fn(value,+axis,-1)}let range=Math.sign(value)||1;if(last[range].keyCode===0){return}const pressed=Math.abs(value)>=deadzone+Math.abs(last[range].threshold);eventEmitter.emit(GAMEPAD_UPDATE,index,"axes",+axis,value);if(!last[range].pressed&&pressed){if(last[-range].pressed){triggerKeyEvent(last[-range].keyCode,false,mapped_axis+256);last[-range].value=0;last[-range].pressed=false}triggerKeyEvent(last[range].keyCode,true,mapped_axis+256)}else if((last[range].pressed||last[-range].pressed)&&!pressed){range=last[range].pressed?range:-range;triggerKeyEvent(last[range].keyCode,false,mapped_axis+256)}last[range].value=value;last[range].pressed=pressed})})};if(globalThis.navigator&&typeof globalThis.navigator.getGamepads==="function"){globalThis.addEventListener("gamepadconnected",e=>{eventEmitter.emit(GAMEPAD_CONNECTED,e.gamepad)},false);globalThis.addEventListener("gamepaddisconnected",e=>{eventEmitter.emit(GAMEPAD_DISCONNECTED,e.gamepad)},false)}var GAMEPAD={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function bindGamepad(index,button,keyCode){if(!getBindingKey(keyCode)){throw new Error("no action defined for keycode "+keyCode)}if(!eventEmitter.hasListener(GAME_BEFORE_UPDATE,updateGamepads)&&typeof navigator.getGamepads==="function"){eventEmitter.addListener(GAME_BEFORE_UPDATE,updateGamepads)}if(!bindings[index]){bindings[index]={axes:{},buttons:{}}}const mapping={keyCode:keyCode,value:0,pressed:false,threshold:button.threshold};const binding=bindings[index][button.type];if(button.type==="buttons"){binding[button.code]=mapping}else if(button.type==="axes"){const range=Math.sign(button.threshold)||1;if(!binding[button.code]){binding[button.code]={}}const axes=binding[button.code];axes[range]=mapping;if(!axes[-range]){axes[-range]={keyCode:0,value:0,pressed:false,threshold:-range}}}}function unbindGamepad(index,button){if(!bindings[index]){throw new Error("no bindings for gamepad "+index)}bindings[index].buttons[button]={}}function setGamepadDeadzone(value){deadzone=value}var setGamepadMapping=addMapping;var KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};var preventDefault=true;var fnHash={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function extractUniforms(gl,shader){const uniforms={};const uniRx=/uniform\s+(\w+)\s+(\w+)/g;const uniformsData={};const descriptor={};const locations={};let match;[shader.vertex,shader.fragment].forEach(shader2=>{while(match=uniRx.exec(shader2)){uniformsData[match[2]]=match[1]}});Object.keys(uniformsData).forEach(name=>{const type=uniformsData[name];locations[name]=gl.getUniformLocation(shader.program,name);descriptor[name]={get:function(name2){return function(){return locations[name2]}}(name),set:function(name2,type2,fn){if(/^mat/.test(type2)){return function(val){gl[fn](locations[name2],false,val)}}else{return function(val){let fnv=fn;if(val.length&&/v$/.test(fn)){fnv+="v"}gl[fnv](locations[name2],val)}}}(name,type,"uniform"+fnHash[type])}});Object.defineProperties(uniforms,descriptor);return uniforms}function extractAttributes(gl,shader){const attributes={};const attrRx=/attribute\s+\w+\s+(\w+)/g;let match;let i=0;while(match=attrRx.exec(shader.vertex)){attributes[match[1]]=i++}return attributes}function compileShader(gl,type,source){const shader=gl.createShader(type);gl.shaderSource(shader,source);gl.compileShader(shader);if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){throw new Error(gl.getShaderInfoLog(shader))}return shader}function compileProgram(gl,vertex,fragment,attributes){const vertShader=compileShader(gl,gl.VERTEX_SHADER,vertex);const fragShader=compileShader(gl,gl.FRAGMENT_SHADER,fragment);let program=gl.createProgram();gl.attachShader(program,vertShader);gl.attachShader(program,fragShader);for(const location in attributes){gl.bindAttribLocation(program,attributes[location],location)}gl.linkProgram(program);if(!gl.getProgramParameter(program,gl.LINK_STATUS)){const error_msg="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+gl.getProgramParameter(program,gl.VALIDATE_STATUS)+"\ngl.getError()"+gl.getError()+"\ngl.getProgramInfoLog()"+gl.getProgramInfoLog(program);gl.deleteProgram(program);program=null;throw new Error(error_msg)}gl.useProgram(program);gl.deleteShader(vertShader);gl.deleteShader(fragShader);return program}function setPrecision(src,precision){if(src.substring(0,9)!=="precision"){return"precision "+precision+" float;"+src}return src}function getMaxShaderPrecision(gl){if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT).precision>0){return"highp"}if(gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT).precision>0&&gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.MEDIUM_FLOAT).precision>0){return"mediump"}return"lowp"}function minify(src){src=src.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");src=src.replace(/(\\n\s+)|(\s+\\n)/g,"");src=src.replace(/(\\r|\\n)+/g,"");src=src.replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1");return src}var GLShader=class{constructor(gl,vertex,fragment,precision){this.gl=gl;this.vertex=setPrecision(minify(vertex),precision||getMaxShaderPrecision(this.gl));this.fragment=setPrecision(minify(fragment),precision||getMaxShaderPrecision(this.gl));this.attributes=extractAttributes(this.gl,this);this.program=compileProgram(this.gl,this.vertex,this.fragment,this.attributes);this.uniforms=extractUniforms(this.gl,this);eventEmitter.addListener(ONCONTEXT_LOST,this.destroy.bind(this))}bind(){this.gl.useProgram(this.program)}getAttribLocation(name){const attr=this.attributes[name];if(typeof attr!=="undefined"){return attr}else{return-1}}setUniform(name,value){const uniforms=this.uniforms;if(typeof uniforms[name]!=="undefined"){if(typeof value==="object"&&typeof value.toArray==="function"){uniforms[name]=value.toArray()}else{uniforms[name]=value}}else{throw new Error("undefined ("+name+") uniform for shader "+this)}}setVertexAttributes(gl,attributes,vertexByteSize){for(let index=0;index<attributes.length;++index){const element=attributes[index];const location=this.getAttribLocation(element.name);if(location!==-1){gl.enableVertexAttribArray(location);gl.vertexAttribPointer(location,element.size,element.type,element.normalized,vertexByteSize,element.offset)}else{gl.disableVertexAttribArray(index)}}}destroy(){this.uniforms=null;this.attributes=null;this.gl.deleteProgram(this.program);this.vertex=null;this.fragment=null}};var propertiesToObserve=["x","y","z"];var setOfProperties=new Set(propertiesToObserve);var isObservableProperty=property=>{return setOfProperties.has(property)};var ObservableVector3d=class{constructor(x=0,y=0,z=0,callback){this.callBackEnabled=true;const{proxy,revoke}=Proxy.revocable(new Vector3d(x,y,z),{set:(target,property,value)=>{if(isObservableProperty(property)){Reflect.set(target,property,value);if(this.callBackEnabled){this._callback?.()}return true}return false}});this._revoke=revoke;this._vector3d=proxy;if(callback){this.setCallback(callback)}}set(x=0,y=0,z=0){this.callBackEnabled=false;this._vector3d.x=x;this._vector3d.y=y;this._vector3d.z=z;this._callback?.();this.callBackEnabled=true;return this}setMuted(x=0,y=0,z=0){this.callBackEnabled=false;this._vector3d.x=x;this._vector3d.y=y;this._vector3d.z=z;this.callBackEnabled=true;return this}get x(){return this._vector3d.x}set x(value){this._vector3d.x=value}get y(){return this._vector3d.y}set y(value){this._vector3d.y=value}get z(){return this._vector3d.z}set z(value){this._vector3d.z=value}setCallback(callback){this._callback=callback}setZero(){return this.set(0,0,0)}setV(v){return this.set(v.x,v.y,"z"in v?v.z:void 0)}add(v){return this.set(this.x+v.x,this.y+v.y,this.z+("z"in v?v.z:0))}sub(v){return this.set(this.x-v.x,this.y-v.y,this.z-("z"in v?v.z:0))}scale(x,y=x,z=1){return this.set(this.x*x,this.y*y,this.z*z)}scaleV(v){return this.scale(v.x,v.y,v.z)}toIso(){return this.set(this.x-this.y,(this.x+this.y)*.5,this.z)}to2d(){return this.set(this.y+this.x/2,this.y-this.x/2,this.z)}div(n){return this.set(this.x/n,this.y/n,this.z/n)}abs(){return this.set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(low,high){return this._vector3d.clamp(low,high)}clampSelf(low,high){return this._vector3d.clampSelf(low,high)}minV(v){const _vz="z"in v?v.z:0;return this.set(this.x<v.x?this.x:v.x,this.y<v.y?this.y:v.y,this.z<_vz?this.z:_vz)}maxV(v){const _vz="z"in v?v.z:0;return this.set(this.x>v.x?this.x:v.x,this.y>v.y?this.y:v.y,this.z>_vz?this.z:_vz)}floor(){return this._vector3d.floor()}floorSelf(){return this._vector3d.floorSelf()}ceil(){return this._vector3d.ceil()}ceilSelf(){return this._vector3d.ceilSelf()}negate(){return this._vector3d.negate()}negateSelf(){return this._vector3d.negateSelf()}copy(v){return this.set(v.x,v.y,"z"in v?v.z:0)}equals(...args){let _x;let _y;let _z;if(args.length===1){const arg=args[0];if(typeof arg==="object"){[_x,_y,_z]=[arg.x,arg.y,"z"in arg?arg.z:this.z]}else{_x=arg;_y=this.y;_z=this.z}}else if(args.length===2){[_x,_y,_z]=[args[0],args[1],this.z]}else{[_x,_y,_z]=args}return this.x===_x&&this.y===_y&&this.z===_z}normalize(){return this._vector3d.normalize()}perp(){return this._vector3d.perp()}rotate(angle,v){let cx=0;let cy=0;if(v){cx=v.x;cy=v.y}const x=this.x-cx;const y=this.y-cy;const c=Math.cos(angle);const s=Math.sin(angle);return this.set(x*c-y*s+cx,x*s+y*c+cy,this.z)}dot(v){return this._vector3d.dot(v)}cross(v){const ax=this.x;const ay=this.y;const az=this.z;const bx=v.x;const by=v.y;const bz=v.z;this.set(ay*bz-az*by,az*bx-ax*bz,ax*by-ay*bx);return this}length2(){return this._vector3d.length2()}length(){return this._vector3d.length()}lerp(v,alpha2){this.set(this.x+(v.x-this.x)*alpha2,this.y+(v.y-this.y)*alpha2,this.z+(v.z-this.z)*alpha2);return this}moveTowards(target,step){const angle=Math.atan2(target.y-this.y,target.x-this.x);const dx=this.x-target.x;const dy=this.y-target.y;const distance=Math.sqrt(dx*dx+dy*dy);if(distance===0||step>=0&&distance<=step*step){return target}this.set(this.x+Math.cos(angle)*step,this.y+Math.sin(angle)*step,this.z);return this}distance(v){return this._vector3d.distance(v)}angle(v){return this._vector3d.angle(v)}project(v){const ratio=this.dot(v)/v.length2();return this.scale(ratio,ratio,ratio)}projectN(v){const ratio=this.dot(v)/v.length2();return this.scale(ratio,ratio,ratio)}clone(cb){return observableVector3dPool.get(this.x,this.y,this.z,cb)}toString(){return this._vector3d.toString()}revoke(){this._revoke()}};var observableVector3dPool=createPool((x,y,z,cb)=>{const vector=new ObservableVector3d(x,y,z,cb);return{instance:vector,reset(x2=0,y2=0,z2=0,cb2){vector.setMuted(x2,y2,z2);if(cb2){vector.setCallback(cb2)}}}});var ObservablePoint=class _ObservablePoint{constructor(x=0,y=0,callback){this.callBackEnabled=true;const{proxy,revoke}=Proxy.revocable(new Point(x,y),{set:(target,property,value)=>{if(property==="x"||property==="y"){Reflect.set(target,property,value);if(this.callBackEnabled){this._callback?.()}return true}return false}});this.callBackEnabled=true;this._revoke=revoke;this._point=proxy;if(callback){this.setCallback(callback)}}set(x=0,y=0){this.callBackEnabled=false;this._point.x=x;this._point.y=y;this._callback?.();this.callBackEnabled=true;return this}setMuted(x=0,y=0){this.callBackEnabled=false;this._point.x=x;this._point.y=y;this.callBackEnabled=true;return this}get x(){return this._point.x}set x(value){this._point.x=value}get y(){return this._point.y}set y(value){this._point.y=value}setCallback(callback){this._callback=callback}equals(xOrPoint,y){return this._point.equals(xOrPoint,y)}clone(){return new _ObservablePoint(this._point.x,this._point.y,this._callback)}revoke(){this._revoke()}};var Renderable=class _Renderable extends Rect{constructor(x,y,width,height){super(x,y,width,height);this.pos=new ObservableVector3d(x,y,0,()=>{this.updateBounds();this.isDirty=true});this.anchorPoint=new ObservablePoint(.5,.5,()=>{this.updateBounds();this.isDirty=true});if(typeof this.currentTransform==="undefined"){this.currentTransform=matrix2dPool.get()}this.currentTransform.identity();this.body=void 0;this.GUID=void 0;this.onVisibilityChange=void 0;this.alwaysUpdate=false;this.updateWhenPaused=false;this.isPersistent=false;this.floating=false;this.autoTransform=true;this.alpha=1;this.ancestor=void 0;this.mask=void 0;this.shader=void 0;this.blendMode="normal";this.name="";this.isRenderable=true;this.isKinematic=true;this.isDirty=true;this._absPos=void 0;this._flip={x:false,y:false};this._inViewport=false;this._parentApp=void 0;this._tint=colorPool.get(255,255,255,1);this.setOpacity(1)}get parentApp(){if(typeof this._parentApp==="undefined"){if(typeof this.ancestor!=="undefined"&&typeof this.ancestor.getRootAncestor==="function"){this._parentApp=this.ancestor.getRootAncestor().app}}return this._parentApp}get isFloating(){return this.floating===true||typeof this.ancestor!=="undefined"&&this.ancestor.isFloating===true}get tint(){return this._tint}set tint(value){this._tint.copy(value);this.isDirty=true}get depth(){return this.pos.z}set depth(value){this.pos.z=value;this.isDirty=true}get inViewport(){return this._inViewport}set inViewport(value){if(this._inViewport!==value){this._inViewport=value;if(typeof this.onVisibilityChange==="function"){this.onVisibilityChange.call(this,value)}}}get isFlippedX(){return this._flip.x===true}get isFlippedY(){return this._flip.y===true}getBounds(){if(typeof this._bounds==="undefined"){super.getBounds();if(this.isFinite()){this.updateBounds()}else{this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)}}return this._bounds}getOpacity(){return this.alpha}setOpacity(alpha2){if(typeof alpha2==="number"){this.alpha=clamp(alpha2,0,1);if(isNaN(this.alpha)){this.alpha=1}this.isDirty=true}}flipX(flip=true){this._flip.x=!!flip;this.isDirty=true;return this}flipY(flip=true){this._flip.y=!!flip;this.isDirty=true;return this}transform(m){this.currentTransform.multiply(m);this.updateBounds();this.isDirty=true;return this}angleTo(target){const a=this.getBounds();let ax;let ay;if(target instanceof _Renderable){const b=target.getBounds();ax=b.centerX-a.centerX;ay=b.centerY-a.centerY}else{ax=target.x-a.centerX;ay=target.y-a.centerY}return Math.atan2(ay,ax)}distanceTo(target){const a=this.getBounds();let dx;let dy;if(target instanceof _Renderable){const b=target.getBounds();dx=a.centerX-b.centerX;dy=a.centerY-b.centerY}else{dx=a.centerX-target.x;dy=a.centerY-target.y}return Math.sqrt(dx*dx+dy*dy)}lookAt(target){let position2;if(target instanceof _Renderable){position2=target.pos}else{position2=target}const angle=this.angleTo(position2);this.rotate(angle);return this}rotate(angle,v){if(angle!==0){this.currentTransform.rotate(angle,v);this.updateBounds();this.isDirty=true}return this}scale(x,y=x){this.currentTransform.scale(x,y);this.updateBounds();this.isDirty=true;return this}scaleV(v){this.scale(v.x,v.y);return this}update(dt){return this.isDirty}updateBounds(absolute=true){if(this.isRenderable){const bounds=this.getBounds();bounds.clear();if(this.autoTransform===true&&!this.currentTransform.isIdentity()){this.currentTransform.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y);bounds.addFrame(0,0,this.width,this.height,this.currentTransform);this.currentTransform.translate(this.width*this.anchorPoint.x,this.height*this.anchorPoint.y)}else{bounds.addFrame(0,0,this.width,this.height);bounds.translate(-this.width*this.anchorPoint.x,-this.height*this.anchorPoint.y)}if(absolute===true){const absPos=this.getAbsolutePosition();bounds.centerOn(absPos.x+bounds.x+bounds.width/2,absPos.y+bounds.y+bounds.height/2)}return bounds}else{return super.updateBounds(absolute)}}getAbsolutePosition(){if(typeof this._absPos==="undefined"){this._absPos=vector2dPool.get()}this._absPos.set(this.pos.x,this.pos.y);if(typeof this.ancestor!=="undefined"&&typeof this.ancestor.getAbsolutePosition==="function"&&this.floating!==true){this._absPos.add(this.ancestor.getAbsolutePosition())}return this._absPos}preDraw(renderer2){const ax=this.width*this.anchorPoint.x;const ay=this.height*this.anchorPoint.y;renderer2.save();renderer2.setGlobalAlpha(renderer2.globalAlpha()*this.getOpacity());if(this._flip.x||this._flip.y){const dx=this._flip.x?this.centerX-ax:0;const dy=this._flip.y?this.centerY-ay:0;renderer2.translate(dx,dy);renderer2.scale(this._flip.x?-1:1,this._flip.y?-1:1);renderer2.translate(-dx,-dy)}if(typeof this.mask!=="undefined"){renderer2.translate(this.pos.x,this.pos.y);renderer2.setMask(this.mask);renderer2.translate(-this.pos.x,-this.pos.y)}if(typeof this.shader==="object"&&typeof renderer2.gl!=="undefined"){renderer2.customShader=this.shader}if(this.autoTransform===true&&!this.currentTransform.isIdentity()){renderer2.translate(this.pos.x,this.pos.y);renderer2.transform(this.currentTransform);renderer2.translate(-this.pos.x,-this.pos.y)}renderer2.translate(-ax,-ay);renderer2.setTint(this.tint,this.getOpacity());if(this.blendMode!==renderer2.getBlendMode()){renderer2.setBlendMode(this.blendMode)}}draw(renderer2,viewport){}postDraw(renderer2){renderer2.clearTint();if(typeof this.mask!=="undefined"){renderer2.clearMask()}if(typeof this.shader==="object"&&typeof renderer2.gl!=="undefined"){renderer2.customShader=void 0}renderer2.restore();this.isDirty=false}onCollision(){return false}destroy(){matrix2dPool.release(this.currentTransform);this.currentTransform=void 0;this.anchorPoint.revoke();this.anchorPoint=void 0;this.pos=void 0;if(typeof this._absPos!=="undefined"){vector2dPool.release(this._absPos);this._absPos=void 0}if(this._bounds instanceof Bounds){boundsPool.release(this._bounds);this._bounds=void 0}this.onVisibilityChange=void 0;if(typeof this.mask!=="undefined"){legacy_pool_default.push(this.mask);this.mask=void 0}if(this._tint instanceof Color){colorPool.release(this._tint);this._tint=void 0}this.ancestor=void 0;this._parentApp=void 0;if(this.body instanceof Body){this.body.destroy.apply(this.body,arguments);this.body=void 0}releaseAllPointerEvents(this);this.onDestroyEvent.apply(this,arguments);if(this.shader instanceof GLShader){this.shader.destroy();this.shader=void 0}}onDestroyEvent(){}};var Easing={Linear:{None:k=>{return k}},Quadratic:{In:k=>{return k*k},Out:k=>{return k*(2-k)},InOut:k=>{if((k*=2)<1){return.5*k*k}return-.5*(--k*(k-2)-1)}},Cubic:{In:k=>{return k*k*k},Out:k=>{return--k*k*k+1},InOut:k=>{if((k*=2)<1){return.5*k*k*k}return.5*((k-=2)*k*k+2)}},Quartic:{In:k=>{return k*k*k*k},Out:k=>{return 1- --k*k*k*k},InOut:k=>{if((k*=2)<1){return.5*k*k*k*k}return-.5*((k-=2)*k*k*k-2)}},Quintic:{In:k=>{return k*k*k*k*k},Out:k=>{return--k*k*k*k*k+1},InOut:k=>{if((k*=2)<1){return.5*k*k*k*k*k}return.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:k=>{return 1-Math.cos(k*Math.PI/2)},Out:k=>{return Math.sin(k*Math.PI/2)},InOut:k=>{return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:k=>{return k===0?0:Math.pow(1024,k-1)},Out:k=>{return k===1?1:1-Math.pow(2,-10*k)},InOut:k=>{if(k===0){return 0}if(k===1){return 1}if((k*=2)<1){return.5*Math.pow(1024,k-1)}return.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:k=>{return 1-Math.sqrt(1-k*k)},Out:k=>{return Math.sqrt(1- --k*k)},InOut:k=>{if((k*=2)<1){return-.5*(Math.sqrt(1-k*k)-1)}return.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:k=>{if(k===0){return 0}if(k===1){return 1}return-Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)},Out:k=>{if(k===0){return 0}if(k===1){return 1}return Math.pow(2,-10*k)*Math.sin((k-.1)*5*Math.PI)+1},InOut:k=>{if(k===0){return 0}if(k===1){return 1}k*=2;if(k<1){return-.5*Math.pow(2,10*(k-1))*Math.sin((k-1.1)*5*Math.PI)}return.5*Math.pow(2,-10*(k-1))*Math.sin((k-1.1)*5*Math.PI)+1}},Back:{In:k=>{const s=1.70158;return k*k*((s+1)*k-s)},Out:k=>{const s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:k=>{const s=1.70158*1.525;if((k*=2)<1){return.5*(k*k*((s+1)*k-s))}return.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:k=>{return 1-Easing.Bounce.Out(1-k)},Out:k=>{if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:k=>{if(k<.5){return Easing.Bounce.In(k*2)*.5}return Easing.Bounce.Out(k*2-1)*.5+.5}}};var linear=(p0,p1,t)=>{return(p1-p0)*t+p0};var factorialCache=[1];var factorial=n=>{if(factorialCache[n]){return factorialCache[n]}let s=1;for(let i=n;i>1;i--){s*=i}factorialCache[n]=s;return s};var bernstein=(n,i)=>{return factorial(n)/factorial(i)/factorial(n-i)};var catmullRom=(p0,p1,p2,p3,t)=>{const v0=(p2-p0)*.5;const v1=(p3-p1)*.5;const t2=t*t;const t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1};var Interpolation={Linear:(v,k)=>{const m=v.length-1;const f=m*k;const i=Math.floor(f);if(k<0){return linear(v[0],v[1],f)}if(k>1){return linear(v[m],v[m-1],m-f)}return linear(v[i],v[i+1>m?m:i+1],f-i)},Bezier:(v,k)=>{let b=0;const n=v.length-1;for(let i=0;i<=n;i++){b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*bernstein(n,i)}return b},CatmullRom:(v,k)=>{const m=v.length-1;let f=m*k;let i=Math.floor(f);if(v[0]===v[m]){if(k<0){i=Math.floor(f=m*(1+k))}return catmullRom(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(k<0){return v[0]-(catmullRom(v[0],v[0],v[1],v[1],-f)-v[0])}if(k>1){return v[m]-(catmullRom(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return catmullRom(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}}};var Tween=class{#boundResumeCallback;constructor(object){this.setProperties(object);this.#boundResumeCallback=this._resumeCallback.bind(this)}onResetEvent(object){this.setProperties(object)}setProperties(object){this._object=object;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._yoyo=false;this._reversed=false;this._delayTime=0;this._startTime=null;this._easingFunction=Easing.Linear.None;this._interpolationFunction=Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=false;this._onUpdateCallback=null;this._onCompleteCallback=null;this._tweenTimeTracker=game.lastUpdate;this.isPersistent=false;this.updateWhenPaused=false;this.isRenderable=false;for(const field in object){if(typeof object!=="object"){this._valuesStart[field]=parseFloat(object[field])}}}_resumeCallback(elapsed){if(this._startTime){this._startTime+=elapsed}}onActivateEvent(){eventEmitter.addListener(STATE_RESUME,this.#boundResumeCallback)}onDeactivateEvent(){eventEmitter.removeListener(STATE_RESUME,this.#boundResumeCallback)}to(properties,options){this._valuesEnd=properties;if(typeof options!=="undefined"){if(options.duration){this._duration=options.duration}if(options.yoyo){this.yoyo(options.yoyo)}if(options.easing){this.easing(options.easing)}if(options.repeat){this.repeat(options.repeat)}if(options.delay){this.delay(options.delay)}if(options.interpolation){this.interpolation(options.interpolation)}if(options.autoStart){this.start()}}return this}start(time=timer_default.getTime()){this._onStartCallbackFired=false;game.world.addChild(this);this._startTime=time+this._delayTime;for(const property in this._valuesEnd){const endValue=this._valuesEnd[property];if(Array.isArray(endValue)){if(endValue.length===0){continue}this._valuesEnd[property]=[this._object[property]].concat(endValue)}this._valuesStart[property]=this._object[property];if(!Array.isArray(this._valuesStart[property])){this._valuesStart[property]*=1}this._valuesStartRepeat[property]=this._valuesStart[property]||0}return this}stop(){game.world.removeChildNow(this);return this}delay(amount){this._delayTime=amount;return this}repeat(times){this._repeat=times;return this}yoyo(yoyo){this._yoyo=yoyo;return this}easing(easing){this._easingFunction=easing;return this}interpolation(interpolation){this._interpolationFunction=interpolation;return this}chain(...tweens){this._chainedTweens=tweens;return this}onStart(onStartCallback){this._onStartCallback=onStartCallback;return this}onUpdate(onUpdateCallback){this._onUpdateCallback=onUpdateCallback;return this}onComplete(onCompleteCallback){this._onCompleteCallback=onCompleteCallback;return this}update(dt){this._tweenTimeTracker=game.lastUpdate>this._tweenTimeTracker?game.lastUpdate:this._tweenTimeTracker+dt;const time=this._tweenTimeTracker;if(this._startTime===null||time<this._startTime){return true}if(!this._onStartCallbackFired){if(this._onStartCallback!==null){this._onStartCallback.call(this._object)}this._onStartCallbackFired=true}let elapsed=(time-this._startTime)/this._duration;elapsed=elapsed>1?1:elapsed;const value=this._easingFunction(elapsed);for(const property in this._valuesEnd){const start=this._valuesStart[property]||0;let end=this._valuesEnd[property];if(Array.isArray(end)){this._object[property]=this._interpolationFunction(end,value)}else{if(typeof end==="string"){end=start+parseFloat(end)}if(typeof end==="number"){this._object[property]=start+(end-start)*value}}}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._object,value)}if(elapsed===1){if(this._repeat>0){if(isFinite(this._repeat)){this._repeat--}for(const property in this._valuesStartRepeat){if(typeof this._valuesEnd[property]==="string"){this._valuesStartRepeat[property]=this._valuesStartRepeat[property]+parseFloat(this._valuesEnd[property])}if(this._yoyo){const tmp=this._valuesStartRepeat[property];this._valuesStartRepeat[property]=this._valuesEnd[property];this._valuesEnd[property]=tmp}this._valuesStart[property]=this._valuesStartRepeat[property]}if(this._yoyo){this._reversed=!this._reversed}this._startTime=time+this._delayTime;return true}else{game.world.removeChildNow(this);if(this._onCompleteCallback!==null){this._onCompleteCallback.call(this._object)}for(let i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++){this._chainedTweens[i].start(time)}return false}}return true}static get Easing(){return Easing}static get Interpolation(){return Interpolation}};var tweenPool=createPool(obj=>{const tween=new Tween(obj);return{instance:tween,reset(obj2){tween.setProperties(obj2)}}});var targetV=new Vector2d;var Camera2d=class extends Renderable{constructor(minX,minY,maxX,maxY){super(minX,minY,maxX-minX,maxY-minY);this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3};this.bounds=boundsPool.get();this.smoothFollow=true;this.damping=1;this.near=-1e3;this.far=1e3;this.projectionMatrix=new Matrix3d;this.invCurrentTransform=new Matrix2d;this.offset=new Vector2d;this.target=null;this.follow_axis=this.AXIS.NONE;this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null};this._fadeOut={color:null,tween:null};this._fadeIn={color:null,tween:null};this.name="default";this.setDeadzone(this.width/6,this.height/6);this.anchorPoint.set(0,0);this.isKinematic=false;this.bounds.setMinMax(minX,minY,maxX,maxY);this._updateProjectionMatrix();eventEmitter.addListener(GAME_RESET,this.reset.bind(this));eventEmitter.addListener(CANVAS_ONRESIZE,this.resize.bind(this))}_updateProjectionMatrix(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)}_followH(target){let targetX=this.pos.x;if(target.x-this.pos.x>this.deadzone.right){targetX=Math.min(target.x-this.deadzone.right,this.bounds.width-this.width)}else if(target.x-this.pos.x<this.deadzone.pos.x){targetX=Math.max(target.x-this.deadzone.pos.x,this.bounds.left)}return targetX}_followV(target){let targetY=this.pos.y;if(target.y-this.pos.y>this.deadzone.bottom){targetY=Math.min(target.y-this.deadzone.bottom,this.bounds.height-this.height)}else if(target.y-this.pos.y<this.deadzone.pos.y){targetY=Math.max(target.y-this.deadzone.pos.y,this.bounds.top)}return targetY}reset(x=0,y=0){this.pos.x=x;this.pos.y=y;this.unfollow();this.smoothFollow=true;this.damping=1;this.currentTransform.identity();this.invCurrentTransform.identity().invert();this._updateProjectionMatrix()}setDeadzone(w,h){if(typeof this.deadzone==="undefined"){this.deadzone=new Rect(0,0,0,0)}this.deadzone.pos.set(~~((this.width-w)/2),~~((this.height-h)/2-h*.25));this.deadzone.resize(w,h);this.smoothFollow=false;this.updateTarget();this.smoothFollow=true}resize(w,h){super.resize(w,h);this.smoothFollow=false;this.setBounds(0,0,w,h);this.setDeadzone(w/6,h/6);this.update();this.smoothFollow=true;this._updateProjectionMatrix();eventEmitter.emit(VIEWPORT_ONRESIZE,this.width,this.height);return this}setBounds(x,y,w,h){this.smoothFollow=false;this.bounds.setMinMax(x,y,w+x,h+y);this.moveTo(this.pos.x,this.pos.y);this.update();this.smoothFollow=true}follow(target,axis,damping){if(target instanceof Renderable){this.target=target.pos}else if(target instanceof Vector2d||target instanceof Vector3d){this.target=target}else{throw new Error("invalid target for me.Camera2d.follow")}this.follow_axis=typeof axis==="undefined"?this.AXIS.BOTH:axis;this.smoothFollow=false;if(typeof damping!=="number"){this.damping=1}else{this.damping=clamp(damping,0,1)}this.updateTarget();this.smoothFollow=true}unfollow(){this.target=null;this.follow_axis=this.AXIS.NONE}move(x,y){this.moveTo(this.pos.x+x,this.pos.y+y)}moveTo(x,y){const _x=this.pos.x;const _y=this.pos.y;this.pos.x=clamp(x,this.bounds.left,this.bounds.width);this.pos.y=clamp(y,this.bounds.top,this.bounds.height);if(_x!==this.pos.x||_y!==this.pos.y){this.isDirty=true}}updateTarget(){if(this.target){targetV.setV(this.pos);switch(this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:targetV.x=this._followH(this.target);break;case this.AXIS.VERTICAL:targetV.y=this._followV(this.target);break;case this.AXIS.BOTH:targetV.x=this._followH(this.target);targetV.y=this._followV(this.target);break;default:break}if(!this.pos.equals(targetV)){if(this.smoothFollow===true&&this.damping<1){if(toBeCloseTo(targetV.x,this.pos.x,2)&&toBeCloseTo(targetV.y,this.pos.y,2)){this.pos.setV(targetV);return}else{this.pos.lerp(targetV,this.damping)}}else{this.pos.setV(targetV)}this.isDirty=true}}}update(dt){this.updateTarget(dt);if(this._shake.duration>0){this._shake.duration-=dt;if(this._shake.duration<=0){this._shake.duration=0;this.offset.setZero();if(typeof this._shake.onComplete==="function"){this._shake.onComplete()}}else{if(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.HORIZONTAL){this.offset.x=(Math.random()-.5)*this._shake.intensity}if(this._shake.axis===this.AXIS.BOTH||this._shake.axis===this.AXIS.VERTICAL){this.offset.y=(Math.random()-.5)*this._shake.intensity}}this.isDirty=true}if(this.isDirty===true){eventEmitter.emit(VIEWPORT_ONCHANGE,this.pos)}if(this._fadeIn.tween!=null||this._fadeOut.tween!=null){this.isDirty=true}if(!this.currentTransform.isIdentity()){this.invCurrentTransform.copy(this.currentTransform).invert()}else{this.invCurrentTransform.identity()}return super.update(dt)}shake(intensity,duration,axis,onComplete,force){if(this._shake.duration===0||force===true){this._shake.intensity=intensity;this._shake.duration=duration;this._shake.axis=axis||this.AXIS.BOTH;this._shake.onComplete=typeof onComplete==="function"?onComplete:void 0}}fadeOut(color,duration=1e3,onComplete){this._fadeOut.color=colorPool.get(color);this._fadeOut.tween=tweenPool.get(this._fadeOut.color).to({alpha:0},{duration:duration}).onComplete(onComplete||null);this._fadeOut.tween.isPersistent=true;this._fadeOut.tween.start()}fadeIn(color,duration=1e3,onComplete){this._fadeIn.color=colorPool.get(color);const _alpha=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0;this._fadeIn.tween=tweenPool.get(this._fadeIn.color).to({alpha:_alpha},{duration:duration}).onComplete(onComplete||null);this._fadeIn.tween.isPersistent=true;this._fadeIn.tween.start()}focusOn(target){const bounds=target.getBounds();this.moveTo(target.pos.x+bounds.left+bounds.width/2,target.pos.y+bounds.top+bounds.height/2)}isVisible(obj,floating=obj.floating){if(floating===true||obj.floating===true){return renderer.overlaps(obj.getBounds())}else{return obj.getBounds().overlaps(this)}}localToWorld(x,y,v){v=v||vector2dPool.get();v.set(x,y).add(this.pos).sub(game.world.pos);if(!this.currentTransform.isIdentity()){this.invCurrentTransform.apply(v)}return v}worldToLocal(x,y,v){v=v||vector2dPool.get();v.set(x,y);if(!this.currentTransform.isIdentity()){this.currentTransform.apply(v)}return v.sub(this.pos).add(game.world.pos)}drawFX(renderer2){if(this._fadeIn.tween){renderer2.save();renderer2.resetTransform();renderer2.setColor(this._fadeIn.color);renderer2.fillRect(0,0,this.width,this.height);renderer2.restore();if(this._fadeIn.color.alpha===1){this._fadeIn.tween=null;colorPool.release(this._fadeIn.color);this._fadeIn.color=null}}if(this._fadeOut.tween){renderer2.save();renderer2.resetTransform();renderer2.setColor(this._fadeOut.color);renderer2.fillRect(0,0,this.width,this.height);renderer2.restore();if(this._fadeOut.color.alpha===0){this._fadeOut.tween=null;colorPool.release(this._fadeOut.color);this._fadeOut.color=null}}}draw(renderer2,container){const translateX=this.pos.x+this.offset.x;const translateY=this.pos.y+this.offset.y;container.currentTransform.translate(-translateX,-translateY);renderer2.setProjection(this.projectionMatrix);renderer2.clipRect(0,0,this.width,this.height);this.preDraw(renderer2);container.preDraw(renderer2,this);container.draw(renderer2,this);this.drawFX(renderer2);container.postDraw(renderer2,this);this.postDraw(renderer2);container.currentTransform.translate(translateX,translateY)}};var default_camera;var default_settings={cameras:[]};var Stage=class{constructor(settings){this.cameras=new Map;this.lights=new Map;this.ambientLight=new Color(0,0,0,0);this.settings=Object.assign(default_settings,settings||{})}reset(){this.settings.cameras.forEach(camera=>{this.cameras.set(camera.name,camera)});if(this.cameras.has("default")===false){if(typeof default_camera==="undefined"){const width=renderer.width;const height=renderer.height;default_camera=new Camera2d(0,0,width,height)}this.cameras.set("default",default_camera)}eventEmitter.emit(STAGE_RESET,this);this.onResetEvent.apply(this,arguments)}update(dt){let isDirty=false;this.cameras.forEach(camera=>{if(camera.update(dt)===true){isDirty=true}});this.lights.forEach(light=>{if(light.update(dt)===true){isDirty=true}});return isDirty}draw(renderer2,world){this.cameras.forEach(camera=>{camera.draw(renderer2,world);if(this.ambientLight.alpha!==0){renderer2.save();this.lights.forEach(light=>{renderer2.setMask(light.getVisibleArea(),true)});renderer2.setColor(this.ambientLight);renderer2.fillRect(0,0,camera.width,camera.height);renderer2.clearMask();renderer2.restore()}this.lights.forEach(light=>{light.preDraw(renderer2,world);light.draw(renderer2,world);light.postDraw(renderer2,world)})})}destroy(){this.cameras.clear();this.lights.forEach(light=>{light.destroy()});this.lights.clear();this.onDestroyEvent.apply(this,arguments)}onResetEvent(){if(typeof this.settings.onResetEvent==="function"){this.settings.onResetEvent.apply(this,arguments)}}onDestroyEvent(){if(typeof this.settings.onDestroyEvent==="function"){this.settings.onDestroyEvent.apply(this,arguments)}}};var loader_exports={};__export(loader_exports,{baseURL:()=>baseURL,crossOrigin:()=>crossOrigin2,getBinary:()=>getBinary,getFont:()=>getFont,getImage:()=>getImage,getJSON:()=>getJSON,getTMX:()=>getTMX,getVideo:()=>getVideo,load:()=>load2,nocache:()=>nocache,onError:()=>onError,onProgress:()=>onProgress,onload:()=>onload,preload:()=>preload,reload:()=>reload,setBaseURL:()=>setBaseURL,setNocache:()=>setNocache,setOptions:()=>setOptions,setParser:()=>setParser,unload:()=>unload2,unloadAll:()=>unloadAll2,withCredentials:()=>withCredentials});var imgList={};var tmxList={};var binList={};var jsonList={};var videoList={};var fontList={};function fetchData(url,responseType,settings={}){return new Promise((resolve,reject)=>{fetch(url,{method:"GET",cache:settings.nocache===""?"no-cache":"reload",credentials:settings.withCredentials===true?"include":"omit",mode:settings.crossOrigin==="anonymous"?"cors":"no-cors"}).then(response=>{if(!response.ok){if(response.status!==0){if(typeof onerror==="function"){reject(new Error("`Network response was not ok ${response.statusText}`"))}}}switch(responseType){case"json":return response.json();case"text":return response.text();case"blob":return response.blob();case"arrayBuffer":return response.arrayBuffer();default:reject(new Error("Invalid response type"))}}).then(data2=>{return resolve(data2)}).catch(error=>{return reject(error)})})}function parseDDS(){throw new Error("unsupported format")}function parseKTX(){throw new Error("unsupported format")}function parseKTX2(){throw new Error("unsupported format")}function parsePVR(){throw new Error("unsupported format")}function parsePKM(){throw new Error("unsupported format")}var _renderer;eventEmitter.addListenerOnce(VIDEO_INIT,renderer2=>{_renderer=renderer2});function parseCompressedImage(arrayBuffer,imgExt){let texture;if(_renderer.type.includes("WebGL")){switch(imgExt){case"dds":texture=parseDDS(arrayBuffer);break;case"pvr":texture=parsePVR(arrayBuffer);break;case"pkm":texture=parsePKM(arrayBuffer);break;case"ktx":texture=parseKTX(arrayBuffer);break;case"ktx2":texture=parseKTX2(arrayBuffer);break}}if(typeof texture!=="undefined"){if(_renderer.hasSupportedCompressedFormats(texture.format)){console.log("Compressed texture format supported: "+texture.format);return texture}}throw"unsupported texture format:"+imgExt+texture?" ("+texture.format+")":""}function preloadImage(img,onload2,onerror2,settings){if(typeof imgList[img.name]!=="undefined"){return 0}const sources=Array.isArray(img.src)?img.src:[img.src];let isFormatSupported=false;for(const imgPath of sources){const imgExt=getExtension(imgPath);switch(imgExt){case"dds":case"pvr":case"pkm":case"ktx":case"ktx2":fetchData(imgPath,"arrayBuffer",settings).then(arrayBuffer=>{try{imgList[img.name]=parseCompressedImage(arrayBuffer,imgExt);isFormatSupported=true;if(typeof onload2==="function"){onload2()}}catch{}}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});break;case"svg":fetchData(imgPath,"text",settings).then(svgText=>{const svgImage=new Image;svgImage.onload=function(){imgList[img.name]=svgImage;if(typeof onload2==="function"){onload2()}};svgImage.onerror=function(error){if(typeof onerror2==="function"){onerror2(error)}};svgImage.src="data:image/svg+xml;charset=utf8,"+encodeURIComponent(svgText)}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});isFormatSupported=true;break;default:fetchData(imgPath,"blob",settings).then(blob=>{globalThis.createImageBitmap(blob).then(bitmap=>{imgList[img.name]=bitmap;if(typeof onload2==="function"){onload2()}})}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});isFormatSupported=true;break}if(isFormatSupported===true){return 1}}throw new Error("No supported Image file format found for "+img.name)}function preloadFontFace(data2,onload2,onerror2){const fontFaceSet=typeof globalThis.document!=="undefined"?globalThis.document.fonts:void 0;if(isDataUrl(data2.src)===true){if(!data2.src.startsWith("url(")){data2.src="url("+data2.src+")"}}if(typeof fontFaceSet!=="undefined"){const font=new FontFace(data2.name,data2.src);font.load().then(()=>{fontList[data2.name]=font;fontFaceSet.add(font);if(typeof onload2==="function"){onload2()}},()=>{if(typeof onerror2==="function"){onerror2(data2.name)}})}else{if(typeof onerror2==="function"){onerror2()}}return 1}var collision={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1<<0,NPC_OBJECT:1<<1,ENEMY_OBJECT:1<<2,COLLECTABLE_OBJECT:1<<3,ACTION_OBJECT:1<<4,PROJECTILE_OBJECT:1<<5,WORLD_SHAPE:1<<6,USER:1<<7,ALL_OBJECT:4294967295},rayCast(line,result){return game.world.detector.rayCast(line,result)}};var TMXTileset=class{constructor(tileset){this.TileProperties=[];this.imageCollection=[];this.firstgid=this.lastgid=+tileset.firstgid;if(typeof tileset.source!=="undefined"){const src=tileset.source;const ext=getExtension(src);if(ext==="tsx"||ext==="json"){tileset=getTMX(getBasename(src));if(!tileset){throw new Error(src+" external TSX/JSON tileset not found")}}}this.name=tileset.name;this.tilewidth=+tileset.tilewidth;this.tileheight=+tileset.tileheight;this.spacing=+tileset.spacing||0;this.margin=+tileset.margin||0;this.tileoffset=new Vector2d;this.isAnimated=false;this.isCollection=false;this.class=tileset.class;this.animations=new Map;this._lastUpdate=0;const tiles=tileset.tiles;for(const i in tiles){if(tiles.hasOwnProperty(i)){if("animation"in tiles[i]){this.isAnimated=true;this.animations.set(tiles[+i].animation[0].tileid,{dt:0,idx:0,frames:tiles[+i].animation,cur:tiles[+i].animation[0]})}if("properties"in tiles[i]){if(Array.isArray(tiles[i].properties)){const tileProperty={};for(const j in tiles[i].properties){tileProperty[tiles[i].properties[j].name]=tiles[i].properties[j].value}this.setTileProperty(+tiles[i].id+this.firstgid,tileProperty)}else{this.setTileProperty(+i+this.firstgid,tiles[i].properties)}}if("image"in tiles[i]){const image=getImage(tiles[i].image);if(!image){throw new Error("melonJS: '"+tiles[i].image+"' file for tile '"+(+i+this.firstgid)+"' not found!")}this.imageCollection[+i+this.firstgid]=image}}}this.isCollection=this.imageCollection.length>0;const offset=tileset.tileoffset;if(offset){this.tileoffset.x=+offset.x;this.tileoffset.y=+offset.y}const tileInfo=tileset.tileproperties;if(tileInfo){for(const i in tileInfo){if(tileInfo.hasOwnProperty(i)){this.setTileProperty(+i+this.firstgid,tileInfo[i])}}}if(this.isCollection===false){this.image=getImage(tileset.image);if(!this.image){throw new Error("melonJS: '"+tileset.image+"' file for tileset '"+this.name+"' not found!")}this.texture=renderer.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing});this.atlas=this.texture.getAtlas();const hTileCount=+tileset.columns||Math.round(this.image.width/(this.tilewidth+this.spacing));let vTileCount=Math.round(this.image.height/(this.tileheight+this.spacing));if(tileset.tilecount%hTileCount>0){++vTileCount}this.lastgid=this.firstgid+(hTileCount*vTileCount-1||0);if(tileset.tilecount&&this.lastgid-this.firstgid+1!==+tileset.tilecount){console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+tileset.tilecount+")")}}}getTileImage(gid){return this.imageCollection[gid]}setTileProperty(gid,prop){this.TileProperties[gid]=prop}contains(gid){return gid>=this.firstgid&&gid<=this.lastgid}getViewTileId(gid){const localId=gid-this.firstgid;if(this.animations.has(localId)){return this.animations.get(localId).cur.tileid}return localId}getTileProperties(tileId){return this.TileProperties[tileId]}update(dt){let duration=0;const now=timer_default.getTime();let result=false;if(this._lastUpdate!==now){this._lastUpdate=now;this.animations.forEach(anim=>{anim.dt+=dt;duration=anim.cur.duration;while(anim.dt>=duration){anim.dt-=duration;anim.idx=(anim.idx+1)%anim.frames.length;anim.cur=anim.frames[anim.idx];duration=anim.cur.duration;result=true}})}return result}drawTile(renderer2,dx,dy,tmxTile){if(tmxTile.flipped){renderer2.save();renderer2.translate(dx,dy);renderer2.transform(tmxTile.currentTransform);dx=dy=0}if(this.isCollection===true){renderer2.drawImage(this.imageCollection[tmxTile.tileId],0,0,tmxTile.width,tmxTile.height,dx,dy,tmxTile.width,tmxTile.height)}else{const offset=this.atlas[this.getViewTileId(tmxTile.tileId)].offset;renderer2.drawImage(this.image,offset.x,offset.y,this.tilewidth,this.tileheight,dx,dy,this.tilewidth+renderer2.uvOffset,this.tileheight+renderer2.uvOffset)}if(tmxTile.flipped){renderer2.restore()}}};var TMX_FLIP_H=2147483648;var TMX_FLIP_V=1073741824;var TMX_FLIP_AD=536870912;var TMX_CLEAR_BIT_MASK=~(TMX_FLIP_H|TMX_FLIP_V|TMX_FLIP_AD);var COLLISION_GROUP="collision";var TMXTilesetGroup=class{constructor(){this.tilesets=[];this.length=0}add(tileset){this.tilesets.push(tileset);this.length++}getTilesetByIndex(i){return this.tilesets[i]}getTilesetByGid(gid){let invalidRange=-1;gid&=TMX_CLEAR_BIT_MASK;for(let i=0,len=this.tilesets.length;i<len;i++){if(this.tilesets[i].contains(gid)){return this.tilesets[i]}if(this.tilesets[i].firstgid===this.tilesets[i].lastgid&&gid>=this.tilesets[i].firstgid){invalidRange=i}}if(invalidRange!==-1){return this.tilesets[invalidRange]}else{throw new Error("no matching tileset found for gid "+gid)}}};var TMXUtils_exports={};__export(TMXUtils_exports,{applyTMXProperties:()=>applyTMXProperties,decode:()=>decode,parse:()=>parse,setInflateFunction:()=>setInflateFunction});var inflateFunction;function setTMXValue(name,type,value){let match;if(typeof value!=="string"){return value}switch(type){case"int":case"float":value=Number(value);break;case"bool":value=value==="true";break;default:if(!value||isBoolean(value)){value=value?value==="true":true}else if(isNumeric(value)){value=Number(value)}else if(value.search(/^json:/i)===0){match=value.split(/^json:/i)[1];try{value=JSON.parse(match)}catch{throw new Error("Unable to parse JSON: "+match)}}else if(value.search(/^eval:/i)===0){match=value.split(/^eval:/i)[1];try{value=Function("'use strict';return ("+match+")")()}catch{throw new Error("Unable to evaluate: "+match)}}else if((match=value.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(match=value.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/))){value="#"+match[2]+match[1]}if(name.search(/^(ratio|anchorPoint)$/)===0){if(typeof value==="number"){value={x:value,y:value}}}}return value}function parseAttributes(obj,elt){if(elt.attributes&&elt.attributes.length>0){for(let j=0;j<elt.attributes.length;j++){const attribute=elt.attributes.item(j);if(typeof attribute.name!=="undefined"){obj[attribute.name]=attribute.value}else{obj[attribute.nodeName]=attribute.nodeValue}}}}function normalize(obj,item){const nodeName=item.nodeName;switch(nodeName){case"data":{const data2=parse(item);data2.encoding=data2.encoding||"xml";if(typeof data2.chunks!=="undefined"){obj.chunks=obj.chunks||[];data2.chunks.forEach(chunk=>{obj.chunks.push({x:+chunk.x,y:+chunk.y,width:+chunk.width,height:+chunk.height,data:decode(chunk.text,data2.encoding,data2.compression)})});obj.encoding="none"}if(typeof data2.text!=="undefined"&&typeof obj.chunks==="undefined"){obj.data=decode(data2.text,data2.encoding,data2.compression);obj.encoding="none"}break}case"chunk":obj.chunks=obj.chunks||[];obj.chunks.push(parse(item));break;case"imagelayer":case"layer":case"objectgroup":case"group":{const layer=parse(item);layer.type=nodeName==="layer"?"tilelayer":nodeName;if(layer.image){layer.image=layer.image.source}obj.layers=obj.layers||[];obj.layers.push(layer);break}case"animation":obj.animation=parse(item).frames;break;case"frame":case"object":{const name=nodeName+"s";obj[name]=obj[name]||[];obj[name].push(parse(item));break}case"tile":{const tile=parse(item);if(tile.image){tile.imagewidth=tile.image.width;tile.imageheight=tile.image.height;tile.image=tile.image.source}obj.tiles=obj.tiles||{};obj.tiles[tile.id]=tile;break}case"tileset":{const tileset=parse(item);if(tileset.image){tileset.imagewidth=tileset.image.width;tileset.imageheight=tileset.image.height;tileset.image=tileset.image.source}obj.tilesets=obj.tilesets||[];obj.tilesets.push(tileset);break}case"polygon":case"polyline":{obj[nodeName]=[];const points=parse(item).points.split(" ");for(let i=0;i<points.length;i++){const v=points[i].split(",");obj[nodeName].push({x:+v[0],y:+v[1]})}break}case"properties":obj.properties=parse(item);break;case"property":{const property=parse(item);const value=typeof property.value!=="undefined"?property.value:property.text;obj[property.name]=setTMXValue(property.name,property.type||"string",value);break}default:obj[nodeName]=parse(item);break}}function decompress(data2,format){if(typeof inflateFunction==="function"){return inflateFunction(data2,format)}else{throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}}function decodeCSV(input){const entries=input.replace("\n","").trim().split(",");const result=[];for(let i=0;i<entries.length;i++){result.push(+entries[i])}return result}function decodeBase64AsArray(input,bytes=1){const dec=globalThis.atob(input.replace(/[^A-Za-z0-9\+\/\=]/g,""));const ar=new Uint32Array(dec.length/bytes);for(let i=0,len=dec.length/bytes;i<len;i++){ar[i]=0;for(let j=bytes-1;j>=0;--j){ar[i]+=dec.charCodeAt(i*bytes+j)<<(j<<3)}}return ar}function setInflateFunction(fn){inflateFunction=fn}function decode(data2,encoding,compression){compression=compression||"none";encoding=encoding||"none";switch(encoding){case"csv":return decodeCSV(data2);case"base64":if(compression!=="none"){data2=decompress(data2,compression)}else{data2=decodeBase64AsArray(data2,4)}return data2;case"none":return data2;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+encoding)}}function parse(xml){const obj={};let text="";if(xml.nodeType===1){parseAttributes(obj,xml)}if(xml.hasChildNodes()){const children=xml.childNodes;for(const node of children){switch(node.nodeType){case 1:normalize(obj,node);break;case 3:text+=node.nodeValue.trim();break}}}if(text){obj.text=text}return obj}function applyTMXProperties(obj,data2){const properties=data2.properties;const types=data2.propertytypes;if(typeof properties!=="undefined"){for(const property in properties){if(properties.hasOwnProperty(property)){let type="string";let name=property;let value=properties[property];if(typeof properties[property].name!=="undefined"){name=properties[property].name}if(typeof types!=="undefined"){type=types[property]}else if(typeof properties[property].type!=="undefined"){type=properties[property].type}if(typeof properties[property].value!=="undefined"){value=properties[property].value}obj[name]=setTMXValue(name,type,value)}}}}var Tile=class extends Bounds{constructor(x,y,gid,tileset){let width;let height;super();if(tileset.isCollection){const image=tileset.getTileImage(gid&TMX_CLEAR_BIT_MASK);width=image.width;height=image.height}else{width=tileset.tilewidth;height=tileset.tileheight}this.setMinMax(0,0,width,height);this.tileset=tileset;this.currentTransform=null;this.col=x;this.row=y;this.tileId=gid;this.flippedX=(this.tileId&TMX_FLIP_H)!==0;this.flippedY=(this.tileId&TMX_FLIP_V)!==0;this.flippedAD=(this.tileId&TMX_FLIP_AD)!==0;this.flipped=this.flippedX||this.flippedY||this.flippedAD;if(this.flipped===true){if(this.currentTransform===null){this.currentTransform=new Matrix2d}this.setTileTransform(this.currentTransform.identity())}this.tileId&=TMX_CLEAR_BIT_MASK}setTileTransform(transform){transform.translate(this.width/2,this.height/2);if(this.flippedAD){transform.rotate(-90*Math.PI/180);transform.scale(-1,1)}if(this.flippedX){transform.scale(this.flippedAD?1:-1,this.flippedAD?-1:1)}if(this.flippedY){transform.scale(this.flippedAD?-1:1,this.flippedAD?1:-1)}transform.translate(-this.width/2,-this.height/2)}getRenderable(settings){let renderable;const tileset=this.tileset;if(tileset.animations.has(this.tileId)){const frames=[];const frameId=[];tileset.animations.get(this.tileId).frames.forEach(frame=>{frameId.push(frame.tileid);frames.push({name:""+frame.tileid,delay:frame.duration})});renderable=tileset.texture.createAnimationFromName(frameId,settings);renderable.addAnimation(this.tileId-tileset.firstgid,frames);renderable.setCurrentAnimation(this.tileId-tileset.firstgid)}else{if(tileset.isCollection===true){const image=tileset.getTileImage(this.tileId);renderable=new Sprite(0,0,Object.assign({image:image}));renderable.anchorPoint.set(0,0);renderable.scale(settings.width/this.width,settings.height/this.height);if(typeof settings.rotation!=="undefined"){renderable.anchorPoint.set(.5,.5);renderable.currentTransform.rotate(settings.rotation);renderable.currentTransform.translate(settings.width/2,settings.height/2);settings.rotation=void 0}}else{renderable=tileset.texture.createSpriteFromName(this.tileId-tileset.firstgid,settings);renderable.anchorPoint.set(0,0)}}this.setTileTransform(renderable.currentTransform);return renderable}};var TMXObject=class{constructor(map,settings,z){this.points=void 0;this.name=settings.name;this.x=+settings.x;this.y=+settings.y;this.z=+z;this.width=+settings.width||0;this.height=+settings.height||0;this.gid=+settings.gid||null;this.tintcolor=settings.tintcolor;this.type=settings.type;this.class=typeof settings.class!=="undefined"?settings.class:settings.type;this.text=void 0;this.rotation=degToRad(+settings.rotation||0);this.id=+settings.id||void 0;this.orientation=map.orientation;this.shapes=void 0;this.isEllipse=false;this.isPoint=false;this.isPolygon=false;this.isPolyLine=false;if(typeof this.gid==="number"){this.setTile(map.tilesets)}else{if(typeof settings.ellipse!=="undefined"){this.isEllipse=true}else if(typeof settings.point!=="undefined"){this.isPoint=true}else if(typeof settings.polygon!=="undefined"){this.points=settings.polygon;this.isPolygon=true}else if(typeof settings.polyline!=="undefined"){this.points=settings.polyline;this.isPolyLine=true}}if(typeof settings.text!=="undefined"){this.text=settings.text;this.text.font=settings.text.fontfamily||"sans-serif";this.text.size=settings.text.pixelsize||16;this.text.fillStyle=settings.text.color||"#000000";this.text.textAlign=settings.text.halign||"left";this.text.textBaseline=settings.text.valign||"top";this.text.width=this.width;this.text.height=this.height;applyTMXProperties(this.text,settings)}else{applyTMXProperties(this,settings);if(!this.shapes){this.shapes=this.parseTMXShapes()}}if(!map.isEditor){map.getRenderer().adjustPosition(this)}}setTile(tilesets){const tileset=tilesets.getTilesetByGid(this.gid);if(tileset.isCollection===false){this.width=this.framewidth=tileset.tilewidth;this.height=this.frameheight=tileset.tileheight}this.tile=new Tile(this.x,this.y,this.gid,tileset)}parseTMXShapes(){const shapes=[];if(this.isEllipse===true){shapes.push(ellipsePool.get(this.width/2,this.height/2,this.width,this.height).rotate(this.rotation))}else if(this.isPoint===true){shapes.push(pointPool.get(this.x,this.y))}else{if(this.isPolygon===true){const _polygon=polygonPool.get(0,0,this.points);const isConvex=_polygon.isConvex();if(isConvex===false){throw new Error("collision polygones in Tiled should be defined as Convex")}else if(isConvex===null){throw new Error("invalid polygone")}shapes.push(_polygon.rotate(this.rotation))}else if(this.isPolyLine===true){const p=this.points;let p1;let p2;const segments=p.length-1;for(let i=0;i<segments;i++){p1=vector2dPool.get(p[i].x,p[i].y);p2=vector2dPool.get(p[i+1].x,p[i+1].y);if(this.rotation!==0){p1=p1.rotate(this.rotation);p2=p2.rotate(this.rotation)}shapes.push(linePool.get(0,0,[p1,p2]))}}else{shapes.push(polygonPool.get(0,0,[vector2dPool.get(),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height),vector2dPool.get(0,this.height)]).rotate(this.rotation))}}if(this.orientation==="isometric"){for(let i=0;i<shapes.length;i++){if(typeof shapes[i].toIso==="function"){shapes[i].toIso()}}}return shapes}getObjectPropertyByName(name){return this[name]}};function correctRadii(signedRx,signedRy,x1p,y1p){const prx=Math.abs(signedRx);const pry=Math.abs(signedRy);const A=pow(x1p)/pow(prx)+pow(y1p)/pow(pry);const rx=A>1?Math.sqrt(A)*prx:prx;const ry=A>1?Math.sqrt(A)*pry:pry;return[rx,ry]}function mat2DotVec2([m00,m01,m10,m11],[vx,vy]){return[m00*vx+m01*vy,m10*vx+m11*vy]}function vec2Add([ux,uy],[vx,vy]){return[ux+vx,uy+vy]}function vec2Scale([a0,a1],scalar){return[a0*scalar,a1*scalar]}function vec2Dot([ux,uy],[vx,vy]){return ux*vx+uy*vy}function vec2Mag([ux,uy]){return Math.sqrt(ux**2+uy**2)}function vec2Angle(u,v){const[ux,uy]=u;const[vx,vy]=v;const sign2=ux*vy-uy*vx>=0?1:-1;return sign2*Math.acos(vec2Dot(u,v)/(vec2Mag(u)*vec2Mag(v)))}function endpointToCenterParameterization(x1,y1,x2,y2,largeArcFlag,sweepFlag,srx,sry,xAxisRotationDeg){const xAxisRotation=degToRad(xAxisRotationDeg);const cosphi=Math.cos(xAxisRotation);const sinphi=Math.sin(xAxisRotation);const[x1p,y1p]=mat2DotVec2([cosphi,sinphi,-sinphi,cosphi],[(x1-x2)/2,(y1-y2)/2]);const[rx,ry]=correctRadii(srx,sry,x1p,y1p);const sign2=largeArcFlag!==sweepFlag?1:-1;const n=pow(rx)*pow(ry)-pow(rx)*pow(y1p)-pow(ry)*pow(x1p);const d=pow(rx)*pow(y1p)+pow(ry)*pow(x1p);const[cxp,cyp]=vec2Scale([rx*y1p/ry,-ry*x1p/rx],sign2*Math.sqrt(Math.abs(n/d)));const[cx,cy]=vec2Add(mat2DotVec2([cosphi,-sinphi,sinphi,cosphi],[cxp,cyp]),[(x1+x2)/2,(y1+y2)/2]);const a=[(x1p-cxp)/rx,(y1p-cyp)/ry];const b=[(-x1p-cxp)/rx,(-y1p-cyp)/ry];const startAngle=vec2Angle([1,0],a);const deltaAngle0=vec2Angle(a,b)%(2*Math.PI);const deltaAngle=!sweepFlag&&deltaAngle0>0?deltaAngle0-2*Math.PI:sweepFlag&&deltaAngle0<0?deltaAngle0+2*Math.PI:deltaAngle0;const endAngle=startAngle+deltaAngle;return{cx:cx,cy:cy,rx:rx,ry:ry,startAngle:startAngle,endAngle:endAngle,xAxisRotation:xAxisRotation,anticlockwise:deltaAngle<0}}var Path2D=class{constructor(svgPath){this.points=[];this.arcResolution=5;this.vertices=[];this.startPoint=pointPool.get();this.isDirty=false;if(typeof svgPath==="string"){this.parseSVGPath(svgPath)}}parseSVGPath(svgPath){const pathCommands=svgPath.match(/([a-df-z])[^a-df-z]*/gi);const points=this.points;const startPoint=this.startPoint;let lastPoint=startPoint;this.beginPath();for(let i=0;i<pathCommands.length;i++){const pathCommand=pathCommands[i];const command=pathCommand[0].toUpperCase();const coordinates=pathCommand.slice(1).trim().split(/[\s,]+/).map(parseFloat);switch(command){case"A":{const p=endpointToCenterParameterization(...coordinates);this.arc(p.x,p.y,p.radiusX,p.radiusY,p.rotation,p.startAngle,p.endAngle,p.applyanticlockwise)}break;case"H":lastPoint=points.length===0?startPoint:points[points.length-1];this.lineTo(lastPoint.x+coordinates[0],lastPoint.y);break;case"V":lastPoint=points.length===0?startPoint:points[points.length-1];this.lineTo(lastPoint.x,lastPoint.y+coordinates[0]);break;case"M":this.moveTo(...coordinates);break;case"L":this.lineTo(...coordinates);break;case"Q":this.quadraticCurveTo(...coordinates);break;case"C":this.bezierCurveTo(...coordinates);break;case"Z":this.closePath();break;default:console.warn("Unsupported command:",command);break}}}beginPath(){this.points.forEach(point=>{pointPool.release(point)});this.isDirty=true;this.points.length=0;this.startPoint.set(0,0)}closePath(){const points=this.points;if(points.length>0){const firstPoint=points[0];if(!firstPoint.equals(points[points.length-1])){this.lineTo(firstPoint.x,firstPoint.y)}this.isDirty=true}}triangulatePath(){const vertices=this.vertices;if(this.isDirty){const points=this.points;const indices=earcut(points.flatMap(p=>{return[p.x,p.y]}));const indicesLength=indices.length;while(vertices.length<indicesLength){vertices.push(pointPool.get())}for(let i=0;i<indicesLength;i++){const point=points[indices[i]];vertices[i].set(point.x,point.y)}while(vertices.length>indicesLength){pointPool.release(vertices[vertices.length-1]);vertices.length-=1}this.isDirty=false}return vertices}moveTo(x,y){this.startPoint.set(x,y);this.isDirty=true}lineTo(x,y){const points=this.points;const startPoint=this.startPoint;const lastPoint=points.length===0?startPoint:points[points.length-1];if(!startPoint.equals(lastPoint)){points.push(pointPool.get(startPoint.x,startPoint.y))}else{points.push(pointPool.get(lastPoint.x,lastPoint.y))}points.push(pointPool.get(x,y));startPoint.x=x;startPoint.y=y;this.isDirty=true}arc(x,y,radius,startAngle,endAngle,anticlockwise=false){if(startAngle===endAngle){return}const fullCircle=anticlockwise?Math.abs(startAngle-endAngle)>=TAU:Math.abs(endAngle-startAngle)>=TAU;startAngle=startAngle%TAU;endAngle=endAngle%TAU;if(startAngle<0){startAngle+=TAU}if(endAngle<0){endAngle+=TAU}if(startAngle>=endAngle){endAngle+=TAU}let diff=endAngle-startAngle;let direction=1;if(anticlockwise){direction=-1;diff=TAU-diff}if(fullCircle){diff=TAU}const length=diff*radius;const nr_of_interpolation_points=length/this.arcResolution;const dangle=diff/nr_of_interpolation_points;const angleStep=dangle*direction;this.moveTo(x+radius*Math.cos(startAngle),y+radius*Math.sin(startAngle));let angle=startAngle;for(let j=0;j<nr_of_interpolation_points;j++){this.lineTo(x+radius*Math.cos(angle),y+radius*Math.sin(angle));angle+=angleStep}this.lineTo(x+radius*Math.cos(endAngle),y+radius*Math.sin(endAngle));this.isDirty=true}arcTo(x1,y1,x2,y2,radius){const points=this.points;const startPoint=this.startPoint;const lastPoint=points.length===0?startPoint:points[points.length-1];const x0=lastPoint.x;const y0=lastPoint.y;let a0=x0-x1;let a1=y0-y1;let b0=x2-x1;let b1=y2-y1;const l_a=Math.sqrt(Math.pow(a0,2)+Math.pow(a1,2));const l_b=Math.sqrt(Math.pow(b0,2)+Math.pow(b1,2));a0/=l_a;a1/=l_a;b0/=l_b;b1/=l_b;const angle=Math.atan2(a1,a0)-Math.atan2(b1,b0);const tan_angle_div2=Math.tan(angle/2);const adj_l=radius/tan_angle_div2;const tangent1_pointx=x1+a0*adj_l;const tangent1_pointy=y1+a1*adj_l;const tangent2_pointx=x1+b0*adj_l;const tangent2_pointy=y1+b1*adj_l;this.moveTo(tangent1_pointx,tangent1_pointy);let bisec0=(a0+b0)/2;let bisec1=(a1+b1)/2;const bisec_l=Math.sqrt(Math.pow(bisec0,2)+Math.pow(bisec1,2));bisec0/=bisec_l;bisec1/=bisec_l;const hyp_l=Math.sqrt(Math.pow(radius,2)+Math.pow(adj_l,2));const centerx=x1+hyp_l*bisec0;const centery=y1+hyp_l*bisec1;const startAngle=Math.atan2(tangent1_pointy-centery,tangent1_pointx-centerx);const endAngle=Math.atan2(tangent2_pointy-centery,tangent2_pointx-centerx);this.arc(centerx,centery,radius,startAngle,endAngle)}ellipse(x,y,radiusX,radiusY,rotation,startAngle,endAngle,anticlockwise=false){if(startAngle===endAngle){return}const fullCircle=anticlockwise?Math.abs(startAngle-endAngle)>=TAU:Math.abs(endAngle-startAngle)>=TAU;startAngle=startAngle%TAU;endAngle=endAngle%TAU;if(startAngle<0){startAngle+=TAU}if(endAngle<0){endAngle+=TAU}if(startAngle>=endAngle){endAngle+=TAU}let diff=endAngle-startAngle;let direction=1;if(anticlockwise){direction=-1;diff=TAU-diff}if(fullCircle){diff=TAU}const length=(diff*radiusX+diff*radiusY)/2;const nr_of_interpolation_points=length/this.arcResolution;const dangle=diff/nr_of_interpolation_points;const angleStep=dangle*direction;let angle=startAngle;const cos_rotation=Math.cos(rotation);const sin_rotation=Math.sin(rotation);this.moveTo(x+radiusX*Math.cos(startAngle),y+radiusY*Math.sin(startAngle));for(let j=0;j<nr_of_interpolation_points;j++){const _x1=radiusX*Math.cos(angle);const _y1=radiusY*Math.sin(angle);const _x2=x+_x1*cos_rotation-_y1*sin_rotation;const _y2=y+_x1*sin_rotation+_y1*cos_rotation;this.lineTo(_x2,_y2);angle+=angleStep}this.lineTo(x+radiusX*Math.cos(startAngle),y+radiusY*Math.sin(startAngle));this.isDirty=true}quadraticCurveTo(cpX,cpY,x,y){const points=this.points;const startPoint=this.startPoint;const lastPoint=points.length===0?startPoint:points[points.length-1];const endPoint=pointPool.get().set(x,y);const controlPoint=pointPool.get().set(cpX,cpY);const resolution=this.arcResolution;const t=1/resolution;for(let i=1;i<=resolution;i++){this.lineTo(lastPoint.x*Math.pow(1-t*i,2)+controlPoint.x*2*(1-t*i)*t*i+endPoint.x*Math.pow(t*i,2),lastPoint.y*Math.pow(1-t*i,2)+controlPoint.y*2*(1-t*i)*t*i+endPoint.y*Math.pow(t*i,2))}pointPool.release(endPoint);pointPool.release(controlPoint);this.isDirty=true}bezierCurveTo(cp1X,cp1Y,cp2X,cp2Y,x,y){const points=this.points;const startPoint=this.startPoint;const lastPoint=points.length===0?startPoint:points[points.length-1];const endPoint=pointPool.get().set(x,y);const controlPoint1=pointPool.get().set(cp1X,cp1Y);const controlPoint2=pointPool.get().set(cp2X,cp2Y);const resolution=this.arcResolution;const t=1/resolution;for(let i=1;i<=resolution;i++){this.lineTo(lastPoint.x*Math.pow(1-t*i,3)+controlPoint1.x*3*Math.pow(1-t*i,2)*t*i+controlPoint2.x*3*(1-t*i)*Math.pow(t*i,2)+endPoint.x*Math.pow(t*i,3),lastPoint.y*Math.pow(1-t*i,3)+controlPoint1.y*3*Math.pow(1-t*i,2)*t*i+controlPoint2.y*3*(1-t*i)*Math.pow(t*i,2)+endPoint.y*Math.pow(t*i,3))}pointPool.release(endPoint,controlPoint1,controlPoint2);pointPool.release(controlPoint1);pointPool.release(controlPoint2);this.isDirty=true}rect(x,y,width,height){this.moveTo(x,y);this.lineTo(x+width,y);this.moveTo(x+width,y);this.lineTo(x+width,y+height);this.moveTo(x+width,y+height);this.lineTo(x,y+height);this.moveTo(x,y+height);this.lineTo(x,y);this.isDirty=true}roundRect(x,y,width,height,radius){this.moveTo(x+radius,y);this.lineTo(x+width-radius,y);this.arcTo(x+width,y,x+width,y+radius,radius);this.moveTo(x+width,y+radius);this.lineTo(x+width,y+height-radius);this.arcTo(x+width,y+height,x+width-radius,y+height,radius);this.moveTo(x+width-radius,y+height);this.lineTo(x+radius,y+height);this.arcTo(x,y+height,x,y+height-radius,radius);this.moveTo(x,y+height-radius);this.lineTo(x,y+radius);this.arcTo(x,y,x+radius,y,radius);this.isDirty=true}};var path2d_default=Path2D;var defaultAttributes={offscreenCanvas:false,willReadFrequently:false,antiAlias:false,context:"2d",transparent:false,premultipliedAlpha:true,stencil:true,blendMode:"normal",failIfMajorPerformanceCaveat:true,preferWebGL1:false,powerPreference:"default"};var WebGLVersion;function createContext(canvas,attributes){let context;if(attributes.context==="2d"){context=canvas.getContext(attributes.context,{willReadFrequently:attributes.willReadFrequently})}else if(attributes.context==="webgl"){const attr={alpha:attributes.transparent,antialias:attributes.antiAlias,depth:attributes.depth,stencil:true,preserveDrawingBuffer:false,premultipliedAlpha:attributes.transparent?attributes.premultipliedAlpha:false,powerPreference:attributes.powerPreference,failIfMajorPerformanceCaveat:attributes.failIfMajorPerformanceCaveat};if(attributes.preferWebGL1!==true){context=canvas.getContext("webgl2",attr);if(context){WebGLVersion=2}}if(!context){WebGLVersion=1;context=canvas.getContext("webgl",attr)||canvas.getContext("experimental-webgl",attr)}if(!context){throw new Error("A WebGL context could not be created.")}}else{throw new Error("Invalid context type. Must be one of '2d' or 'webgl'")}return context}var CanvasRenderTarget=class{constructor(width,height,attributes=defaultAttributes){this.attributes=Object.assign({},defaultAttributes,attributes);if(typeof attributes.context==="undefined"){attributes.context="2d"}if(typeof attributes.canvas!=="undefined"){this.canvas=attributes.canvas}else{this.canvas=createCanvas(width,height,this.attributes.offscreenCanvas)}this.context=createContext(this.canvas,this.attributes);this.WebGLVersion=WebGLVersion;this.setAntiAlias(this.attributes.antiAlias)}onResetEvent(width,height){this.clear();this.resize(width,height)}clear(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}setAntiAlias(enable2=false){const canvas=this.canvas;setPrefixed("imageSmoothingEnabled",enable2,this.context);if(typeof canvas.style!=="undefined"){if(enable2!==true){canvas.style["image-rendering"]="optimizeSpeed";canvas.style["image-rendering"]="-moz-crisp-edges";canvas.style["image-rendering"]="-o-crisp-edges";canvas.style["image-rendering"]="-webkit-optimize-contrast";canvas.style["image-rendering"]="optimize-contrast";canvas.style["image-rendering"]="crisp-edges";canvas.style["image-rendering"]="pixelated";canvas.style.msInterpolationMode="nearest-neighbor"}else{canvas.style["image-rendering"]="auto"}}}resize(width,height){this.canvas.width=Math.round(width);this.canvas.height=Math.round(height)}getImageData(x,y,width,height){x=clamp(Math.floor(x),0,this.canvas.width-1);y=clamp(Math.floor(y),0,this.canvas.height-1);width=clamp(width,1,this.canvas.width-x);height=clamp(height,1,this.canvas.height-y);return this.context.getImageData(x,y,width,height)}toBlob(type="image/png",quality){if(typeof this.canvas.convertToBlob==="function"){return this.canvas.convertToBlob({type:type,quality:quality})}else{return new Promise(resolve=>{this.canvas.toBlob(blob=>{resolve(blob)},type,quality)})}}toImageBitmap(type="image/png",quality){return new Promise(resolve=>{if(typeof this.canvas.transferToImageBitmap==="function"){resolve(this.canvas.transferToImageBitmap())}else{const image=new Image;image.src=this.canvas.toDataURL(type,quality);image.onload=()=>{globalThis.createImageBitmap(image).then(bitmap=>{return resolve(bitmap)})}}})}toDataURL(type="image/png",quality){return new Promise(resolve=>{resolve(this.canvas.toDataURL(type,quality))})}invalidate(renderer2){if(typeof renderer2.gl!=="undefined"){renderer2.setCompositor("quad");this.glTextureUnit=renderer2.cache.getUnit(renderer2.cache.get(this.canvas));renderer2.currentCompositor.unbindTexture2D(null,this.glTextureUnit)}}destroy(){this.context=void 0;this.canvas=void 0}get width(){return this.canvas.width}set width(val){this.canvas.width=Math.round(val)}get height(){return this.canvas.height}set height(val){this.canvas.height=Math.round(val)}};var canvasrendertarget_default=CanvasRenderTarget;var Renderer=class{constructor(options){this.renderTarget=new canvasrendertarget_default(options.width,options.height,typeof globalThis.canvas!=="undefined"?Object.assign(options,{canvas:globalThis.canvas}):options);this.settings=options;this.designRatio=this.settings.width/this.settings.height;this.scaleRatio=new Vector2d(this.settings.scale,this.settings.scale);this.isContextValid=true;this.depthTest="sorting";this.path2D=new path2d_default;this.type="Generic";this.backgroundColor=new Color(0,0,0,this.settings.transparent?0:1);this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]);this.maskLevel=0;this.currentBlendMode="none";this.currentColor=new Color(0,0,0,1);this.currentTint=new Color(255,255,255,1);this.projectionMatrix=new Matrix3d;this.uvOffset=0}get height(){return this.getCanvas().height}set height(value){this.resize(this.width,value)}get width(){return this.getCanvas().width}set width(value){this.resize(value,this.height)}clear(){}flush(){}reset(){this.resetTransform();this.setBlendMode(this.settings.blendMode);this.setColor("#000000");this.clearTint();this.cache.clear();this.currentScissor[0]=0;this.currentScissor[1]=0;this.currentScissor[2]=this.width;this.currentScissor[3]=this.height;this.clearMask()}getCanvas(){return this.renderTarget.canvas}getContext(){return this.renderTarget.context}getBlendMode(){return this.currentBlendMode}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(bounds){return bounds.left<=this.width&&bounds.right>=0&&bounds.top<=this.height&&bounds.bottom>=0}resize(width,height){const canvas=this.getCanvas();if(width!==canvas.width||height!==canvas.height){canvas.width=width;canvas.height=height;this.currentScissor[0]=0;this.currentScissor[1]=0;this.currentScissor[2]=width;this.currentScissor[3]=height;eventEmitter.emit(CANVAS_ONRESIZE,width,height)}}setAntiAlias(enable2=false){this.renderTarget.setAntiAlias(enable2)}setProjection(matrix){this.projectionMatrix.copy(matrix)}stroke(shape,fill){switch(shape.type){case"RoundRect":this.strokeRoundRect(shape.left,shape.top,shape.width,shape.height,shape.radius,fill);break;case"Rectangle":case"Bounds":this.strokeRect(shape.left,shape.top,shape.width,shape.height,fill);break;case"Polygon":case"Line":this.strokePolygon(shape,fill);break;case"Ellipse":this.strokeEllipse(shape.pos.x,shape.pos.y,shape.radiusV.x,shape.radiusV.y,fill);break;case"Point":this.strokePoint(shape.x,shape.y);break;default:throw new Error("Invalid geometry for fill/stroke")}}fill(shape){this.stroke(shape,true)}tint(src,color,mode="multiply"){const attributes={context:"2d",offscreenCanvas:true,transparent:true,antiAlias:this.settings.antiAlias};const canvasTexture=new canvasrendertarget_default(src.width,src.height,attributes);const context=canvasTexture.context;context.fillStyle=color instanceof Color?color.toRGB():color;context.fillRect(0,0,src.width,src.height);context.globalCompositeOperation=mode;context.drawImage(src,0,0);context.globalCompositeOperation="destination-atop";context.drawImage(src,0,0);return canvasTexture.canvas}setMask(){}clearMask(){}setTint(tint,alpha2=tint.alpha){this.currentTint.copy(tint);this.currentTint.alpha*=alpha2}clearTint(){this.currentTint.setFloat(1,1,1,1)}toBlob(type="image/png",quality){return this.renderTarget.toBlob(type,quality)}toImageBitmap(type="image/png",quality){return this.renderTarget.toImageBitmap(type,quality)}toDataURL(type="image/png",quality){return this.renderTarget.toDataURL(type,quality)}};function parseTexturePacker(data2,textureAtlas){const atlas={};data2.frames.forEach(frame=>{if(frame.hasOwnProperty("filename")){const s=frame.frame;const trimmed=!!frame.trimmed;let trim;if(trimmed){trim={x:frame.spriteSourceSize.x,y:frame.spriteSourceSize.y,w:frame.spriteSourceSize.w,h:frame.spriteSourceSize.h}}let originX;let originY;const hasTextureAnchorPoint=frame.sourceSize&&frame.pivot;if(hasTextureAnchorPoint){originX=frame.sourceSize.w*frame.pivot.x-(trimmed?trim.x:0);originY=frame.sourceSize.h*frame.pivot.y-(trimmed?trim.y:0)}atlas[frame.filename]={name:frame.filename,texture:data2.meta.image||"default",offset:new Vector2d(s.x,s.y),anchorPoint:hasTextureAnchorPoint?new Vector2d(originX/s.w,originY/s.h):null,trimmed:trimmed,trim:trim,width:s.w,height:s.h,angle:frame.rotated===true?-ETA:0};textureAtlas.addUVs(atlas,frame.filename,data2.meta.size.w,data2.meta.size.h)}});return atlas}function parseSpriteSheet(data2,textureAtlas){const atlas={};const image=data2.image;const spacing=data2.spacing||0;const margin=data2.margin||0;let width=image.width;let height=image.height;const spritecount=vector2dPool.get(~~((width-margin+spacing)/(data2.framewidth+spacing)),~~((height-margin+spacing)/(data2.frameheight+spacing)));if(width%(data2.framewidth+spacing)!==0||height%(data2.frameheight+spacing)!==0){const computed_width=spritecount.x*(data2.framewidth+spacing);const computed_height=spritecount.y*(data2.frameheight+spacing);if(computed_width-width!==spacing&&computed_height-height!==spacing){width=computed_width;height=computed_height;console.warn("Spritesheet Texture for image: "+image.src+" is not divisible by "+(data2.framewidth+spacing)+"x"+(data2.frameheight+spacing)+", truncating effective size to "+width+"x"+height)}}for(let frame=0,count=spritecount.x*spritecount.y;frame<count;frame++){const name=""+frame;atlas[name]={name:name,texture:"default",offset:new Vector2d(margin+(spacing+data2.framewidth)*(frame%spritecount.x),margin+(spacing+data2.frameheight)*~~(frame/spritecount.x)),anchorPoint:data2.anchorPoint||null,trimmed:false,trim:void 0,width:data2.framewidth,height:data2.frameheight,angle:0};textureAtlas.addUVs(atlas,name,width,height)}vector2dPool.release(spritecount);return atlas}function parseAseprite(data2,textureAtlas){const atlas={};const frames=data2.frames;for(const name in frames){const frame=frames[name].frame;const trimmed=!!frame.trimmed;let trim;if(trimmed){trim={x:frame.spriteSourceSize.x,y:frame.spriteSourceSize.y,w:frame.spriteSourceSize.w,h:frame.spriteSourceSize.h}}let originX;let originY;const hasTextureAnchorPoint=frame.sourceSize&&frame.pivot;if(hasTextureAnchorPoint){originX=frame.sourceSize.w*frame.pivot.x-(trimmed?trim.x:0);originY=frame.sourceSize.h*frame.pivot.y-(trimmed?trim.y:0)}atlas[name]={name:name,texture:data2.meta.image||"default",offset:new Vector2d(frame.x,frame.y),anchorPoint:hasTextureAnchorPoint?new Vector2d(originX/frame.w,originY/frame.h):null,trimmed:trimmed,trim:trim,width:frame.w,height:frame.h,angle:frame.rotated===true?-ETA:0};textureAtlas.addUVs(atlas,name,data2.meta.size.w,data2.meta.size.h)}const anims={};for(const name in data2.meta.frameTags){const anim=data2.meta.frameTags[name];const indexArray=Array.from({length:anim.to-anim.from+1},(_,i)=>{return anim.from+i});anims[name]={name:anim.name,index:indexArray,speed:10*(indexArray.length-1),direction:anim.direction}}atlas.anims=anims;return atlas}function createAtlas(width,height,name="default",repeat="no-repeat"){return{meta:{app:"melonJS",size:{w:width,h:height},repeat:repeat,image:"default"},frames:[{filename:name,frame:{x:0,y:0,w:width,h:height}}]}}function identifyFormat(app){if(app.includes("texturepacker")||app.includes("free-tex-packer")){return"texturepacker"}else if(app.includes("shoebox")){return"shoebox"}else if(app.includes("aseprite")){return"aseprite"}else if(app.includes("melonJS")){return"melonJS"}else{throw new Error("Unknown texture atlas format: "+app)}}var TextureAtlas=class{constructor(atlases,src,cache2){this.format=null;this.sources=new Map;this.atlases=new Map;this.activeAtlas=void 0;if(typeof atlases!=="undefined"){atlases=Array.isArray(atlases)?atlases:[atlases];for(const i in atlases){const atlas=atlases[i];if(typeof atlas.meta!=="undefined"){this.format=identifyFormat(atlas.meta.app);this.repeat=atlas.meta.repeat||"no-repeat";switch(this.format){case"texturepacker":case"aseprite":if(typeof src==="undefined"){const image=getImage(atlas.meta.image);if(!image){throw new Error("Atlas texture '"+image+"' not found")}this.sources.set(atlas.meta.image,image)}else{this.sources.set(atlas.meta.image||"default",typeof src==="string"?getImage(src):src)}if(this.format==="texturepacker"){this.atlases.set(atlas.meta.image||"default",parseTexturePacker(atlas,this))}else{this.atlases.set(atlas.meta.image||"default",parseAseprite(atlas,this))}break;case"shoebox":if(!atlas.meta.exporter||!atlas.meta.exporter.includes("melonJS")){throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx")}this.sources.set("default",typeof src==="string"?getImage(src):src);this.atlases.set(atlas.meta.image||"default",parseTexturePacker(atlas,this));break;case"melonJS":this.sources.set("default",typeof src==="string"?getImage(src):src);this.atlases.set(atlas.meta.image||"default",parseTexturePacker(atlas,this));break;default:throw new Error("Unknown texture atlas format: "+atlas.meta.app)}}else{if(typeof atlas.framewidth!=="undefined"&&typeof atlas.frameheight!=="undefined"){this.format="Spritesheet (fixed cell size)";this.repeat="no-repeat";if(typeof src!=="undefined"){atlas.image=typeof src==="string"?getImage(src):src}this.atlases.set("default",parseSpriteSheet(atlas,this));this.sources.set("default",atlas.image)}}}this.activeAtlas=this.atlases.keys().next().value}if(this.atlases.length===0){throw new Error("texture atlas format not supported")}if(cache2!==false){this.sources.forEach(source=>{renderer.cache.set(source,this)})}}getAtlas(name){if(typeof name==="string"){return this.atlases.get(name)}else{return this.atlases.get(this.activeAtlas)}}getFormat(){return this.format}getTexture(region){if(typeof region==="object"&&typeof region.texture==="string"){return this.sources.get(region.texture)}else{return this.sources.get(this.activeAtlas)}}addRegion(name,x,y,w,h){if(renderer.settings.verbose===true){console.warn("Adding texture region",name,"for texture",this)}const source=this.getTexture();const atlas=this.getAtlas();const dw=source.width;const dh=source.height;atlas[name]={name:name,offset:new Vector2d(x,y),width:w,height:h,angle:0};this.addUVs(atlas,name,dw,dh);return atlas[name]}getRegion(name,atlas){let region;if(typeof atlas==="string"){region=this.getAtlas(atlas)[name]}else{for(const atlas2 of this.atlases.values()){if(typeof atlas2[name]!=="undefined"){region=atlas2[name];break}}}return region}getUVs(name){let region=this.getRegion(name);if(typeof region==="undefined"){const keys=name.split(",");const sx=+keys[0];const sy=+keys[1];const sw=+keys[2];const sh=+keys[3];region=this.addRegion(name,sx,sy,sw,sh)}return region.uvs}addUVs(atlas,name,w,h){if(typeof renderer.gl!=="undefined"){const s=atlas[name].offset;const sw=atlas[name].width;const sh=atlas[name].height;atlas[name].uvs=new Float32Array([s.x/w,s.y/h,(s.x+sw)/w,(s.y+sh)/h]);const key=s.x+","+s.y+","+w+","+h;atlas[key]=atlas[name]}return atlas[name].uvs}createSpriteFromName(name,settings,nineSlice=false){return legacy_pool_default.pull(nineSlice===true?"me.NineSliceSprite":"me.Sprite",0,0,Object.assign({image:this,region:name},settings||{}))}createAnimationFromName(names,settings){const tpAtlas=[];const indices={};let width=0;let height=0;const textureAtlas=this.getAtlas();if(typeof names==="undefined"){names=textureAtlas}for(const i in names){const name=Array.isArray(names)?names[i]:i;const region=this.getRegion(name);if(region==null){throw new Error("Texture - region for "+name+" not found")}tpAtlas.push(region);indices[name]=tpAtlas.length-1;width=Math.max(region.width,width);height=Math.max(region.height,height)}return new Sprite(0,0,Object.assign({image:this,framewidth:width,frameheight:height,margin:0,spacing:0,atlas:tpAtlas,anims:textureAtlas.anims,atlasIndices:indices},settings||{}))}};var Multimap=class _Multimap{constructor(operator,iterable){this.size_=0;this.map=new Map;this.operator=operator;if(iterable){for(const[key,value]of iterable){this.put(key,value)}}return this}get size(){return this.size_}get(key){const values=this.map.get(key);if(values){return this.operator.clone(values)}else{return this.operator.create()}}put(key,value){let values=this.map.get(key);if(!values){values=this.operator.create()}if(!this.operator.add(value,values)){return false}this.map.set(key,values);this.size_++;return true}putAll(arg1,arg2){let pushed=0;if(arg2){const key=arg1;const values=arg2;for(const value of values){this.put(key,value);pushed++}}else if(arg1 instanceof _Multimap){for(const[key,value]of arg1.entries()){this.put(key,value);pushed++}}else{throw new TypeError("unexpected arguments")}return pushed>0}has(key){return this.map.has(key)}hasEntry(key,value){return this.operator.has(value,this.get(key))}delete(key){this.size_-=this.operator.size(this.get(key));return this.map.delete(key)}deleteEntry(key,value){const current=this.get(key);if(!this.operator.delete(value,current)){return false}this.map.set(key,current);this.size_--;return true}clear(){this.map.clear();this.size_=0}keys(){return this.map.keys()}entries(){const self2=this;function*gen(){for(const[key,values]of self2.map.entries()){for(const value of values){yield[key,value]}}}return gen()}values(){const self2=this;function*gen(){for(const[,value]of self2.entries()){yield value}}return gen()}forEach(callback,thisArg){for(const[key,value]of this.entries()){callback.call(thisArg===void 0?this:thisArg,value,key,this)}}[Symbol.iterator](){return this.entries()}asMap(){const ret=new Map;for(const key of this.keys()){ret.set(key,this.operator.clone(this.get(key)))}return ret}};var ArrayMultimap=class extends Multimap{constructor(iterable){super(new ArrayOperator,iterable)}get[Symbol.toStringTag](){return"ArrayMultimap"}};var ArrayOperator=class{create(){return[]}clone(collection){return collection.slice()}add(value,collection){collection.push(value);return true}size(collection){return collection.length}delete(value,collection){const index=collection.indexOf(value);if(index>-1){collection.splice(index,1);return true}return false}has(value,collection){return collection.includes(value)}};var TextureCache=class{constructor(max_size=Infinity){this.cache=new ArrayMultimap;this.tinted=new Map;this.units=new Map;this.usedUnits=new Set;this.max_size=max_size;this.clear()}clear(){this.cache.clear();this.tinted.clear();this.units.clear();this.usedUnits.clear()}allocateTextureUnit(){for(let unit=0;unit<this.max_size;unit++){if(!this.usedUnits.has(unit)){this.usedUnits.add(unit);return unit}}throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}freeTextureUnit(texture){const source=texture.sources.get(texture.activeAtlas);const unit=this.units.get(source);if(typeof unit!=="undefined"){this.usedUnits.delete(source);this.units.delete(source)}}getUnit(texture){const source=texture.sources.get(texture.activeAtlas);if(!this.units.has(source)){this.units.set(source,this.allocateTextureUnit())}return this.units.get(source)}set(image,textureAtlas){const width=image.width||image.videoWidth;const height=image.height||image.videoHeight;if(renderer.WebGLVersion===1&&(!isPowerOfTwo(width)||!isPowerOfTwo(height))){const src=typeof image.src!=="undefined"?image.src:image;console.warn("[Texture] "+src+" is not a POT texture ("+width+"x"+height+")")}return this.cache.put(image,textureAtlas)}get(image,atlas){let entry=this.cache.get(image)[0];if(typeof entry!=="undefined"&&typeof atlas!=="undefined"){this.cache.forEach((value,key)=>{const _atlas=value.getAtlas();if(key===image&&_atlas.width===atlas.framewidth&&_atlas.height===atlas.frameheight){entry=value}})}if(typeof entry==="undefined"){if(!atlas){atlas=createAtlas(image.width||image.videoWidth,image.height||image.videoHeight,image.src?getBasename(image.src):void 0)}entry=new TextureAtlas(atlas,image,false);this.set(image,entry)}if(typeof entry.sources!=="undefined"&&entry.sources.size>1){console.log(entry);for(const[key,value]of entry.sources.entries()){if(value===image){console.log("cache hit");console.log(key);entry.activeAtlas=key}}}return entry}delete(image){if(this.cache.has(image)){const texture=this.cache.get(image)[0];if(typeof texture!=="undefined"){this.freeTextureUnit(texture)}this.cache.delete(image)}}tint(src,color){let image_cache=this.tinted.get(src);if(image_cache===void 0){image_cache=this.tinted.set(src,new Map)}if(!image_cache.has(color)){image_cache.set(color,renderer.tint(src,color,"multiply"))}return image_cache.get(color)}};var cache_default=TextureCache;var CanvasRenderer=class extends Renderer{constructor(options){super(options);this.setBlendMode(this.settings.blendMode);this.setColor(this.currentColor);this.cache=new cache_default;if(this.settings.textureSeamFix!==false&&!this.settings.antiAlias){this.uvOffset=1}this.type="CANVAS";this.getCanvas().addEventListener("contextlost",e=>{e.preventDefault();this.isContextValid=false;eventEmitter.emit(ONCONTEXT_LOST,this)},false);this.getCanvas().addEventListener("contextrestored",()=>{this.isContextValid=true;eventEmitter.emit(ONCONTEXT_RESTORED,this)},false);eventEmitter.addListener(GAME_RESET,()=>{this.reset()})}reset(){super.reset();this.clearColor(this.currentColor,this.settings.transparent!==true)}resetTransform(){this.getContext().setTransform(1,0,0,1,0,0)}setBlendMode(mode="normal",context){context=context||this.getContext();this.currentBlendMode=mode;switch(mode){case"screen":context.globalCompositeOperation="screen";break;case"lighter":case"additive":context.globalCompositeOperation="lighter";break;case"multiply":context.globalCompositeOperation="multiply";break;default:context.globalCompositeOperation="source-over";this.currentBlendMode="normal";break}}clear(){if(this.backgroundColor.alpha>0){this.clearColor(this.backgroundColor)}}clearColor(color="#000000",opaque=false){const canvas=this.getCanvas();const context=this.getContext();this.save();this.resetTransform();context.globalAlpha=1;context.globalCompositeOperation=opaque===true?"copy":"source-over";context.fillStyle=color instanceof Color?color.toRGBA():color;this.fillRect(0,0,canvas.width,canvas.height);this.restore()}clearRect(x,y,width,height){this.getContext().clearRect(x,y,width,height)}createPattern(image,repeat){return this.getContext().createPattern(image,repeat)}drawImage(image,sx,sy,sw,sh,dx,dy,dw,dh){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();if(typeof sw==="undefined"){sw=dw=image.width;sh=dh=image.height;dx=sx;dy=sy;sx=0;sy=0}else if(typeof dx==="undefined"){dx=sx;dy=sy;dw=sw;dh=sh;sw=image.width;sh=image.height;sx=0;sy=0}if(this.settings.subPixel===false){dx=~~dx;dy=~~dy}let source=image;const tint=this.currentTint.toArray();if(tint[0]!==1||tint[1]!==1||tint[2]!==1){source=this.cache.tint(image,this.currentTint.toRGB())}context.drawImage(source,sx,sy,sw,sh,dx,dy,dw,dh)}drawPattern(pattern,x,y,width,height){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();const fillStyle=context.fillStyle;context.fillStyle=pattern;context.fillRect(x,y,width,height);context.fillStyle=fillStyle}beginPath(){this.getContext().beginPath()}moveTo(x,y){this.getContext().moveTo(x,y)}lineTo(x,y){this.getContext().lineTo(x,y)}rect(x,y,width,height){this.getContext().rect(x,y,width,height)}roundRect(x,y,width,height,radii){this.getContext().roundRect(x,y,width,height,radii)}stroke(shape,fill){if(typeof shape==="undefined"){if(fill===true){this.getContext().fill()}else{this.getContext().stroke()}}else{super.stroke(shape,fill)}}fill(shape){this.stroke(shape,true)}closePath(){this.getContext().closePath()}strokeArc(x,y,radius,start,end,antiClockwise,fill=false){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();context.translate(x,y);context.beginPath();context.arc(0,0,radius,start,end,antiClockwise||false);context[fill===true?"fill":"stroke"]();context.translate(-x,-y)}fillArc(x,y,radius,start,end,antiClockwise){this.strokeArc(x,y,radius,start,end,antiClockwise||false,true)}strokeEllipse(x,y,w,h,fill=false){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();const hw=w;const hh=h;const lx=x-hw;const rx=x+hw;const ty=y-hh;const by=y+hh;const xmagic=hw*.551784;const ymagic=hh*.551784;const xmin=x-xmagic;const xmax=x+xmagic;const ymin=y-ymagic;const ymax=y+ymagic;context.beginPath();context.moveTo(x,ty);context.bezierCurveTo(xmax,ty,rx,ymin,rx,y);context.bezierCurveTo(rx,ymax,xmax,by,x,by);context.bezierCurveTo(xmin,by,lx,ymax,lx,y);context.bezierCurveTo(lx,ymin,xmin,ty,x,ty);context[fill===true?"fill":"stroke"]();context.closePath()}fillEllipse(x,y,w,h){this.strokeEllipse(x,y,w,h,true)}strokeLine(startX,startY,endX,endY){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();context.beginPath();context.moveTo(startX,startY);context.lineTo(endX,endY);context.stroke()}fillLine(startX,startY,endX,endY){this.strokeLine(startX,startY,endX,endY)}strokePolygon(poly,fill=false){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();const points=poly.points;const pointsLength=points.length;const firstPoint=points[0];this.translate(poly.pos.x,poly.pos.y);context.beginPath();context.moveTo(firstPoint.x,firstPoint.y);for(let i=1;i<pointsLength;i++){const point=points[i];context.lineTo(point.x,point.y)}context.lineTo(firstPoint.x,firstPoint.y);context[fill===true?"fill":"stroke"]();context.closePath();this.translate(-poly.pos.x,-poly.pos.y)}fillPolygon(poly){this.strokePolygon(poly,true)}strokeRect(x,y,width,height,fill=false){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();context[fill===true?"fillRect":"strokeRect"](x,y,width,height)}fillRect(x,y,width,height){this.strokeRect(x,y,width,height,true)}strokeRoundRect(x,y,width,height,radius,fill=false){if(this.getGlobalAlpha()<1/255){return}const context=this.getContext();context.beginPath();context.roundRect(x,y,width,height,radius);context[fill===true?"fill":"stroke"]()}fillRoundRect(x,y,width,height,radius){this.strokeRoundRect(x,y,width,height,radius,true)}strokePoint(x,y){this.strokeLine(x,y,x+1,y+1)}fillPoint(x,y){this.strokePoint(x,y)}restore(){const canvas=this.getCanvas();this.getContext().restore();this.currentColor.glArray[3]=this.getGlobalAlpha();this.currentScissor[0]=0;this.currentScissor[1]=0;this.currentScissor[2]=canvas.width;this.currentScissor[3]=canvas.height}save(){this.getContext().save()}rotate(angle){this.getContext().rotate(angle)}scale(x,y){this.getContext().scale(x,y)}setColor(color){const currentColor=this.currentColor;const context=this.getContext();currentColor.copy(color);context.strokeStyle=context.fillStyle=currentColor.toRGBA()}setGlobalAlpha(alpha2){this.getContext().globalAlpha=alpha2}getGlobalAlpha(){return this.getContext().globalAlpha}get lineWidth(){return this.getContext().lineWidth}set lineWidth(value){this.getContext().lineWidth=value}get lineJoin(){return this.getContext().lineJoin}set lineJoin(value){const context=this.getContext();context.lineJoin=value}setTransform(a,b,c,d,e,f){this.resetTransform();this.transform(a,b,c,d,e,f)}transform(a,b,c,d,e,f){if(typeof a==="object"){const m=a.toArray();a=m[0];b=m[1];c=m[3];d=m[4];e=m[6];f=m[7]}if(this.settings.subPixel===false){e|=0;f|=0}this.getContext().transform(a,b,c,d,e,f)}translate(x,y){if(this.settings.subPixel===false){this.getContext().translate(~~x,~~y)}else{this.getContext().translate(x,y)}}clipRect(x,y,width,height){const canvas=this.getCanvas();if(x!==0||y!==0||width!==canvas.width||height!==canvas.height){const currentScissor=this.currentScissor;if(currentScissor[0]!==x||currentScissor[1]!==y||currentScissor[2]!==width||currentScissor[3]!==height){const context=this.getContext();context.beginPath();context.rect(x,y,width,height);context.clip();currentScissor[0]=x;currentScissor[1]=y;currentScissor[2]=width;currentScissor[3]=height}}}setMask(mask,invert=false){const context=this.getContext();if(this.maskLevel===0){context.save();if(typeof mask!=="undefined"){context.beginPath()}}if(typeof mask!=="undefined"){switch(mask.type){case"RoundRect":context.roundRect(mask.top,mask.left,mask.width,mask.height,mask.radius);break;case"Rectangle":case"Bounds":context.rect(mask.top,mask.left,mask.width,mask.height);break;case"Polygon":{const _x=mask.pos.x;const _y=mask.pos.y;context.moveTo(_x+mask.points[0].x,_y+mask.points[0].y);for(let i=1;i<mask.points.length;i++){const point=mask.points[i];context.lineTo(_x+point.x,_y+point.y)}}break;case"Ellipse":{const _x=mask.pos.x;const _y=mask.pos.y;const hw=mask.radiusV.x;const hh=mask.radiusV.y;const lx=_x-hw;const rx=_x+hw;const ty=_y-hh;const by=_y+hh;const xmagic=hw*.551784;const ymagic=hh*.551784;const xmin=_x-xmagic;const xmax=_x+xmagic;const ymin=_y-ymagic;const ymax=_y+ymagic;context.moveTo(_x,ty);context.bezierCurveTo(xmax,ty,rx,ymin,rx,_y);context.bezierCurveTo(rx,ymax,xmax,by,_x,by);context.bezierCurveTo(xmin,by,lx,ymax,lx,_y);context.bezierCurveTo(lx,ymin,xmin,ty,_x,ty)}break;default:throw new Error("Invalid geometry for setMask")}}this.maskLevel++;if(invert===true){context.closePath();context.globalCompositeOperation="destination-atop";context.fill()}else{context.clip()}}clearMask(){if(this.maskLevel>0){this.maskLevel=0;this.getContext().restore()}}};function initArray(rows,cols){const array=new Array(cols);for(let col=0;col<cols;col++){array[col]=new Array(rows);for(let row=0;row<rows;row++){array[col][row]=null}}return array}function setLayerData(layer,bounds,data2){let idx=0;let width;let height;if(typeof bounds.rows==="undefined"){width=bounds.width;height=bounds.height}else{width=bounds.cols;height=bounds.rows}for(let y=0;y<height;y++){for(let x=0;x<width;x++){const gid=data2[idx++];if(gid!==0){layer.layerData[x+bounds.x][y+bounds.y]=layer.getTileById(gid,x+bounds.x,y+bounds.y)}}}}var TMXLayer=class extends Renderable{constructor(map,data2,tilewidth,tileheight,orientation2,tilesets,z){super(0,0,0,0);this.tilewidth=data2.tilewidth||tilewidth;this.tileheight=data2.tileheight||tileheight;this.orientation=orientation2;this.x=0;this.y=0;this.tilesets=tilesets;this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null;this.maxTileSize={width:0,height:0};for(let i=0;i<this.tilesets.length;i++){const tileset=this.tilesets.getTilesetByIndex(i);this.maxTileSize.width=Math.max(this.maxTileSize.width,tileset.tilewidth);this.maxTileSize.height=Math.max(this.maxTileSize.height,tileset.tileheight)}this.animatedTilesets=[];this.isAnimated=false;this.renderorder=data2.renderorder||"right-down";this.class=data2.class;this.pos.z=z;this.anchorPoint.set(0,0);this.name=data2.name;this.cols=+data2.width;this.rows=+data2.height;const visible=typeof data2.visible!=="undefined"?+data2.visible:1;this.setOpacity(visible?+data2.opacity:0);if(typeof data2.tintcolor==="string"){this.tint.parseHex(data2.tintcolor,true)}if(this.orientation==="isometric"){this.width=(this.cols+this.rows)*(this.tilewidth/2);this.height=(this.cols+this.rows)*(this.tileheight/2)}else{this.width=this.cols*this.tilewidth;this.height=this.rows*this.tileheight}applyTMXProperties(this,data2);this.setRenderer(map.getRenderer());this.layerData=initArray(this.rows,this.cols);if(map.infinite===0){setLayerData(this,this,decode(data2.data,data2.encoding,data2.compression))}else if(map.infinite===1){data2.chunks.forEach(chunk=>{setLayerData(this,chunk,decode(chunk.data,data2.encoding,data2.compression))})}}onActivateEvent(){if(this.animatedTilesets===void 0){this.animatedTilesets=[]}if(this.tilesets){const tileset=this.tilesets.tilesets;for(let i=0;i<tileset.length;i++){if(tileset[i].isAnimated){this.animatedTilesets.push(tileset[i])}}}this.isAnimated=this.animatedTilesets.length>0;if(typeof this.preRender==="undefined"&&this.isAnimated===false){this.preRender=this.ancestor.getRootAncestor().preRender}else{this.preRender=false}if(this.preRender===true&&!this.canvasRenderer){this.canvasRenderer=new CanvasRenderer({canvas:createCanvas(this.width,this.height),width:this.width,heigth:this.height,transparent:true});this.getRenderer().drawTileLayer(this.canvasRenderer,this,this)}this.isDirty=true}onDeactivateEvent(){this.animatedTilesets=void 0}setRenderer(renderer2){this.renderer=renderer2;this.isDirty=true}getRenderer(){return this.renderer}getTileId(x,y){const tile=this.getTile(x,y);return tile?tile.tileId:null}getTile(x,y){let tile=null;if(this.contains(x,y)){const coord=this.getRenderer().pixelToTileCoords(x,y,vector2dPool.get());tile=this.cellAt(coord.x,coord.y);vector2dPool.release(coord)}return tile}setTile(tile,x,y){this.layerData[x][y]=tile;this.isDirty=true;return tile}getTileById(tileId,x,y){if(!this.tileset.contains(tileId)){this.tileset=this.tilesets.getTilesetByGid(tileId)}return new Tile(x,y,tileId,this.tileset)}cellAt(x,y,boundsCheck){const _x=~~x;const _y=~~y;const renderer2=this.getRenderer();if(boundsCheck===false||_x>=0&&_x<renderer2.cols&&_y>=0&&_y<renderer2.rows){return this.layerData[_x][_y]}else{return null}}clearTile(x,y){this.layerData[x][y]=null;if(this.preRender){this.canvasRenderer.clearRect(x*this.tilewidth,y*this.tileheight,this.tilewidth,this.tileheight)}this.isDirty=true}update(dt){let result=this.isDirty;if(this.isAnimated){for(let i=0;i<this.animatedTilesets.length;i++){result=this.animatedTilesets[i].update(dt)||result}}return result}draw(renderer2,rect){if(this.preRender){const width=Math.min(rect.width,this.width);const height=Math.min(rect.height,this.height);renderer2.drawImage(this.canvasRenderer.getCanvas(),rect.pos.x,rect.pos.y,width,height,rect.pos.x,rect.pos.y,width,height)}else{this.getRenderer().drawTileLayer(renderer2,this,rect)}}};var TMXGroup=class{constructor(map,data2,z){this.name=data2.name;this.width=data2.width||0;this.height=data2.height||0;this.tintcolor=data2.tintcolor;this.class=data2.class;this.z=z;this.objects=[];const visible=typeof data2.visible!=="undefined"?data2.visible:true;this.opacity=visible===true?clamp(+data2.opacity||1,0,1):0;applyTMXProperties(this,data2);if(data2.objects){data2.objects.forEach(object=>{object.tintcolor=this.tintcolor;this.objects.push(new TMXObject(map,object,z))})}if(data2.layers){data2.layers.forEach(data3=>{const layer=new TMXLayer(map,data3,map.tilewidth,map.tileheight,map.orientation,map.tilesets,z++);layer.setRenderer(map.getRenderer());this.width=Math.max(this.width,layer.width);this.height=Math.max(this.height,layer.height);this.objects.push(layer)})}}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(idx){return this.objects[idx]}};function deferredRemove(child,keepalive){this.removeChildNow(child,keepalive)}var globalFloatingCounter=0;var Container=class _Container extends Renderable{constructor(x=0,y=0,width,height,root=false){super(x,y,typeof width==="undefined"?typeof game.viewport!=="undefined"?game.viewport.width:Infinity:width,typeof height==="undefined"?typeof game.viewport!=="undefined"?game.viewport.height:Infinity:height);this.pendingSort=null;this.root=root;this.children=void 0;this.sortOn="z";this.autoSort=true;this.autoDepth=true;this.clipping=false;this.onChildChange=function(){};this.enableChildBoundsUpdate=false;this.backgroundColor=colorPool.get(0,0,0,0);this.drawCount=0;this.autoTransform=true;this.isKinematic=false;this.anchorPoint.set(0,0);if(this.root===true){eventEmitter.addListener(CANVAS_ONRESIZE,()=>{this.updateBounds()})}}reset(){if(this.pendingSort){clearTimeout(this.pendingSort);this.pendingSort=null}const children=this.getChildren();for(let i=children.length,child;i>=0;child=children[--i]){if(child&&child.isPersistent!==true){this.removeChildNow(child)}}if(typeof this.currentTransform!=="undefined"){this.currentTransform.identity()}this.backgroundColor.setColor(0,0,0,0)}addChild(child,z){if(child.ancestor instanceof _Container){child.ancestor.removeChildNow(child)}else{if(child.isRenderable){child.GUID=createGUID(child.id)}}child.ancestor=this;this.getChildren().push(child);if(typeof child.updateBounds==="function"){if(this.isFloating===true){child.floating=false}child.updateBounds()}if(typeof child.pos!=="undefined"){if(typeof z==="number"){child.pos.z=z}else if(this.autoDepth===true){child.pos.z=this.getChildren().length}}if(this.autoSort===true){this.sort()}if(typeof child.onActivateEvent==="function"&&this.isAttachedToRoot()){child.onActivateEvent()}if(this.enableChildBoundsUpdate===true){this.updateBounds()}if(this.isAttachedToRoot()){const worldContainer=this.getRootAncestor();if(child.body instanceof Body){worldContainer.addBody(child.body)}if(child instanceof _Container){child.forEach(cchild=>{if(cchild.body instanceof Body){worldContainer.addBody(cchild.body)}})}}this.isDirty=true;this.onChildChange.call(this,this.getChildren().length-1);return child}addChildAt(child,index){if(index>=0&&index<this.getChildren().length){if(child.ancestor instanceof _Container){child.ancestor.removeChildNow(child)}else{if(child.isRenderable){child.GUID=createGUID()}}child.ancestor=this;this.getChildren().splice(index,0,child);if(typeof child.updateBounds==="function"){if(this.isFloating===true){child.floating=false}child.updateBounds()}if(typeof child.onActivateEvent==="function"&&this.isAttachedToRoot()){child.onActivateEvent()}if(this.enableChildBoundsUpdate===true){this.updateBounds()}if(this.isAttachedToRoot()){const worldContainer=this.getRootAncestor();if(child.body instanceof Body){worldContainer.addBody(child.body)}if(child instanceof _Container){child.forEach(cchild=>{if(cchild.body instanceof Body){worldContainer.addBody(cchild.body)}})}}this.isDirty=true;this.onChildChange.call(this,index);return child}else{throw new Error("Index ("+index+") Out Of Bounds for addChildAt()")}}forEach(callback,thisArg){let i=0;const children=this.getChildren();const len=children.length;if(typeof callback!=="function"){throw new Error(callback+" is not a function")}while(i<len){callback.call(thisArg??this,children[i],i,children);i++}}swapChildren(child,child2){const index=this.getChildIndex(child);const index2=this.getChildIndex(child2);if(index!==-1&&index2!==-1){const _z=child.pos.z;child.pos.z=child2.pos.z;child2.pos.z=_z;this.getChildren()[index]=child2;this.getChildren()[index2]=child;this.isDirty=true}else{throw new Error(child+" Both the supplied childs must be a child of the caller "+this)}}getChildAt(index){if(index>=0&&index<this.getChildren().length){return this.getChildren()[index]}else{throw new Error("Index ("+index+") Out Of Bounds for getChildAt()")}}getChildIndex(child){return this.getChildren().indexOf(child)}getNextChild(child){const index=this.getChildren().indexOf(child)-1;if(index>=0&&index<this.getChildren().length){return this.getChildAt(index)}return void 0}hasChild(child){return this===child.ancestor}getChildByProp(prop,value){let objList=[];function compare2(obj,prop2){const v=obj[prop2];if(value instanceof RegExp&&typeof v==="string"){if(value.test(v)){objList.push(obj)}}else if(v===value){objList.push(obj)}}this.forEach(child=>{compare2(child,prop);if(child instanceof _Container){objList=objList.concat(child.getChildByProp(prop,value))}});return objList}getChildByType(classType){let objList=[];this.forEach(child=>{if(child instanceof classType){objList.push(child)}if(child instanceof _Container){objList=objList.concat(child.getChildByType(classType))}});return objList}getChildByName(name){return this.getChildByProp("name",name)}getChildByGUID(guid){const obj=this.getChildByProp("GUID",guid);return obj.length>0?obj[0]:null}getChildren(){if(typeof this.children==="undefined"){this.children=[]}return this.children}updateBounds(absolute=true){const bounds=this.getBounds();super.updateBounds(absolute);if(this.enableChildBoundsUpdate===true){this.forEach(child=>{if(child.isRenderable){const childBounds=child.updateBounds(absolute);if(childBounds.isFinite()){bounds.addBounds(childBounds)}}})}return bounds}isAttachedToRoot(){if(this.root===true){return true}else{let ancestor=this.ancestor;while(ancestor){if(ancestor.root===true){return true}ancestor=ancestor.ancestor}return false}}getRootAncestor(){if(this.root===true){return this}else{let ancestor=this.ancestor;while(ancestor){if(ancestor.root===true){break}ancestor=ancestor.ancestor}return ancestor}}onActivateEvent(){this.forEach(child=>{if(typeof child.onActivateEvent==="function"){child.onActivateEvent()}})}removeChild(child,keepalive){if(this.hasChild(child)){defer(deferredRemove,this,child,keepalive)}else{throw new Error("Child is not mine.")}}removeChildNow(child,keepalive){if(this.hasChild(child)&&this.getChildIndex(child)>=0){if(typeof child.onDeactivateEvent==="function"){child.onDeactivateEvent()}if(child.body instanceof Body){this.getRootAncestor().removeBody(child.body)}if(!keepalive){if(legacy_pool_default.push(child,false)===false){if(typeof child.destroy==="function"){child.destroy()}}}const childIndex=this.getChildIndex(child);if(childIndex>=0){this.getChildren().splice(childIndex,1);child.ancestor=void 0}if(this.enableChildBoundsUpdate===true){this.updateBounds()}this.isDirty=true;this.onChildChange.call(this,childIndex)}}setChildsProperty(prop,value,recursive){this.forEach(child=>{if(recursive===true&&child instanceof _Container){child.setChildsProperty(prop,value,recursive)}child[prop]=value})}moveUp(child){const childIndex=this.getChildIndex(child);if(childIndex-1>=0){this.swapChildren(child,this.getChildAt(childIndex-1));this.isDirty=true}}moveDown(child){const childIndex=this.getChildIndex(child);if(childIndex>=0&&childIndex+1<this.getChildren().length){this.swapChildren(child,this.getChildAt(childIndex+1));this.isDirty=true}}moveToTop(child){const childIndex=this.getChildIndex(child);if(childIndex>0){const children=this.getChildren();children.splice(0,0,children.splice(childIndex,1)[0]);child.pos.z=children[1].pos.z+1;this.isDirty=true}}moveToBottom(child){const childIndex=this.getChildIndex(child);const children=this.getChildren();if(childIndex>=0&&childIndex<children.length-1){children.splice(children.length-1,0,children.splice(childIndex,1)[0]);child.pos.z=children[children.length-2].pos.z-1;this.isDirty=true}}sort(recursive){if(!this.pendingSort){if(recursive===true){this.forEach(child=>{if(child instanceof _Container){child.sort(recursive)}})}this.pendingSort=defer(function(){this.getChildren().sort(this["_sort"+this.sortOn.toUpperCase()]);this.pendingSort=null;this.isDirty=true},this)}}onDeactivateEvent(){this.forEach(child=>{if(typeof child.onDeactivateEvent==="function"){child.onDeactivateEvent()}})}_sortZ(a,b){return b.pos&&a.pos?b.pos.z-a.pos.z:a.pos?-Infinity:Infinity}_sortReverseZ(a,b){return a.pos&&b.pos?a.pos.z-b.pos.z:a.pos?Infinity:-Infinity}_sortX(a,b){if(!b.pos||!a.pos){return a.pos?-Infinity:Infinity}const result=b.pos.z-a.pos.z;return result?result:b.pos.x-a.pos.x}_sortY(a,b){if(!b.pos||!a.pos){return a.pos?-Infinity:Infinity}const result=b.pos.z-a.pos.z;return result?result:b.pos.y-a.pos.y}destroy(){this.reset();super.destroy(arguments);colorPool.release(this.backgroundColor)}update(dt){let isFloating=false;const isPaused=state_default.isPaused();const children=this.getChildren();const childrenLength=children.length;for(let i=childrenLength,obj;i--,obj=children[i];){if(isPaused&&!obj.updateWhenPaused){continue}if(obj.isRenderable){isFloating=globalFloatingCounter>0||obj.floating;if(isFloating){globalFloatingCounter++}obj.inViewport=false;state_default.current().cameras.forEach(camera=>{if(camera.isVisible(obj,isFloating)){obj.inViewport=true}});this.isDirty|=(obj.inViewport||obj.alwaysUpdate)&&obj.update(dt);if(globalFloatingCounter>0){globalFloatingCounter--}}else{this.isDirty|=obj.update(dt)}}return super.update(dt)}draw(renderer2,viewport){let isFloating=false;const bounds=this.getBounds();this.drawCount=0;if(this.root===false&&this.clipping===true&&bounds.isFinite()===true){renderer2.clipRect(bounds.left,bounds.top,bounds.width,bounds.height)}renderer2.translate(this.pos.x,this.pos.y);if(this.backgroundColor.alpha>1/255){renderer2.clearColor(this.backgroundColor)}const children=this.getChildren();for(let i=children.length,obj;i--,obj=children[i];){if(obj.isRenderable){isFloating=obj.floating===true;if(obj.inViewport||isFloating){if(isFloating){renderer2.save();renderer2.resetTransform()}obj.preDraw(renderer2);obj.draw(renderer2,viewport);obj.postDraw(renderer2);if(isFloating){renderer2.restore()}this.drawCount++}}}}};var TMXRenderer=class{constructor(cols,rows,tilewidth,tileheight){this.cols=cols;this.rows=rows;this.tilewidth=tilewidth;this.tileheight=tileheight;this.bounds=new Bounds}canRender(component){return this.tilewidth===component.tilewidth&&this.tileheight===component.tileheight}getBounds(layer){const bounds=layer instanceof TMXLayer?boundsPool.get():this.bounds;bounds.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight);return bounds}pixelToTileCoords(x,y,v){return v}tileToPixelCoords(col,row,v){return v}drawTile(){}drawTileLayer(){}};var TMXOrthogonalRenderer=class extends TMXRenderer{constructor(map){super(map.cols,map.rows,map.tilewidth,map.tileheight)}canRender(layer){return layer.orientation==="orthogonal"&&super.canRender(layer)}pixelToTileCoords(x,y,v){const ret=v||new Vector2d;return ret.set(x/this.tilewidth,y/this.tileheight)}tileToPixelCoords(x,y,v){const ret=v||new Vector2d;return ret.set(x*this.tilewidth,y*this.tileheight)}adjustPosition(obj){if(typeof obj.gid==="number"){obj.y-=obj.height}}drawTile(renderer2,x,y,tmxTile){const tileset=tmxTile.tileset;tileset.drawTile(renderer2,tileset.tileoffset.x+x*this.tilewidth,tileset.tileoffset.y+(y+1)*this.tileheight-tileset.tileheight,tmxTile)}drawTileLayer(renderer2,layer,rect){let incX=1;let incY=1;const start=this.pixelToTileCoords(Math.max(rect.pos.x-(layer.maxTileSize.width-layer.tilewidth),0),Math.max(rect.pos.y-(layer.maxTileSize.height-layer.tileheight),0),vector2dPool.get()).floorSelf();const end=this.pixelToTileCoords(rect.pos.x+rect.width+this.tilewidth,rect.pos.y+rect.height+this.tileheight,vector2dPool.get()).ceilSelf();end.x=end.x>this.cols?this.cols:end.x;end.y=end.y>this.rows?this.rows:end.y;switch(layer.renderorder){case"right-up":end.y=start.y+(start.y=end.y)-end.y;incY=-1;break;case"left-down":end.x=start.x+(start.x=end.x)-end.x;incX=-1;break;case"left-up":end.x=start.x+(start.x=end.x)-end.x;end.y=start.y+(start.y=end.y)-end.y;incX=-1;incY=-1;break;default:break}for(let y=start.y;y!==end.y;y+=incY){for(let x=start.x;x!==end.x;x+=incX){const tmxTile=layer.cellAt(x,y,false);if(tmxTile){this.drawTile(renderer2,x,y,tmxTile)}}}vector2dPool.release(start);vector2dPool.release(end)}};var TMXIsometricRenderer=class extends TMXRenderer{constructor(map){super(map.cols,map.rows,map.tilewidth,map.tileheight);this.hTilewidth=this.tilewidth/2;this.hTileheight=this.tileheight/2;this.originX=this.rows*this.hTilewidth}canRender(layer){return layer.orientation==="isometric"&&super.canRender(layer)}getBounds(layer){const bounds=layer instanceof TMXLayer?boundsPool.get():this.bounds;bounds.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2));return bounds}pixelToTileCoords(x,y,v){const ret=v||new Vector2d;return ret.set(y/this.tileheight+(x-this.originX)/this.tilewidth,y/this.tileheight-(x-this.originX)/this.tilewidth)}tileToPixelCoords(x,y,v){const ret=v||new Vector2d;return ret.set((x-y)*this.hTilewidth+this.originX,(x+y)*this.hTileheight)}adjustPosition(obj){const tileX=obj.x/this.hTilewidth;const tileY=obj.y/this.tileheight;const isoPos=vector2dPool.get();this.tileToPixelCoords(tileX,tileY,isoPos);obj.x=isoPos.x;obj.y=isoPos.y;vector2dPool.release(isoPos)}drawTile(renderer2,x,y,tmxTile){const tileset=tmxTile.tileset;tileset.drawTile(renderer2,(this.cols-1)*tileset.tilewidth+(x-y)*tileset.tilewidth>>1,-tileset.tilewidth+(x+y)*tileset.tileheight>>2,tmxTile)}drawTileLayer(renderer2,layer,rect){let tileset=layer.tileset;const rowItr=this.pixelToTileCoords(rect.pos.x-tileset.tilewidth,rect.pos.y-tileset.tileheight,vector2dPool.get()).floorSelf();const tileEnd=this.pixelToTileCoords(rect.pos.x+rect.width+tileset.tilewidth,rect.pos.y+rect.height+tileset.tileheight,vector2dPool.get()).ceilSelf();const rectEnd=this.tileToPixelCoords(tileEnd.x,tileEnd.y,vector2dPool.get());const startPos=this.tileToPixelCoords(rowItr.x,rowItr.y,vector2dPool.get());startPos.x-=this.hTilewidth;startPos.y+=this.tileheight;const inUpperHalf=startPos.y-rect.pos.y>this.hTileheight;const inLeftHalf=rect.pos.x-startPos.x<this.hTilewidth;if(inUpperHalf){if(inLeftHalf){rowItr.x--;startPos.x-=this.hTilewidth}else{rowItr.y--;startPos.x+=this.hTilewidth}startPos.y-=this.hTileheight}let shifted=inUpperHalf^inLeftHalf;const columnItr=rowItr.clone();for(let y=startPos.y*2;y-this.tileheight*2<rectEnd.y*2;y+=this.tileheight){columnItr.setV(rowItr);for(let x=startPos.x;x<rectEnd.x;x+=this.tilewidth){const tmxTile=layer.cellAt(columnItr.x,columnItr.y);if(tmxTile){tileset=tmxTile.tileset;const offset=tileset.tileoffset;tileset.drawTile(renderer2,offset.x+x,offset.y+y/2-tileset.tileheight,tmxTile)}columnItr.x++;columnItr.y--}if(!shifted){rowItr.x++;startPos.x+=this.hTilewidth;shifted=true}else{rowItr.y++;startPos.x-=this.hTilewidth;shifted=false}}vector2dPool.release(columnItr);vector2dPool.release(rowItr);vector2dPool.release(tileEnd);vector2dPool.release(rectEnd);vector2dPool.release(startPos)}};var offsetsStaggerX=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}];var offsetsStaggerY=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];var TMXHexagonalRenderer=class extends TMXRenderer{constructor(map){super(map.cols,map.rows,map.tilewidth&~1,map.tileheight&~1);this.hexsidelength=map.hexsidelength||0;this.staggerX=map.staggeraxis==="x";this.staggerEven=map.staggerindex==="even";this.sidelengthx=0;this.sidelengthy=0;if(map.orientation==="hexagonal"){if(this.staggerX){this.sidelengthx=this.hexsidelength}else{this.sidelengthy=this.hexsidelength}}this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2;this.sideoffsety=(this.tileheight-this.sidelengthy)/2;this.columnwidth=this.sideoffsetx+this.sidelengthx;this.rowheight=this.sideoffsety+this.sidelengthy;this.centers=[new Vector2d,new Vector2d,new Vector2d,new Vector2d]}canRender(layer){return layer.orientation==="hexagonal"&&super.canRender(layer)}getBounds(layer){const bounds=layer instanceof TMXLayer?boundsPool.get():this.bounds;if(this.staggerX){bounds.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy));if(bounds.width>1){bounds.height+=this.rowheight}}else{bounds.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety);if(bounds.height>1){bounds.width+=this.columnwidth}}return bounds}doStaggerX(x){return this.staggerX&&x&1^this.staggerEven}doStaggerY(y){return!this.staggerX&&y&1^this.staggerEven}topLeft(x,y,v){const ret=v||new Vector2d;if(!this.staggerX){if(y&1^this.staggerEven){ret.set(x,y-1)}else{ret.set(x-1,y-1)}}else{if(x&1^this.staggerEven){ret.set(x-1,y)}else{ret.set(x-1,y-1)}}return ret}topRight(x,y,v){const ret=v||new Vector2d;if(!this.staggerX){if(y&1^this.staggerEven){ret.set(x+1,y-1)}else{ret.set(x,y-1)}}else{if(x&1^this.staggerEven){ret.set(x+1,y)}else{ret.set(x+1,y-1)}}return ret}bottomLeft(x,y,v){const ret=v||new Vector2d;if(!this.staggerX){if(y&1^this.staggerEven){ret.set(x,y+1)}else{ret.set(x-1,y+1)}}else{if(x&1^this.staggerEven){ret.set(x-1,y+1)}else{ret.set(x-1,y)}}return ret}bottomRight(x,y,v){const ret=v||new Vector2d;if(!this.staggerX){if(y&1^this.staggerEven){ret.set(x+1,y+1)}else{ret.set(x,y+1)}}else{if(x&1^this.staggerEven){ret.set(x+1,y+1)}else{ret.set(x+1,y)}}return ret}pixelToTileCoords(x,y,v){const ret=v||new Vector2d;if(this.staggerX){x-=this.staggerEven?this.tilewidth:this.sideoffsetx}else{y-=this.staggerEven?this.tileheight:this.sideoffsety}const referencePoint=vector2dPool.get(Math.floor(x/(this.columnwidth*2)),Math.floor(y/(this.rowheight*2)));const rel=vector2dPool.get(x-referencePoint.x*(this.columnwidth*2),y-referencePoint.y*(this.rowheight*2));if(this.staggerX){referencePoint.x=referencePoint.x*2;if(this.staggerEven){++referencePoint.x}}else{referencePoint.y=referencePoint.y*2;if(this.staggerEven){++referencePoint.y}}let left;let top;let centerX;let centerY;if(this.staggerX){left=this.sidelengthx/2;centerX=left+this.columnwidth;centerY=this.tileheight/2;this.centers[0].set(left,centerY);this.centers[1].set(centerX,centerY-this.rowheight);this.centers[2].set(centerX,centerY+this.rowheight);this.centers[3].set(centerX+this.columnwidth,centerY)}else{top=this.sidelengthy/2;centerX=this.tilewidth/2;centerY=top+this.rowheight;this.centers[0].set(centerX,top);this.centers[1].set(centerX-this.columnwidth,centerY);this.centers[2].set(centerX+this.columnwidth,centerY);this.centers[3].set(centerX,centerY+this.rowheight)}let nearest=0;let minDist=Number.MAX_VALUE;for(let i=0;i<4;++i){const dc=this.centers[i].sub(rel).length2();if(dc<minDist){minDist=dc;nearest=i}}const offsets=this.staggerX?offsetsStaggerX:offsetsStaggerY;ret.set(referencePoint.x+offsets[nearest].x,referencePoint.y+offsets[nearest].y);vector2dPool.release(referencePoint);vector2dPool.release(rel);return ret}tileToPixelCoords(x,y,v){const tileX=Math.floor(x);const tileY=Math.floor(y);const ret=v||new Vector2d;if(this.staggerX){ret.y=tileY*(this.tileheight+this.sidelengthy);if(this.doStaggerX(tileX)){ret.y+=this.rowheight}ret.x=tileX*this.columnwidth}else{ret.x=tileX*(this.tilewidth+this.sidelengthx);if(this.doStaggerY(tileY)){ret.x+=this.columnwidth}ret.y=tileY*this.rowheight}return ret}adjustPosition(obj){if(typeof obj.gid==="number"){obj.y-=obj.height}}drawTile(renderer2,x,y,tmxTile){const tileset=tmxTile.tileset;const point=this.tileToPixelCoords(x,y,vector2dPool.get());tileset.drawTile(renderer2,tileset.tileoffset.x+point.x,tileset.tileoffset.y+point.y+(this.tileheight-tileset.tileheight),tmxTile);vector2dPool.release(point)}drawTileLayer(renderer2,layer,rect){let tile;const startTile=this.pixelToTileCoords(rect.pos.x,rect.pos.y,vector2dPool.get());startTile.sub(layer.pos);let startPos=this.tileToPixelCoords(startTile.x+layer.pos.x,startTile.y+layer.pos.y,vector2dPool.get());const rowTile=startTile.clone();const rowPos=startPos.clone();const inUpperHalf=rect.pos.y-startPos.y<this.sideoffsety;const inLeftHalf=rect.pos.x-startPos.x<this.sideoffsetx;if(inUpperHalf){startTile.y--}if(inLeftHalf){startTile.x--}const endX=layer.cols;const endY=layer.rows;if(this.staggerX){startTile.x=Math.max(0,startTile.x);startTile.y=Math.max(0,startTile.y);startPos=this.tileToPixelCoords(startTile.x+layer.pos.x,startTile.y+layer.pos.y,startPos);let staggeredRow=this.doStaggerX(startTile.x+layer.pos.x);for(;startPos.y<rect.bottom&&startTile.y<endY;){rowTile.setV(startTile);rowPos.setV(startPos);for(;rowPos.x<rect.right&&rowTile.x<endX;rowTile.x+=2){tile=layer.cellAt(rowTile.x,rowTile.y,false);if(tile){tile.tileset.drawTile(renderer2,rowPos.x,rowPos.y,tile)}rowPos.x+=this.tilewidth+this.sidelengthx}if(staggeredRow){startTile.x-=1;startTile.y+=1;startPos.x-=this.columnwidth;staggeredRow=false}else{startTile.x+=1;startPos.x+=this.columnwidth;staggeredRow=true}startPos.y+=this.rowheight}vector2dPool.release(rowTile);vector2dPool.release(rowPos)}else{startTile.x=Math.max(0,startTile.x);startTile.y=Math.max(0,startTile.y);startPos=this.tileToPixelCoords(startTile.x+layer.pos.x,startTile.y+layer.pos.y,startPos);if(this.doStaggerY(startTile.y)){startPos.x-=this.columnwidth}for(;startPos.y<rect.bottom&&startTile.y<endY;startTile.y++){rowTile.setV(startTile);rowPos.setV(startPos);if(this.doStaggerY(startTile.y)){rowPos.x+=this.columnwidth}for(;rowPos.x<rect.right&&rowTile.x<endX;rowTile.x++){tile=layer.cellAt(rowTile.x,rowTile.y,false);if(tile){tile.tileset.drawTile(renderer2,rowPos.x,rowPos.y,tile)}rowPos.x+=this.tilewidth+this.sidelengthx}startPos.y+=this.rowheight}vector2dPool.release(rowTile);vector2dPool.release(rowPos)}vector2dPool.release(startTile);vector2dPool.release(startPos)}};var TMXStaggeredRenderer=class extends TMXHexagonalRenderer{canRender(layer){return layer.orientation==="staggered"&&super.canRender(layer)}pixelToTileCoords(x,y,v){let ret=v||new Vector2d;let alignedX=x;let alignedY=y;if(this.staggerX){alignedX-=this.staggerEven?this.sideoffsetx:0}else{alignedY-=this.staggerEven?this.sideoffsety:0}let referencePoint=vector2dPool.get(Math.floor(alignedX/this.tilewidth),Math.floor(alignedY/this.tileheight));if(this.staggerX){referencePoint.x=referencePoint.x*2;if(this.staggerEven){++referencePoint.x}}else{referencePoint.y=referencePoint.y*2;if(this.staggerEven){++referencePoint.y}}const rel=vector2dPool.get(alignedX-referencePoint.x*this.tilewidth,alignedY-referencePoint.y*this.tileheight);const y_pos=rel.x*(this.tileheight/this.tilewidth);if(this.sideoffsety-y_pos>rel.y){referencePoint=this.topLeft(referencePoint.x,referencePoint.y,referencePoint)}if(-this.sideoffsety+y_pos>rel.y){referencePoint=this.topRight(referencePoint.x,referencePoint.y,referencePoint)}if(this.sideoffsety+y_pos<rel.y){referencePoint=this.bottomLeft(referencePoint.x,referencePoint.y,referencePoint)}if(this.sideoffsety*3-y_pos<rel.y){referencePoint=this.bottomRight(referencePoint.x,referencePoint.y,referencePoint)}ret=this.tileToPixelCoords(referencePoint.x,referencePoint.y,ret);ret.set(x-ret.x,y-ret.y);ret.set(ret.x-this.tilewidth/2,ret.y*(this.tilewidth/this.tileheight));ret.div(this.tilewidth/Math.sqrt(2)).rotate(degToRad(-45)).add(referencePoint);vector2dPool.release(referencePoint);vector2dPool.release(rel);return ret}};function getNewTMXRenderer(map){switch(map.orientation){case"orthogonal":return new TMXOrthogonalRenderer(map);case"isometric":return new TMXIsometricRenderer(map);case"hexagonal":return new TMXHexagonalRenderer(map);case"staggered":return new TMXStaggeredRenderer(map);default:throw new Error(map.orientation+" type TMX Tile Map not supported!")}}function warning(deprecated,replacement,version2){if("__vitest_browser__"in window){return}const msg="melonJS: %s is deprecated since version %s, please use %s";const stack=(new Error).stack;if(console.groupCollapsed){console.groupCollapsed("%c"+msg,"font-weight:normal;color:yellow;",deprecated,version2,replacement)}else{console.warn(msg,deprecated,version2,replacement)}if(typeof stack!=="undefined"){console.warn(stack)}if(console.groupCollapsed){console.groupEnd()}}function readLayer(map,data2,z){return new TMXLayer(map,data2,map.tilewidth,map.tileheight,map.orientation,map.tilesets,z)}function readImageLayer(map,data2,z){applyTMXProperties(data2.properties,data2);const imageLayer=legacy_pool_default.pull("ImageLayer",+data2.offsetx||+data2.x||0,+data2.offsety||+data2.y||0,Object.assign({name:data2.name,image:data2.image,ratio:vector2dPool.get(+data2.parallaxx||1,+data2.parallaxy||1),tint:typeof data2.tintcolor!=="undefined"?colorPool.get().parseHex(data2.tintcolor,true):void 0,z:z},data2.properties));const visible=typeof data2.visible!=="undefined"?data2.visible:true;imageLayer.setOpacity(visible?+data2.opacity:0);return imageLayer}function readTileset(data2){return new TMXTileset(data2)}function readObjectGroup(map,data2,z){return new TMXGroup(map,data2,z)}var TMXTileMap=class{constructor(levelId,data2){this.data=data2;this.name=levelId;this.cols=+data2.width;this.rows=+data2.height;this.tilewidth=+data2.tilewidth;this.tileheight=+data2.tileheight;this.infinite=+data2.infinite||0;this.orientation=data2.orientation;this.renderorder=data2.renderorder||"right-down";this.version=""+data2.version;this.tiledversion=""+data2.tiledversion;this.class=data2.class;this.tilesets=null;if(typeof this.layers==="undefined"){this.layers=[]}if(typeof this.objectGroups==="undefined"){this.objectGroups=[]}this.isEditor=data2.editor==="melon-editor";this.nextobjectid=+data2.nextobjectid||void 0;this.hexsidelength=+data2.hexsidelength;this.staggeraxis=data2.staggeraxis;this.staggerindex=data2.staggerindex;this.bounds=this.getRenderer().getBounds().clone();this.width=this.bounds.width;this.height=this.bounds.height;this.backgroundcolor=data2.backgroundcolor;if(this.version!=="undefined"&&this.version!==""){if(checkVersion(this.version,"1.5")<0){warning("("+this.name+") Tiled Map format version 1.4 and below","format 1.5 or higher","10.4.4")}}applyTMXProperties(this,data2);this.initialized=false}getRenderer(){if(typeof this.renderer==="undefined"||!this.renderer.canRender(this)){this.renderer=getNewTMXRenderer(this)}return this.renderer}getBounds(){return this.bounds}readMapObjects(data2){if(this.initialized===true){return}let zOrder2=0;if(!this.tilesets){this.tilesets=new TMXTilesetGroup}if(typeof data2.tilesets!=="undefined"){const tilesets=data2.tilesets;tilesets.forEach(tileset=>{this.tilesets.add(readTileset(tileset))})}if(this.background_image){this.layers.push(legacy_pool_default.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:zOrder2++}))}data2.layers.forEach(layer=>{switch(layer.type){case"imagelayer":this.layers.push(readImageLayer(this,layer,zOrder2++));break;case"tilelayer":this.layers.push(readLayer(this,layer,zOrder2++));break;case"objectgroup":this.objectGroups.push(readObjectGroup(this,layer,zOrder2++));break;case"group":this.objectGroups.push(readObjectGroup(this,layer,zOrder2++));break;default:break}});this.initialized=true}addTo(container,flatten,setViewportBounds){const _sort=container.autoSort;const _depth=container.autoDepth;const levelBounds=this.getBounds();container.autoSort=false;container.autoDepth=false;if(this.backgroundcolor){container.backgroundColor.parseCSS(this.backgroundcolor)}this.getLayers().forEach(layer=>{container.addChild(layer)});this.getObjects(flatten).forEach(object=>{container.addChild(object)});container.resize(this.bounds.width,this.bounds.height);container.sort(true);function _setBounds(width,height){game.viewport.setBounds(0,0,Math.max(levelBounds.width,width),Math.max(levelBounds.height,height));container.pos.set(Math.max(0,~~((width-levelBounds.width)/2)),Math.max(0,~~((height-levelBounds.height)/2)),container.pos.z)}if(setViewportBounds===true){eventEmitter.removeListener(VIEWPORT_ONRESIZE,_setBounds);_setBounds(game.viewport.width,game.viewport.height);eventEmitter.addListener(VIEWPORT_ONRESIZE,_setBounds)}container.autoSort=_sort;container.autoDepth=_depth}getObjects(flatten){const objects=[];let isCollisionGroup=false;let targetContainer;this.readMapObjects(this.data);for(let g=0;g<this.objectGroups.length;g++){const group=this.objectGroups[g];isCollisionGroup=group.name.toLowerCase().includes(COLLISION_GROUP);if(flatten===false){targetContainer=new Container(0,0,this.width,this.height);targetContainer.anchorPoint.set(0,0);targetContainer.name=group.name;targetContainer.pos.z=group.z;targetContainer.setOpacity(group.opacity);targetContainer.autoSort=false;targetContainer.autoDepth=false}for(let o=0;o<group.objects.length;o++){const settings=group.objects[o];let obj;let shape;if(typeof settings.anchorPoint==="undefined"){settings.anchorPoint={x:0,y:0}}if(typeof settings.tintcolor!=="undefined"){settings.tint=colorPool.get();settings.tint.parseHex(settings.tintcolor,true)}if(settings instanceof TMXLayer){obj=settings}else if(typeof settings.text==="object"){if(typeof settings.text.anchorPoint==="undefined"){settings.text.anchorPoint=settings.anchorPoint}if(settings.text.bitmap===true){obj=legacy_pool_default.pull("BitmapText",settings.x,settings.y,settings.text)}else{obj=legacy_pool_default.pull("Text",settings.x,settings.y,settings.text)}obj.pos.z=settings.z}else if(typeof settings.tile==="object"){shape=settings.shapes;if(typeof shape==="undefined"){shape=polygonPool.get(0,0,[vector2dPool.get(0,0),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height)])}obj=settings.tile.getRenderable(settings);obj.body=new Body(obj,shape);obj.body.setStatic(true);obj.pos.setMuted(settings.x,settings.y,settings.z)}else{if(typeof settings.name!=="undefined"&&settings.name!==""){obj=legacy_pool_default.pull(settings.name,settings.x,settings.y,settings)}else{obj=legacy_pool_default.pull("Renderable",settings.x,settings.y,settings.width,settings.height);shape=settings.shapes;if(typeof shape==="undefined"){shape=polygonPool.get(0,0,[vector2dPool.get(0,0),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height)])}obj.anchorPoint.set(0,0);obj.name=settings.name;obj.type=settings.type;obj.class=settings.class||settings.type;obj.id=settings.id;obj.body=new Body(obj,shape);obj.body.setStatic(true);obj.resize(obj.body.getBounds().width,obj.body.getBounds().height)}obj.pos.z=settings.z}if(isCollisionGroup&&!settings.name&&obj.body){obj.body.collisionType=collision.types.WORLD_SHAPE;obj.body.isStatic=true}if(flatten!==false){if(obj.isRenderable===true){obj.setOpacity(obj.getOpacity()*group.opacity);if(typeof obj.renderable!=="undefined"&&obj.renderable.isRenderable===true){obj.renderable.setOpacity(obj.renderable.getOpacity()*group.opacity)}}objects.push(obj)}else{targetContainer.addChild(obj)}}if(flatten===false&&targetContainer.children.length>0){targetContainer.autoSort=true;targetContainer.autoDepth=true;objects.push(targetContainer)}}return objects}getLayers(){this.readMapObjects(this.data);return this.layers}destroy(){this.tilesets=void 0;this.layers.length=0;this.objectGroups.length=0;this.initialized=false}};var levels={};var levelIdx=[];var currentLevelIdx=0;function safeLoadLevel(levelId,options,restart){options.container.reset();game.reset();if(levels[level.getCurrentLevelId()]){levels[level.getCurrentLevelId()].destroy()}currentLevelIdx=levelIdx.indexOf(levelId);loadTMXLevel(levelId,options.container,options.flatten,options.setViewportBounds);eventEmitter.emit(LEVEL_LOADED,levelId);options.onLoaded(levelId);if(restart){state_default.restart()}}function loadTMXLevel(levelId,container,flatten,setViewportBounds){const level2=levels[levelId];resetGUID(levelId,level2.nextobjectid);container.anchorPoint.set(0,0);level2.addTo(container,flatten,setViewportBounds)}var level={add(format,levelId,callback){switch(format){case"tmx":if(levels[levelId]==null){levels[levelId]=new TMXTileMap(levelId,getTMX(levelId));levelIdx.push(levelId)}else{return false}if(callback){callback()}return true;default:throw new Error("no level loader defined for format "+format)}},load(levelId,options){options=Object.assign({container:game.world,onLoaded:game.onLevelLoaded,flatten:game.mergeGroup,setViewportBounds:true},options||{});if(typeof levels[levelId]==="undefined"){throw new Error("level "+levelId+" not found")}if(levels[levelId]instanceof TMXTileMap){const wasRunning=state_default.isRunning();if(wasRunning){state_default.stop();setTimeout(()=>{safeLoadLevel(levelId,options,true)})}else{safeLoadLevel(levelId,options)}}else{throw new Error("no level loader defined")}return true},getCurrentLevelId(){return levelIdx[currentLevelIdx]},getCurrentLevel(){return levels[this.getCurrentLevelId()]},reload(options){return this.load(this.getCurrentLevelId(),options)},next(options){if(currentLevelIdx+1<levelIdx.length){return this.load(levelIdx[currentLevelIdx+1],options)}else{return false}},previous(options){if(currentLevelIdx-1>=0){return this.load(levelIdx[currentLevelIdx-1],options)}else{return false}},levelCount(){return levelIdx.length}};function preloadTMX(tmxData,onload2,onerror2,settings){if(typeof tmxList[tmxData.name]!=="undefined"){return 0}function addToTMXList(data2){tmxList[tmxData.name]=data2;if(tmxData.type==="tmx"){level.add(tmxData.type,tmxData.name)}}if(tmxData.data){addToTMXList(tmxData.data);if(typeof onload2==="function"){onload2()}return}fetchData(tmxData.src,"text",settings).then(response=>{if(typeof response!=="string"){throw new Error("Invalid response type")}let result;switch(getExtension(tmxData.src)){case"xml":case"tmx":case"tsx":{const parser=new DOMParser;if(typeof parser.parseFromString==="undefined"){throw new Error("XML file format loading supported, use the JSON file format instead")}const xmlDoc=parser.parseFromString(response,"text/xml");const data2=parse(xmlDoc);result=data2.map||data2.tilesets[0]||data2;break}case"json":case"tmj":case"tsj":result=JSON.parse(response);break;default:throw new Error(`TMX file format not supported: ${getExtension(tmxData.src)}`)}addToTMXList(result);if(typeof onload2==="function"){onload2()}}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});return 1}function preloadJSON(data2,onload2,onerror2,settings){if(typeof jsonList[data2.name]!=="undefined"){return 0}fetchData(data2.src,"json",settings).then(response=>{jsonList[data2.name]=response;if(typeof onload2==="function"){onload2()}}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});return 1}function preloadBinary(data2,onload2,onerror2,settings){fetchData(data2.src,"arrayBuffer",settings).then(response=>{const decoder=new TextDecoder;binList[data2.name]=decoder.decode(response);if(typeof onload2==="function"){onload2()}}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}});return 1}function preloadJavascript(data2,onload2,onerror2,settings){const script=globalThis.document.createElement("script");script.src=data2.src;script.type="text/javascript";if(typeof crossOrigin==="string"){script.crossOrigin=settings.crossOrigin}script.defer=true;if(typeof onload2==="function"){script.onload=()=>{onload2()}}if(typeof onerror2==="function"){script.onerror=()=>{onerror2(data2.name)}}globalThis.document.getElementsByTagName("body")[0].appendChild(script);return 1}function preloadVideo(data2,onload2,onerror2,settings){if(typeof videoList[data2.name]!=="undefined"){return 0}const videoElement=videoList[data2.name]=globalThis.document.createElement("video");if(isDataUrl(data2.src)){const mimeType=data2.src.match(/[^:]\w+\/[\w-+\d.]+(?=;|,)/)[0];if(!mimeType||videoElement.canPlayType(mimeType)===""){throw new Error(`Invalid dataURL or Video file format not supported: ${mimeType}`)}}else{if(!hasVideoFormat(getExtension(data2.src))){throw new Error(`Video file format not supported: ${getExtension(data2.src)}`)}}if(isDataUrl(data2.src)){fetchData(data2.src,"blob",settings).then(blob=>{videoElement.src=globalThis.URL.createObjectURL(blob)}).catch(error=>{if(typeof onerror2==="function"){onerror2(error)}})}else{videoElement.src=data2.src}videoElement.setAttribute("preload",data2.stream===true?"metadata":"auto");videoElement.setAttribute("playsinline","true");videoElement.setAttribute("disablePictureInPicture","true");videoElement.setAttribute("controls","false");videoElement.setAttribute("crossorigin",settings.crossOrigin);if(data2.autoplay===true){videoElement.setAttribute("autoplay","true")}if(data2.loop===true){videoElement.setAttribute("loop","true")}if(typeof onload2==="function"){if(data2.stream===true||data2.autoplay===false){videoElement.onloadedmetadata=()=>{if(typeof onload2==="function"){onload2()}}}else{videoElement.oncanplay=()=>{if(typeof onload2==="function"){onload2()}}}}if(typeof onerror2==="function"){videoElement.onerror=()=>{onerror2()}}videoElement.load();return 1}var nocache="";var baseURL={};var crossOrigin2;var withCredentials=false;function setNocache(enable2=false){nocache=enable2?"?"+~~(Math.random()*1e7):""}function setOptions(options){if(options.crossOrigin!==void 0){crossOrigin2=options.crossOrigin}if(options.nocache!==void 0){setNocache(options.nocache)}if(options.withCredentials!==void 0){withCredentials=options.withCredentials}}function setBaseURL(type,url="./"){if(type!=="*"){baseURL[type]=url}else{baseURL["audio"]=url;baseURL["video"]=url;baseURL["binary"]=url;baseURL["image"]=url;baseURL["json"]=url;baseURL["js"]=url;baseURL["tmx"]=url;baseURL["tsx"]=url}}var onload;var onProgress;var onError;var parsers=new Map;var parserInitialized=false;var resourceCount=0;var loadCount=0;var timerId=0;var failureLoadedAssets={};function initParsers(){setParser("binary",preloadBinary);setParser("image",preloadImage);setParser("json",preloadJSON);setParser("js",preloadJavascript);setParser("tmx",preloadTMX);setParser("tsx",preloadTMX);setParser("audio",load);setParser("fontface",preloadFontFace);setParser("video",preloadVideo);parserInitialized=true}function checkLoadStatus(onloadcb){if(loadCount===resourceCount){if(typeof onloadcb==="function"||onload){clearTimeout(timerId);const callback=onloadcb||onload;setTimeout(()=>{callback();eventEmitter.emit(LOADER_COMPLETE)},300)}else{throw new Error("no load callback defined")}}else{timerId=setTimeout(()=>{checkLoadStatus(onloadcb)},100)}}function onResourceLoaded(res){delete failureLoadedAssets[res.src];loadCount++;const progress=loadCount/resourceCount;if(typeof onProgress==="function"){onProgress(progress,res)}eventEmitter.emit(LOADER_PROGRESS,progress,res)}function onLoadingError(res){failureLoadedAssets[res.src]=res;if(this.onError){this.onError(res)}eventEmitter.emit(LOADER_ERROR,res);throw new Error("Failed loading resource "+res.src)}function setParser(type,parserFn){if(typeof parserFn!=="function"){throw new Error("invalid parser function for "+type)}if(typeof parsers.get(type)!=="undefined"){warning("overriding parser for "+type+" format")}parsers.set(type,parserFn)}function preload(assets,onloadcb,switchToLoadState=true){for(let i=0;i<assets.length;i++){resourceCount+=load2(assets[i],onResourceLoaded.bind(this,assets[i]),onLoadingError.bind(this,assets[i]))}if(typeof onloadcb!=="undefined"){onload=onloadcb}if(switchToLoadState===true){state_default.change(state_default.LOADING)}checkLoadStatus(onload)}function reload(src){const assetToReload=failureLoadedAssets[src];this.unload(assetToReload);resourceCount-=1;resourceCount+=this.load(assetToReload,this.onResourceLoaded.bind(this,assetToReload),this.onLoadingError.bind(this,assetToReload));checkLoadStatus(this.onload)}function load2(asset,onload2,onerror2){if(parserInitialized===false){initParsers()}if(typeof baseURL[asset.type]!=="undefined"){asset.src=baseURL[asset.type]+asset.src}const parser=parsers.get(asset.type);if(typeof parser==="undefined"){throw new Error("load : unknown or invalid resource type : "+asset.type)}return parser.call(this,asset,onload2,onerror2,{nocache:nocache,crossOrigin:crossOrigin2,withCredentials:withCredentials})}function unload2(asset){switch(asset.type){case"binary":if(!(asset.name in binList)){return false}delete binList[asset.name];return true;case"image":if(!(asset.name in imgList)){return false}delete imgList[asset.name];return true;case"json":if(!(asset.name in jsonList)){return false}delete jsonList[asset.name];return true;case"js":return true;case"fontface":if(typeof typeof globalThis.document!=="undefined"&&typeof globalThis.document.fonts!=="undefined"){globalThis.document.fonts.delete(fontList[asset.name]);delete fontList[asset.name];return true}return false;case"tmx":case"tsx":if(!(asset.name in tmxList)){return false}delete tmxList[asset.name];return true;case"audio":return unload(asset.name);case"video":if(!(asset.name in videoList)){return false}delete videoList[asset.name];return true;default:throw new Error("unload : unknown or invalid resource type : "+asset.type)}}function unloadAll2(){let name;for(name in binList){if(binList.hasOwnProperty(name)){unload2({name:name,type:"binary"})}}for(name in imgList){if(imgList.hasOwnProperty(name)){unload2({name:name,type:"image"})}}for(name in tmxList){if(tmxList.hasOwnProperty(name)){unload2({name:name,type:"tmx"})}}for(name in jsonList){if(jsonList.hasOwnProperty(name)){unload2({name:name,type:"json"})}}for(name in videoList){if(videoList.hasOwnProperty(name)){unload2({name:name,type:"json"})}}for(name in fontList){if(fontList.hasOwnProperty(name)){unload2({name:name,type:"font"})}}unloadAll()}function getTMX(elt){elt=""+elt;if(elt in tmxList){return tmxList[elt]}return null}function getBinary(elt){elt=""+elt;if(elt in binList){return binList[elt]}return null}function getImage(image){image=getBasename(""+image);if(image in imgList){return imgList[image]}return null}function getJSON(elt){elt=""+elt;if(elt in jsonList){return jsonList[elt]}return null}function getVideo(elt){elt=""+elt;if(elt in videoList){return videoList[elt]}return null}function getFont(elt){elt=""+elt;if(elt in fontList){return fontList[elt]}return null}var Sprite=class extends Renderable{constructor(x,y,settings){super(x,y,0,0);this.animationpause=false;this.animationspeed=100;this.offset=vector2dPool.get(0,0);this.isVideo=false;this.source=null;this.anim={};this.resetAnim=void 0;this.current={name:void 0,length:0,offset:vector2dPool.get(0,0),width:0,height:0,angle:0,idx:0};this.dt=0;this._flicker={isFlickering:false,duration:0,callback:null,state:false};if(settings.image instanceof TextureAtlas){this.source=settings.image;this.image=this.source.getTexture();this.textureAtlas=settings.image;if(typeof settings.region!=="undefined"){const region=this.source.getRegion(settings.region);if(region){this.setRegion(region)}else{throw new Error("Texture - region for "+settings.region+" not found")}}}else{this.image=typeof settings.image==="object"?settings.image:getImage(settings.image);if(!this.image){throw new Error("me.Sprite: '"+settings.image+"' image/texture not found!")}this.isVideo=globalThis.HTMLVideoElement&&this.image instanceof globalThis.HTMLVideoElement;if(this.isVideo){this.width=this.current.width=settings.framewidth=settings.framewidth||this.image.videoWidth;this.height=this.current.height=settings.frameheight=settings.frameheight||this.image.videoHeight;this.animationpause=this.image.autoplay!==true;if(this.animationpause){this.image.pause()}this.removeStatePauseListener=eventEmitter.addListener("statePause",()=>{this.image.pause()});this.image.onended=()=>{if(typeof this.onended==="function"){if(!this.image.loop){this.animationpause=true}this.onended()}}}else{this.width=this.current.width=settings.framewidth=settings.framewidth||this.image.width;this.height=this.current.height=settings.frameheight=settings.frameheight||this.image.height;this.source=renderer.cache.get(this.image,settings);this.textureAtlas=this.source.getAtlas()}}if(typeof settings.atlas!=="undefined"){this.textureAtlas=settings.atlas;this.atlasIndices=settings.atlasIndices}if(typeof settings.flipX!=="undefined"){this.flipX(!!settings.flipX)}if(typeof settings.flipY!=="undefined"){this.flipY(!!settings.flipY)}if(typeof settings.rotation!=="undefined"){this.rotate(settings.rotation)}if(settings.anchorPoint){this.anchorPoint.set(settings.anchorPoint.x,settings.anchorPoint.y)}if(typeof settings.tint!=="undefined"){if(settings.tint instanceof Color){this.tint.copy(settings.tint)}else{this.tint.parseCSS(settings.tint)}}if(typeof settings.name==="string"){this.name=settings.name}if(typeof settings.z!=="undefined"){this.pos.z=settings.z}if(typeof settings.anims!=="undefined"){for(const anim in settings.anims){this.addAnimation(settings.anims[anim].name,settings.anims[anim].index,settings.anims[anim].speed)}}if(!this.isVideo&&this.addAnimation("default",null)!==0){this.setCurrentAnimation("default")}}isFlickering(){return this._flicker.isFlickering}play(){this.animationpause=false}pause(){this.animationpause=true}flicker(duration,callback=void 0){this._flicker.duration=duration;if(this._flicker.duration<=0){this._flicker.isFlickering=false;this._flicker.callback=void 0}else if(!this._flicker.isFlickering){this._flicker.callback=callback;this._flicker.isFlickering=true}return this}addAnimation(name,index,animationspeed){this.anim[name]={name:name,frames:[],idx:0,length:0};let counter=0;if(typeof this.textureAtlas!=="object"){return 0}if(index==null){index=[];Object.keys(this.textureAtlas).forEach((v,i)=>{index[i]=i})}for(let i=0,len=index.length;i<len;i++){const frame=index[i];let frameObject;if(typeof frame==="number"||typeof frame==="string"){frameObject={name:frame,delay:animationspeed||this.animationspeed}}else{frameObject=frame}const frameObjectName=frameObject.name;if(typeof frameObjectName==="number"){if(typeof this.textureAtlas[frameObjectName]!=="undefined"){this.anim[name].frames[i]=Object.assign({},this.textureAtlas[frameObjectName],frameObject);counter++}}else{if(this.source.getFormat().includes("Spritesheet")){throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture")}else{this.anim[name].frames[i]=Object.assign({},this.textureAtlas[this.atlasIndices[frameObjectName]],frameObject);counter++}}}this.anim[name].length=counter;return counter}setCurrentAnimation(name,resetAnim,preserve_dt=false){if(typeof this.anim[name]!=="undefined"){if(!this.isCurrentAnimation(name)){this.current.name=name;this.current.length=this.anim[this.current.name].length;if(typeof resetAnim==="string"){this.resetAnim=this.setCurrentAnimation.bind(this,resetAnim,null,true)}else if(typeof resetAnim==="function"){this.resetAnim=resetAnim}else{this.resetAnim=void 0}this.setAnimationFrame(0);if(!preserve_dt){this.dt=0}this.isDirty=true}}else{throw new Error("animation id '"+name+"' not defined")}return this}reverseAnimation(name){if(typeof name!=="undefined"&&typeof this.anim[name]!=="undefined"){this.anim[name].frames.reverse()}else{this.anim[this.current.name].frames.reverse()}this.isDirty=true;return this}isCurrentAnimation(name){return this.current.name===name}setRegion(region){this.image=this.source.getTexture(region);this.current.offset.setV(region.offset);this.current.angle=typeof region.angle==="number"?region.angle:0;this.width=this.current.width=region.width;this.height=this.current.height=region.height;if(region.anchorPoint){this.anchorPoint.setMuted(this._flip.x&&region.trimmed===true?1-region.anchorPoint.x:region.anchorPoint.x,this._flip.y&&region.trimmed===true?1-region.anchorPoint.y:region.anchorPoint.y)}this.updateBounds();this.isDirty=true;return this}setAnimationFrame(index=0){this.current.idx=index%this.current.length;return this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))}getCurrentAnimationFrame(){return this.current.idx}getAnimationFrameObjectByIndex(id){return this.anim[this.current.name].frames[id]}update(dt){if(this.isVideo){if(this.animationpause){this.image.pause()}else if(this.image.paused){this.image.play()}this.isDirty=!this.image.paused}else{if(!this.animationpause&&this.current.length>1){let duration=this.getAnimationFrameObjectByIndex(this.current.idx).delay;this.dt+=dt;while(this.dt>=duration){this.isDirty=true;this.dt-=duration;const nextFrame=this.current.length>1?this.current.idx+1:this.current.idx;this.setAnimationFrame(nextFrame);if(this.current.idx===0){if(typeof this.onended==="function"){this.onended()}if(typeof this.resetAnim==="function"){if(this.resetAnim()===false){this.setAnimationFrame(this.current.length-1);this.dt%=duration;break}}}duration=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}}if(this._flicker.isFlickering){this._flicker.duration-=dt;if(this._flicker.duration<0){if(typeof this._flicker.callback==="function"){this._flicker.callback()}this.flicker(-1)}this.isDirty=true}return super.update(dt)}draw(renderer2){if(this._flicker.isFlickering){this._flicker.state=!this._flicker.state;if(!this._flicker.state){return}}const frame=this.current;let xpos=this.pos.x;const ypos=this.pos.y;let w=frame.width;let h=frame.height;const frame_offset=frame.offset;const g_offset=this.offset;if(frame.angle!==0){renderer2.translate(-xpos,-ypos);renderer2.rotate(frame.angle);xpos-=h;w=frame.height;h=frame.width}renderer2.drawImage(this.image,g_offset.x+frame_offset.x,g_offset.y+frame_offset.y,w,h,xpos,ypos,w,h)}destroy(){vector2dPool.release(this.offset);this.offset=void 0;if(this.isVideo){this.removeStatePauseListener();this.image.onended=void 0;this.image.pause();this.image.currentTime=0}this.image=void 0;super.destroy()}};var melonjs_logo_default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAA8FBMVEUgICBrqDHRZVtqpzEhJCAjKCBurTIfHyDQZFptrDEWAB8OAB7VZ1wtIiIAEhYlISDYaF4SAB4pIiEAFhkcFh8eGyBopDAMAB5noS8kKyAAGhtjmy4bEB9lni8ZBR/HYFdPeim/XFQ9XCUaCh9flS1VhCtSfyorOSEVHh4HHB1EZyatVExhmC5ajCxHbSc0SyMuQCInMiFKcSgxRSI6VSRBYiWdTUZdki09JyZ8PzpYiSs3UCRlNjK1WE9ckC1MdShbjywyJCONRkDKYliUSUNeMzBDKShXMC2kUEl1PDeEQj1OLStnNjNxOjZsODQAAAcMh1CFAAAU4UlEQVR42uyaa3fSMBjHk5EQkgClkBZKoXblNhlswIooc2N6pp7jUb//x/FpRbnt4JWwzv7eraQvfs/zby7tUEpKSkpKSkpKSkpKSkpKSkqKTsg30P8E+FIArJllqQaglMXQt6tPuhogGSlaLWFKKU2hEB33eqPRqDemRAlhRhdbVjwIBj8xogajhpBSkNH1dOJ37mYDt1mr2UCt1mwOZned7qQfjhxPVs0WovTpRIFFNkpIU42CSWfm2phnIzjHP+DLS9hutjuL4IqZUigC9yU/CWDBhBROOJkPbBxL4swKjDf/jEvBbXe4CMeiKixKEx0EAq03JbqeDJs4Ul9a7mE5AqqAazM/pJCb5JaAUmWa42nHBflYDf8y8WC4qznv9yRKZAUIRUKO+/Maz/J1+d8ugu0rK3kVoNSTVhDZr8v/WRGyQw8lC0KJMK989+/sVzXILiRNzmrACGXSC4Z2lsf2f08GN2lyHgJCLUn6bRw1/2dim+A9hIKiJMAQ6NOJu7f5a7r8B+u/7N7BAzMZBaBIkkkz0t83sfMsgDHsgN1BOybaFNvww2qblMgEUGKqi2aU/X3u2HZnHf8iuL4aO0S1PKDVQM54dBn0F50718bfq5CwOYBQIaaDVfd37MG91u5MwhER8WHQU8qC2wCEmFJefEYUrBdedGe15b4xQasAtaqXt/wh/W87W1679YNeCxQbjNCItTchBFheRErAmHEYb575ch/Qeuz9ByXpdHH2QX2wx4NuMBbSbJCfn3IJWZ4dndBvZ6Bytt949A8AbZjT6OHftQeDTHtx2VgebhFj6KfAmGisJaS46k+mj/4sELW/N+QP6UOIXf/Sqwq0p/F7okA8KU312BcAqmTf3k1/1Hx7HlgyskfsL96h7b3XMNCRcYQzz+KH9N3FSC57fxiYUTDOWLmAjgcjpBo2d9oPKxdv95Fs0UPGl5XPinWDVYqGwdBxYFQJH/Mdfc5nQUuyw77KYYXKm/ub09PzV/Xn5SNVAOJ/B/Hf0W8HwiQUHRTwf/2slM/nS6WbN/XjZIDK6534w8zv9r1In6GDUq6/y+VzMaVTdGYg7cDj38/wHX17YknQPzSGUb8p5U5icqX7ovaZkBFk+nw7/hx3epIdvPtAufIpf7Ikl39W0B0BRpToQPy32j8IZUPPW+xC8S0E4Afv6noLwGgL3WZ32u8roetbTqF4v1aA/JdKGWmEUc8ZgP/m0j+4riKKNFEoflwrQO6D1gQwKnrulj/mXUto048XgZV+/vQMaYQ5otfc8s/Wpprav5oFz5cRgHXwo85VgFHw55nN+Ld7UvMnPOP5y2elXMRJ6VzDA7DPH2e7XstBemHl+vubfAk4efGc6SsAo9542x9fVJH+D/lQgfrnF+fn9++KWv0bdHP+z3A7rFKC9MMMo1KsVIr1ssYHgFiqvemfdUemg45EuVAuFMpIH4SI4ZZ/2xEOQ8eCAUgjVHa3/G+txuN/Z/+vYE51suU/9NT/5G8GIL3uPxfsCfwf11fyrW1FgRiGTkna0vZpYHQUXRHdVZBhvCMorP7/V+3oyprgPiy2Dxk2HzA06TknpyHz19CjVfcpf9kj+6SBtqgcMPz/q/vPdPgwLP/DsCM1f2vTf7Ifap5/hYXQ/FGnX7S16LdABADc23oqVP91kYfgrU5b1GxKHSCo7tILzR/z9eJ8nliv0zqAMZ8ATEJfaP6+7jlj3CDlXpHVfsfnH+eyn4kMzMdGQRNO7fNkGEXbGTigBkDq1lZzU07BnaXzIab6LCMAuEEmdWcD8+ax9uNTckxFqyWxwKBgKXZrzerHtAbcPhFQ0R8oAExdChXADIt1Tz0KkGi9TjML1CBLqgA0YZGIFZhZqVNUtf9GCdBbF0IF4Be/vvQYz6pyxhRwH+QC4CpXoAgELvE6iKMtfwJLzv+5YU2iDasOR0MJMBdMgFsMK6ICrppGY+rELGAdhFpAYoXYgRdBRzsLUtB3L/z+7zpITFvHYhQAdorGyQudAdCuNe8qoJjVNgYAF0M+9iFbAe9tK2w4BKIIdVJ0CLASv7jeBFo7cBwCrxcgP1IAjEv5ALipwII1gmGGMR4A2uEB+blJK4x4E1kdZhQA5xYowPe58z3lwKfH199WbQRAc/LpuwPWu17k0qaFCnANAgHSvKJcZdMCxJtgOsQuKsexG2uCwMxa8O8aUa/axHZCe/OUZA42ag0Avqi5ll2nYSAaRQEbZI+NrbKwEFFYJURCiEcpqEE0aZOmBfH/f4PLQ+OEttwxLKg3jq5Or3TG9jyOJ/FjgSIGZvBRLhB1oFvi7/3X5CIDhZHodOLtfyyEXUlh0IGzyDoQM+rbGljFRNaE2ZOXj0MT3pALxGQo8v1z1ILRBb6+hTJoZgLvBoMYRjZAeALuv/v/hZCzeTxWRIu/iwEvbqQMmKcxUekwHqF/KQSo74OCVX8rCyQoC9C/QYBZENZTcYMlRkqjWFlVZfn9OWGXwcoDVFKewD+fo33v9AwQD3HGFqH5XsXHACWVA7BObfp+YyoL4BKpLvb+MuvBlVn1q03iwIONVNFy1jPUBvGyPOaGJT4GGOPAHd9v66bIuy7Pi3p5GKoTrYSdeRXaQrk7LD02P2Gbejv2FqrYdugFxgHM5ChBEFNpIn/czxaObdMJrcXP4Z94sdxZUGZmAZmA+7ws0im4a9oenFQsKg58uE8NhBgE43+LlBysa65FmvJweIppMzobsmJKWve+EFrMsUJ3+wEqGaUKPA9XkSYNhj0xUd8xYkbBsU516lnMhv+LFs1nKCX7BZYVjIUQZ8FC830PRjG6LnSqBzCSPcloP0U9IaLZhknntlynSGhOS+yV/bWuEla1EPwSONXdAc0VKYv4ZcyoWQBGEDp/2zdI/zyrYgfyR6CAL7nm18BC18pJFnlLhuUMsScgvs9CwjrXyOgCq/Q9yIQpBa0Q/DqW6+JoJSNX9AGNT4S2uezhx8B9kBvu2AZGjpQubwLRglHKLnX6Z7DodmgBQjDHkji7O3+MoFFZgITx+pLiMdiChL1G7DUL8DWQLBDPw3dGh5Yjn38YT+TuMrhuvy71HbGiGyzRAg8DVYQQzO49evYg7ArLiP7v82/7n3OcZ8u6F36+IzjfVCqivwkTetqNCHpP2nvdfS74PJTr7zH+NM9pTflPwTMbcN1YkgEwFcL7EXIddf85LQ1SrtZ8FsO6uh13w7Abt02nZ7tjbiuR1+2Xn2COYPxaCCM3+KCqQz86fnpDSgOkPQg+i/dtb8E6P/zUt8Vln+/pF4fVD7D103Gbz8B8cIbULeJlHXqLM2ZQZDHEuGMnpsF+m0Alpfk+pKmAtZdCJNf5wUGJYAervRB8eggotSH2SlAy2myBchi14VbCxKlzka+BScWCqofBUASYCbsVKAQzD65g7CbmEl9OCTQtocEm74ysiPsq6imhilLVxANyUfR2o9i0SN7YstH8DP+9db+DYcD/iFsgqnXWd02SXAc9CrLpx124yFd2w35HlQ4tEPCHxPwO9haY7oG1NbQbMnLPYPbw2YNIMYAlxeTIDlP+WP0axAUhTrGzefUXEeK+kXetvU3DUDQtqdxKSQwJG1romIbQSLWhfuChFRioG92rsP//c3AiwbErxfKxBMoFf/am5cyPc+899/hDkTOJHZ4IKMQQrC6irDZTh+YVa9VHlsbuyK6uEe7tINCdK9hVutGkUgL/S0pox5cEchPX2X9qrXVfuIQIoAcsDN2sj+yb5XuVU8JZlgkpZ+PMzMbhvG0AwKqfteh6O3VZbqL8J4tNhggAluxxBgaNEIK7A/BNWvkWC7DCV/X+3qsMU0+LkqiS75NyMUhD+LqqrjdT51TPlQeAVTZ11nXpW1nm1sDOWhA1blBBcGEincwV1crqwV7Vq6r0U8ZxiCEevONwtzaaKnGS6X3lCGRHSwaAuyzU4Uyr5tjaLv4wL6+cm3BbxwFw9pSujJsfowBY2UfAutHeyRftZGwXb4RxY2+XDQHAgQGAlblMHI382xeRABwnSicBpyDYjS/HADYILhiYFAMA6k8DUDgANCQAfue0bPy3AeC3QD48AGK2gHLOgJFwAKhDENfgvwkArkGGCH0SDcAuEeKp8MhQYcEAtFT4EU2Fn9nB0HvJAExQHEMwRIfDogFgw2GI7eGXIhkANyESlxITvQLc/2UwAO+cLILgW4BMikIg46TF01QwAGxaHOwBuoI9uQBwhRGMPbs09nouFwCo3fAlLG6GCooFAMVRrGVaXTUz5XGxAHjK44xAQioArUBiZgskYiUyUrcAKhygdDEiqT2xPACZDS6qSe2+y04hIROAFM5aSO6F2qe5pmxDAMBJivJCydFhqsiOK9SHhQLQNb/ahTHFycsglh7EFogB4IQUSyORsqT841Aay8aBxR7VqYlQHPfK33SysAUVwY/qzF/ZO5kRfKLljAkidJMfZaEPgJXVD+ubNnUZqL0yS0upwKAOWidW7ZY++UhSIRQxp79KmAvth8sIha5Q8VZJ0B6YdquFaZlBTjyl7UMQEQcXyG8fZ93TN+MHCJv75l4bzWQ3+RhlRI8A2UzGozpEdpvjgSDRYALh7TY6qS+PWpHvBcT9nmdizk+nmQHsNq+xAHoRuLkYt21k32qlQ/01D0es0gVUCIcAZUimdbG+u7z/XOP7PQgsiu395WpbNKUKaEKqNmbyeZFoNiEKOscrDHkf1bxpmz91GdZY2HWHhjWHlt3kRc6bS/I2IoijIkyadZ7nJTNZU5PpByHAAmhXvkgfGqXUACY77fOc5h2SeXRciTNQ2Gkef56oOAsNtF1KQwCRIN/9CxqFZII8E5WXFpdFiZeW2oNHyRrIhSAfGrMHUCUfrKN8yAI+oYyUkFK2HaVFW2khtR/rPzDal+UkZGjwzOMAwRSJkReScwyi5QGdEvxI2wqZSEdNeGryRNYl018dT9X/zlIzndt0eHR4MNSnVXyPgoAGR3tKYidJ8dOa4PRCTTD2eRl7CUyEmAqirIHqbuxveuOcAjIuApwAHjNFKqmC5lsZIdH8zGuuzp8mYJQCTgGo/FARix7KMSQzYzn8vAAU8gFGcPQS+DJ8AH4rndH8PqQ3S35yd2U7isNAMFHasWw/WcopQhRBIBICQsggJCIx/P9XrTMcDWbZY5YQs36Yh4EZXNXl7vJB3Hkjd7fCkCfc3/ZGbgh4zp5xwYbuBdBWGr00pF2OrT0E6p/sIH6V1uRHTANeDv1NE/j4rB1mFYMHgTYJsJtnrGORL1W9w107NA4/u+gqjL+cFXprU2+cbSvA828GxFKImwRmLpDiji6WwCdvsuDjOU1MA7iI+WzXBj4MmfFpQKuAeC7wOdss6n8afe8qjaUaqNdRWoeEPt1g4wPGpFkMUJKuIruDAaA/ahsToVmXr4NnYanq4GI4eq4waLKJZxADYF12MvFIEO3EZKPLTMxxhADo1ztK0zgtxIND3JhieKnTeKEEhacT4F9OHOB+qRkMXHZwcCOzgwxFv76IfKszMxgg4bqNDDa26cSs01hsmKMtDlj9X8La4sfAdHkvHn6vHhngtGcGAJT+EX+3RxnwDDV+GPf7rIYUQGQa/tyj3RFA063GwN4f98cAJT6f3HaIDaukO1FS8GCuMTCveGz10yhJvIWGP+rWolKSFkMtEw7LvuaGMa/yW/y208iO8GMxXEXslnRnE8LrUyEFIpqhht8edb5aRWNeawzYLJMvnxhQsMKZw16KHw2RzoC7iF+dCOJ0PGX2a/Hj0sNFA5gIPl4zDFD+KzX8dfzhoyh0zwCzP/nrREA8MQu0HtjOSHTeAcwDxcDVPt/d1iGQVygQiKx2rq1FIPh4BX7MA/G5AOEwCNZKBN3PjuJEbCLX0cZgVL90kY6SxFcW5E4EZegTq9N+ECssdszWyZ8X/DX4UYc+n+oydFx7SgR0Z4sogEzWgc684x6s9PV1GMS6DbsmguGMc9IRBUC4HM3d+w+d9jIlAxKOIi0R2A5z85HkHWRDCiQV5YIxR8PP7KWAfiblsSxyV++P6tDhQz5dBS38emLfhV9ZkKa/Q8xknKAdu04Fiw/OLfKssFCLAJf1xEH4PZpQ3ZBvMCdddcvejxLhE3hO8KnkzQ7hX8t/LfvdnwAiiz327IoCli9jwUFxQP8l9kBgLKzNvhX/Pc/zpo+JqD4M+NpBEVzlAjeaNqkYA4Hv00s8wetswJDj6/BPfQNOKlCAsN7+rIPtSMjXKy4SIH8rBGoBEPCkqGYHx8XMfx3+wUdombE9RzhfBg8ocIPDUnHAfULgr0JP1R8Vs13kovZvEq2TqfCbsC1xMkXFzsY46RxsPxuQioRWCQC/RA5AFPhUCL9cL6JW+j+Dz1rXTfuXPzaSiNEcY3XHgT3YLRvCheSeBQR5oKpdIQfLS6WQUM4mA8e9Qa/7TWPCf/FpfLwcIgU6B0zBGe6zWVklMlQ8jD2/BX0mg3pjLkUo07jcZIsWPEP0OvwgA9l78r9vBAT5jB5QcESjYDlRvpsuN01dES/lnEupfqQeVKtmtMx2+dBhJ/APmHSdaWGW+rERPyymAVKgtRMq5rYIg2g4z/P9YbFY7PN8PoyC4wuI/QH8yUokxDIu/Ofk7YVFFmllSyfhjJCxFvIXaqa99Ah+MKnF2KzBf0dBElbrAdNk8IAKbL9/txJIlK1EajT8Yzb0hTXb2pjC/7k5X55qvqzCxHT458mL4M10iDL4bsMSEuxGifDeAv5RBcBFPDsEWMq/H3vmOttlIbhFzKt8v5SBL/hquW85QBL+Xvmuk3+W/H2CfyuDccvBIrKxsP859jb0LNqvy1RweK/gYwMCiZDVKMsDdlLCr2m4vEWBD+bTTcFFCu8XfI0Dr53XjbL9yeRh/dNgo0+yo+10s1LcJW+O/ryo05IQ8ricZYt5pGg4Wr6bxo6/taP5YTprKh624AmYavn+urVgfC6F9KpSef7JYTtQ7jcInLYFyhcP8sMkW27KwudCcA/I+4f+Tgnn+a5CKCT3SVWs6ros63q1qgg9/do7vY3+L6H/0a4dqgAAg1AULYPBsjax+P//uA3TwuJAxj3RJiYf7xJ5rBVVLNzHcA8T7fkZl6iePpchSDvs8b9XBwAAAAAAqGQCc31B4/xqSwwAAAAASUVORK5CYII=";var ProgressBar=class extends Renderable{#boundOnProgressUpdate;#boundResize;constructor(x,y,w,h){super(x,y,w,h);this.barHeight=h;this.anchorPoint.set(0,0);this.#boundOnProgressUpdate=this.onProgressUpdate.bind(this);this.#boundResize=this.resize.bind(this);eventEmitter.addListener(LOADER_PROGRESS,this.#boundOnProgressUpdate);eventEmitter.addListener(VIEWPORT_ONRESIZE,this.#boundResize);this.anchorPoint.set(0,0);this.progress=0}onProgressUpdate(progress){this.progress=~~(progress*this.width);this.isDirty=true}draw(renderer2,viewport){renderer2.setColor("black");renderer2.fillRect(this.pos.x,viewport.centerY,renderer2.width,this.barHeight/2);renderer2.setColor("#55aa00");renderer2.fillRect(this.pos.x,viewport.centerY,this.progress,this.barHeight/2)}onDestroyEvent(){eventEmitter.removeListener(LOADER_PROGRESS,this.#boundOnProgressUpdate);eventEmitter.removeListener(VIEWPORT_ONRESIZE,this.#boundResize)}};var DefaultLoadingScreen=class extends Stage{onResetEvent(){const barHeight=8;game.world.backgroundColor.parseCSS("#202020");game.world.addChild(new ProgressBar(0,renderer.height/2,renderer.width,barHeight),1);load2({name:"melonjs_logo",type:"image",src:melonjs_logo_default},()=>{game.world.addChild(new Sprite(renderer.width/2,renderer.height/2,{image:"melonjs_logo",framewidth:256,frameheight:256}),2)})}onDestroyEvent(){unload2({name:"melonjs_logo",type:"image"})}};var loadingscreen_default=DefaultLoadingScreen;var _state=-1;var _animFrameId=-1;var _isPaused=false;var _stages={};var _fade={color:"",duration:0};var _onSwitchComplete=null;var _extraArgs=null;var _pauseTime=0;function _startRunLoop(){if(_animFrameId===-1&&_state!==-1){_animFrameId=globalThis.requestAnimationFrame(_renderFrame)}}function _resumeRunLoop(){if(_isPaused&&_state!==-1){_isPaused=false}}function _pauseRunLoop(){_isPaused=true}function _renderFrame(time){eventEmitter.emit(TICK,time);if(_animFrameId!==-1){_animFrameId=globalThis.requestAnimationFrame(_renderFrame)}}function _stopRunLoop(){globalThis.cancelAnimationFrame(_animFrameId);_animFrameId=-1}function _switchState(state2){_stopRunLoop();if(_stages[_state]){_stages[_state].stage.destroy()}if(_stages[state2]){_state=state2;_stages[_state].stage.reset.apply(_stages[_state].stage,_extraArgs);_startRunLoop();eventEmitter.emit(STATE_CHANGE);if(_onSwitchComplete){_onSwitchComplete()}}}eventEmitter.addListenerOnce(BOOT,()=>{state.set(state.LOADING,new loadingscreen_default);state.set(state.DEFAULT,new Stage);eventEmitter.addListenerOnce(VIDEO_INIT,()=>{state.change(state.DEFAULT,true)})});var state={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,stop(pauseTrack2=false){if(_state!==this.LOADING&&this.isRunning()){_stopRunLoop();if(pauseTrack2===true){pauseTrack2()}_pauseTime=globalThis.performance.now();eventEmitter.emit(STATE_STOP)}},pause(music=false){if(_state!==this.LOADING&&!this.isPaused()){_pauseRunLoop();if(music===true){pauseTrack()}_pauseTime=globalThis.performance.now();eventEmitter.emit(STATE_PAUSE)}},restart(music=false){if(!this.isRunning()){_startRunLoop();if(music===true){resumeTrack()}_pauseTime=globalThis.performance.now()-_pauseTime;eventEmitter.emit(STATE_RESTART,_pauseTime)}},resume(music=false){if(this.isPaused()){_resumeRunLoop();if(music===true){resumeTrack()}_pauseTime=globalThis.performance.now()-_pauseTime;eventEmitter.emit(STATE_RESUME,_pauseTime)}},isRunning(){return _animFrameId!==-1},isPaused(){return _isPaused},set(state2,stage,start=false){if(!(stage instanceof Stage)){throw new Error(stage+" is not an instance of me.Stage")}_stages[state2]={};_stages[state2].stage=stage;_stages[state2].transition=true;if(start===true){this.change(state2)}},get(state2=_state){if(typeof _stages[state2]!=="undefined"){return _stages[state2].stage}else{return void 0}},current(){return this.get()},transition(effect,color,duration){if(effect==="fade"){_fade.color=color;_fade.duration=duration}},setTransition(state2,enable2){_stages[state2].transition=enable2},change(state2,forceChange=false){if(typeof _stages[state2]==="undefined"){throw new Error("Undefined Stage for state '"+state2+"'")}if(!this.isCurrent(state2)){_extraArgs=null;if(arguments.length>2){_extraArgs=Array.prototype.slice.call(arguments,2)}if(_fade.duration&&_stages[state2].transition){_onSwitchComplete=()=>{game.viewport.fadeOut(_fade.color,_fade.duration)};game.viewport.fadeIn(_fade.color,_fade.duration,function(){defer(_switchState,this,state2)})}else{if(forceChange===true){_switchState(state2)}else{defer(_switchState,this,state2)}}}},isCurrent(state2){return _state===state2}};var state_default=state;var Timer=class{constructor(){this.tick=1;this.fps=0;this.maxfps=60;this.interpolation=false;this.framecount=0;this.framedelta=0;this.last=0;this.now=0;this.delta=0;this.step=0;this.minstep=0;this.timers=[];this.timerId=0;eventEmitter.addListenerOnce(BOOT,()=>{this.reset();this.now=this.last=0;eventEmitter.addListener(GAME_BEFORE_UPDATE,time=>{this.update(time)})});eventEmitter.addListener(STATE_RESUME,()=>{this.reset()});eventEmitter.addListener(STATE_RESTART,()=>{this.reset()});eventEmitter.addListener(STATE_CHANGE,()=>{this.reset()})}reset(){this.last=this.now=globalThis.performance.now();this.delta=0;this.framedelta=0;this.framecount=0;this.step=Math.ceil(1e3/this.maxfps);this.minstep=1e3/this.maxfps*1.25}setTimeout(fn,delay,pauseable,...args){this.timers.push({fn:fn,delay:delay,elapsed:0,repeat:false,timerId:++this.timerId,pauseable:pauseable??true,args:args});return this.timerId}setInterval(fn,delay,pauseable,...args){this.timers.push({fn:fn,delay:delay,elapsed:0,repeat:true,timerId:++this.timerId,pauseable:pauseable===true||true,args:args});return this.timerId}clearTimeout(timeoutID){if(timeoutID>0){defer(()=>{this.clearTimer(timeoutID)},this)}}clearInterval(intervalID){if(intervalID>0){defer(()=>{this.clearTimer(intervalID)},this)}}getTime(){return this.now}getDelta(){return this.delta}countFPS(){this.framecount++;this.framedelta+=this.delta;if(this.framecount%10===0){this.fps=clamp(Math.round(1e3*this.framecount/this.framedelta),0,this.maxfps);this.framedelta=0;this.framecount=0}}update(time){this.last=this.now;this.now=time;this.delta=this.now-this.last;if(this.delta<0){this.delta=0}this.tick=this.delta>this.minstep&&this.interpolation?this.delta/this.step:1;this.updateTimers()}clearTimer(timerId2){for(let i=0;i<this.timers.length;i++){if(this.timers[i].timerId===timerId2){this.timers.splice(i,1);break}}}updateTimers(){for(const timer2 of this.timers){if(!(timer2.pauseable&&state_default.isPaused())){timer2.elapsed+=this.delta}if(timer2.elapsed>=timer2.delay){timer2.fn(...timer2.args);if(timer2.repeat){timer2.elapsed-=timer2.delay}else{this.clearTimer(timer2.timerId)}}}}};var timer=new Timer;var timer_default=timer;var Particle=class extends Renderable{constructor(emitter){super(emitter.getRandomPointX(),emitter.getRandomPointY(),emitter.settings.image.width,emitter.settings.image.height);this.vel=vector2dPool.get();this.onResetEvent(emitter,true)}onResetEvent(emitter,newInstance=false){if(!newInstance){this.pos.set(emitter.getRandomPointX(),emitter.getRandomPointY());this.resize(emitter.settings.image.width,emitter.settings.image.height);this.currentTransform.identity()}this.image=emitter.settings.image;this.alwaysUpdate=true;if(typeof emitter.settings.tint==="string"){this.tint.parseCSS(emitter.settings.tint)}this.blendMode=emitter.settings.textureAdditive?"additive":"normal";if(emitter.settings.blendMode!=="normal"){this.blendMode=emitter.settings.blendMode}const angle=emitter.settings.angle+(emitter.settings.angleVariation>0?(randomFloat(0,2)-1)*emitter.settings.angleVariation:0);const speed=emitter.settings.speed+(emitter.settings.speedVariation>0?(randomFloat(0,2)-1)*emitter.settings.speedVariation:0);this.vel.set(speed*Math.cos(angle),-speed*Math.sin(angle));this.life=randomFloat(emitter.settings.minLife,emitter.settings.maxLife);this.startLife=this.life;this.startScale=clamp(randomFloat(emitter.settings.minStartScale,emitter.settings.maxStartScale),emitter.settings.minStartScale,emitter.settings.maxStartScale);this.endScale=clamp(randomFloat(emitter.settings.minEndScale,emitter.settings.maxEndScale),emitter.settings.minEndScale,emitter.settings.maxEndScale);this.gravity=emitter.settings.gravity;this.wind=emitter.settings.wind;this.followTrajectory=emitter.settings.followTrajectory;this.onlyInViewport=emitter.settings.onlyInViewport;this._deltaInv=timer_default.maxfps/1e3;if(!emitter.settings.followTrajectory){this._angle=randomFloat(emitter.settings.minRotation,emitter.settings.maxRotation)}this.alive=true}update(dt){const skew=dt*this._deltaInv;this.life=this.life>dt?this.life-dt:0;if(this.alive&&this.life<=0){const parent=this.ancestor;parent.removeChild(this,true);particlePool.release(this);this.alive=false;return false}const ageRatio=this.life/this.startLife;let scale2=this.startScale;if(this.startScale>this.endScale){scale2*=ageRatio;scale2=scale2<this.endScale?this.endScale:scale2}else if(this.startScale<this.endScale){scale2/=ageRatio;scale2=scale2>this.endScale?this.endScale:scale2}this.alpha=ageRatio;this.vel.x+=this.wind*skew;this.vel.y+=this.gravity*skew;const angle=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this._angle;this.pos.x+=this.vel.x*skew;this.pos.y+=this.vel.y*skew;this.currentTransform.setTransform(scale2,0,0,0,scale2,0,this.pos.x,this.pos.y,1).rotate(angle);this.isDirty=this.inViewport||!this.onlyInViewport;return super.update(dt)}draw(renderer2){const w=this.width;const h=this.height;renderer2.drawImage(this.image,0,0,w,h,-w/2,-h/2,w,h)}};var particlePool=createPool(emitter=>{const instance=new Particle(emitter);return{instance:instance,reset(emitter2){instance.onResetEvent(emitter2,false)}}});var LOG2_PAGE_SIZE=9;var PAGE_SIZE=1<<LOG2_PAGE_SIZE;var Glyph=class{constructor(){this.id=0;this.x=0;this.y=0;this.width=0;this.height=0;this.u=0;this.v=0;this.u2=0;this.v2=0;this.xoffset=0;this.yoffset=0;this.xadvance=0;this.fixedWidth=false}getKerning(ch){if(this.kerning){const page=this.kerning[ch>>>LOG2_PAGE_SIZE];if(page){return page[ch&PAGE_SIZE-1]||0}}return 0}setKerning(ch,value){if(!this.kerning){this.kerning={}}let page=this.kerning[ch>>>LOG2_PAGE_SIZE];if(typeof page==="undefined"){this.kerning[ch>>>LOG2_PAGE_SIZE]={};page=this.kerning[ch>>>LOG2_PAGE_SIZE]}page[ch&PAGE_SIZE-1]=value}};var capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function getValueFromPair(string,pattern){const value=string.match(pattern);if(!value){throw new Error(`${`Could not find pattern ${pattern}`} in string: ${string}`)}return value[0].split("=")[1]}function getFirstGlyph(glyphs){const keys=Object.keys(glyphs);for(let i=0;i<keys.length;i++){if(parseInt(keys[i])>32){return glyphs[keys[i]]}}return null}function createSpaceGlyph(glyphs){const spaceCharCode=" ".charCodeAt(0);let glyph=glyphs[spaceCharCode];if(!glyph){glyph=new Glyph;glyph.id=spaceCharCode;const firstGlyph=getFirstGlyph(glyphs);glyph.xadvance=firstGlyph!==null?firstGlyph.xadvance:0;glyphs[spaceCharCode]=glyph}}var BitmapTextData=class{constructor(data2){this.padTop=0;this.padRight=0;this.padBottom=0;this.padLeft=0;this.lineHeight=0;this.capHeight=1;this.descent=0;this.glyphs={};this.parse(data2)}parse(fontData){if(!fontData){throw new Error("File containing font data was empty, cannot load the bitmap font.")}const lines=fontData.split(/\r\n|\n/);const padding=fontData.match(/padding=\d+,\d+,\d+,\d+/g);if(!padding){throw new Error("Padding not found in first line")}const paddingValues=padding[0].split("=")[1].split(",");this.padTop=parseFloat(paddingValues[0]);this.padLeft=parseFloat(paddingValues[1]);this.padBottom=parseFloat(paddingValues[2]);this.padRight=parseFloat(paddingValues[3]);this.lineHeight=parseFloat(getValueFromPair(lines[1],/lineHeight=\d+/g));this.capHeight=1;this.descent=0;this.glyphs={};const baseLine=parseFloat(getValueFromPair(lines[1],/base=\d+/g));const padY=this.padTop+this.padBottom;let glyph=null;for(let i=4;i<lines.length;i++){const line=lines[i];const characterValues=line.split(/=|\s+/);if(!line||/^kernings/.test(line)){continue}if(/^kerning\s/.test(line)){const first=parseFloat(characterValues[2]);const second=parseFloat(characterValues[4]);const amount=parseFloat(characterValues[6]);glyph=this.glyphs[first];if(glyph!==null&&typeof glyph!=="undefined"){glyph.setKerning(second,amount)}}else{glyph=new Glyph;const ch=parseFloat(characterValues[2]);glyph.id=ch;glyph.x=parseFloat(characterValues[4]);glyph.y=parseFloat(characterValues[6]);glyph.width=parseFloat(characterValues[8]);glyph.height=parseFloat(characterValues[10]);glyph.xoffset=parseFloat(characterValues[12]);glyph.yoffset=parseFloat(characterValues[14]);glyph.xadvance=parseFloat(characterValues[16]);if(glyph.width>0&&glyph.height>0){this.descent=Math.min(baseLine+glyph.yoffset,this.descent)}this.glyphs[ch]=glyph}}this.descent+=this.padBottom;createSpaceGlyph(this.glyphs);let capGlyph=null;for(let i=0;i<capChars.length;i++){const capChar=capChars[i];capGlyph=this.glyphs[capChar.charCodeAt(0)];if(capGlyph){break}}if(!capGlyph){for(const charCode in this.glyphs){if(Object.prototype.hasOwnProperty.call(this.glyphs,charCode)){glyph=this.glyphs[charCode];if(glyph.height===0||glyph.width===0){continue}this.capHeight=Math.max(this.capHeight,glyph.height)}}}else{this.capHeight=capGlyph.height}this.capHeight-=padY}};var bitmapTextDataPool=createPool(fontData=>{const instance=new BitmapTextData(fontData);return{instance:instance,reset(fontData2){instance.parse(fontData2)}}});var pools={vector2d:vector2dPool,vector3d:vector3dPool,point:pointPool,matrix2d:matrix2dPool,matrix3d:matrix3dPool,bounds:boundsPool,color:colorPool,polygon:polygonPool,line:linePool,rectangle:rectPool,roundedRectangle:roundedRectanglePool,ellipse:ellipsePool,tween:tweenPool,particle:particlePool,bitmapTextData:bitmapTextDataPool};var getPool=key=>{return pools[key]};var getTotalPoolSize=()=>{let totalSize=0;for(const key in pools){totalSize+=pools[key].size()}return totalSize};var ObjectPool=class{constructor(){this.objectClass={};this.instance_counter=0}register(className,classObj,recycling=false){if(typeof classObj!=="undefined"){this.objectClass[className]={class:classObj,pool:recycling?[]:void 0}}else{throw new Error("Cannot register object '"+className+"', invalid class")}}pull(name,...args){const className=this.objectClass[name];if(className){const proto=className["class"];const poolArray=className.pool;let obj;if(poolArray&&(obj=poolArray.pop())){obj.onResetEvent.apply(obj,args);this.instance_counter--}else{obj=new(proto.bind.apply(proto,[proto,...args]));if(poolArray){obj.className=name}}return obj}throw new Error("Cannot instantiate object of type '"+name+"'")}purge(){for(const className in this.objectClass){if(this.objectClass[className]){this.objectClass[className].pool=[]}}this.instance_counter=0}push(obj,throwOnError=true){if(!this.poolable(obj)){if(throwOnError===true){throw new Error("me.pool: object "+obj+" cannot be recycled")}else{return false}}this.objectClass[obj.className].pool.push(obj);this.instance_counter++;return true}exists(name){return name in this.objectClass}poolable(obj){const className=obj.className;return typeof className!=="undefined"&&typeof obj.onResetEvent==="function"&&className in this.objectClass&&typeof this.objectClass[className].pool!=="undefined"}getInstanceCount(){return this.instance_counter+getTotalPoolSize()}};var pool=new ObjectPool;var legacy_pool_default=pool;var Body=class{constructor(ancestor,shapes,onBodyUpdate){this.ancestor=ancestor;if(typeof this.bounds==="undefined"){this.bounds=boundsPool.get()}if(typeof this.shapes==="undefined"){this.shapes=[]}this.collisionMask=collision.types.ALL_OBJECT;this.collisionType=collision.types.ENEMY_OBJECT;if(typeof this.vel==="undefined"){this.vel=vector2dPool.get()}this.vel.set(0,0);if(typeof this.force==="undefined"){this.force=vector2dPool.get()}this.force.set(0,0);if(typeof this.friction==="undefined"){this.friction=vector2dPool.get()}this.friction.set(0,0);this.bounce=0;this.mass=1;if(typeof this.maxVel==="undefined"){this.maxVel=vector2dPool.get()}this.maxVel.set(490,490);this.isStatic=false;this.gravityScale=1;this.ignoreGravity=false;this.falling=false;this.jumping=false;if(typeof onBodyUpdate==="function"){this.onBodyUpdate=onBodyUpdate}this.bounds.clear();if(typeof shapes!=="undefined"){if(Array.isArray(shapes)){for(let s=0;s<shapes.length;s++){this.addShape(shapes[s])}}else{this.addShape(shapes)}}this.ancestor.isKinematic=false}setStatic(isStatic=true){this.isStatic=isStatic===true}addShape(shape){if(shape instanceof Rect||shape instanceof Bounds){const poly=shape.toPolygon();this.shapes.push(poly);this.bounds.add(poly.points);this.bounds.translate(poly.pos)}else if(shape instanceof Ellipse){if(!this.shapes.includes(shape)){this.shapes.push(shape)}this.bounds.addBounds(shape.getBounds());this.bounds.translate(shape.getBounds().x,shape.getBounds().y)}else if(shape instanceof Polygon){if(!this.shapes.includes(shape)){this.shapes.push(shape)}this.bounds.add(shape.points);this.bounds.translate(shape.pos)}else if(shape instanceof Point){if(!this.shapes.includes(shape)){this.shapes.push(shape)}this.bounds.addPoint(shape)}else{this.fromJSON(shape)}if(typeof this.onBodyUpdate==="function"){this.onBodyUpdate(this)}return this.shapes.length}setVertices(vertices,index=0,clear=true){const polygon=this.getShape(index);if(polygon instanceof Polygon){polygon.setShape(0,0,vertices)}else{this.shapes[index]=pointPool.get(0,0,vertices)}this.bounds.add(this.shapes[index].points,clear);if(typeof this.onBodyUpdate==="function"){this.onBodyUpdate(this)}}addVertices(vertices,index=0){this.setVertices(vertices,index,false)}fromJSON(json,id){let data2=json;if(typeof id!=="undefined"){data2=json[id]}if(typeof data2==="undefined"){throw new Error("Identifier ("+id+") undefined for the given JSON object)")}if(data2.length){for(let i=0;i<data2.length;i++){this.addVertices(data2[i].shape,i)}this.mass=data2[0].density||0;this.friction.set(data2[0].friction||0,data2[0].friction||0);this.bounce=data2[0].bounce||0}return data2.length}getShape(index){return this.shapes[index||0]}getBounds(){return this.bounds}removeShape(shape){this.bounds.clear();remove(this.shapes,shape);for(let s=0;s<this.shapes.length;s++){this.addShape(this.shapes[s])}return this.shapes.length}removeShapeAt(index){return this.removeShape(this.getShape(index))}setCollisionMask(bitmask=collision.types.ALL_OBJECT){this.collisionMask=bitmask}setCollisionType(type){if(typeof type!=="undefined"){if(typeof collision.types[type]!=="undefined"){this.collisionType=collision.types[type]}else{throw new Error("Invalid value for the collisionType property")}}}respondToCollision(response){const overlap=response.overlapV;this.ancestor.pos.sub(overlap);if(overlap.x!==0){this.vel.x=~~(.5+this.vel.x-overlap.x)||0;if(this.bounce>0){this.vel.x*=-this.bounce}}if(overlap.y!==0){this.vel.y=~~(.5+this.vel.y-overlap.y)||0;if(this.bounce>0){this.vel.y*=-this.bounce}if(!this.ignoreGravity){const dir=this.falling===true?1:this.jumping===true?-1:0;this.falling=overlap.y>=dir;this.jumping=overlap.y<=-dir}}}forEach(callback,thisArg){let i=0;const shapes=this.shapes;const len=shapes.length;if(typeof callback!=="function"){throw new Error(callback+" is not a function")}while(i<len){callback.call(thisArg??this,shapes[i],i,shapes);i++}}contains(...args){let _x;let _y;if(args.length===2){[_x,_y]=args}else{[_x,_y]=[args[0].x,args[0].y]}if(this.getBounds().contains(_x,_y)){for(let i=this.shapes.length,shape;i--,shape=this.shapes[i];){if(shape.contains(_x,_y)){return true}}}return false}rotate(angle,v=this.getBounds().center){if(angle!==0){this.bounds.clear();this.forEach(shape=>{shape.rotate(angle,v);this.bounds.addBounds(shape.getBounds())})}return this}setMaxVelocity(x,y){this.maxVel.x=x;this.maxVel.y=y}setFriction(x=0,y=0){this.friction.x=x;this.friction.y=y}update(){const deltaTime=timer_default.tick;if(this.force.x!==0){this.vel.x+=this.force.x*deltaTime}if(this.force.y!==0){this.vel.y+=this.force.y*deltaTime}if(this.friction.x>0){const fx=this.friction.x*deltaTime;const nx=this.vel.x+fx;const x=this.vel.x-fx;this.vel.x=nx<0?nx:x>0?x:0}if(this.friction.y>0){const fy=this.friction.y*deltaTime;const ny=this.vel.y+fy;const y=this.vel.y-fy;this.vel.y=ny<0?ny:y>0?y:0}if(this.vel.y!==0){this.vel.y=clamp(this.vel.y,-this.maxVel.y,this.maxVel.y)}if(this.vel.x!==0){this.vel.x=clamp(this.vel.x,-this.maxVel.x,this.maxVel.x)}this.falling=this.vel.y*Math.sign(this.force.y)>0;this.jumping=this.falling?false:this.jumping;this.ancestor.pos.add(this.vel);return this.vel.x!==0||this.vel.y!==0}destroy(){boundsPool.release(this.bounds);vector2dPool.release(this.vel);vector2dPool.release(this.force);vector2dPool.release(this.friction);vector2dPool.release(this.maxVel);this.shapes.forEach(shape=>{if(shape instanceof Point){pointPool.release(shape)}else if(shape instanceof Line){linePool.release(shape)}else if(shape instanceof Polygon){polygonPool.release(shape)}else if(shape instanceof Ellipse){ellipsePool.release(shape)}else{legacy_pool_default.push(shape)}});this.onBodyUpdate=void 0;this.ancestor=void 0;this.bounds=void 0;this.vel=void 0;this.force=void 0;this.friction=void 0;this.maxVel=void 0;this.shapes.length=0;this.setStatic(false)}};var VertexArrayBuffer=class{constructor(vertex_size,vertex_per_obj){this.vertexSize=vertex_size;this.objSize=vertex_per_obj;this.maxVertex=256;this.vertexCount=0;this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize);this.bufferF32=new Float32Array(this.buffer);this.bufferU32=new Uint32Array(this.buffer)}clear(){this.vertexCount=0}isFull(vertex=this.objSize){return this.vertexCount+vertex>=this.maxVertex}resize(vertexCount){while(vertexCount>this.maxVertex){this.maxVertex<<=1}const data2=this.bufferF32;this.buffer=new ArrayBuffer(this.maxVertex*this.vertexSize*this.objSize);this.bufferF32=new Float32Array(this.buffer);this.bufferU32=new Uint32Array(this.buffer);this.bufferF32.set(data2);return this}push(x,y,u,v,tint){let offset=this.vertexCount*this.vertexSize;if(this.vertexCount>=this.maxVertex){this.resize(this.vertexCount)}this.bufferF32[offset]=x;this.bufferF32[++offset]=y;if(typeof u!=="undefined"){this.bufferF32[++offset]=u;this.bufferF32[++offset]=v}if(typeof tint!=="undefined"){this.bufferU32[++offset]=tint}this.vertexCount++;return this}toFloat32(begin,end){if(typeof end!=="undefined"){return this.bufferF32.subarray(begin,end)}else{return this.bufferF32}}toUint32(begin,end){if(typeof end!=="undefined"){return this.bufferU32.subarray(begin,end)}else{return this.bufferU32}}length(){return this.vertexCount}isEmpty(){return this.vertexCount===0}};var Compositor=class{constructor(renderer2,settings){this.init(renderer2,settings)}init(renderer2,settings){this.renderer=renderer2;this.gl=renderer2.gl;this.color=renderer2.currentColor;this.viewMatrix=renderer2.currentTransform;this.defaultShader=void 0;this.currentShader=void 0;this.mode=this.gl.TRIANGLES;this.attributes=[];this.vertexByteSize=0;this.vertexSize=0;this.vertexData=null;if(typeof settings!=="undefined"&&Array.isArray(settings.attributes)){settings.attributes.forEach(attr=>{this.addAttribute(attr.name,attr.size,attr.type,attr.normalized,attr.offset);this.vertexData=new VertexArrayBuffer(this.vertexSize,6)})}else{throw new Error("attributes definition missing")}if(typeof settings!=="undefined"&&typeof settings.shader!=="undefined"){this.defaultShader=new GLShader(this.gl,settings.shader.vertex,settings.shader.fragment)}else{throw new Error("shader definition missing")}}reset(){this.gl=this.renderer.gl;this.vertexData.clear()}bind(){if(this.renderer.currentProgram!==this.defaultShader.program){this.useShader(this.defaultShader)}}useShader(shader){if(this.renderer.currentProgram!==shader.program){this.flush();shader.bind();shader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix);shader.setVertexAttributes(this.gl,this.attributes,this.vertexByteSize);this.currentShader=shader;this.renderer.currentProgram=this.currentShader.program}}addAttribute(name,size,type,normalized,offset){this.attributes.push({name:name,size:size,type:type,normalized:normalized,offset:offset});switch(type){case this.gl.BYTE:this.vertexByteSize+=size*Int8Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_BYTE:this.vertexByteSize+=size*Uint8Array.BYTES_PER_ELEMENT;break;case this.gl.SHORT:this.vertexByteSize+=size*Int16Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_SHORT:this.vertexByteSize+=size*Uint16Array.BYTES_PER_ELEMENT;break;case this.gl.INT:this.vertexByteSize+=size*Int32Array.BYTES_PER_ELEMENT;break;case this.gl.UNSIGNED_INT:this.vertexByteSize+=size*Uint32Array.BYTES_PER_ELEMENT;break;case this.gl.FLOAT:this.vertexByteSize+=size*Float32Array.BYTES_PER_ELEMENT;break;default:throw new Error("Invalid GL Attribute type")}this.vertexSize=this.vertexByteSize/Float32Array.BYTES_PER_ELEMENT}setProjection(matrix){this.currentShader.setUniform("uProjectionMatrix",matrix)}flush(mode=this.mode){const vertex=this.vertexData;const vertexCount=vertex.vertexCount;if(vertexCount>0){const gl=this.gl;const vertexSize=vertex.vertexSize;if(this.renderer.WebGLVersion>1){gl.bufferData(gl.ARRAY_BUFFER,vertex.toFloat32(),gl.STREAM_DRAW,0,vertexCount*vertexSize)}else{gl.bufferData(gl.ARRAY_BUFFER,vertex.toFloat32(0,vertexCount*vertexSize),gl.STREAM_DRAW)}gl.drawArrays(mode,0,vertexCount);vertex.clear()}}};var primitive_default="// Current vertex point\nattribute vec2 aVertex;\nattribute vec4 aColor;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n}\n";var primitive_default2="varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n";var PrimitiveCompositor=class extends Compositor{init(renderer2){super.init(renderer2,{attributes:[{name:"aVertex",size:2,type:renderer2.gl.FLOAT,normalized:false,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:renderer2.gl.UNSIGNED_BYTE,normalized:true,offset:2*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:primitive_default,fragment:primitive_default2}})}drawVertices(mode,verts,vertexCount=verts.length){const viewMatrix=this.viewMatrix;const vertexData=this.vertexData;const alpha2=this.renderer.getGlobalAlpha();const colorUint32=this.renderer.currentColor.toUint32(alpha2);if(vertexData.isFull(vertexCount)){this.flush()}if(mode!==this.mode){this.flush(this.mode);this.mode=mode}if(!viewMatrix.isIdentity()){verts.forEach(vert=>{viewMatrix.apply(vert);vertexData.push(vert.x,vert.y,void 0,void 0,colorUint32)})}else{verts.forEach(vert=>{vertexData.push(vert.x,vert.y,void 0,void 0,colorUint32)})}if(this.mode===this.gl.LINE_STRIP||this.mode===this.gl.LINE_LOOP){this.flush(this.mode)}}};var quad_default="// Current vertex point\nattribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.bgr * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n";var quad_default2="uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n";var V_ARRAY=[new Vector2d,new Vector2d,new Vector2d,new Vector2d];var QuadCompositor=class extends Compositor{init(renderer2){super.init(renderer2,{attributes:[{name:"aVertex",size:2,type:renderer2.gl.FLOAT,normalized:false,offset:0*Float32Array.BYTES_PER_ELEMENT},{name:"aRegion",size:2,type:renderer2.gl.FLOAT,normalized:false,offset:2*Float32Array.BYTES_PER_ELEMENT},{name:"aColor",size:4,type:renderer2.gl.UNSIGNED_BYTE,normalized:true,offset:4*Float32Array.BYTES_PER_ELEMENT}],shader:{vertex:quad_default,fragment:quad_default2}});this.currentTextureUnit=-1;this.boundTextures=[]}reset(){super.reset();for(let i=0;i<this.renderer.maxTextures;i++){const texture2D=this.getTexture2D(i);if(typeof texture2D!=="undefined"){this.deleteTexture2D(texture2D)}}this.currentTextureUnit=-1}createTexture2D(unit,pixels=null,filter,repeat="no-repeat",w=pixels.width,h=pixels.height,premultipliedAlpha=true,mipmap=true){const gl=this.gl;const isPOT=isPowerOfTwo(w)&&isPowerOfTwo(h);const rs=repeat.search(/^repeat(-x)?$/)===0&&(isPOT||this.renderer.WebGLVersion>1)?gl.REPEAT:gl.CLAMP_TO_EDGE;const rt=repeat.search(/^repeat(-y)?$/)===0&&(isPOT||this.renderer.WebGLVersion>1)?gl.REPEAT:gl.CLAMP_TO_EDGE;const texture=gl.createTexture();this.bindTexture2D(texture,unit);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,rs);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,rt);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filter);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filter);gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,premultipliedAlpha);if(pixels===null||typeof pixels.byteLength!=="undefined"){gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,w,h,0,gl.RGBA,gl.UNSIGNED_BYTE,pixels,0)}else if(typeof globalThis.OffscreenCanvas!=="undefined"&&pixels instanceof globalThis.OffscreenCanvas){const imageBitmap=pixels.transferToImageBitmap();gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,imageBitmap);imageBitmap.close()}else{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,pixels)}if(isPOT&&mipmap===true){gl.generateMipmap(gl.TEXTURE_2D)}return texture}deleteTexture2D(texture){this.gl.deleteTexture(texture);this.unbindTexture2D(texture)}getTexture2D(unit){return this.boundTextures[unit]}bindTexture2D(texture,unit){const gl=this.gl;if(texture!==this.boundTextures[unit]){this.flush();if(this.currentTextureUnit!==unit){this.currentTextureUnit=unit;gl.activeTexture(gl.TEXTURE0+unit)}gl.bindTexture(gl.TEXTURE_2D,texture);this.boundTextures[unit]=texture}else if(this.currentTextureUnit!==unit){this.flush();this.currentTextureUnit=unit;gl.activeTexture(gl.TEXTURE0+unit)}}unbindTexture2D(texture,unit){if(typeof unit==="undefined"){unit=this.boundTextures.indexOf(texture)}if(unit!==-1){delete this.boundTextures[unit];if(unit===this.currentTextureUnit){this.currentTextureUnit=-1}}return unit}uploadTexture(texture,w,h,force=false){const unit=this.renderer.cache.getUnit(texture);const texture2D=this.boundTextures[unit];if(typeof texture2D==="undefined"||force){this.createTexture2D(unit,texture.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,texture.repeat,w,h,texture.premultipliedAlpha)}else{this.bindTexture2D(texture2D,unit)}return this.currentTextureUnit}addQuad(texture,x,y,w,h,u0,v0,u1,v1,tint,reupload=false){const vertexData=this.vertexData;if(vertexData.isFull(6)){this.flush()}const unit=this.uploadTexture(texture,w,h,reupload);this.currentShader.setUniform("uSampler",unit);const m=this.viewMatrix;const vec0=V_ARRAY[0].set(x,y);const vec1=V_ARRAY[1].set(x+w,y);const vec2=V_ARRAY[2].set(x,y+h);const vec3=V_ARRAY[3].set(x+w,y+h);if(!m.isIdentity()){m.apply(vec0);m.apply(vec1);m.apply(vec2);m.apply(vec3)}vertexData.push(vec0.x,vec0.y,u0,v0,tint);vertexData.push(vec1.x,vec1.y,u1,v0,tint);vertexData.push(vec2.x,vec2.y,u0,v1,tint);vertexData.push(vec2.x,vec2.y,u0,v1,tint);vertexData.push(vec1.x,vec1.y,u1,v0,tint);vertexData.push(vec3.x,vec3.y,u1,v1,tint)}};var supportedCompressedTextureFormats;var WebGLRenderer=class extends Renderer{constructor(options){super(Object.assign(options,{context:"webgl"}));this.GPUVendor=void 0;this.GPURenderer=void 0;this.gl=this.renderTarget.context;this.lineWidth=1;this.lineJoin="round";this.vertexBuffer=this.gl.createBuffer();this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);this._colorStack=[];this._matrixStack=[];this._scissorStack=[];this._blendStack=[];this.currentTransform=new Matrix2d;this.currentCompositor=void 0;this.currentProgram=void 0;this.compositors=new Map;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer);this.addCompositor(new(this.settings.compositor||QuadCompositor)(this),"quad",true);this.addCompositor(new(this.settings.compositor||PrimitiveCompositor)(this),"primitive");this.depthTest=options.depthTest;if(this.depthTest==="z-buffer"){this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LEQUAL);this.gl.depthMask(true)}else{this.gl.disable(this.gl.DEPTH_TEST);this.gl.depthMask(false)}this.gl.disable(this.gl.SCISSOR_TEST);this.gl.enable(this.gl.BLEND);this.setBlendMode(this.settings.blendMode);const debugInfo=this.gl.getExtension("WEBGL_debug_renderer_info");if(debugInfo!==null){this.GPUVendor=this.gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);this.GPURenderer=this.gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)}this.customShader=void 0;this.cache=new cache_default(this.maxTextures);this.type="WebGL"+this.WebGLVersion;this.getCanvas().addEventListener("webglcontextlost",e=>{e.preventDefault();this.isContextValid=false;eventEmitter.emit(ONCONTEXT_LOST,this)},false);this.getCanvas().addEventListener("webglcontextrestored",()=>{this.reset();this.isContextValid=true;eventEmitter.emit(ONCONTEXT_RESTORED,this)},false);eventEmitter.addListener(GAME_RESET,()=>{this.reset()});eventEmitter.addListener(CANVAS_ONRESIZE,(width,height)=>{this.flush();this.setViewport(0,0,width,height)})}get WebGLVersion(){return this.renderTarget.WebGLVersion}getSupportedCompressedTextureFormats(){if(typeof supportedCompressedTextureFormats==="undefined"){const gl=this.gl;supportedCompressedTextureFormats={astc:gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:gl.getExtension("WEBGL_compressed_texture_etc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||gl.getExtension("WEBGL_compressed_texture_es3_0")}}return supportedCompressedTextureFormats}hasSupportedCompressedFormats(format){const supportedFormats=this.getSupportedCompressedTextureFormats();for(const supportedFormat in supportedFormats){for(const extension in supportedFormats[supportedFormat]){if(format===supportedFormats[supportedFormat][extension]){return true}}}return false}reset(){super.reset();this._colorStack.forEach(color=>{colorPool.release(color)});this._matrixStack.forEach(matrix=>{matrix2dPool.release(matrix)});this._colorStack.length=0;this._matrixStack.length=0;this._blendStack.length=0;this.clear();this.setViewport();if(this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING)!==this.vertexBuffer){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer)}this.currentCompositor=void 0;this.currentProgram=void 0;this.customShader=void 0;this.compositors.forEach(compositor=>{if(this.isContextValid===false){compositor.init(this)}else{compositor.reset()}});this.setCompositor("quad");this.gl.disable(this.gl.SCISSOR_TEST)}addCompositor(compositor,name="default",activate=false){if(typeof this.compositors.get(name)!=="undefined"){throw new Error("Invalid Compositor name")}this.compositors.set(name,compositor);if(activate===true){this.setCompositor(name)}}setCompositor(name="default",shader=this.customShader){const compositor=this.compositors.get(name);if(typeof compositor==="undefined"){throw new Error("Invalid Compositor")}if(this.currentCompositor!==compositor){if(this.currentCompositor!==void 0){this.currentCompositor.flush()}this.currentCompositor=compositor}if(name==="quad"&&typeof shader==="object"){this.currentCompositor.useShader(shader)}else{this.currentCompositor.bind()}return this.currentCompositor}resetTransform(){this.currentTransform.identity()}createPattern(image,repeat){this.setCompositor("quad");if(renderer.WebGLVersion===1&&(!isPowerOfTwo(image.width)||!isPowerOfTwo(image.height))){const src=typeof image.src!=="undefined"?image.src:image;throw new Error("[WebGL Renderer] "+src+" is not a POT texture ("+image.width+"x"+image.height+")")}const texture=new TextureAtlas(createAtlas(image.width,image.height,"pattern",repeat),image);this.currentCompositor.uploadTexture(texture);return texture}flush(){this.currentCompositor.flush()}setProjection(matrix){super.setProjection(matrix);this.currentCompositor.setProjection(matrix)}setViewport(x=0,y=0,w=this.getCanvas().width,h=this.getCanvas().height){this.gl.viewport(x,y,w,h)}clear(){const gl=this.gl;const clearColor=this.backgroundColor.toArray();gl.clearColor(clearColor[0],clearColor[1],clearColor[2],clearColor[3]);this.lineWidth=1;if(this.depthTest==="z-buffer"){gl.clear(gl.DEPTH_BUFFER_BIT|gl.COLOR_BUFFER_BIT|gl.STENCIL_BUFFER_BIT)}else{gl.clear(gl.COLOR_BUFFER_BIT|gl.STENCIL_BUFFER_BIT)}}clearColor(color="#000000",opaque=false){let glArray;const gl=this.gl;if(color instanceof Color){glArray=color.toArray()}else{const _color=colorPool.get();glArray=_color.parseCSS(color).toArray();colorPool.release(_color)}gl.clearColor(glArray[0],glArray[1],glArray[2],opaque===true?1:glArray[3]);gl.clear(gl.COLOR_BUFFER_BIT)}clearRect(x,y,width,height){this.save();this.clipRect(x,y,width,height);this.clearColor();this.restore()}drawImage(image,sx,sy,sw,sh,dx,dy,dw,dh){if(typeof sw==="undefined"){sw=dw=image.width;sh=dh=image.height;dx=sx;dy=sy;sx=0;sy=0}else if(typeof dx==="undefined"){dx=sx;dy=sy;dw=sw;dh=sh;sw=image.width;sh=image.height;sx=0;sy=0}if(this.settings.subPixel===false){dx|=0;dy|=0}this.setCompositor("quad");const reupload=typeof image.videoWidth!=="undefined";const texture=this.cache.get(image);const uvs=texture.getUVs(sx+","+sy+","+sw+","+sh);this.currentCompositor.addQuad(texture,dx,dy,dw,dh,uvs[0],uvs[1],uvs[2],uvs[3],this.currentTint.toUint32(this.getGlobalAlpha()),reupload)}drawPattern(pattern,x,y,width,height){const uvs=pattern.getUVs("0,0,"+width+","+height);this.setCompositor("quad");this.currentCompositor.addQuad(pattern,x,y,width,height,uvs[0],uvs[1],uvs[2],uvs[3],this.currentTint.toUint32(this.getGlobalAlpha()))}beginPath(){this.path2D.beginPath()}moveTo(x,y){this.path2D.moveTo(x,y)}lineTo(x,y){this.path2D.lineTo(x,y)}rect(x,y,width,height){this.path2D.rect(x,y,width,height)}roundRect(x,y,width,height,radii){this.path2D.roundRect(x,y,width,height,radii)}stroke(shape,fill){this.setCompositor("primitive");if(typeof shape==="undefined"){if(fill===true){this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}else{this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}}else{super.stroke(shape,fill)}}fill(shape){this.stroke(shape,true)}closePath(){this.path2D.closePath()}getContext(){return this.gl}setBlendMode(mode="normal",gl=this.gl){if(this.currentBlendMode!==mode){this.flush();gl.enable(gl.BLEND);this.currentBlendMode=mode;switch(mode){case"screen":gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_COLOR);break;case"lighter":case"additive":gl.blendFunc(gl.ONE,gl.ONE);break;case"multiply":gl.blendFunc(gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA);break;default:gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);this.currentBlendMode="normal";break}}}restore(){if(this._matrixStack.length!==0){const color=this._colorStack.pop();const matrix=this._matrixStack.pop();this.currentColor.copy(color);this.currentTransform.copy(matrix);this.setBlendMode(this._blendStack.pop());colorPool.release(color);matrix2dPool.release(matrix)}if(this._scissorStack.length!==0){this.currentScissor.set(this._scissorStack.pop())}else{const canvas=this.getCanvas();this.gl.disable(this.gl.SCISSOR_TEST);this.currentScissor[0]=0;this.currentScissor[1]=0;this.currentScissor[2]=canvas.width;this.currentScissor[3]=canvas.height}}save(){this._colorStack.push(this.currentColor.clone());this._matrixStack.push(this.currentTransform.clone());if(this.gl.isEnabled(this.gl.SCISSOR_TEST)){this._scissorStack.push(this.currentScissor.slice())}this._blendStack.push(this.getBlendMode())}rotate(angle){this.currentTransform.rotate(angle)}scale(x,y){this.currentTransform.scale(x,y)}setAntiAlias(enable2=false){super.setAntiAlias(enable2)}setGlobalAlpha(alpha2){this.currentColor.alpha=alpha2}getGlobalAlpha(){return this.currentColor.alpha}setColor(color){const alpha2=this.currentColor.alpha;this.currentColor.copy(color);this.currentColor.alpha*=alpha2}strokeArc(x,y,radius,start,end,antiClockwise=false,fill=false){this.setCompositor("primitive");this.path2D.beginPath();this.path2D.arc(x,y,radius,start,end,antiClockwise);if(fill===false){this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else{this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillArc(x,y,radius,start,end,antiClockwise=false){this.strokeArc(x,y,radius,start,end,antiClockwise,true)}strokeEllipse(x,y,w,h,fill=false){this.setCompositor("primitive");this.path2D.beginPath();this.path2D.ellipse(x,y,w,h,0,0,360);if(fill===false){this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else{this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillEllipse(x,y,w,h){this.strokeEllipse(x,y,w,h,true)}strokeLine(startX,startY,endX,endY){this.setCompositor("primitive");if(this.lineWidth===1){this.path2D.beginPath();this.path2D.moveTo(startX,startY);this.path2D.lineTo(endX,endY);this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else if(this.lineWidth>1){const halfWidth=this.lineWidth/2;const angle=Math.atan2(endY-startY,endX-startX);const dx=Math.sin(angle)*halfWidth;const dy=Math.cos(angle)*halfWidth;const x1=startX-dx;const y1=startY+dy;const x2=startX+dx;const y2=startY-dy;const x3=endX+dx;const y3=endY-dy;const x4=endX-dx;const y4=endY+dy;this.path2D.beginPath();this.path2D.moveTo(x1,y1);this.path2D.lineTo(x2,y2);this.path2D.lineTo(x3,y3);this.path2D.lineTo(x4,y4);this.path2D.closePath();this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillLine(startX,startY,endX,endY){this.strokeLine(startX,startY,endX,endY)}strokePolygon(poly,fill=false){const points=poly.points;const len=points.length;this.translate(poly.pos.x,poly.pos.y);if(fill===false&&this.lineWidth>1){const radius=this.lineWidth/2;for(let i=0;i<len-1;i++){const curPoint=points[i];const nextPoint=points[i+1];this.fillEllipse(nextPoint.x,nextPoint.y,radius,radius);this.strokeLine(curPoint.x,curPoint.y,nextPoint.x,nextPoint.y)}const lastPoint=points[len-1];const firstPoint=points[0];if(!lastPoint.equals(firstPoint)){this.fillEllipse(firstPoint.x,firstPoint.y,radius,radius);this.strokeLine(lastPoint.x,lastPoint.y,firstPoint.x,firstPoint.y)}}else{this.setCompositor("primitive");this.path2D.beginPath();for(let i=0;i<len-1;i++){const curPoint=points[i];const nextPoint=points[i+1];this.path2D.moveTo(curPoint.x,curPoint.y);this.path2D.lineTo(nextPoint.x,nextPoint.y)}this.path2D.closePath();if(fill===false){this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else{this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}this.translate(-poly.pos.x,-poly.pos.y)}fillPolygon(poly){this.strokePolygon(poly,true)}strokeRect(x,y,width,height,fill=false){if(fill===false&&this.lineWidth>1){const radius=this.lineWidth/2;this.strokeLine(x,y,x+width,y);this.strokeLine(x+width,y,x+width,y+height);this.strokeLine(x+width,y+height,x,y+height);this.strokeLine(x,y+height,x,y);this.fillEllipse(x,y,radius,radius);this.fillEllipse(x+width,y,radius,radius);this.fillEllipse(x+width,y+height,radius,radius);this.fillEllipse(x,y+height,radius,radius)}else{this.setCompositor("primitive");this.path2D.beginPath();this.path2D.rect(x,y,width,height);if(fill===false){this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else{this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}}fillRect(x,y,width,height){this.strokeRect(x,y,width,height,true)}strokeRoundRect(x,y,width,height,radius,fill=false){this.setCompositor("primitive");this.path2D.beginPath();this.path2D.roundRect(x,y,width,height,radius);if(fill===false){this.currentCompositor.drawVertices(this.gl.LINES,this.path2D.points)}else{this.currentCompositor.drawVertices(this.gl.TRIANGLES,this.path2D.triangulatePath())}}fillRoundRect(x,y,width,height,radius){this.strokeRoundRect(x,y,width,height,radius,true)}strokePoint(x,y){this.strokeLine(x,y,x+1,y+1)}fillPoint(x,y){this.strokePoint(x,y)}setTransform(a,b,c,d,e,f){this.resetTransform();this.transform(a,b,c,d,e,f)}transform(a,b,c,d,e,f){if(typeof a==="object"){this.currentTransform.multiply(a)}else{this.currentTransform.transform(a,b,c,d,e,f)}if(this.settings.subPixel===false){const a2=this.currentTransform.toArray();a2[6]|=0;a2[7]|=0}}translate(x,y){const currentTransform=this.currentTransform;currentTransform.translate(x,y);if(this.settings.subPixel===false){const a=currentTransform.toArray();a[6]|=0;a[7]|=0}}clipRect(x,y,width,height){const canvas=this.getCanvas();const gl=this.gl;if(x!==0||y!==0||width!==canvas.width||height!==canvas.height){const currentScissor=this.currentScissor;if(gl.isEnabled(gl.SCISSOR_TEST)){if(currentScissor[0]===x&&currentScissor[1]===y&&currentScissor[2]===width&&currentScissor[3]===height){return}}this.flush();gl.enable(this.gl.SCISSOR_TEST);gl.scissor(x+this.currentTransform.tx,canvas.height-height-y-this.currentTransform.ty,width,height);currentScissor[0]=x;currentScissor[1]=y;currentScissor[2]=width;currentScissor[3]=height}else{gl.disable(gl.SCISSOR_TEST)}}setMask(mask,invert=false){const gl=this.gl;this.flush();if(this.maskLevel===0){gl.enable(gl.STENCIL_TEST);gl.clear(gl.STENCIL_BUFFER_BIT)}this.maskLevel++;gl.colorMask(false,false,false,false);gl.stencilFunc(gl.EQUAL,this.maskLevel,1);gl.stencilOp(gl.REPLACE,gl.REPLACE,gl.REPLACE);this.fill(mask);this.flush();gl.colorMask(true,true,true,true);if(invert===true){gl.stencilFunc(gl.EQUAL,this.maskLevel+1,1)}else{gl.stencilFunc(gl.NOTEQUAL,this.maskLevel+1,1)}gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}clearMask(){if(this.maskLevel>0){this.flush();this.maskLevel=0;this.gl.disable(this.gl.STENCIL_TEST)}}};var ColorLayer=class extends Renderable{constructor(name,color,z){super(0,0,Infinity,Infinity);this.color=colorPool.get().parseCSS(color);this.onResetEvent(name,color,z)}onResetEvent(name,color,z=0){this.name=name;this.pos.z=z;this.floating=true;this.color.parseCSS(color)}draw(renderer2,viewport){renderer2.save();renderer2.clipRect(0,0,viewport.width,viewport.height);renderer2.clearColor(this.color);renderer2.restore()}destroy(){colorPool.release(this.color);this.color=void 0;super.destroy()}};var ImageLayer=class extends Sprite{constructor(x,y,settings){super(x,y,settings);this.floating=true;this.offset.set(x,y);this.ratio=vector2dPool.get(1,1);if(typeof settings.ratio!=="undefined"){if(isNumeric(settings.ratio)){this.ratio.set(settings.ratio,+settings.ratio)}else{this.ratio.setV(settings.ratio)}}if(typeof settings.anchorPoint==="undefined"){this.anchorPoint.set(0,0)}else{if(typeof settings.anchorPoint==="number"){this.anchorPoint.set(settings.anchorPoint,settings.anchorPoint)}else{this.anchorPoint.set(settings.anchorPoint.x,settings.anchorPoint.y)}}this.repeat=settings.repeat||"repeat";this.boundCreatePattern=this.createPattern.bind(this);eventEmitter.addListener(ONCONTEXT_RESTORED,this.boundCreatePattern)}get repeat(){return this._repeat}set repeat(value){this._repeat=value;switch(this._repeat){case"no-repeat":this.repeatX=false;this.repeatY=false;break;case"repeat-x":this.repeatX=true;this.repeatY=false;break;case"repeat-y":this.repeatX=false;this.repeatY=true;break;default:this.repeatX=true;this.repeatY=true;break}this.resize(game.viewport.width,game.viewport.height);this.createPattern()}onActivateEvent(){this.boundUpdateLayer=this.updateLayer.bind(this);this.boundResize=this.resize.bind(this);eventEmitter.addListener(VIEWPORT_ONCHANGE,this.boundUpdateLayer);eventEmitter.addListener(VIEWPORT_ONRESIZE,this.boundResize);eventEmitter.addListener(LEVEL_LOADED,this.boundUpdateLayer);if(this.ancestor.root!==true){this.updateLayer()}}resize(w,h){return super.resize(this.repeatX?Infinity:w,this.repeatY?Infinity:h)}createPattern(){this._pattern=renderer.createPattern(this.image,this._repeat)}updateLayer(){const rx=this.ratio.x;const ry=this.ratio.y;const viewport=game.viewport;if(rx===0&&ry===0){return}const width=this.width;const height=this.height;const bw=viewport.bounds.width;const bh=viewport.bounds.height;const ax=this.anchorPoint.x;const ay=this.anchorPoint.y;const x=ax*(rx-1)*(bw-viewport.width)+this.offset.x-rx*viewport.pos.x;const y=ay*(ry-1)*(bh-viewport.height)+this.offset.y-ry*viewport.pos.y;if(this.repeatX){this.pos.x=x%width}else{this.pos.x=x}if(this.repeatY){this.pos.y=y%height}else{this.pos.y=y}this.isDirty=true}preDraw(renderer2){renderer2.save();renderer2.setGlobalAlpha(renderer2.globalAlpha()*this.getOpacity());renderer2.setTint(this.tint);if(this.blendMode!==renderer2.getBlendMode()){renderer2.setBlendMode(this.blendMode)}}draw(renderer2,viewport){const width=this.width;const height=this.height;const bw=viewport.bounds.width;const bh=viewport.bounds.height;const ax=this.anchorPoint.x;const ay=this.anchorPoint.y;let x=this.pos.x;let y=this.pos.y;if(this.ratio.x===0&&this.ratio.y===0){x=x+ax*(bw-width);y=y+ay*(bh-height)}renderer2.translate(x,y);renderer2.drawPattern(this._pattern,0,0,viewport.width*2,viewport.height*2)}onDeactivateEvent(){eventEmitter.removeListener(VIEWPORT_ONCHANGE,this.boundUpdateLayer);eventEmitter.removeListener(VIEWPORT_ONRESIZE,this.boundResize);eventEmitter.removeListener(LEVEL_LOADED,this.boundUpdateLayer)}destroy(){vector2dPool.release(this.ratio);this.ratio=void 0;eventEmitter.removeListener(ONCONTEXT_RESTORED,this.boundCreatePattern);super.destroy()}};var NineSliceSprite=class extends Sprite{constructor(x,y,settings){super(x,y,settings);if(typeof settings.width!=="number"||typeof settings.height!=="number"){throw new Error("height and width properties are mandatory")}this.width=Math.floor(settings.width);this.height=Math.floor(settings.height);this.nss_width=this.width;this.nss_height=this.height;this.insetx=settings.insetx;this.insety=settings.insety}get width(){return super.width}set width(value){super.width=this.nss_width=value}get height(){return super.height}set height(value){super.height=this.nss_height=value}draw(renderer2){const frame=this.current;let dx=this.pos.x;const dy=this.pos.y;let w=frame.width;let h=frame.height;const frame_offset=frame.offset;const g_offset=this.offset;if(frame.angle!==0){renderer2.translate(-dx,-dy);renderer2.rotate(frame.angle);dx-=h;w=frame.height;h=frame.width}const sx=g_offset.x+frame_offset.x;const sy=g_offset.y+frame_offset.y;const corner_width=this.insetx||w/4;const corner_height=this.insety||h/4;renderer2.drawImage(this.image,sx,sy,corner_width,corner_height,dx,dy,corner_width,corner_height);renderer2.drawImage(this.image,sx+w-corner_width,sy,corner_width,corner_height,dx+this.nss_width-corner_width,dy,corner_width,corner_height);renderer2.drawImage(this.image,sx,sy+h-corner_height,corner_width,corner_height,dx,dy+this.nss_height-corner_height,corner_width,corner_height);renderer2.drawImage(this.image,sx+w-corner_width,sy+h-corner_height,corner_width,corner_height,dx+this.nss_width-corner_width,dy+this.nss_height-corner_height,corner_width,corner_height);const image_center_width=w-(corner_width<<1);const image_center_height=h-(corner_height<<1);const target_center_width=this.nss_width-(corner_width<<1);const target_center_height=this.nss_height-(corner_height<<1);renderer2.drawImage(this.image,sx+corner_width,sy,image_center_width,corner_height,dx+corner_width,dy,target_center_width,corner_height);renderer2.drawImage(this.image,sx+corner_width,sy+h-corner_height,image_center_width,corner_height,dx+corner_width,dy+this.nss_height-corner_height,target_center_width,corner_height);renderer2.drawImage(this.image,sx,sy+corner_height,corner_width,image_center_height,dx,dy+corner_height,corner_width,target_center_height);renderer2.drawImage(this.image,sx+w-corner_width,sy+corner_height,corner_width,image_center_height,dx+this.nss_width-corner_width,dy+corner_height,corner_width,target_center_height);renderer2.drawImage(this.image,sx+corner_width,sy+corner_height,image_center_width,image_center_height,dx+corner_width,dy+corner_height,target_center_width,target_center_height)}};var UIBaseElement=class extends Container{#boundPointerMoveHandler;constructor(x,y,w,h){super(x,y,w,h);this.isClickable=true;this.isDraggable=false;this.holdThreshold=250;this.isHoldable=false;this.hover=false;this.released=true;this.floating=true;this.holdTimeout=-1;this.isKinematic=false;this.enableChildBoundsUpdate=true;this.#boundPointerMoveHandler=this.pointerMove.bind(this)}clicked(event){if(event.button===0&&this.isClickable){this.isDirty=true;this.released=false;if(this.isHoldable){timer_default.clearTimer(this.holdTimeout);this.holdTimeout=timer_default.setTimeout(()=>{return this.hold()},this.holdThreshold,false);this.released=false}if(this.isDraggable){this.grabOffset.set(event.gameX,event.gameY);this.grabOffset.sub(this.pos)}return this.onClick(event)}}onClick(){return true}enter(event){this.hover=true;this.isDirty=true;if(this.isDraggable===true){eventEmitter.addListener(POINTERMOVE,this.#boundPointerMoveHandler);this.grabOffset=vector2dPool.get(0,0)}return this.onOver(event)}pointerMove(event){if(this.hover===true&&this.released===false){this.pos.set(event.gameX,event.gameY,this.pos.z);this.pos.sub(this.grabOffset);this.isDirty=true;return this.onMove(event)}}onMove(){}onOver(){}leave(event){this.hover=false;this.isDirty=true;if(this.isDraggable===true){eventEmitter.removeListener(POINTERMOVE,this.#boundPointerMoveHandler);vector2dPool.release(this.grabOffset);this.grabOffset=void 0}this.release(event);return this.onOut(event)}onOut(){}release(event){if(this.released===false){this.released=true;this.isDirty=true;timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1;return this.onRelease(event)}}onRelease(){return true}hold(){timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1;this.isDirty=true;if(!this.released){this.onHold()}}onHold(){}onActivateEvent(){registerPointerEvent("pointerdown",this,e=>{return this.clicked(e)});registerPointerEvent("pointerup",this,e=>{return this.release(e)});registerPointerEvent("pointercancel",this,e=>{return this.release(e)});registerPointerEvent("pointerenter",this,e=>{return this.enter(e)});registerPointerEvent("pointerleave",this,e=>{return this.leave(e)});super.onActivateEvent()}onDeactivateEvent(){releasePointerEvent("pointerdown",this);releasePointerEvent("pointerup",this);releasePointerEvent("pointercancel",this);releasePointerEvent("pointerenter",this);releasePointerEvent("pointerleave",this);timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1;if(this.isDraggable===true){eventEmitter.removeListener(POINTERMOVE,this.#boundPointerMoveHandler);if(typeof this.grabOffset!=="undefined"){vector2dPool.release(this.grabOffset);this.grabOffset=void 0}}super.onDeactivateEvent()}};function setContextStyle(context,style){context.font=style.font;context.fillStyle=style.fillStyle.toRGBA();context.strokeStyle=style.strokeStyle.toRGBA();context.lineWidth=style.lineWidth;context.textAlign=style.textAlign;context.textBaseline=style.textBaseline}var runits=["ex","em","pt","px"];var toPX=[12,24,.75,1];var Text=class extends Renderable{constructor(x,y,settings){super(x,y,settings.width||0,settings.height||0);this.fillStyle=colorPool.get(0,0,0);this.strokeStyle=colorPool.get(0,0,0);this.lineWidth=0;this.textAlign="left";this.textBaseline="top";this.lineHeight=1;this.wordWrapWidth=-1;this.fontSize=10;this._text=[];this.onResetEvent(x,y,settings)}onResetEvent(x,y,settings){if(typeof this.fillStyle==="undefined"){this.fillStyle=colorPool.get(0,0,0)}if(typeof this.strokeStyle==="undefined"){this.strokeStyle=colorPool.get(0,0,0)}if(typeof settings.fillStyle!=="undefined"){if(settings.fillStyle instanceof Color){this.fillStyle.copy(settings.fillStyle)}else{this.fillStyle.parseCSS(settings.fillStyle)}}if(typeof settings.strokeStyle!=="undefined"){if(settings.strokeStyle instanceof Color){this.strokeStyle.copy(settings.strokeStyle)}else{this.strokeStyle.parseCSS(settings.strokeStyle)}}this.lineWidth=settings.lineWidth||0;this.textAlign=settings.textAlign||"left";this.textBaseline=settings.textBaseline||"top";this.lineHeight=settings.lineHeight||1;this.wordWrapWidth=settings.wordWrapWidth||-1;this.fontSize=10;if(typeof settings.anchorPoint!=="undefined"){this.anchorPoint.set(settings.anchorPoint.x,settings.anchorPoint.y)}else{this.anchorPoint.set(0,0)}if(typeof settings.floating!=="undefined"){this.floating=!!settings.floating}this.setFont(settings.font,settings.size);if(settings.bold===true){this.bold()}if(settings.italic===true){this.italic()}this.canvasTexture=new canvasrendertarget_default(2,2,{offscreenCanvas:false});this.metrics=new textmetrics_default(this);this.setText(settings.text)}bold(){this.font="bold "+this.font;this.isDirty=true;return this}italic(){this.font="italic "+this.font;this.isDirty=true;return this}setFont(font,size=10){const font_names=font.split(",").map(value=>{value=value.trim();return!/(^".*"$)|(^'.*'$)/.test(value)?'"'+value+'"':value});if(typeof size==="number"){this.fontSize=size;size+="px"}else{const CSSval=size.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(CSSval[1]);if(CSSval[2]){this.fontSize*=toPX[runits.indexOf(CSSval[2])]}else{size+="px"}}this.height=this.fontSize;this.font=size+" "+font_names.join(",");this.isDirty=true;return this}setText(value=""){const bounds=this.getBounds();if(this._text.toString()!==value.toString()){if(!Array.isArray(value)){this._text=(""+value).split("\n")}else{this._text=value}}if(this._text.length>0&&this.wordWrapWidth>0){this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth,this.canvasTexture.context)}bounds.addBounds(this.metrics.measureText(this._text,this.canvasTexture.context),true);let width=Math.ceil(this.metrics.width);let height=Math.ceil(this.metrics.height);if(renderer.WebGLVersion===1){width=nextPowerOfTwo(this.metrics.width);height=nextPowerOfTwo(this.metrics.height)}this.canvasTexture.invalidate(renderer);if(this.canvasTexture.width<width||this.canvasTexture.height<height){this.canvasTexture.resize(width,height)}this.canvasTexture.clear();this._drawFont(this.canvasTexture.context,this._text,this.pos.x-this.metrics.x,this.pos.y-this.metrics.y);this.isDirty=true;return this}measureText(renderer2,text=this._text){return this.metrics.measureText(text,this.canvasTexture.context)}draw(renderer2,text,x=this.pos.x,y=this.pos.y){if(typeof this.ancestor==="undefined"){if(this.pos.x!==x||this.pos.y!==y){this.pos.x=x;this.pos.y=y;this.isDirty=true}this.setText(text);renderer2.save();renderer2.setGlobalAlpha(renderer2.globalAlpha()*this.getOpacity())}x=this.metrics.x;y=this.metrics.y;if(renderer2.settings.subPixel===false){x=~~x;y=~~y}renderer2.drawImage(this.canvasTexture.canvas,x,y);if(typeof this.ancestor==="undefined"){renderer2.restore()}}_drawFont(context,text,x,y){setContextStyle(context,this);for(let i=0;i<text.length;i++){const string=text[i].trimEnd();if(this.fillStyle.alpha>0){context.fillText(string,x,y)}if(this.lineWidth>0&&this.strokeStyle.alpha>0){context.strokeText(string,x,y)}y+=this.metrics.lineHeight()}return this.metrics}destroy(){if(typeof renderer.gl!=="undefined"){renderer.setCompositor("quad");renderer.currentCompositor.deleteTexture2D(renderer.currentCompositor.getTexture2D(this.glTextureUnit));this.glTextureUnit=void 0}renderer.cache.delete(this.canvasTexture.canvas);legacy_pool_default.push(this.canvasTexture);this.canvasTexture.destroy();this.canvasTexture=void 0;colorPool.release(this.fillStyle);colorPool.release(this.strokeStyle);this.fillStyle=this.strokeStyle=void 0;this.metrics=void 0;this._text.length=0;super.destroy()}};var TextMetrics=class extends Bounds{constructor(ancestor){super();this.ancestor=ancestor;this.setMinMax(0,0,0,0)}lineHeight(){if(this.ancestor instanceof Text){return this.ancestor.fontSize*this.ancestor.lineHeight}else{return this.ancestor.fontData.capHeight*this.ancestor.lineHeight*this.ancestor.fontScale.y}}lineWidth(text,context){if(this.ancestor instanceof Text){return context.measureText(text).width}else{const characters=text.split("");const charactersLength=characters.length;let width=0;let lastGlyph=null;for(let i=0;i<charactersLength;i++){const ch=characters[i].charCodeAt(0);const glyph=this.ancestor.fontData.glyphs[ch];if(typeof glyph!=="undefined"){const kerning=lastGlyph&&lastGlyph.kerning?lastGlyph.getKerning(ch):0;width+=(glyph.xadvance+kerning)*this.ancestor.fontScale.x;lastGlyph=glyph}}return width}}measureText(text,context){let strings;if(!Array.isArray(text)){strings=(""+text).split("\n")}else{strings=text}if(typeof context!=="undefined"){context.save();setContextStyle(context,this.ancestor)}this.width=this.height=0;for(let i=0;i<strings.length;i++){this.width=Math.max(this.lineWidth(strings[i].trimEnd(),context),this.width);this.height+=this.lineHeight()}this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);this.x=Math.floor(this.ancestor.textAlign==="right"?this.ancestor.pos.x-this.width:this.ancestor.textAlign==="center"?this.ancestor.pos.x-this.width/2:this.ancestor.pos.x);this.y=Math.floor(this.ancestor.textBaseline.search(/^(top|hanging)$/)===0?this.ancestor.pos.y:this.ancestor.textBaseline==="middle"?this.ancestor.pos.y-this.lineHeight()/2:this.ancestor.pos.y-this.lineHeight());if(typeof context!=="undefined"){context.restore()}return this}wordWrap(text,width,context){let currentLine="";const output=[];if(Array.isArray(text)){text=text.join(" ")}const words=text.replace(/[\r\n]+/g," ").split(" ");if(typeof context!=="undefined"){context.save();setContextStyle(context,this.ancestor)}for(let i=0;i<words.length;i++){const word=words[i];const lineWidth=this.lineWidth(currentLine+word+" ",context);if(lineWidth<width){currentLine+=word+" "}else{output.push(currentLine+"\n");currentLine=word+" "}}output.push(currentLine);if(typeof context!=="undefined"){context.restore()}return output}};var textmetrics_default=TextMetrics;var BitmapText=class extends Renderable{constructor(x,y,settings){super(x,y,settings.width||0,settings.height||0);this.textAlign=settings.textAlign||"left";this.textBaseline=settings.textBaseline||"top";this.lineHeight=settings.lineHeight||1;this.wordWrapWidth=settings.wordWrapWidth||-1;this._text=[];this.fontScale=vector2dPool.get(1,1);this.fontImage=typeof settings.font==="object"?settings.font:getImage(settings.font);if(typeof settings.fontData!=="string"){this.fontData=bitmapTextDataPool.get(getBinary(settings.font))}else{this.fontData=bitmapTextDataPool.get(settings.fontData.includes("info face")?settings.fontData:getBinary(settings.fontData))}if(typeof settings.floating!=="undefined"){this.floating=!!settings.floating}if(typeof settings.fillStyle!=="undefined"){this.fillStyle=settings.fillStyle}if(typeof settings.anchorPoint!=="undefined"){this.anchorPoint.set(settings.anchorPoint.x,settings.anchorPoint.y)}else{this.anchorPoint.set(0,0)}this.metrics=new textmetrics_default(this);if(typeof settings.size==="number"&&settings.size!==1){this.resize(settings.size)}this.setText(settings.text)}set(textAlign,scale2){this.textAlign=textAlign;if(scale2){this.resize(scale2)}this.isDirty=true;return this}setText(value=""){if(this._text.toString()!==value.toString()){if(!Array.isArray(value)){this._text=(""+value).split("\n")}else{this._text=value}this.isDirty=true}if(this._text.length>0&&this.wordWrapWidth>0){this._text=this.metrics.wordWrap(this._text,this.wordWrapWidth)}this.updateBounds();return this}updateBounds(absolute=true){const bounds=this.getBounds();bounds.clear();if(typeof this.metrics!=="undefined"){let ax;let ay;bounds.addBounds(this.metrics.measureText(this._text));switch(this.textAlign){case"right":ax=this.metrics.width*1;break;case"center":ax=this.metrics.width*.5;break;default:ax=0;break}switch(this.textBaseline){case"middle":ay=this.metrics.height*.5;break;case"ideographic":case"alphabetic":case"bottom":ay=this.metrics.height*1;break;default:ay=0;break}bounds.translate(ax,ay)}if(absolute===true){if(typeof this.ancestor!=="undefined"&&typeof this.ancestor.getAbsolutePosition==="function"&&this.floating!==true){bounds.translate(this.ancestor.getAbsolutePosition())}}return bounds}get fillStyle(){return this.tint}set fillStyle(value){if(value instanceof Color){this.tint.copy(value)}else{this.tint.parseCSS(value)}}resize(scale2){this.fontScale.set(scale2,scale2);this.updateBounds();this.isDirty=true;return this}measureText(text=this._text){return this.metrics.measureText(text)}draw(renderer2,text,x,y){const _alpha=renderer2.globalAlpha();if(typeof this.ancestor==="undefined"){this.setText(text);renderer2.setGlobalAlpha(_alpha*this.getOpacity())}else{x=this.pos.x;y=this.pos.y}const lX=x;const stringHeight=this.metrics.lineHeight();let maxWidth=0;for(let i=0;i<this._text.length;i++){x=lX;const string=this._text[i].trimEnd();const stringWidth=this.metrics.lineWidth(string);switch(this.textAlign){case"right":x-=stringWidth;break;case"center":x-=stringWidth*.5;break;default:break}switch(this.textBaseline){case"middle":y-=stringHeight*.5;break;case"ideographic":case"alphabetic":case"bottom":y-=stringHeight;break;default:break}if(this.isDirty===true&&typeof this.ancestor==="undefined"){if(i===0){this.pos.y=y}if(maxWidth<stringWidth){maxWidth=stringWidth;this.pos.x=x}}let lastGlyph=null;for(let c=0,len=string.length;c<len;c++){const ch=string.charCodeAt(c);const glyph=this.fontData.glyphs[ch];if(typeof glyph!=="undefined"){const glyphWidth=glyph.width;const glyphHeight=glyph.height;const kerning=lastGlyph&&lastGlyph.kerning?lastGlyph.getKerning(ch):0;const scaleX=this.fontScale.x;const scaleY=this.fontScale.y;if(glyphWidth!==0&&glyphHeight!==0){renderer2.drawImage(this.fontImage,glyph.x,glyph.y,glyphWidth,glyphHeight,x+glyph.xoffset*scaleX,y+glyph.yoffset*scaleY,glyphWidth*scaleX,glyphHeight*scaleY)}x+=(glyph.xadvance+kerning)*scaleX;lastGlyph=glyph}else{console.warn("BitmapText: no defined Glyph in for "+String.fromCharCode(ch))}}y+=stringHeight}if(typeof this.ancestor==="undefined"){renderer2.setGlobalAlpha(_alpha)}this.isDirty=false}destroy(){vector2dPool.release(this.fontScale);this.fontScale=void 0;bitmapTextDataPool.release(this.fontData);this.fontData=void 0;this._text.length=0;this.metrics=void 0;super.destroy()}};var UITextButton=class extends UIBaseElement{constructor(x,y,settings){super(x,y);this.bindKey=settings.bindKey||-1;this.hoverOffColor=settings.hoverOffColor||settings.backgroundColor||"#00aa0080";this.hoverOnColor=settings.hoverOnColor||settings.hoverColor||"#00ff00ff";this.borderStrokeColor=settings.borderStrokeColor||"#000000";this.textAlign=settings.textAlign=settings.textAlign||"center";this.textBaseline=settings.textBaseline=settings.textBaseline||"middle";this.bitmapText=new BitmapText(0,0,settings);this.dimensions=this.bitmapText.measureText();settings.borderWidth=settings.borderWidth||this.dimensions.width+16;settings.borderHeight=settings.borderHeight||this.dimensions.height+16;this.border=new RoundRect(x,y,settings.borderWidth,settings.borderHeight);this.resize(this.border.getBounds().width,this.border.getBounds().height);this.bitmapText.pos.set(this.width/2,this.height/2);this.addChild(this.bitmapText)}draw(renderer2){if(this.hover===true){renderer2.setColor(this.hoverOnColor)}else{renderer2.setColor(this.hoverOffColor)}renderer2.fill(this.border);renderer2.setColor(this.borderStrokeColor);renderer2.stroke(this.border);super.draw(renderer2)}};var UISpriteElement=class extends Sprite{constructor(x,y,settings){super(x,y,settings);this.isClickable=true;this.holdThreshold=250;this.isHoldable=false;this.hover=false;this.holdTimeout=-1;this.released=true;this.floating=true;this.isKinematic=false}clicked(event){if(event.button===0&&this.isClickable){this.isDirty=true;this.released=false;if(this.isHoldable){timer_default.clearTimer(this.holdTimeout);this.holdTimeout=timer_default.setTimeout(()=>{return this.hold()},this.holdThreshold,false);this.released=false}return this.onClick(event)}}onClick(){return false}enter(event){this.hover=true;this.isDirty=true;return this.onOver(event)}onOver(){}leave(event){this.hover=false;this.isDirty=true;this.release(event);return this.onOut(event)}onOut(){}release(event){if(this.released===false){this.released=true;this.isDirty=true;timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1;return this.onRelease(event)}}onRelease(){return false}hold(){timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1;this.isDirty=true;if(!this.released){this.onHold()}}onHold(){}onActivateEvent(){registerPointerEvent("pointerdown",this,e=>{return this.clicked(e)});registerPointerEvent("pointerup",this,e=>{return this.release(e)});registerPointerEvent("pointercancel",this,e=>{return this.release(e)});registerPointerEvent("pointerenter",this,e=>{return this.enter(e)});registerPointerEvent("pointerleave",this,e=>{return this.leave(e)})}onDeactivateEvent(){releasePointerEvent("pointerdown",this);releasePointerEvent("pointerup",this);releasePointerEvent("pointercancel",this);releasePointerEvent("pointerenter",this);releasePointerEvent("pointerleave",this);timer_default.clearTimer(this.holdTimeout);this.holdTimeout=-1}};var Collectable=class extends Sprite{constructor(x,y,settings){super(x,y,settings);this.name=settings.name;this.type=settings.type;this.id=settings.id;let shape=settings.shapes;if(typeof shape==="undefined"){shape=polygonPool.get(0,0,[vector2dPool.get(0,0),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height)])}this.body=new Body(this,shape);this.body.collisionType=collision.types.COLLECTABLE_OBJECT;this.body.setCollisionMask(collision.types.PLAYER_OBJECT);this.body.setStatic(true);if(settings.anchorPoint){this.anchorPoint.set(settings.anchorPoint.x,settings.anchorPoint.y)}else{this.anchorPoint.set(0,0)}}};var Trigger=class extends Renderable{constructor(x,y,settings){super(x,y,settings.width||0,settings.height||0);this.anchorPoint.set(0,0);this.fade=settings.fade;this.duration=settings.duration;this.fading=false;this.name="Trigger";this.type=settings.type;this.id=settings.id;this.gotolevel=settings.to;this.triggerSettings={event:"level"};["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(property=>{if(typeof settings[property]!=="undefined"){this.triggerSettings[property]=settings[property]}});let shape=settings.shapes;if(typeof shape==="undefined"){shape=polygonPool.get(0,0,[vector2dPool.get(0,0),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height)])}this.body=new Body(this,shape);this.body.collisionType=collision.types.ACTION_OBJECT;this.body.setCollisionMask(collision.types.PLAYER_OBJECT);this.body.setStatic(true);this.resize(this.body.getBounds().width,this.body.getBounds().height)}getTriggerSettings(){const world=this.ancestor.getRootAncestor();if(typeof this.triggerSettings.container==="string"){this.triggerSettings.container=world.getChildByName(this.triggerSettings.container)[0]}return this.triggerSettings}onFadeComplete(){const world=this.ancestor.getRootAncestor();level.load(this.gotolevel,this.getTriggerSettings());world.app.viewport.fadeOut(this.fade,this.duration)}triggerEvent(){const triggerSettings=this.getTriggerSettings();const world=this.ancestor.getRootAncestor();if(triggerSettings.event==="level"){this.gotolevel=triggerSettings.to;if(this.fade&&this.duration){if(!this.fading){this.fading=true;world.app.viewport.fadeIn(this.fade,this.duration,()=>{return this.onFadeComplete()})}}else{level.load(this.gotolevel,triggerSettings)}}else{throw new Error("Trigger invalid type")}}onCollision(){if(this.name==="Trigger"){this.triggerEvent.apply(this)}return false}};function createGradient(light){const context=light.texture.context;const x1=light.texture.width/2;const y1=light.texture.height/2;const radiusX=light.radiusX;const radiusY=light.radiusY;let scaleX;let scaleY;let invScaleX;let invScaleY;let gradient;light.texture.clear();if(radiusX>=radiusY){scaleX=1;invScaleX=1;scaleY=radiusY/radiusX;invScaleY=radiusX/radiusY;gradient=context.createRadialGradient(x1,y1*invScaleY,0,x1,radiusY*invScaleY,radiusX)}else{scaleY=1;invScaleY=1;scaleX=radiusX/radiusY;invScaleX=radiusY/radiusX;gradient=context.createRadialGradient(x1*invScaleX,y1,0,x1*invScaleX,y1,radiusY)}gradient.addColorStop(0,light.color.toRGBA(light.intensity));gradient.addColorStop(1,light.color.toRGBA(0));context.fillStyle=gradient;context.setTransform(scaleX,0,0,scaleY,0,0);context.fillRect(0,0,light.texture.width*invScaleX,light.texture.height*invScaleY)}var Light2d=class extends Renderable{constructor(x,y,radiusX,radiusY=radiusX,color="#FFF",intensity=.7){super(x,y,radiusX*2,radiusY*2);this.color=colorPool.get().parseCSS(color);this.radiusX=radiusX;this.radiusY=radiusY;this.intensity=intensity;this.blendMode="lighter";this.visibleArea=ellipsePool.get(this.centerX,this.centerY,this.width,this.height);this.texture=new canvasrendertarget_default(this.width,this.height,{offscreenCanvas:false});this.anchorPoint.set(0,0);createGradient(this)}getVisibleArea(){return this.visibleArea.setShape(this.getBounds().centerX,this.getBounds().centerY,this.width,this.height)}update(){return true}draw(renderer2){renderer2.drawImage(this.texture.canvas,this.getBounds().x,this.getBounds().y)}destroy(){colorPool.release(this.color);this.color=void 0;legacy_pool_default.push(this.texture);this.texture.destroy();this.texture=void 0;ellipsePool.release(this.visibleArea);this.visibleArea=void 0;super.destroy()}};var Draggable=class extends Renderable{constructor(x,y,width,height){super(x,y,width,height);this.isKinematic=false;this.dragging=false;this.dragId=null;this.grabOffset=new Vector2d(0,0);this.initEvents()}initEvents(){registerPointerEvent("pointerdown",this,e=>{eventEmitter.emit(DRAGSTART,e,this)});registerPointerEvent("pointerup",this,e=>{eventEmitter.emit(DRAGEND,e,this)});registerPointerEvent("pointercancel",this,e=>{eventEmitter.emit(DRAGEND,e,this)});this.handlePointerMove=e=>{this.dragMove(e)};this.handleDragStart=(e,draggable)=>{if(draggable===this){this.dragStart(e)}};this.handleDragEnd=(e,draggable)=>{if(draggable===this){this.dragEnd(e)}};eventEmitter.addListener(POINTERMOVE,this.handlePointerMove);eventEmitter.addListener(DRAGSTART,this.handleDragStart);eventEmitter.addListener(DRAGEND,this.handleDragEnd)}dragStart(e){if(this.dragging===false){this.dragging=true;this.grabOffset.set(e.gameX,e.gameY);this.grabOffset.sub(this.pos);return false}}dragMove(e){if(this.dragging===true){this.pos.set(e.gameX,e.gameY,this.pos.z);this.pos.sub(this.grabOffset)}}dragEnd(){if(this.dragging===true){this.dragging=false;return false}}destroy(){eventEmitter.removeListener(POINTERMOVE,this.handlePointerMove);eventEmitter.removeListener(DRAGSTART,this.handleDragStart);eventEmitter.removeListener(DRAGEND,this.handleDragEnd);releasePointerEvent("pointerdown",this);releasePointerEvent("pointerup",this);releasePointerEvent("pointercancel",this);super.destroy()}};var DropTarget=class extends Renderable{constructor(x,y,width,height){super(x,y,width,height);this.isKinematic=false;this.CHECKMETHOD_OVERLAP="overlaps";this.CHECKMETHOD_CONTAINS="contains";this.checkMethod=this.CHECKMETHOD_OVERLAP;this.removeDragEndListener=eventEmitter.addListener(DRAGEND,this.checkOnMe.bind(this))}setCheckMethod(checkMethod){if(typeof this.getBounds()[this.checkMethod]==="function"){this.checkMethod=checkMethod}}checkOnMe(e,draggable){if(draggable&&this.getBounds()[this.checkMethod](draggable.getBounds())){this.drop(draggable)}}drop(){}destroy(){this.removeDragEndListener();super.destroy()}};var sat_exports={};__export(sat_exports,{testEllipseEllipse:()=>testEllipseEllipse,testEllipsePolygon:()=>testEllipsePolygon,testPolygonEllipse:()=>testPolygonEllipse,testPolygonPolygon:()=>testPolygonPolygon});var LEFT_VORNOI_REGION=-1;var MIDDLE_VORNOI_REGION=0;var RIGHT_VORNOI_REGION=1;var T_VECTORS=[];for(let v=0;v<10;v++){T_VECTORS.push(new Vector2d)}var T_ARRAYS=[];for(let a=0;a<5;a++){T_ARRAYS.push([])}function flattenPointsOn(points,normal,result){let min=Number.MAX_VALUE;let max=-Number.MAX_VALUE;const len=points.length;for(let i=0;i<len;i++){const dot=points[i].dot(normal);if(dot<min){min=dot}if(dot>max){max=dot}}result[0]=min;result[1]=max}function isSeparatingAxis(aPos,bPos,aPoints,bPoints,axis,response){const rangeA=T_ARRAYS.pop();const rangeB=T_ARRAYS.pop();const offsetV=T_VECTORS.pop().copy(bPos).sub(aPos);const projectedOffset=offsetV.dot(axis);flattenPointsOn(aPoints,axis,rangeA);flattenPointsOn(bPoints,axis,rangeB);rangeB[0]+=projectedOffset;rangeB[1]+=projectedOffset;if(rangeA[0]>rangeB[1]||rangeB[0]>rangeA[1]){T_VECTORS.push(offsetV);T_ARRAYS.push(rangeA);T_ARRAYS.push(rangeB);return true}if(response){let overlap=0;if(rangeA[0]<rangeB[0]){response.aInB=false;if(rangeA[1]<rangeB[1]){overlap=rangeA[1]-rangeB[0];response.bInA=false}else{const option1=rangeA[1]-rangeB[0];const option2=rangeB[1]-rangeA[0];overlap=option1<option2?option1:-option2}}else{response.bInA=false;if(rangeA[1]>rangeB[1]){overlap=rangeA[0]-rangeB[1];response.aInB=false}else{const option11=rangeA[1]-rangeB[0];const option22=rangeB[1]-rangeA[0];overlap=option11<option22?option11:-option22}}const absOverlap=Math.abs(overlap);if(absOverlap<response.overlap){response.overlap=absOverlap;response.overlapN.copy(axis);if(overlap<0){response.overlapN.negateSelf()}}}T_VECTORS.push(offsetV);T_ARRAYS.push(rangeA);T_ARRAYS.push(rangeB);return false}function vornoiRegion(line,point){const len2=line.length2();const dp=point.dot(line);if(dp<0){return LEFT_VORNOI_REGION}else if(dp>len2){return RIGHT_VORNOI_REGION}else{return MIDDLE_VORNOI_REGION}}function testPolygonPolygon(a,polyA,b,polyB,response){const aPoints=polyA.points;const aNormals=polyA.normals;const aLen=aNormals.length;const bPoints=polyB.points;const bNormals=polyB.normals;const bLen=bNormals.length;const posA=T_VECTORS.pop().copy(a.pos).add(a.ancestor.getAbsolutePosition()).add(polyA.pos);const posB=T_VECTORS.pop().copy(b.pos).add(b.ancestor.getAbsolutePosition()).add(polyB.pos);for(let i=0;i<aLen;i++){if(isSeparatingAxis(posA,posB,aPoints,bPoints,aNormals[i],response)){T_VECTORS.push(posA);T_VECTORS.push(posB);return false}}for(let i=0;i<bLen;i++){if(isSeparatingAxis(posA,posB,aPoints,bPoints,bNormals[i],response)){T_VECTORS.push(posA);T_VECTORS.push(posB);return false}}if(response){response.a=a;response.b=b;response.overlapV.copy(response.overlapN).scale(response.overlap)}T_VECTORS.push(posA);T_VECTORS.push(posB);return true}function testEllipseEllipse(a,ellipseA,b,ellipseB,response){const differenceV=T_VECTORS.pop().copy(b.pos).add(b.ancestor.getAbsolutePosition()).add(ellipseB.pos).sub(a.pos).add(a.ancestor.getAbsolutePosition()).sub(ellipseA.pos);const radiusA=ellipseA.radius;const radiusB=ellipseB.radius;const totalRadius=radiusA+radiusB;const totalRadiusSq=totalRadius*totalRadius;const distanceSq=differenceV.length2();if(distanceSq>totalRadiusSq){T_VECTORS.push(differenceV);return false}if(response){const dist=Math.sqrt(distanceSq);response.a=a;response.b=b;response.overlap=totalRadius-dist;response.overlapN.copy(differenceV.normalize());response.overlapV.copy(differenceV).scale(response.overlap);response.aInB=radiusA<=radiusB&&dist<=radiusB-radiusA;response.bInA=radiusB<=radiusA&&dist<=radiusA-radiusB}T_VECTORS.push(differenceV);return true}function testPolygonEllipse(a,polyA,b,ellipseB,response){const circlePos=T_VECTORS.pop().copy(b.pos).add(b.ancestor.getAbsolutePosition()).add(ellipseB.pos).sub(a.pos).add(a.ancestor.getAbsolutePosition()).sub(polyA.pos);const radius=ellipseB.radius;const radius2=radius*radius;const points=polyA.points;const edges=polyA.edges;const len=edges.length;const edge=T_VECTORS.pop();const normal=T_VECTORS.pop();const point=T_VECTORS.pop();let dist=0;for(let i=0;i<len;i++){const next=i===len-1?0:i+1;const prev=i===0?len-1:i-1;let overlap=0;let overlapN=null;edge.copy(edges[i]);point.copy(circlePos).sub(points[i]);if(response&&point.length2()>radius2){response.aInB=false}let region=vornoiRegion(edge,point);let inRegion=true;if(region===LEFT_VORNOI_REGION){let point2=null;if(len>1){edge.copy(edges[prev]);point2=T_VECTORS.pop().copy(circlePos).sub(points[prev]);region=vornoiRegion(edge,point2);if(region!==RIGHT_VORNOI_REGION){inRegion=false}}if(inRegion){dist=point.length();if(dist>radius){T_VECTORS.push(circlePos);T_VECTORS.push(edge);T_VECTORS.push(normal);T_VECTORS.push(point);if(point2){T_VECTORS.push(point2)}return false}else if(response){response.bInA=false;overlapN=point.normalize();overlap=radius-dist}}if(point2){T_VECTORS.push(point2)}}else if(region===RIGHT_VORNOI_REGION){if(len>1){edge.copy(edges[next]);point.copy(circlePos).sub(points[next]);region=vornoiRegion(edge,point);if(region!==LEFT_VORNOI_REGION){inRegion=false}}if(inRegion){dist=point.length();if(dist>radius){T_VECTORS.push(circlePos);T_VECTORS.push(edge);T_VECTORS.push(normal);T_VECTORS.push(point);return false}else if(response){response.bInA=false;overlapN=point.normalize();overlap=radius-dist}}}else{normal.copy(polyA.normals[i]);dist=point.dot(normal);const distAbs=Math.abs(dist);if((len===1||dist>0)&&distAbs>radius){T_VECTORS.push(circlePos);T_VECTORS.push(edge);T_VECTORS.push(normal);T_VECTORS.push(point);return false}else if(response){overlapN=normal;overlap=radius-dist;if(dist>=0||overlap<2*radius){response.bInA=false}}}if(overlapN&&response&&Math.abs(overlap)<Math.abs(response.overlap)){response.overlap=overlap;response.overlapN.copy(overlapN)}}if(response){response.a=a;response.b=b;response.overlapV.copy(response.overlapN).scale(response.overlap)}T_VECTORS.push(circlePos);T_VECTORS.push(edge);T_VECTORS.push(normal);T_VECTORS.push(point);return true}function testEllipsePolygon(a,ellipseA,b,polyB,response){const result=testPolygonEllipse(b,polyB,a,ellipseA,response);if(result&&response){const resa=response.a;const aInB=response.aInB;response.overlapN.negateSelf();response.overlapV.negateSelf();response.a=response.b;response.b=resa;response.aInB=response.bInA;response.bInA=aInB}return result}var ResponseObject=class{constructor(){this.a=null;this.b=null;this.overlapN=new Vector2d;this.overlapV=new Vector2d;this.aInB=true;this.bInA=true;this.indexShapeA=-1;this.indexShapeB=-1;this.overlap=Number.MAX_VALUE}clear(){this.aInB=true;this.bInA=true;this.overlap=Number.MAX_VALUE;this.indexShapeA=-1;this.indexShapeB=-1;return this}};var response_default=ResponseObject;var dummyObj={pos:new Vector2d(0,0),ancestor:{_absPos:new Vector2d(0,0),getAbsolutePosition:function(){return this._absPos}}};var boundsA=new Bounds;var boundsB=new Bounds;var Detector=class{constructor(world){this.world=world;this.response=new response_default}shouldCollide(a,b){const bodyA=a.body;const bodyB=b.body;return typeof bodyA==="object"&&typeof bodyB==="object"&&a!==b&&a.isKinematic!==true&&b.isKinematic!==true&&bodyA.shapes.length>0&&bodyB.shapes.length>0&&!(bodyA.isStatic===true&&bodyB.isStatic===true)&&(bodyA.collisionMask&bodyB.collisionType)!==0&&(bodyA.collisionType&bodyB.collisionMask)!==0}collides(bodyA,bodyB,response=this.response){for(let indexA=bodyA.shapes.length,shapeA;indexA--,shapeA=bodyA.shapes[indexA];){for(let indexB=bodyB.shapes.length,shapeB;indexB--,shapeB=bodyB.shapes[indexB];){if(sat_exports["test"+shapeA.type+shapeB.type].call(this,bodyA.ancestor,shapeA,bodyB.ancestor,shapeB,response.clear())===true){response.indexShapeA=indexA;response.indexShapeB=indexB;return true}}}return false}collisions(objA){let collisionCounter=0;const candidates=this.world.broadphase.retrieve(objA);boundsA.addBounds(objA.getBounds(),true);boundsA.addBounds(objA.body.getBounds());candidates.forEach(objB=>{if(this.shouldCollide(objA,objB)){boundsB.addBounds(objB.getBounds(),true);boundsB.addBounds(objB.body.getBounds());if(boundsA.overlaps(boundsB)){if(this.collides(objA.body,objB.body)){collisionCounter++;if(objA.onCollision&&objA.onCollision(this.response,objB)!==false&&objA.body.isStatic===false){objA.body.respondToCollision.call(objA.body,this.response)}if(objB.onCollision&&objB.onCollision(this.response,objA)!==false&&objB.body.isStatic===false){objB.body.respondToCollision.call(objB.body,this.response)}}}}});return collisionCounter>0}rayCast(line,result=[]){let collisionCounter=0;const candidates=this.world.broadphase.retrieve(line);for(let i=candidates.length,objB;i--,objB=candidates[i];){if(objB.body&&line.getBounds().overlaps(objB.getBounds())){const bLen=objB.body.shapes.length;if(objB.body.shapes.length===0){continue}const shapeA=line;let indexB=0;do{const shapeB=objB.body.getShape(indexB);if(sat_exports["test"+shapeA.type+shapeB.type].call(this,dummyObj,shapeA,objB,shapeB)){result[collisionCounter]=objB;collisionCounter++}indexB++}while(indexB<bLen)}}result.length=collisionCounter;return result}};var detector_default=Detector;var World=class extends Container{constructor(x=0,y=0,width=Infinity,height=Infinity){super(x,y,width,height,true);this.name="rootContainer";this.anchorPoint.set(0,0);this.app=void 0;this.physic="builtin";this.fps=60;this.gravity=new Vector2d(0,.98);this.preRender=false;this.bodies=new Set;this.broadphase=new QuadTree(this,this.getBounds().clone(),collision.maxChildren,collision.maxDepth);this.detector=new detector_default(this);eventEmitter.addListener(GAME_RESET,this.reset.bind(this));eventEmitter.addListener(LEVEL_LOADED,()=>{this.broadphase.clear(this.getBounds())})}reset(){this.broadphase.clear();this.anchorPoint.set(0,0);super.reset();this.bodies.clear()}addBody(body){if(this.physic==="builtin"){this.bodies.add(body)}return this}removeBody(body){if(this.physic==="builtin"){this.bodies.delete(body)}return this}bodyApplyGravity(body){if(!body.ignoreGravity&&body.gravityScale!==0){const gravity=this.gravity;body.force.x+=body.mass*gravity.x*body.gravityScale;body.force.y+=body.mass*gravity.y*body.gravityScale}}update(dt){if(this.physic==="builtin"||hasRegisteredEvents()===true){this.broadphase.clear();this.broadphase.insertContainer(this)}this.step(dt);return super.update(dt)}step(dt){if(this.physic==="builtin"){const isPaused=state_default.isPaused();this.bodies.forEach(body=>{if(!body.isStatic){const ancestor=body.ancestor;if(!(isPaused&&!ancestor.updateWhenPaused)&&(ancestor.inViewport||ancestor.alwaysUpdate)){this.bodyApplyGravity(body);if(body.update(dt)===true){ancestor.isDirty=true}this.detector.collisions(ancestor);body.force.set(0,0)}}})}eventEmitter.emit(WORLD_STEP,dt)}};var ParticleEmitterSettings={width:1,height:1,image:void 0,textureSize:8,tint:"#fff",totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:false,textureAdditive:false,blendMode:"normal",onlyInViewport:true,floating:false,maxParticles:10,frequency:100,duration:Infinity,framesToSkip:0};var settings_default=ParticleEmitterSettings;function createDefaultParticleTexture(w=8,h=8){const defaultParticleTexture=new canvasrendertarget_default(w,h,{offscreenCanvas:true});defaultParticleTexture.context.fillStyle="#fff";defaultParticleTexture.context.fillRect(0,0,w,h);return defaultParticleTexture}var ParticleEmitter=class extends Container{constructor(x,y,settings={}){super(x,y,settings.width|1,settings.height|1);this.settings={};this.centerOn(x,y);this._stream=false;this._frequencyTimer=0;this._durationTimer=0;this._enabled=false;this.alwaysUpdate=true;this.autoSort=false;this._updateCount=0;this._dt=0;this.reset(settings)}reset(settings={}){Object.assign(this.settings,settings_default,settings);if(typeof this.settings.image==="undefined"){this._defaultParticle=createDefaultParticleTexture(settings.textureSize,settings.textureSize);this.settings.image=this._defaultParticle.canvas}this.floating=this.settings.floating;this.isDirty=true}getRandomPointX(){return randomFloat(0,this.getBounds().width)}getRandomPointY(){return randomFloat(0,this.getBounds().height)}addParticles(count){for(let i=0;i<count;i++){this.addChild(particlePool.get(this),this.pos.z)}this.isDirty=true}isRunning(){return this._enabled&&this._stream}streamParticles(duration){this._enabled=true;this._stream=true;this.settings.frequency=Math.max(1,this.settings.frequency);this._durationTimer=typeof duration==="number"?duration:this.settings.duration}stopStream(){this._enabled=false}burstParticles(total){this._enabled=true;this._stream=false;this.addParticles(typeof total==="number"?total:this.settings.totalParticles);this._enabled=false}update(dt){if(++this._updateCount>this.settings.framesToSkip){this._updateCount=0}if(this._updateCount>0){this._dt+=dt;return this.isDirty}dt+=this._dt;this._dt=0;this.isDirty|=super.update(dt);if(this._enabled&&this._stream){if(this._durationTimer!==Infinity){this._durationTimer-=dt;if(this._durationTimer<=0){this.stopStream();return this.isDirty}}this._frequencyTimer+=dt;const particlesCount=this.children.length;if(particlesCount<this.settings.totalParticles&&this._frequencyTimer>=this.settings.frequency){if(particlesCount+this.settings.maxParticles<=this.settings.totalParticles){this.addParticles(this.settings.maxParticles)}else{this.addParticles(this.settings.totalParticles-particlesCount)}this._frequencyTimer=0;this.isDirty=true}}return this.isDirty}destroy(){super.destroy(arguments);if(typeof this._defaultParticle!=="undefined"){this._defaultParticle.destroy();this._defaultParticle=void 0}this.settings.image=void 0;this.settings=void 0}};var Entity=class extends Renderable{constructor(x,y,settings){super(x,y,settings.width,settings.height);this.children=[];if(settings.image){settings.framewidth=settings.framewidth||settings.width;settings.frameheight=settings.frameheight||settings.height;this.renderable=new Sprite(0,0,settings)}if(settings.anchorPoint){this.anchorPoint.setMuted(settings.anchorPoint.x,settings.anchorPoint.y)}else{this.anchorPoint.setMuted(0,0)}if(typeof settings.name==="string"){this.name=settings.name}this.type=settings.type||"";this.id=settings.id||"";this.alive=true;if(typeof settings.shapes==="undefined"){settings.shapes=polygonPool.get(0,0,[vector2dPool.get(0,0),vector2dPool.get(this.width,0),vector2dPool.get(this.width,this.height),vector2dPool.get(0,this.height)])}this.body=new Body(this,settings.shapes,()=>{return this.onBodyUpdate()});if(this.width===0&&this.height===0){this.resize(this.body.getBounds().width,this.body.getBounds().height)}this.body.setCollisionMask(settings.collisionMask);this.body.setCollisionType(settings.collisionType);this.autoTransform=false}get renderable(){return this.children[0]}set renderable(value){if(value instanceof Renderable){this.children[0]=value;this.children[0].ancestor=this;this.updateBounds()}else{throw new Error(value+"should extend me.Renderable")}}update(dt){if(this.renderable){this.isDirty|=this.renderable.update(dt)}return super.update(dt)}updateBounds(absolute=true){const bounds=this.getBounds();bounds.clear();bounds.addFrame(0,0,this.width,this.height);if(this.children&&this.children.length>0){bounds.addBounds(this.children[0].getBounds())}if(this.body){bounds.addBounds(this.body.getBounds())}if(absolute===true){const absPos=this.getAbsolutePosition();bounds.centerOn(absPos.x+bounds.x+bounds.width/2,absPos.y+bounds.y+bounds.height/2)}return bounds}onBodyUpdate(){this.updateBounds()}preDraw(renderer2){renderer2.save();renderer2.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y);if(this.renderable instanceof Renderable){renderer2.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)}}draw(renderer2,viewport){const renderable=this.renderable;if(renderable instanceof Renderable){renderable.preDraw(renderer2);renderable.draw(renderer2,viewport);renderable.postDraw(renderer2)}}destroy(){if(this.renderable){this.renderable.destroy.apply(this.renderable,arguments);this.children.splice(0,1)}super.destroy(arguments)}onDeactivateEvent(){if(this.renderable&&this.renderable.onDeactivateEvent){this.renderable.onDeactivateEvent()}}};function autoDetectRenderer(options){try{if(isWebGLSupported(options)){return new WebGLRenderer(options)}}catch(e){console.log("Error creating WebGL renderer :"+e.message)}return new CanvasRenderer(options)}function scale(game2,x,y){let renderer2=game2.renderer;let canvas=renderer2.getCanvas();let context=renderer2.getContext();let settings=renderer2.settings;let pixelRatio=devicePixelRatio;let w=settings.zoomX=canvas.width*x*pixelRatio;let h=settings.zoomY=canvas.height*y*pixelRatio;renderer2.scaleRatio.set(x*pixelRatio,y*pixelRatio);canvas.style.width=w/pixelRatio+"px";canvas.style.height=h/pixelRatio+"px";renderer2.setAntiAlias(context,settings.antiAlias);renderer2.setBlendMode(settings.blendMode,context);game2.repaint()}function onresize(game2){let renderer2=game2.renderer;let settings=renderer2.settings;let scaleX=settings.scale,scaleY=settings.scale;let nodeBounds;if(settings.autoScale){let canvasMaxWidth=Infinity;let canvasMaxHeight=Infinity;if(globalThis.getComputedStyle){let style=globalThis.getComputedStyle(renderer2.getCanvas(),null);canvasMaxWidth=parseInt(style.maxWidth,10)||Infinity;canvasMaxHeight=parseInt(style.maxHeight,10)||Infinity}if(typeof game2.settings.scaleTarget!=="undefined"){nodeBounds=getElementBounds(game2.settings.scaleTarget)}else{nodeBounds=getParentBounds(game2.getParentElement())}let _max_width=Math.min(canvasMaxWidth,nodeBounds.width);let _max_height=Math.min(canvasMaxHeight,nodeBounds.height);let screenRatio=_max_width/_max_height;if(settings.scaleMethod==="fill-min"&&screenRatio>renderer2.designRatio||settings.scaleMethod==="fill-max"&&screenRatio<renderer2.designRatio||settings.scaleMethod==="flex-width"){let sWidth=Math.min(canvasMaxWidth,settings.height*screenRatio);scaleX=scaleY=_max_width/sWidth;renderer2.resize(Math.floor(sWidth),settings.height)}else if(settings.scaleMethod==="fill-min"&&screenRatio<renderer2.designRatio||settings.scaleMethod==="fill-max"&&screenRatio>renderer2.designRatio||settings.scaleMethod==="flex-height"){let sHeight=Math.min(canvasMaxHeight,settings.width*(_max_height/_max_width));scaleX=scaleY=_max_height/sHeight;renderer2.resize(settings.width,Math.floor(sHeight))}else if(settings.scaleMethod==="flex"){renderer2.resize(Math.floor(_max_width),Math.floor(_max_height))}else if(settings.scaleMethod==="stretch"){scaleX=_max_width/settings.width;scaleY=_max_height/settings.height}else{if(screenRatio<renderer2.designRatio){scaleX=scaleY=_max_width/settings.width}else{scaleX=scaleY=_max_height/settings.height}}}scale(game2,scaleX,scaleY)}function consoleHeader(app){let renderType=app.renderer.type;let gpu_renderer=typeof app.renderer.GPURenderer==="string"?" ("+app.renderer.GPURenderer+")":"";let depthTesting=renderType.includes("WebGL")&&app.renderer.depthTest==="z-buffer"?"Depth Test | ":"";let audioType=hasWebAudio?"Web Audio":"HTML5 Audio";console.log(renderType+" renderer"+gpu_renderer+" | "+depthTesting+audioType+" | pixel ratio "+devicePixelRatio+" | "+(platform.nodeJS?"node.js":platform.isMobile?"mobile":"desktop")+" | "+getScreenOrientation()+" | "+language);console.log("resolution: requested "+app.settings.width+"x"+app.settings.height+", got "+app.renderer.width+"x"+app.renderer.height)}var Application=class{constructor(width,height,options){this.parentElement=void 0;this.renderer=void 0;this.viewport=void 0;this.world=void 0;this.mergeGroup=true;this.lastUpdate=0;this.isInitialized=false;this.settings=void 0;this.pauseOnBlur=true;this.resumeOnFocus=true;this.stopOnBlur=false;this.isDirty=true;this.isAlwaysDirty=false;this.frameCounter=0;this.frameRate=1;this.accumulator=0;this.accumulatorMax=0;this.accumulatorUpdateDelta=0;this.stepSize=1e3/60;this.updateDelta=0;this.lastUpdateStart=null;this.updateAverageDelta=0;if(options.legacy!==true){this.init(width,height,options)}}init(width,height,options){this.settings=Object.assign(defaultApplicationSettings,options||{});this.settings.width=width;this.settings.height=height;this.settings.transparent=!!this.settings.transparent;this.settings.antiAlias=!!this.settings.antiAlias;this.settings.failIfMajorPerformanceCaveat=!!this.settings.failIfMajorPerformanceCaveat;this.settings.depthTest=this.settings.depthTest==="z-buffer"?"z-buffer":"sorting";this.settings.subPixel=!!this.settings.subPixel;this.settings.verbose=!!this.settings.verbose;if(this.settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)!==-1){this.settings.autoScale=this.settings.scale==="auto"||true}else{this.settings.scaleMethod=ScaleMethods.Fit;this.settings.autoScale=this.settings.scale==="auto"||false}let uriFragment=getUriFragment();if(uriFragment.webgl===true||uriFragment.webgl1===true||uriFragment.webgl2===true){this.settings.renderer=WEBGL;if(uriFragment.webgl1===true){this.settings.preferWebGL1=true}}else if(uriFragment.canvas===true){this.settings.renderer=CANVAS}this.settings.scale=this.settings.autoScale?1:+this.settings.scale||1;this.settings.zoomX=width*this.settings.scale;this.settings.zoomY=height*this.settings.scale;this.parentElement=getElement(this.settings.parent);if(typeof this.settings.scaleTarget!=="undefined"){this.settings.scaleTarget=getElement(this.settings.scaleTarget)}if(typeof this.settings.renderer==="number"){switch(this.settings.renderer){case AUTO:case WEBGL:this.renderer=autoDetectRenderer(this.settings);break;default:this.renderer=new CanvasRenderer(this.settings);break}}else{let CustomRenderer=this.settings.renderer;this.renderer=new CustomRenderer(this.settings)}eventEmitter.addListener(WINDOW_ONRESIZE,()=>{return onresize(this)});eventEmitter.addListener(WINDOW_ONORIENTATION_CHANGE,()=>{return onresize(this)});this.parentElement.appendChild(this.renderer.getCanvas());if(platform.isMobile){enableSwipe(false)}onresize(this);if("MutationObserver"in globalThis){let observer=new MutationObserver(()=>{return onresize(this)});observer.observe(this.parentElement,{attributes:false,childList:true,subtree:true})}if(this.settings.consoleHeader!==false){consoleHeader(this)}this.world=new World(0,0,this.settings.width,this.settings.height);this.world.app=this;this.world.physic=this.settings.physic;this.lastUpdate=globalThis.performance.now();this.world.autoSort=!(this.renderer.type==="WEBGL"&&this.settings.depthTest==="z-buffer");this.isInitialized=true;eventEmitter.emit(GAME_INIT);eventEmitter.addListener(STATE_CHANGE,this.repaint.bind(this));eventEmitter.addListener(STATE_RESTART,this.repaint.bind(this));eventEmitter.addListener(STATE_RESUME,this.repaint.bind(this));eventEmitter.addListener(STAGE_RESET,this.reset.bind(this));eventEmitter.addListener(TICK,time=>{this.update(time);this.draw()});eventEmitter.addListener(BLUR,()=>{if(this.stopOnBlur===true){state_default.stop(true)}if(this.pauseOnBlur===true){state_default.pause(true)}});eventEmitter.addListener(FOCUS,()=>{if(this.stopOnBlur===true){state_default.restart(true)}if(this.resumeOnFocus===true){state_default.resume(true)}})}reset(){let current=state_default.get();if(typeof current!=="undefined"){this.viewport=current.cameras.get("default")}eventEmitter.emit(GAME_RESET);this.updateFrameRate()}get sortOn(){return this.world.sortOn}set sortOn(value){this.world.sortOn=value}onLevelLoaded(){}updateFrameRate(){this.frameCounter=0;this.frameRate=~~(.5+60/timer_default.maxfps);this.stepSize=1e3/this.world.fps;this.accumulator=0;this.accumulatorMax=this.stepSize*10;this.isAlwaysDirty=timer_default.maxfps>this.world.fps}getParentElement(){return this.parentElement}repaint(){this.isDirty=true}update(time){if(++this.frameCounter%this.frameRate===0){this.frameCounter=0;eventEmitter.emit(GAME_BEFORE_UPDATE,time);this.accumulator+=timer_default.getDelta();this.accumulator=Math.min(this.accumulator,this.accumulatorMax);this.updateDelta=timer_default.interpolation?timer_default.getDelta():this.stepSize;this.accumulatorUpdateDelta=timer_default.interpolation?this.updateDelta:Math.max(this.updateDelta,this.updateAverageDelta);while(this.accumulator>=this.accumulatorUpdateDelta||timer_default.interpolation){this.lastUpdateStart=globalThis.performance.now();if(state_default.isPaused()!==true){eventEmitter.emit(GAME_UPDATE,time)}this.isDirty=this.world.update(this.updateDelta);this.isDirty=state_default.current().update(this.updateDelta)||this.isDirty;this.lastUpdate=globalThis.performance.now();this.updateAverageDelta=this.lastUpdate-this.lastUpdateStart;this.accumulator-=this.accumulatorUpdateDelta;if(timer_default.interpolation){this.accumulator=0;break}}eventEmitter.emit(GAME_AFTER_UPDATE,this.lastUpdate)}}draw(){if(this.renderer.isContextValid===true&&(this.isDirty||this.isAlwaysDirty)){eventEmitter.emit(GAME_BEFORE_DRAW,globalThis.performance.now());this.renderer.clear();state_default.current().draw(this.renderer,this.world);this.isDirty=false;this.renderer.flush();eventEmitter.emit(GAME_AFTER_DRAW,globalThis.performance.now())}}};var plugin_exports={};__export(plugin_exports,{BasePlugin:()=>BasePlugin,cache:()=>cache,get:()=>get,patch:()=>patch,register:()=>register});var version="18.0.0";var cache={};var BasePlugin=class{constructor(app=game){this.version=version;this.app=app}};function patch(proto,name,fn){if(typeof proto.prototype!=="undefined"){proto=proto.prototype}if(typeof proto[name]==="function"){const _parent=proto[name];Object.defineProperty(proto,name,{configurable:true,value:function(name2,fn2){return function(){this._patched=_parent;const ret=fn2.apply(this,arguments);this._patched=null;return ret}}(name,fn)})}else{throw new Error(name+" is not an existing function")}}function register(plugin,name=plugin.toString().match(/ (\w+)/)[1]){if(cache[name]){throw new Error("plugin "+name+" already registered")}let _args=[];if(arguments.length>2){_args=Array.prototype.slice.call(arguments,1)}_args[0]=plugin;const instance=new(plugin.bind.apply(plugin,_args));if(typeof instance==="undefined"||!(instance instanceof BasePlugin)){throw new Error("Plugin should extend the BasePlugin Class !")}if(checkVersion(instance.version,version)>0){throw new Error("Plugin version mismatch, expected: "+instance.version+", got: "+version)}cache[name]=instance}function get(classType){for(const name in cache){if(typeof classType==="string"&&classType===name||cache[name]instanceof classType){return cache[name]}}}var propertiesToObserve2=["x","y"];var setOfProperties2=new Set(propertiesToObserve2);var isObservableProperty2=property=>{return setOfProperties2.has(property)};var ObservableVector2d=class{constructor(x=0,y=0,callback){this.callBackEnabled=true;const{proxy,revoke}=Proxy.revocable(new Vector2d(x,y),{set:(target,property,value)=>{if(isObservableProperty2(property)){Reflect.set(target,property,value);if(this.callBackEnabled){this._callback?.()}return true}return false}});this._revoke=revoke;this._vector2d=proxy;if(callback){this.setCallback(callback)}}set(x=0,y=0){this.callBackEnabled=false;this._vector2d.x=x;this._vector2d.y=y;this._callback?.();this.callBackEnabled=true;return this}setMuted(x=0,y=0){this.callBackEnabled=false;this._vector2d.x=x;this._vector2d.y=y;this.callBackEnabled=true;return this}get x(){return this._vector2d.x}set x(value){this._vector2d.x=value}get y(){return this._vector2d.y}set y(value){this._vector2d.y=value}setCallback(callback){this._callback=callback}setZero(){return this.set(0,0)}setV(v){return this.set(v.x,v.y)}add(v){return this.set(this.x+v.x,this.y+v.y)}sub(v){return this.set(this.x-v.x,this.y-v.y)}scale(x,y=x){return this.set(this.x*x,this.y*y)}toIso(){return this.set(this.x-this.y,(this.x+this.y)*.5)}to2d(){return this.set(this.y+this.x/2,this.y-this.x/2)}scaleV(v){return this.set(this.x*v.x,this.y*v.y)}div(n){return this.set(this.x/n,this.y/n)}abs(){return this.set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(low,high){return this._vector2d.clamp(low,high)}clampSelf(low,high){return this._vector2d.clampSelf(low,high)}minV(v){return this.set(this.x<v.x?this.x:v.x,this.y<v.y?this.y:v.y)}maxV(v){return this.set(this.x>v.x?this.x:v.x,this.y>v.y?this.y:v.y)}floor(){return this._vector2d.floor()}floorSelf(){return this._vector2d.floorSelf()}ceil(){return this._vector2d.ceil()}ceilSelf(){return this._vector2d.ceilSelf()}negate(){return this._vector2d.negate()}negateSelf(){return this._vector2d.negateSelf()}copy(v){return this.set(v.x,v.y)}equals(...args){if(args.length===2){return this.x===args[0]&&this.y===args[1]}return this.x===args[0].x&&this.y===args[0].y}normalize(){return this.div(this.length()||1)}perp(){return this.set(this.y,-this.x)}rotate(angle,v){let cx=0;let cy=0;if(v){cx=v.x;cy=v.y}const x=this.x-cx;const y=this.y-cy;const c=Math.cos(angle);const s=Math.sin(angle);return this.set(x*c-y*s+cx,x*s+y*c+cy)}dot(v){return this._vector2d.dot(v)}cross(v){return this._vector2d.cross(v)}length2(){return this._vector2d.length2()}length(){return this._vector2d.length()}lerp(v,alpha2){this.set(this.x+alpha2*(v.x-this.x),this.y+alpha2*(v.y-this.y));return this}moveTowards(target,step){const angle=Math.atan2(target.y-this.y,target.x-this.x);const distance=this.distance(target);if(distance===0||step>=0&&distance<=step*step){return target}this.set(this.x+Math.cos(angle)*step,this.y+Math.sin(angle)*step);return this}distance(v){return this._vector2d.distance(v)}angle(v){return this._vector2d.angle(v)}project(v){return this.scale(this.dot(v)/v.length2())}projectN(v){return this.scale(this.dot(v))}clone(cb){return observableVector2dPool.get(this.x,this.y,cb)}toString(){return this._vector2d.toString()}revoke(){this._revoke()}};var observableVector2dPool=createPool((x,y,cb)=>{const vector=new ObservableVector2d(x,y,cb);return{instance:vector,reset(x2=0,y2=0,cb2){vector.setMuted(x2,y2);if(cb2){vector.setCallback(cb2)}}}});var CanvasTexture=class extends canvasrendertarget_default{constructor(width,height,attributes){warning("CanvasTexture","CanvasRenderTarget","17.1.0");super(width,height,attributes)}};CanvasRenderer.prototype.setLineWidth=function(width){warning("setLineWidth","lineWidth","17.3.0");this.lineWidth=width};WebGLRenderer.prototype.setLineWidth=function(width){warning("setLineWidth","lineWidth","17.3.0");this.lineWidth=width};var initialized=false;var skipAutoInit=false;var game=new Application(0,0,{legacy:true});function boot(){if(initialized===true){return}if(!("__vitest_browser__"in window)){console.log("melonJS 2 (v"+version+") | http://melonjs.org")}legacy_pool_default.register("me.Entity",Entity);legacy_pool_default.register("me.Collectable",Collectable);legacy_pool_default.register("me.Trigger",Trigger);legacy_pool_default.register("me.Light2d",Light2d);legacy_pool_default.register("me.Particle",Particle,true);legacy_pool_default.register("me.Sprite",Sprite);legacy_pool_default.register("me.NineSliceSprite",NineSliceSprite);legacy_pool_default.register("me.Renderable",Renderable);legacy_pool_default.register("me.Text",Text,true);legacy_pool_default.register("me.BitmapText",BitmapText);legacy_pool_default.register("me.ImageLayer",ImageLayer);legacy_pool_default.register("me.Tween",Tween);legacy_pool_default.register("me.ColorLayer",ColorLayer,true);legacy_pool_default.register("Entity",Entity);legacy_pool_default.register("Collectable",Collectable);legacy_pool_default.register("Trigger",Trigger);legacy_pool_default.register("Light2d",Light2d);legacy_pool_default.register("Tween",Tween,true);legacy_pool_default.register("Particle",Particle,true);legacy_pool_default.register("Sprite",Sprite);legacy_pool_default.register("NineSliceSprite",NineSliceSprite);legacy_pool_default.register("Renderable",Renderable);legacy_pool_default.register("Text",Text,true);legacy_pool_default.register("BitmapText",BitmapText);legacy_pool_default.register("ImageLayer",ImageLayer);legacy_pool_default.register("Tween",Tween);legacy_pool_default.register("ColorLayer",ColorLayer,true);eventEmitter.emit(BOOT);setNocache(getUriFragment().nocache||false);initKeyboardEvent();initialized=true;if(skipAutoInit===true){eventEmitter.emit(DOM_READY)}}onReady(()=>{if(skipAutoInit===false){boot()}});export{AUTO,Application,BitmapText,BitmapTextData,Body,Bounds,CANVAS,Camera2d,canvasrendertarget_default as CanvasRenderTarget,CanvasRenderer,CanvasTexture,Collectable,Color,ColorLayer,Compositor,Container,Draggable,DropTarget,Ellipse,Entity,GLShader,ImageLayer,Light2d,Line,math_exports as Math,Matrix2d,Matrix3d,NineSliceSprite,ObservablePoint,ObservableVector2d,ObservableVector3d,Particle,ParticleEmitter,settings_default as ParticleEmitterSettings,Point,pointer_default as Pointer,Polygon,PrimitiveCompositor,QuadCompositor,QuadTree,Rect,Renderable,Renderer,RoundRect,ScaleMethods,Sprite,Stage,TMXHexagonalRenderer,TMXIsometricRenderer,TMXLayer,TMXOrthogonalRenderer,TMXRenderer,TMXStaggeredRenderer,TMXTileMap,TMXTileset,TMXTilesetGroup,TMXUtils_exports as TMXUtils,Text,TextureAtlas,Tile,Trigger,Tween,UIBaseElement,UISpriteElement,UITextButton,Vector2d,Vector3d,WEBGL,WebGLRenderer,World,audio_exports as audio,boot,collision,device_exports as device,event_exports as event,game,getPool,initialized,input_exports as input,level,loader_exports as loader,math_exports as math,plugin_exports as plugin,cache as plugins,legacy_pool_default as pool,save_default as save,skipAutoInit,state_default as state,timer_default as timer,utils_exports as utils,version,video_exports as video};